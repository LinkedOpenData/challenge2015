!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):window.jQuery||window.Zepto)}(function(a){var b,c,d,e,f,g,h="Close",i="BeforeClose",j="AfterClose",k="BeforeAppend",l="MarkupParse",m="Open",n="Change",o="mfp",p="."+o,q="mfp-ready",r="mfp-removing",s="mfp-prevent-close",t=function(){},u=!!window.jQuery,v=a(window),w=function(a,c){b.ev.on(o+a+p,c)},x=function(b,c,d,e){var f=document.createElement("div");return f.className="mfp-"+b,d&&(f.innerHTML=d),e?c&&c.appendChild(f):(f=a(f),c&&f.appendTo(c)),f},y=function(c,d){b.ev.triggerHandler(o+c,d),b.st.callbacks&&(c=c.charAt(0).toLowerCase()+c.slice(1),b.st.callbacks[c]&&b.st.callbacks[c].apply(b,a.isArray(d)?d:[d]))},z=function(c){return c===g&&b.currTemplate.closeBtn||(b.currTemplate.closeBtn=a(b.st.closeMarkup.replace("%title%",b.st.tClose)),g=c),b.currTemplate.closeBtn},A=function(){a.magnificPopup.instance||(b=new t,b.init(),a.magnificPopup.instance=b)},B=function(){var a=document.createElement("p").style,b=["ms","O","Moz","Webkit"];if(void 0!==a.transition)return!0;for(;b.length;)if(b.pop()+"Transition"in a)return!0;return!1};t.prototype={constructor:t,init:function(){var c=navigator.appVersion;b.isIE7=-1!==c.indexOf("MSIE 7."),b.isIE8=-1!==c.indexOf("MSIE 8."),b.isLowIE=b.isIE7||b.isIE8,b.isAndroid=/android/gi.test(c),b.isIOS=/iphone|ipad|ipod/gi.test(c),b.supportsTransition=B(),b.probablyMobile=b.isAndroid||b.isIOS||/(Opera Mini)|Kindle|webOS|BlackBerry|(Opera Mobi)|(Windows Phone)|IEMobile/i.test(navigator.userAgent),d=a(document),b.popupsCache={}},open:function(c){var e;if(c.isObj===!1){b.items=c.items.toArray(),b.index=0;var g,h=c.items;for(e=0;e<h.length;e++)if(g=h[e],g.parsed&&(g=g.el[0]),g===c.el[0]){b.index=e;break}}else b.items=a.isArray(c.items)?c.items:[c.items],b.index=c.index||0;if(b.isOpen)return void b.updateItemHTML();b.types=[],f="",c.mainEl&&c.mainEl.length?b.ev=c.mainEl.eq(0):b.ev=d,c.key?(b.popupsCache[c.key]||(b.popupsCache[c.key]={}),b.currTemplate=b.popupsCache[c.key]):b.currTemplate={},b.st=a.extend(!0,{},a.magnificPopup.defaults,c),b.fixedContentPos="auto"===b.st.fixedContentPos?!b.probablyMobile:b.st.fixedContentPos,b.st.modal&&(b.st.closeOnContentClick=!1,b.st.closeOnBgClick=!1,b.st.showCloseBtn=!1,b.st.enableEscapeKey=!1),b.bgOverlay||(b.bgOverlay=x("bg").on("click"+p,function(){b.close()}),b.wrap=x("wrap").attr("tabindex",-1).on("click"+p,function(a){b._checkIfClose(a.target)&&b.close()}),b.container=x("container",b.wrap)),b.contentContainer=x("content"),b.st.preloader&&(b.preloader=x("preloader",b.container,b.st.tLoading));var i=a.magnificPopup.modules;for(e=0;e<i.length;e++){var j=i[e];j=j.charAt(0).toUpperCase()+j.slice(1),b["init"+j].call(b)}y("BeforeOpen"),b.st.showCloseBtn&&(b.st.closeBtnInside?(w(l,function(a,b,c,d){c.close_replaceWith=z(d.type)}),f+=" mfp-close-btn-in"):b.wrap.append(z())),b.st.alignTop&&(f+=" mfp-align-top"),b.fixedContentPos?b.wrap.css({overflow:b.st.overflowY,overflowX:"hidden",overflowY:b.st.overflowY}):b.wrap.css({top:v.scrollTop(),position:"absolute"}),(b.st.fixedBgPos===!1||"auto"===b.st.fixedBgPos&&!b.fixedContentPos)&&b.bgOverlay.css({height:d.height(),position:"absolute"}),b.st.enableEscapeKey&&d.on("keyup"+p,function(a){27===a.keyCode&&b.close()}),v.on("resize"+p,function(){b.updateSize()}),b.st.closeOnContentClick||(f+=" mfp-auto-cursor"),f&&b.wrap.addClass(f);var k=b.wH=v.height(),n={};if(b.fixedContentPos&&b._hasScrollBar(k)){var o=b._getScrollbarSize();o&&(n.marginRight=o)}b.fixedContentPos&&(b.isIE7?a("body, html").css("overflow","hidden"):n.overflow="hidden");var r=b.st.mainClass;return b.isIE7&&(r+=" mfp-ie7"),r&&b._addClassToMFP(r),b.updateItemHTML(),y("BuildControls"),a("html").css(n),b.bgOverlay.add(b.wrap).prependTo(b.st.prependTo||a(document.body)),b._lastFocusedEl=document.activeElement,setTimeout(function(){b.content?(b._addClassToMFP(q),b._setFocus()):b.bgOverlay.addClass(q),d.on("focusin"+p,b._onFocusIn)},16),b.isOpen=!0,b.updateSize(k),y(m),c},close:function(){b.isOpen&&(y(i),b.isOpen=!1,b.st.removalDelay&&!b.isLowIE&&b.supportsTransition?(b._addClassToMFP(r),setTimeout(function(){b._close()},b.st.removalDelay)):b._close())},_close:function(){y(h);var c=r+" "+q+" ";if(b.bgOverlay.detach(),b.wrap.detach(),b.container.empty(),b.st.mainClass&&(c+=b.st.mainClass+" "),b._removeClassFromMFP(c),b.fixedContentPos){var e={marginRight:""};b.isIE7?a("body, html").css("overflow",""):e.overflow="",a("html").css(e)}d.off("keyup"+p+" focusin"+p),b.ev.off(p),b.wrap.attr("class","mfp-wrap").removeAttr("style"),b.bgOverlay.attr("class","mfp-bg"),b.container.attr("class","mfp-container"),!b.st.showCloseBtn||b.st.closeBtnInside&&b.currTemplate[b.currItem.type]!==!0||b.currTemplate.closeBtn&&b.currTemplate.closeBtn.detach(),b._lastFocusedEl&&a(b._lastFocusedEl).focus(),b.currItem=null,b.content=null,b.currTemplate=null,b.prevHeight=0,y(j)},updateSize:function(a){if(b.isIOS){var c=document.documentElement.clientWidth/window.innerWidth,d=window.innerHeight*c;b.wrap.css("height",d),b.wH=d}else b.wH=a||v.height();b.fixedContentPos||b.wrap.css("height",b.wH),y("Resize")},updateItemHTML:function(){var c=b.items[b.index];b.contentContainer.detach(),b.content&&b.content.detach(),c.parsed||(c=b.parseEl(b.index));var d=c.type;if(y("BeforeChange",[b.currItem?b.currItem.type:"",d]),b.currItem=c,!b.currTemplate[d]){var f=b.st[d]?b.st[d].markup:!1;y("FirstMarkupParse",f),f?b.currTemplate[d]=a(f):b.currTemplate[d]=!0}e&&e!==c.type&&b.container.removeClass("mfp-"+e+"-holder");var g=b["get"+d.charAt(0).toUpperCase()+d.slice(1)](c,b.currTemplate[d]);b.appendContent(g,d),c.preloaded=!0,y(n,c),e=c.type,b.container.prepend(b.contentContainer),y("AfterChange")},appendContent:function(a,c){b.content=a,a?b.st.showCloseBtn&&b.st.closeBtnInside&&b.currTemplate[c]===!0?b.content.find(".mfp-close").length||b.content.append(z()):b.content=a:b.content="",y(k),b.container.addClass("mfp-"+c+"-holder"),b.contentContainer.append(b.content)},parseEl:function(c){var d,e=b.items[c];if(e.tagName?e={el:a(e)}:(d=e.type,e={data:e,src:e.src}),e.el){for(var f=b.types,g=0;g<f.length;g++)if(e.el.hasClass("mfp-"+f[g])){d=f[g];break}e.src=e.el.attr("data-mfp-src"),e.src||(e.src=e.el.attr("href"))}return e.type=d||b.st.type||"inline",e.index=c,e.parsed=!0,b.items[c]=e,y("ElementParse",e),b.items[c]},addGroup:function(a,c){var d=function(d){d.mfpEl=this,b._openClick(d,a,c)};c||(c={});var e="click.magnificPopup";c.mainEl=a,c.items?(c.isObj=!0,a.off(e).on(e,d)):(c.isObj=!1,c.delegate?a.off(e).on(e,c.delegate,d):(c.items=a,a.off(e).on(e,d)))},_openClick:function(c,d,e){var f=void 0!==e.midClick?e.midClick:a.magnificPopup.defaults.midClick;if(f||2!==c.which&&!c.ctrlKey&&!c.metaKey){var g=void 0!==e.disableOn?e.disableOn:a.magnificPopup.defaults.disableOn;if(g)if(a.isFunction(g)){if(!g.call(b))return!0}else if(v.width()<g)return!0;c.type&&(c.preventDefault(),b.isOpen&&c.stopPropagation()),e.el=a(c.mfpEl),e.delegate&&(e.items=d.find(e.delegate)),b.open(e)}},updateStatus:function(a,d){if(b.preloader){c!==a&&b.container.removeClass("mfp-s-"+c),d||"loading"!==a||(d=b.st.tLoading);var e={status:a,text:d};y("UpdateStatus",e),a=e.status,d=e.text,b.preloader.html(d),b.preloader.find("a").on("click",function(a){a.stopImmediatePropagation()}),b.container.addClass("mfp-s-"+a),c=a}},_checkIfClose:function(c){if(!a(c).hasClass(s)){var d=b.st.closeOnContentClick,e=b.st.closeOnBgClick;if(d&&e)return!0;if(!b.content||a(c).hasClass("mfp-close")||b.preloader&&c===b.preloader[0])return!0;if(c===b.content[0]||a.contains(b.content[0],c)){if(d)return!0}else if(e&&a.contains(document,c))return!0;return!1}},_addClassToMFP:function(a){b.bgOverlay.addClass(a),b.wrap.addClass(a)},_removeClassFromMFP:function(a){this.bgOverlay.removeClass(a),b.wrap.removeClass(a)},_hasScrollBar:function(a){return(b.isIE7?d.height():document.body.scrollHeight)>(a||v.height())},_setFocus:function(){(b.st.focus?b.content.find(b.st.focus).eq(0):b.wrap).focus()},_onFocusIn:function(c){return c.target===b.wrap[0]||a.contains(b.wrap[0],c.target)?void 0:(b._setFocus(),!1)},_parseMarkup:function(b,c,d){var e;d.data&&(c=a.extend(d.data,c)),y(l,[b,c,d]),a.each(c,function(a,c){if(void 0===c||c===!1)return!0;if(e=a.split("_"),e.length>1){var d=b.find(p+"-"+e[0]);if(d.length>0){var f=e[1];"replaceWith"===f?d[0]!==c[0]&&d.replaceWith(c):"img"===f?d.is("img")?d.attr("src",c):d.replaceWith('<img src="'+c+'" class="'+d.attr("class")+'" />'):d.attr(e[1],c)}}else b.find(p+"-"+a).html(c)})},_getScrollbarSize:function(){if(void 0===b.scrollbarSize){var a=document.createElement("div");a.style.cssText="width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;",document.body.appendChild(a),b.scrollbarSize=a.offsetWidth-a.clientWidth,document.body.removeChild(a)}return b.scrollbarSize}},a.magnificPopup={instance:null,proto:t.prototype,modules:[],open:function(b,c){return A(),b=b?a.extend(!0,{},b):{},b.isObj=!0,b.index=c||0,this.instance.open(b)},close:function(){return a.magnificPopup.instance&&a.magnificPopup.instance.close()},registerModule:function(b,c){c.options&&(a.magnificPopup.defaults[b]=c.options),a.extend(this.proto,c.proto),this.modules.push(b)},defaults:{disableOn:0,key:null,midClick:!1,mainClass:"",preloader:!0,focus:"",closeOnContentClick:!1,closeOnBgClick:!0,closeBtnInside:!0,showCloseBtn:!0,enableEscapeKey:!0,modal:!1,alignTop:!1,removalDelay:0,prependTo:null,fixedContentPos:"auto",fixedBgPos:"auto",overflowY:"auto",closeMarkup:'<button title="%title%" type="button" class="mfp-close">&times;</button>',tClose:"Close (Esc)",tLoading:"Loading..."}},a.fn.magnificPopup=function(c){A();var d=a(this);if("string"==typeof c)if("open"===c){var e,f=u?d.data("magnificPopup"):d[0].magnificPopup,g=parseInt(arguments[1],10)||0;f.items?e=f.items[g]:(e=d,f.delegate&&(e=e.find(f.delegate)),e=e.eq(g)),b._openClick({mfpEl:e},d,f)}else b.isOpen&&b[c].apply(b,Array.prototype.slice.call(arguments,1));else c=a.extend(!0,{},c),u?d.data("magnificPopup",c):d[0].magnificPopup=c,b.addGroup(d,c);return d};var C,D,E,F="inline",G=function(){E&&(D.after(E.addClass(C)).detach(),E=null)};a.magnificPopup.registerModule(F,{options:{hiddenClass:"hide",markup:"",tNotFound:"Content not found"},proto:{initInline:function(){b.types.push(F),w(h+"."+F,function(){G()})},getInline:function(c,d){if(G(),c.src){var e=b.st.inline,f=a(c.src);if(f.length){var g=f[0].parentNode;g&&g.tagName&&(D||(C=e.hiddenClass,D=x(C),C="mfp-"+C),E=f.after(D).detach().removeClass(C)),b.updateStatus("ready")}else b.updateStatus("error",e.tNotFound),f=a("<div>");return c.inlineElement=f,f}return b.updateStatus("ready"),b._parseMarkup(d,{},c),d}}});var H,I="ajax",J=function(){H&&a(document.body).removeClass(H)},K=function(){J(),b.req&&b.req.abort()};a.magnificPopup.registerModule(I,{options:{settings:null,cursor:"mfp-ajax-cur",tError:'<a href="%url%">The content</a> could not be loaded.'},proto:{initAjax:function(){b.types.push(I),H=b.st.ajax.cursor,w(h+"."+I,K),w("BeforeChange."+I,K)},getAjax:function(c){H&&a(document.body).addClass(H),b.updateStatus("loading");var d=a.extend({url:c.src,success:function(d,e,f){var g={data:d,xhr:f};y("ParseAjax",g),b.appendContent(a(g.data),I),c.finished=!0,J(),b._setFocus(),setTimeout(function(){b.wrap.addClass(q)},16),b.updateStatus("ready"),y("AjaxContentAdded")},error:function(){J(),c.finished=c.loadError=!0,b.updateStatus("error",b.st.ajax.tError.replace("%url%",c.src))}},b.st.ajax.settings);return b.req=a.ajax(d),""}}});var L,M=function(c){if(c.data&&void 0!==c.data.title)return c.data.title;var d=b.st.image.titleSrc;if(d){if(a.isFunction(d))return d.call(b,c);if(c.el)return c.el.attr(d)||""}return""};a.magnificPopup.registerModule("image",{options:{markup:'<div class="mfp-figure"><div class="mfp-close"></div><figure><div class="mfp-img"></div><figcaption><div class="mfp-bottom-bar"><div class="mfp-title"></div><div class="mfp-counter"></div></div></figcaption></figure></div>',cursor:"mfp-zoom-out-cur",titleSrc:"title",verticalFit:!0,tError:'<a href="%url%">The image</a> could not be loaded.'},proto:{initImage:function(){var c=b.st.image,d=".image";b.types.push("image"),w(m+d,function(){"image"===b.currItem.type&&c.cursor&&a(document.body).addClass(c.cursor)}),w(h+d,function(){c.cursor&&a(document.body).removeClass(c.cursor),v.off("resize"+p)}),w("Resize"+d,b.resizeImage),b.isLowIE&&w("AfterChange",b.resizeImage)},resizeImage:function(){var a=b.currItem;if(a&&a.img&&b.st.image.verticalFit){var c=0;b.isLowIE&&(c=parseInt(a.img.css("padding-top"),10)+parseInt(a.img.css("padding-bottom"),10)),a.img.css("max-height",b.wH-c)}},_onImageHasSize:function(a){a.img&&(a.hasSize=!0,L&&clearInterval(L),a.isCheckingImgSize=!1,y("ImageHasSize",a),a.imgHidden&&(b.content&&b.content.removeClass("mfp-loading"),a.imgHidden=!1))},findImageSize:function(a){var c=0,d=a.img[0],e=function(f){L&&clearInterval(L),L=setInterval(function(){return d.naturalWidth>0?void b._onImageHasSize(a):(c>200&&clearInterval(L),c++,void(3===c?e(10):40===c?e(50):100===c&&e(500)))},f)};e(1)},getImage:function(c,d){var e=0,f=function(){c&&(c.img[0].complete?(c.img.off(".mfploader"),c===b.currItem&&(b._onImageHasSize(c),b.updateStatus("ready")),c.hasSize=!0,c.loaded=!0,y("ImageLoadComplete")):(e++,200>e?setTimeout(f,100):g()))},g=function(){c&&(c.img.off(".mfploader"),c===b.currItem&&(b._onImageHasSize(c),b.updateStatus("error",h.tError.replace("%url%",c.src))),c.hasSize=!0,c.loaded=!0,c.loadError=!0)},h=b.st.image,i=d.find(".mfp-img");if(i.length){var j=document.createElement("img");j.className="mfp-img",c.el&&c.el.find("img").length&&(j.alt=c.el.find("img").attr("alt")),c.img=a(j).on("load.mfploader",f).on("error.mfploader",g),j.src=c.src,i.is("img")&&(c.img=c.img.clone()),j=c.img[0],j.naturalWidth>0?c.hasSize=!0:j.width||(c.hasSize=!1)}return b._parseMarkup(d,{title:M(c),img_replaceWith:c.img},c),b.resizeImage(),c.hasSize?(L&&clearInterval(L),c.loadError?(d.addClass("mfp-loading"),b.updateStatus("error",h.tError.replace("%url%",c.src))):(d.removeClass("mfp-loading"),b.updateStatus("ready")),d):(b.updateStatus("loading"),c.loading=!0,c.hasSize||(c.imgHidden=!0,d.addClass("mfp-loading"),b.findImageSize(c)),d)}}});var N,O=function(){return void 0===N&&(N=void 0!==document.createElement("p").style.MozTransform),N};a.magnificPopup.registerModule("zoom",{options:{enabled:!1,easing:"ease-in-out",duration:300,opener:function(a){return a.is("img")?a:a.find("img")}},proto:{initZoom:function(){var a,c=b.st.zoom,d=".zoom";if(c.enabled&&b.supportsTransition){var e,f,g=c.duration,j=function(a){var b=a.clone().removeAttr("style").removeAttr("class").addClass("mfp-animated-image"),d="all "+c.duration/1e3+"s "+c.easing,e={position:"fixed",zIndex:9999,left:0,top:0,"-webkit-backface-visibility":"hidden"},f="transition";return e["-webkit-"+f]=e["-moz-"+f]=e["-o-"+f]=e[f]=d,b.css(e),b},k=function(){b.content.css("visibility","visible")};w("BuildControls"+d,function(){if(b._allowZoom()){if(clearTimeout(e),b.content.css("visibility","hidden"),a=b._getItemToZoom(),!a)return void k();f=j(a),f.css(b._getOffset()),b.wrap.append(f),e=setTimeout(function(){f.css(b._getOffset(!0)),e=setTimeout(function(){k(),setTimeout(function(){f.remove(),a=f=null,y("ZoomAnimationEnded")},16)},g)},16)}}),w(i+d,function(){if(b._allowZoom()){if(clearTimeout(e),b.st.removalDelay=g,!a){if(a=b._getItemToZoom(),!a)return;f=j(a)}f.css(b._getOffset(!0)),b.wrap.append(f),b.content.css("visibility","hidden"),setTimeout(function(){f.css(b._getOffset())},16)}}),w(h+d,function(){b._allowZoom()&&(k(),f&&f.remove(),a=null)})}},_allowZoom:function(){return"image"===b.currItem.type},_getItemToZoom:function(){return b.currItem.hasSize?b.currItem.img:!1},_getOffset:function(c){var d;d=c?b.currItem.img:b.st.zoom.opener(b.currItem.el||b.currItem);var e=d.offset(),f=parseInt(d.css("padding-top"),10),g=parseInt(d.css("padding-bottom"),10);e.top-=a(window).scrollTop()-f;var h={width:d.width(),height:(u?d.innerHeight():d[0].offsetHeight)-g-f};return O()?h["-moz-transform"]=h.transform="translate("+e.left+"px,"+e.top+"px)":(h.left=e.left,h.top=e.top),h}}});var P="iframe",Q="//about:blank",R=function(a){if(b.currTemplate[P]){var c=b.currTemplate[P].find("iframe");c.length&&(a||(c[0].src=Q),b.isIE8&&c.css("display",a?"block":"none"))}};a.magnificPopup.registerModule(P,{options:{markup:'<div class="mfp-iframe-scaler"><div class="mfp-close"></div><iframe class="mfp-iframe" src="//about:blank" frameborder="0" allowfullscreen></iframe></div>',srcAction:"iframe_src",patterns:{youtube:{index:"youtube.com",id:"v=",src:"//www.youtube.com/embed/%id%?autoplay=1"},vimeo:{index:"vimeo.com/",id:"/",src:"//player.vimeo.com/video/%id%?autoplay=1"},gmaps:{index:"//maps.google.",src:"%id%&output=embed"}}},proto:{initIframe:function(){b.types.push(P),w("BeforeChange",function(a,b,c){b!==c&&(b===P?R():c===P&&R(!0))}),w(h+"."+P,function(){R()})},getIframe:function(c,d){var e=c.src,f=b.st.iframe;a.each(f.patterns,function(){return e.indexOf(this.index)>-1?(this.id&&(e="string"==typeof this.id?e.substr(e.lastIndexOf(this.id)+this.id.length,e.length):this.id.call(this,e)),e=this.src.replace("%id%",e),!1):void 0});var g={};return f.srcAction&&(g[f.srcAction]=e),b._parseMarkup(d,g,c),b.updateStatus("ready"),d}}});var S=function(a){var c=b.items.length;return a>c-1?a-c:0>a?c+a:a},T=function(a,b,c){return a.replace(/%curr%/gi,b+1).replace(/%total%/gi,c)};a.magnificPopup.registerModule("gallery",{options:{enabled:!1,arrowMarkup:'<button title="%title%" type="button" class="mfp-arrow mfp-arrow-%dir%"></button>',preload:[0,2],navigateByImgClick:!0,arrows:!0,tPrev:"Previous (Left arrow key)",tNext:"Next (Right arrow key)",tCounter:"%curr% of %total%"},proto:{initGallery:function(){var c=b.st.gallery,e=".mfp-gallery",g=Boolean(a.fn.mfpFastClick);return b.direction=!0,c&&c.enabled?(f+=" mfp-gallery",w(m+e,function(){c.navigateByImgClick&&b.wrap.on("click"+e,".mfp-img",function(){return b.items.length>1?(b.next(),!1):void 0}),d.on("keydown"+e,function(a){37===a.keyCode?b.prev():39===a.keyCode&&b.next()})}),w("UpdateStatus"+e,function(a,c){c.text&&(c.text=T(c.text,b.currItem.index,b.items.length))}),w(l+e,function(a,d,e,f){var g=b.items.length;e.counter=g>1?T(c.tCounter,f.index,g):""}),w("BuildControls"+e,function(){if(b.items.length>1&&c.arrows&&!b.arrowLeft){var d=c.arrowMarkup,e=b.arrowLeft=a(d.replace(/%title%/gi,c.tPrev).replace(/%dir%/gi,"left")).addClass(s),f=b.arrowRight=a(d.replace(/%title%/gi,c.tNext).replace(/%dir%/gi,"right")).addClass(s),h=g?"mfpFastClick":"click";e[h](function(){b.prev()}),f[h](function(){b.next()}),b.isIE7&&(x("b",e[0],!1,!0),x("a",e[0],!1,!0),x("b",f[0],!1,!0),x("a",f[0],!1,!0)),b.container.append(e.add(f))}}),w(n+e,function(){b._preloadTimeout&&clearTimeout(b._preloadTimeout),b._preloadTimeout=setTimeout(function(){b.preloadNearbyImages(),b._preloadTimeout=null},16)}),void w(h+e,function(){d.off(e),b.wrap.off("click"+e),b.arrowLeft&&g&&b.arrowLeft.add(b.arrowRight).destroyMfpFastClick(),b.arrowRight=b.arrowLeft=null})):!1},next:function(){b.direction=!0,b.index=S(b.index+1),b.updateItemHTML()},prev:function(){b.direction=!1,b.index=S(b.index-1),b.updateItemHTML()},goTo:function(a){b.direction=a>=b.index,b.index=a,b.updateItemHTML()},preloadNearbyImages:function(){var a,c=b.st.gallery.preload,d=Math.min(c[0],b.items.length),e=Math.min(c[1],b.items.length);for(a=1;a<=(b.direction?e:d);a++)b._preloadItem(b.index+a);for(a=1;a<=(b.direction?d:e);a++)b._preloadItem(b.index-a)},_preloadItem:function(c){if(c=S(c),!b.items[c].preloaded){var d=b.items[c];d.parsed||(d=b.parseEl(c)),y("LazyLoad",d),"image"===d.type&&(d.img=a('<img class="mfp-img" />').on("load.mfploader",function(){d.hasSize=!0}).on("error.mfploader",function(){d.hasSize=!0,d.loadError=!0,y("LazyLoadError",d)}).attr("src",d.src)),d.preloaded=!0}}}});var U="retina";a.magnificPopup.registerModule(U,{options:{replaceSrc:function(a){return a.src.replace(/\.\w+$/,function(a){return"@2x"+a})},ratio:1},proto:{initRetina:function(){if(window.devicePixelRatio>1){var a=b.st.retina,c=a.ratio;c=isNaN(c)?c():c,c>1&&(w("ImageHasSize."+U,function(a,b){b.img.css({"max-width":b.img[0].naturalWidth/c,width:"100%"})}),w("ElementParse."+U,function(b,d){d.src=a.replaceSrc(d,c)}))}}}}),function(){var b=1e3,c="ontouchstart"in window,d=function(){v.off("touchmove"+f+" touchend"+f)},e="mfpFastClick",f="."+e;a.fn.mfpFastClick=function(e){return a(this).each(function(){var g,h=a(this);if(c){var i,j,k,l,m,n;h.on("touchstart"+f,function(a){l=!1,n=1,m=a.originalEvent?a.originalEvent.touches[0]:a.touches[0],j=m.clientX,k=m.clientY,v.on("touchmove"+f,function(a){m=a.originalEvent?a.originalEvent.touches:a.touches,n=m.length,m=m[0],(Math.abs(m.clientX-j)>10||Math.abs(m.clientY-k)>10)&&(l=!0,d())}).on("touchend"+f,function(a){d(),l||n>1||(g=!0,a.preventDefault(),clearTimeout(i),i=setTimeout(function(){g=!1},b),e())})})}h.on("click"+f,function(){g||e()})})},a.fn.destroyMfpFastClick=function(){a(this).off("touchstart"+f+" click"+f),c&&v.off("touchmove"+f+" touchend"+f)}}(),A()});

!function(){function a(b,c,d){var e=a.resolve(b);if(null==e){d=d||b,c=c||"root";var f=new Error('Failed to require "'+d+'" from "'+c+'"');throw f.path=d,f.parent=c,f.require=!0,f}var g=a.modules[e];return g.exports||(g.exports={},g.client=g.component=!0,g.call(this,g.exports,a.relative(e),g)),g.exports}var b=Object.prototype.hasOwnProperty;a.modules={},a.aliases={},a.resolve=function(c){"/"===c.charAt(0)&&(c=c.slice(1));for(var d=c+"/index.js",e=[c,c+".js",c+".json",c+"/index.js",c+"/index.json"],f=0;f<e.length;f++){var c=e[f];if(b.call(a.modules,c))return c}return b.call(a.aliases,d)?a.aliases[d]:void 0},a.normalize=function(a,b){var c=[];if("."!=b.charAt(0))return b;a=a.split("/"),b=b.split("/");for(var d=0;d<b.length;++d)".."==b[d]?a.pop():"."!=b[d]&&""!=b[d]&&c.push(b[d]);return a.concat(c).join("/")},a.register=function(b,c){a.modules[b]=c},a.alias=function(c,d){if(!b.call(a.modules,c))throw new Error('Failed to alias "'+c+'", it does not exist');a.aliases[d]=c},a.relative=function(c){function d(a,b){for(var c=a.length;c--;)if(a[c]===b)return c;return-1}function e(b){var d=e.resolve(b);return a(d,c,b)}var f=a.normalize(c,"..");return e.resolve=function(b){var e=b.charAt(0);if("/"==e)return b.slice(1);if("."==e)return a.normalize(f,b);var g=c.split("/"),h=d(g,"deps")+1;return h||(h=0),b=g.slice(0,h+1).join("/")+"/deps/"+b},e.exists=function(c){return b.call(a.modules,e.resolve(c))},e},a.register("component-emitter/index.js",function(a,b,c){function d(a){return a?e(a):void 0}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}c.exports=d,d.prototype.on=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks[a]=this._callbacks[a]||[]).push(b),this},d.prototype.once=function(a,b){function c(){d.off(a,c),b.apply(this,arguments)}var d=this;return this._callbacks=this._callbacks||{},b._off=c,this.on(a,c),this},d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=function(a,b){this._callbacks=this._callbacks||{};var c=this._callbacks[a];if(!c)return this;if(1==arguments.length)return delete this._callbacks[a],this;var d=c.indexOf(b._off||b);return~d&&c.splice(d,1),this},d.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks[a];if(c){c=c.slice(0);for(var d=0,e=c.length;e>d;++d)c[d].apply(this,b)}return this},d.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks[a]||[]},d.prototype.hasListeners=function(a){return!!this.listeners(a).length}}),a.register("dropzone/index.js",function(a,b,c){c.exports=b("./lib/dropzone.js")}),a.register("dropzone/lib/dropzone.js",function(a,b,c){(function(){var a,d,e,f,g,h,i,j={}.hasOwnProperty,k=function(a,b){function c(){this.constructor=a}for(var d in b)j.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},l=[].slice;d="undefined"!=typeof Emitter&&null!==Emitter?Emitter:b("emitter"),h=function(){},a=function(a){function b(a,c){var d,f,h,i,j;if(this.element=a,this.version=b.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(b.forElement(this.element))throw new Error("Dropzone already attached.");if(b.instances.push(this),d=this.element.id,f=null!=(j=d?b.options[e(d)]:void 0)?j:{},h=function(){var a,b,c,d,e,f,g;for(d=arguments[0],c=2<=arguments.length?l.call(arguments,1):[],f=0,g=c.length;g>f;f++){b=c[f];for(a in b)e=b[a],d[a]=e}return d},this.options=h({},this.defaultOptions,f,null!=c?c:{}),null==this.options.url&&(this.options.url=this.element.action),!this.options.url)throw new Error("No URL provided.");return b.isBrowserSupported()?((i=this.getExistingFallback())&&i.parentNode&&i.parentNode.removeChild(i),this.previewsContainer=this.options.previewsContainer?g(this.options.previewsContainer):this.element,void this.init()):this.options.fallback.call(this)}return k(b,a),b.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","selectedfiles","addedfile","removedfile","thumbnail","error","processingfile","uploadprogress","sending","success","complete","reset"],b.prototype.defaultOptions={url:null,parallelUploads:2,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:2,thumbnailWidth:100,thumbnailHeight:100,params:{},clickable:!0,enqueueForUpload:!0,previewsContainer:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",accept:function(a,b){return b()},init:function(){return h},fallback:function(){var a,b,c,d,e,f;for(this.element.className=""+this.element.className+" browser-not-supported",f=this.element.getElementsByTagName("div"),d=0,e=f.length;e>d;d++)a=f[d],/(^| )message($| )/.test(a.className)&&(b=a,a.className="message");return b||(b=g('<div class="message"><span></span></div>'),this.element.appendChild(b)),c=b.getElementsByTagName("span")[0],c&&(c.textContent=this.options.dictFallbackMessage),this.element.appendChild(this.getFallbackForm())},drop:function(a){return this.element.classList.remove("drag-hover")},dragstart:h,dragend:function(a){return this.element.classList.remove("drag-hover")},dragenter:function(a){return this.element.classList.add("drag-hover")},dragover:function(a){return this.element.classList.add("drag-hover")},dragleave:function(a){return this.element.classList.remove("drag-hover")},selectedfiles:function(a){return this.element===this.previewsContainer?this.element.classList.add("started"):void 0},reset:function(){return this.element.classList.remove("started")},addedfile:function(a){return a.previewTemplate=g(this.options.previewTemplate),this.previewsContainer.appendChild(a.previewTemplate),a.previewTemplate.querySelector(".filename span").textContent=a.name,a.previewTemplate.querySelector(".details").appendChild(g('<div class="size">'+this.filesize(a.size)+"</div>"))},removedfile:function(a){return a.previewTemplate.parentNode.removeChild(a.previewTemplate)},thumbnail:function(a,b){return a.previewTemplate.classList.remove("file-preview"),a.previewTemplate.classList.add("image-preview"),a.previewTemplate.querySelector(".details").appendChild(g('<img alt="'+a.name+'" src="'+b+'"/>'))},error:function(a,b){return a.previewTemplate.classList.add("error"),a.previewTemplate.querySelector(".error-message span").textContent=b},processingfile:function(a){return a.previewTemplate.classList.add("processing")},uploadprogress:function(a,b){return a.previewTemplate.querySelector(".progress .upload").style.width=""+b+"%"},sending:h,success:function(a){return a.previewTemplate.classList.add("success")},complete:h,previewTemplate:'<div class="preview file-preview">\n  <div class="details">\n   <div class="filename"><span></span></div>\n  </div>\n  <div class="progress"><span class="upload"></span></div>\n  <div class="success-mark"><span>✔</span></div>\n  <div class="error-mark"><span>✘</span></div>\n  <div class="error-message"><span></span></div>\n</div>'},b.prototype.init=function(){var a,b,c,d,e,f,h=this;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".message")&&this.element.appendChild(g('<div class="default message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.options.clickable&&(this.hiddenFileInput=document.createElement("input"),this.hiddenFileInput.setAttribute("type","file"),this.hiddenFileInput.setAttribute("multiple","multiple"),this.hiddenFileInput.style.display="none",document.body.appendChild(this.hiddenFileInput),this.hiddenFileInput.addEventListener("change",function(){var a;return a=h.hiddenFileInput.files,a.length?(h.emit("selectedfiles",a),h.handleFiles(a)):void 0})),this.files=[],this.filesQueue=[],this.filesProcessing=[],this.URL=null!=(e=window.URL)?e:window.webkitURL,f=this.events,c=0,d=f.length;d>c;c++)a=f[c],this.on(a,this.options[a]);return b=function(a){return a.stopPropagation(),a.preventDefault?a.preventDefault():a.returnValue=!1},this.listeners={dragstart:function(a){return h.emit("dragstart",a)},dragenter:function(a){return b(a),h.emit("dragenter",a)},dragover:function(a){return b(a),h.emit("dragover",a)},dragleave:function(a){return h.emit("dragleave",a)},drop:function(a){return b(a),h.drop(a),h.emit("drop",a)},dragend:function(a){return h.emit("dragend",a)},click:function(a){return h.options.clickable&&(a.target===h.element||a.target===h.element.querySelector(".message"))?h.hiddenFileInput.click():void 0}},this.enable(),this.options.init.call(this)},b.prototype.getFallbackForm=function(){var a,b,c,d;return(a=this.getExistingFallback())?a:(c='<div class="fallback">',this.options.dictFallbackText&&(c+="<p>"+this.options.dictFallbackText+"</p>"),c+='<input type="file" name="'+this.options.paramName+'" multiple="multiple" /><button type="submit">Upload!</button></div>',b=g(c),"FORM"!==this.element.tagName?(d=g('<form action="'+this.options.url+'" enctype="multipart/form-data" method="post"></form>'),d.appendChild(b)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method","post")),null!=d?d:b)},b.prototype.getExistingFallback=function(){var a,b,c,d,e,f;for(b=function(a){var b,c,d;for(c=0,d=a.length;d>c;c++)if(b=a[c],/(^| )fallback($| )/.test(b.className))return b},f=["div","form"],d=0,e=f.length;e>d;d++)if(c=f[d],a=b(this.element.getElementsByTagName("div")))return a},b.prototype.setupEventListeners=function(){var a,b,c,d;c=this.listeners,d=[];for(a in c)b=c[a],d.push(this.element.addEventListener(a,b,!1));return d},b.prototype.removeEventListeners=function(){var a,b,c,d;c=this.listeners,d=[];for(a in c)b=c[a],d.push(this.element.removeEventListener(a,b,!1));return d},b.prototype.disable=function(){return this.options.clickable&&this.element.classList.remove("clickable"),this.removeEventListeners(),this.filesProcessing=[],this.filesQueue=[]},b.prototype.enable=function(){return this.options.clickable&&this.element.classList.add("clickable"),this.setupEventListeners()},b.prototype.filesize=function(a){var b;return a>=1e11?(a/=1e11,b="TB"):a>=1e8?(a/=1e8,b="GB"):a>=1e5?(a/=1e5,b="MB"):a>=100?(a/=100,b="KB"):(a=10*a,b="b"),"<strong>"+Math.round(a)/10+"</strong> "+b},b.prototype.drop=function(a){var b;if(a.dataTransfer)return b=a.dataTransfer.files,this.emit("selectedfiles",b),b.length?this.handleFiles(b):void 0},b.prototype.handleFiles=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this.addFile(b));return e},b.prototype.accept=function(a,b){return a.size>1024*this.options.maxFilesize*1024?b("File is too big ("+Math.round(a.size/1024/10.24)/100+"MB). Max filesize: "+this.options.maxFilesize+"MB"):this.options.accept.call(this,a,b)},b.prototype.addFile=function(a){var b=this;return this.files.push(a),this.emit("addedfile",a),this.options.createImageThumbnails&&a.type.match(/image.*/)&&a.size<=1024*this.options.maxThumbnailFilesize*1024&&this.createThumbnail(a),this.accept(a,function(c){return c?b.errorProcessing(a,c):b.options.enqueueForUpload?(b.filesQueue.push(a),b.processQueue()):void 0})},b.prototype.removeFile=function(a){if(a.processing)throw new Error("Can't remove file currently processing");return this.files=i(this.files,a),this.filesQueue=i(this.filesQueue,a),this.emit("removedfile",a),0===this.files.length?this.emit("reset"):void 0},b.prototype.createThumbnail=function(a){var b,c=this;return b=new FileReader,b.onload=function(){var d;return d=new Image,d.onload=function(){var b,e,f,g,h,i,j,k,l,m,n,o,p;return b=document.createElement("canvas"),e=b.getContext("2d"),i=0,j=0,h=d.width,f=d.height,b.width=c.options.thumbnailWidth,b.height=c.options.thumbnailHeight,o=0,p=0,n=b.width,l=b.height,g=d.width/d.height,m=b.width/b.height,d.height<b.height||d.width<b.width?(l=f,n=h):g>m?(f=d.height,h=f*m):(h=d.width,f=h/m),i=(d.width-h)/2,j=(d.height-f)/2,p=(b.height-l)/2,o=(b.width-n)/2,e.drawImage(d,i,j,h,f,o,p,n,l),k=b.toDataURL("image/png"),c.emit("thumbnail",a,k)},d.src=b.result},b.readAsDataURL(a)},b.prototype.processQueue=function(){var a,b,c;for(b=this.options.parallelUploads,c=this.filesProcessing.length,a=c;b>a;){if(!this.filesQueue.length)return;this.processFile(this.filesQueue.shift()),a++}},b.prototype.processFile=function(a){return this.filesProcessing.push(a),a.processing=!0,this.emit("processingfile",a),this.uploadFile(a)},b.prototype.uploadFile=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=this;if(j=new XMLHttpRequest,j.open("POST",this.options.url,!0),c=function(){return p.errorProcessing(a,j.responseText||"Server responded with "+j.status+" code.")},j.onload=function(b){var d,e;return 200<=(e=j.status)&&300>e?(p.emit("uploadprogress",a,100),d=j.responseText,j.getResponseHeader("content-type")&&~j.getResponseHeader("content-type").indexOf("application/json")&&(d=JSON.parse(d)),p.finished(a,d,b)):c()},j.onerror=function(){return c()},h=null!=(m=j.upload)?m:j,h.onprogress=function(b){return p.emit("uploadprogress",a,Math.max(0,Math.min(100,b.loaded/b.total*100)))},j.setRequestHeader("Accept","application/json"),j.setRequestHeader("Cache-Control","no-cache"),j.setRequestHeader("X-Requested-With","XMLHttpRequest"),j.setRequestHeader("X-File-Name",a.name),b=new FormData,this.options.params){n=this.options.params;for(g in n)i=n[g],b.append(g,i)}if(this.element.tagName="FORM")for(o=this.element.querySelectorAll("input, textarea, select, button"),k=0,l=o.length;l>k;k++)d=o[k],e=d.getAttribute("name"),f=d.getAttribute("type"),(!f||"checkbox"!==f.toLowerCase()||d.checked)&&b.append(e,d.value);return this.emit("sending",a,j,b),b.append(this.options.paramName,a),j.send(b)},b.prototype.finished=function(a,b,c){return this.filesProcessing=i(this.filesProcessing,a),a.processing=!1,this.processQueue(),this.emit("success",a,b,c),this.emit("finished",a,b,c),this.emit("complete",a)},b.prototype.errorProcessing=function(a,b){return this.filesProcessing=i(this.filesProcessing,a),a.processing=!1,this.processQueue(),this.emit("error",a,b),this.emit("complete",a)},b}(d),a.version="2.0.3",a.options={},a.instances=[],a.forElement=function(b){var c,d,e,f;for("string"==typeof b&&(b=document.querySelector(b)),f=a.instances,d=0,e=f.length;e>d;d++)if(c=f[d],c.element===b)return c;return null},a.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],a.isBrowserSupported=function(){var b,c,d,e,f;if(b=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData)if("classList"in document.createElement("a"))for(f=a.blacklistedBrowsers,d=0,e=f.length;e>d;d++)c=f[d],c.test(navigator.userAgent)&&(b=!1);else b=!1;else b=!1;return b},i=function(a,b){var c,d,e,f;for(f=[],d=0,e=a.length;e>d;d++)c=a[d],c!==b&&f.push(c);return f},e=function(a){return a.replace(/[\-_](\w)/g,function(a){return a[1].toUpperCase()})},g=function(a){var b;return b=document.createElement("div"),b.innerHTML=a,b.childNodes[0]},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(b){return this.each(function(){return new a(this,b)})}),"undefined"!=typeof c&&null!==c?c.exports=a:window.Dropzone=a,(f=function(a,b){var c,d,e,f,g,h,i,j,k;if(e=!1,k=!0,d=a.document,j=d.documentElement,c=d.addEventListener?"addEventListener":"attachEvent",i=d.addEventListener?"removeEventListener":"detachEvent",h=d.addEventListener?"":"on",f=function(c){return"readystatechange"!==c.type||"complete"===d.readyState?(("load"===c.type?a:d)[i](h+c.type,f,!1),!e&&(e=!0)?b.call(a,c.type||c):void 0):void 0},g=function(){try{j.doScroll("left")}catch(a){return void setTimeout(g,50)}return f("poll")},"complete"!==d.readyState){if(d.createEventObject&&j.doScroll){try{k=!a.frameElement}catch(l){}k&&g()}return d[c](h+"DOMContentLoaded",f,!1),d[c](h+"readystatechange",f,!1),a[c](h+"load",f,!1)}})(window,function(){var b,c,d,e,f,g;for(d=[],b=function(a){var b,c,e,f;for(f=[],c=0,e=a.length;e>c;c++)b=a[c],/(^| )dropzone($| )/.test(b.className)?f.push(d.push(b)):f.push(void 0);return f},b(document.getElementsByTagName("div")),b(document.getElementsByTagName("form")),g=[],e=0,f=d.length;f>e;e++)c=d[e],g.push(new a(c));return g})}).call(this)}),a.alias("component-emitter/index.js","dropzone/deps/emitter/index.js"),"object"==typeof exports?module.exports=a("dropzone"):"function"==typeof define&&define.amd?define(function(){return a("dropzone")}):window.Dropzone=a("dropzone")}();

Dropzone.prototype.defaultOptions.dictDefaultMessage = "\u3053\u3053\u306b\u30c9\u30ed\u30c3\u30d7\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9";
Dropzone.prototype.defaultOptions.dictFallbackMessage = "\u304a\u4f7f\u3044\u306e\u30d6\u30e9\u30a6\u30b6\u30fc\u306f\u30c9\u30e9\u30c3\u30b0\uff06\u30c9\u30ed\u30c3\u30d7\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u305b\u3093\u3002";
Dropzone.prototype.defaultOptions.dictFallbackText = "\u4e0b\u306e\u30d5\u30a9\u30fc\u30e0\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002";
    

!function(a,b){"use strict";a.extend(a.fn,{concreteConversation:function(b){return this.each(function(){var c=a(this),e=c.data("concreteConversation");e||c.data("concreteConversation",e=new d(c,b))})}});var c={Confirm_remove_message:"Remove this message? Replies to it will not be removed.",Confirm_mark_as_spam:"Are you sure you want to flag this message as spam?",Warn_currently_editing:"Please complete or cancel the current message editing session before editing this message.",Unspecified_error_occurred:"An unspecified error occurred.",Error_deleting_message:"Something went wrong while deleting this message, please refresh and try again.",Error_flagging_message:"Something went wrong while flagging this message, please refresh and try again."};a.fn.concreteConversation.localize=function(b){a.extend(!0,c,b)};var d=function(a,b){this.publish("beforeInitializeConversation",{element:a,options:b}),this.init(a,b),this.publish("initializeConversation",{element:a,options:b})};d.fn=d.prototype={publish:function(a,c){c=c||{},c.ConcreteConversation=this,b.ConcreteEvent.publish(a,c)},init:function(c,d){var e=this;e.$element=c,e.options=a.extend({method:"ajax",paginate:!1,displayMode:"threaded",itemsPerPage:-1,activeUsers:[],uninitialized:!0},d);var f=""!=e.options.posttoken?1:0,g=e.options.paginate?1:0,h=e.options.orderBy,i=e.options.enableOrdering,j=e.options.displayPostingForm,k=e.options.enableCommentRating,l=e.options.commentRatingUserID,m=e.options.commentRatingIP,n=e.options.addMessageLabel?e.options.addMessageLabel:"",o=e.options.dateFormat,p=e.options.customDateFormat,q=e.options.blockAreaHandle,r=(e.options.maxFiles,e.options.maxFileSize,e.options.fileExtensions,e.options.attachmentsEnabled),s=e.options.attachmentOverridesEnabled;"ajax"==e.options.method?a.post(CCM_TOOLS_PATH+"/conversations/view_ajax",{cnvID:e.options.cnvID,cID:e.options.cID,blockID:e.options.blockID,enablePosting:f,itemsPerPage:e.options.itemsPerPage,addMessageLabel:n,paginate:g,displayMode:e.options.displayMode,orderBy:h,enableOrdering:i,displayPostingForm:j,enableCommentRating:k,commentRatingUserID:l,commentRatingIP:m,dateFormat:o,customDateFormat:p,blockAreaHandle:q,attachmentsEnabled:r,attachmentOverridesEnabled:s},function(c){var d=b.obj;b.obj=e,e.$element.empty().append(c);var f=b.location.hash.match(/^#cnv([0-9]+)Message[0-9]+$/);if(null!==f&&f[1]==e.options.cnvID){var g=a("a"+b.location.hash).offset();a("html, body").animate({scrollTop:g.top},800,"linear")}b.obj=d,e.attachBindings(),e.publish("conversationLoaded")}):(e.attachBindings(),e.finishSetup(),e.publish("conversationLoaded"))},mentionList:function(b,c,d){var e=this;if(c){if(e.dropdown.parent.css({top:c.y,left:c.x}),0==b.length)return e.dropdown.handle.dropdown("toggle"),e.dropdown.parent.remove(),e.dropdown.active=!1,void(e.dropdown.activeItem=-1);e.dropdown.list.empty(),b.slice(0,20).map(function(b){var c=a("<li/>"),f=a("<a/>").appendTo(c).text(b.getName());f.click(function(){ConcreteEvent.fire("ConversationMentionSelect",{obj:e,item:b},d)}),c.appendTo(e.dropdown.list)}),e.dropdown.active||(e.dropdown.active=!0,e.dropdown.activeItem=-1,e.dropdown.parent.appendTo(e.$element),e.dropdown.handle.dropdown("toggle")),e.dropdown.activeItem>=0&&e.dropdown.list.children().eq(e.dropdown.activeItem).addClass("active")}},attachSubscriptionBindings:function(){a("a[data-conversation-subscribe]").magnificPopup({type:"ajax",callbacks:{updateStatus:function(b){if("ready"==b.status){var c=a("form[data-conversation-form=subscribe]");a("button").on("click",c,function(b){b.preventDefault(),b.stopPropagation(),a.ajax({url:c.attr("action"),dataType:"json",success:function(b){b.subscribed?(a("[data-conversation-subscribe=subscribe]").hide(),a("[data-conversation-subscribe=unsubscribe]").show()):(a("[data-conversation-subscribe=unsubscribe]").hide(),a("[data-conversation-subscribe=subscribe]").show()),a.magnificPopup.close()}})})}},beforeOpen:function(){this.st.mainClass="mfp-zoom-in"}},closeOnContentClick:!0,midClick:!0})},attachBindings:function(){var d=this;d.$element.unbind(".cnv"),d.options.uninitialized&&(d.options.uninitialized=!1,ConcreteEvent.bind("ConversationMention",function(a,b){d.mentionList(b.items,b.coordinates||!1,b.bindTo||d.$element.get(0))},d.$element.get(0)),d.dropdown={},d.dropdown.parent=a("<div/>").css({position:"absolute",height:0,width:0}),d.dropdown.active=!1,d.dropdown.handle=a("<a/>").appendTo(d.dropdown.parent),d.dropdown.list=a("<ul/>").addClass("dropdown-menu").appendTo(d.dropdown.parent),d.dropdown.handle.dropdown(),ConcreteEvent.bind("ConversationTextareaKeydownUp",function(a){-1==d.dropdown.activeItem&&(d.dropdown.activeItem=d.dropdown.list.children().length),d.dropdown.activeItem-=1,d.dropdown.activeItem+=d.dropdown.list.children().length,d.dropdown.activeItem%=d.dropdown.list.children().length,d.dropdown.list.children().filter(".active").removeClass("active").end().eq(d.dropdown.activeItem).addClass("active")},d.$element.get(0)),ConcreteEvent.bind("ConversationTextareaKeydownDown",function(a){d.dropdown.activeItem+=1,d.dropdown.activeItem+=d.dropdown.list.children().length,d.dropdown.activeItem%=d.dropdown.list.children().length,d.dropdown.list.children().filter(".active").removeClass("active").end().eq(d.dropdown.activeItem).addClass("active")},d.$element.get(0)),ConcreteEvent.bind("ConversationTextareaKeydownEnter",function(a){d.dropdown.list.children().filter(".active").children("a").click()},d.$element.get(0)),ConcreteEvent.bind("ConversationPostError",function(b,c){var d=c.form,e=c.messages,f="";a.each(e,function(a,b){f+=b+"<br>"}),d.find("div.ccm-conversation-errors").html(f).show()}),ConcreteEvent.bind("ConversationSubmitForm",function(a,b){b.form.find("div.ccm-conversation-errors").hide()}));var e=d.options.paginate?1:0,f=""!=d.options.posttoken?1:0,g=d.options.addMessageLabel?d.options.addMessageLabel:"";d.$replyholder=d.$element.find("div.ccm-conversation-add-reply"),d.$newmessageform=d.$element.find("div.ccm-conversation-add-new-message form"),d.$deleteholder=d.$element.find("div.ccm-conversation-delete-message"),d.$attachmentdeleteholder=d.$element.find("div.ccm-conversation-delete-attachment"),d.$permalinkholder=d.$element.find("div.ccm-conversation-message-permalink"),d.$messagelist=d.$element.find("div.ccm-conversation-message-list"),d.$messagecnt=d.$element.find(".ccm-conversation-message-count"),d.$postbuttons=d.$element.find("[data-submit=conversation-message]"),d.$sortselect=d.$element.find("select[data-sort=conversation-message-list]"),d.$loadmore=d.$element.find("[data-load-page=conversation-message-list]"),d.$messages=d.$element.find("div.ccm-conversation-messages"),d.$messagerating=d.$element.find("span.ccm-conversation-message-rating"),d.$element.on("click.cnv","[data-submit=conversation-message]",function(b){b.preventDefault(),d.submitForm(a(this))}),d.$element.on("click.cnv","[data-submit=update-conversation-message]",function(){return d.submitUpdateForm(a(this)),!1}),this.attachSubscriptionBindings();var h=1;d.$element.on("click.cnv","a[data-toggle=conversation-reply]",function(b){b.preventDefault(),a(".ccm-conversation-attachment-container").each(function(){a(this).is(":visible")&&a(this).toggle()});var c=d.$replyholder.appendTo(a(this).closest("div[data-conversation-message-id]"));return c.attr("data-form","conversation-reply").show(),c.find("[data-submit=conversation-message]").attr("data-post-parent-id",a(this).attr("data-post-parent-id")),c.attr("rel","new-reply"+h),h++,!1}),a(".ccm-conversation-attachment-container").hide(),a(".ccm-conversation-add-new-message .ccm-conversation-attachment-toggle").off("click.cnv").on("click.cnv",function(b){b.preventDefault(),a(".ccm-conversation-add-reply .ccm-conversation-attachment-container").is(":visible")&&a(".ccm-conversation-add-reply .ccm-conversation-attachment-container").toggle(),a(".ccm-conversation-add-new-message .ccm-conversation-attachment-container").toggle()}),a(".ccm-conversation-add-reply .ccm-conversation-attachment-toggle").off("click.cnv").on("click.cnv",function(b){b.preventDefault(),a(".ccm-conversation-add-new-message .ccm-conversation-attachment-container").is(":visible")&&a(".ccm-conversation-add-new-message .ccm-conversation-attachment-container").toggle(),a(".ccm-conversation-add-reply .ccm-conversation-attachment-container").toggle()}),d.$element.on("click.cnv","a[data-submit=delete-conversation-message]",function(){var e=a(this);return d.$deletedialog=d.$deleteholder.clone(),d.$deletedialog.dialog?d.$deletedialog.dialog({modal:!0,dialogClass:"ccm-conversation-dialog",title:d.$deleteholder.attr("data-dialog-title"),buttons:[{text:d.$deleteholder.attr("data-cancel-button-title"),"class":"btn pull-left",click:function(){d.$deletedialog.dialog("close")}},{text:d.$deleteholder.attr("data-confirm-button-title"),"class":"btn pull-right btn-danger",click:function(){d.deleteMessage(e.attr("data-conversation-message-id"))}}]}):b.confirm(c.Confirm_remove_message)&&d.deleteMessage(e.attr("data-conversation-message-id")),!1}),d.$element.on("click.cnv","a[data-submit=flag-conversation-message]",function(){var e=a(this);return b.confirm(c.Confirm_mark_as_spam)&&d.flagMessage(e.attr("data-conversation-message-id")),!1}),d.$element.on("click.cnv","a[data-load=edit-conversation-message]",function(){if(a(".ccm-conversation-edit-message").is(":visible"))return b.alert(c.Warn_currently_editing),!1;var e=a(this);d.editMessage(e.attr("data-conversation-message-id"))}),d.$element.on("change.cnv","select[data-sort=conversation-message-list]",function(){d.$messagelist.load(CCM_TOOLS_PATH+"/conversations/view_ajax",{cnvID:d.options.cnvID,task:"get_messages",cID:d.options.cID,blockID:d.options.blockID,enablePosting:f,displayMode:d.options.displayMode,itemsPerPage:d.options.itemsPerPage,paginate:e,addMessageLabel:g,orderBy:a(this).val(),enableOrdering:d.options.enableOrdering,displayPostingForm:d.options.displayPostingForm,enableCommentRating:d.options.enableCommentRating,dateFormat:d.options.dateFormat,customDateFormat:d.options.customDateFormat,blockAreaHandle:d.options.blockAreaHandle,attachmentsEnabled:d.options.attachmentsEnabled,attachmentOverridesEnabled:d.options.attachmentOverridesEnabled},function(b){d.$replyholder.appendTo(d.$element),a(".ccm-conversation-messages .dropdown-toggle").dropdown(),d.attachBindings()})}),d.$element.on("click.cnv",".image-popover-hover",function(){a.magnificPopup.open({items:{src:a(this).attr("data-full-image"),type:"image",verticalFit:!0}})}),d.$element.on("click.cnv","[data-load-page=conversation-message-list]",function(){var b=parseInt(d.$loadmore.attr("data-next-page")),c=parseInt(d.$loadmore.attr("data-total-pages")),e={cnvID:d.options.cnvID,cID:d.options.cID,blockID:d.options.blockID,itemsPerPage:d.options.itemsPerPage,displayMode:d.options.displayMode,blockAreaHandle:d.options.blockAreaHandle,enablePosting:f,addMessageLabel:g,page:b,orderBy:d.$sortselect.val(),enableCommentRating:d.options.enableCommentRating,dateFormat:d.options.dateFormat,customDateFormat:d.options.customDateFormat,attachmentsEnabled:d.options.attachmentsEnabled,attachmentOverridesEnabled:d.options.attachmentOverridesEnabled};a.ajax({type:"post",data:e,url:CCM_TOOLS_PATH+"/conversations/message_page",success:function(e){d.$messages.append(e),a(".ccm-conversation-messages .dropdown-toggle").dropdown(),b+1>c?d.$loadmore.hide():d.$loadmore.attr("data-next-page",b+1)}})}),d.$element.on("click.cnv",".conversation-rate-message",function(){var b=a(this).closest("[data-conversation-message-id]").attr("data-conversation-message-id"),c=a(this).attr("data-conversation-rating-type");d.$messagerating.load(CCM_TOOLS_PATH+"/conversations/rate");var e={cnvID:d.options.cnvID,cID:d.options.cID,blockID:d.options.blockID,cnvMessageID:b,cnvRatingTypeHandle:c,commentRatingUserID:d.options.commentRatingUserID,commentRatingIP:d.options.commentRatingIP};a.ajax({type:"post",data:e,url:CCM_TOOLS_PATH+"/conversations/rate",success:function(c){a('span[data-message-rating="'+b+'"]').load(CCM_TOOLS_PATH+"/conversations/get_rating",{cnvMessageID:b})}})}),d.$element.on("click.cnv","a.share-popup",function(){var c=void 0!=b.screenLeft?b.screenLeft:screen.left,d=void 0!=b.screenTop?b.screenTop:screen.top,e=b.innerWidth?b.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,f=b.innerHeight?b.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,g=e/2-300+c,h=f/2-125+d;return b.open(a(this).attr("href"),"cnvSocialShare","left:"+g+",top:"+h+",height=250,width=600,toolbar=no,status=no"),!1}),d.$element.on("click.cnv","a.share-permalink",function(){var c=a(this),e=c.attr("rel");d.$permalinkdialog=d.$permalinkholder.clone();var f=a("<textarea readonly>").text(decodeURIComponent(e));return d.$permalinkdialog.append(f),f.click(function(){var c=a(this);c.select(),b.setTimeout(function(){c.select()},1),c.mouseup(function(){return c.unbind("mouseup"),!1})}),d.$permalinkdialog.dialog&&d.$permalinkdialog.dialog({modal:!0,dialogClass:"ccm-conversation-dialog",title:d.$permalinkholder.attr("data-dialog-title"),buttons:[{text:d.$permalinkholder.attr("data-cancel-button-title"),"class":"btn pull-left",click:function(){d.$permalinkdialog.dialog("close")}}]}),!1}),d.options.attachmentsEnabled>0&&d.$element.concreteConversationAttachments(d),a(".dropdown-toggle").dropdown()},handlePostError:function(a,b){b||(b=[c.Unspecified_error_occurred]),this.publish("conversationPostError",{form:a,messages:b})},deleteMessage:function(d){var e=this;e.publish("conversationBeforeDeleteMessage",{msgID:d});var f=[{name:"cnvMessageID",value:d}];a.ajax({type:"post",data:f,url:CCM_TOOLS_PATH+"/conversations/delete_message",success:function(b){var c=a("div[data-conversation-message-id="+d+"]");c.length&&c.after(b).remove(),e.updateCount(),e.$deletedialog.dialog&&e.$deletedialog.dialog("close"),e.publish("conversationDeleteMessage",{msgID:d})},error:function(a){e.publish("conversationDeleteMessageError",{msgID:d,error:arguments}),b.alert(c.Error_deleting_message)}})},editMessage:function(b){var c=this,d=[{name:"cnvMessageID",value:b},{name:"cID",value:this.options.cID},{name:"blockAreaHandle",value:this.options.blockAreaHandle},{name:"bID",value:this.options.blockID}];a.ajax({type:"post",data:d,url:CCM_TOOLS_PATH+"/conversations/edit_message",success:function(d){var e=a("div[data-conversation-message-id="+b+"]"),f=e;e.after(d).remove(),a(".ccm-conversation-attachment-container").hide(),a(".ccm-conversation-edit-message .ccm-conversation-attachment-toggle").off("click.cnv").on("click.cnv",function(b){b.preventDefault(),a(".ccm-conversation-edit-message .ccm-conversation-attachment-container").toggle()}),c.$editMessageHolder=c.$element.find("div.ccm-conversation-edit-message"),c.$element.concreteConversationAttachments(c),a("button.cancel-update").on("click.cnv",function(){a(".ccm-conversation-edit-message").replaceWith(f)})},error:function(a){c.publish("conversationEditMessageError",{msgID:b,error:arguments})}})},flagMessage:function(d){var e=this;e.publish("conversationBeforeFlagMessage",{msgID:d});var f=[{name:"cnvMessageID",value:d}];a.ajax({type:"post",data:f,url:CCM_TOOLS_PATH+"/conversations/flag_message",success:function(b){var c=a("div[data-conversation-message-id="+d+"]");c.length&&c.after(b).remove(),e.updateCount(),e.publish("conversationFlagMessage",{msgID:d})},error:function(a){e.publish("conversationFlagMessageError",{msgID:d,error:arguments}),b.alert(c.Error_flagging_message)}})},addMessageFromJSON:function(b,c){var d=this;d.publish("conversationBeforeAddMessageFromJSON",{json:c,form:b});var e=""!=d.options.posttoken?1:0,f=[{name:"cnvMessageID",value:c.cnvMessageID},{name:"enablePosting",value:e},{name:"displayMode",value:d.options.displayMode},{name:"enableCommentRating",value:d.options.enableCommentRating}];a.ajax({type:"post",data:f,url:CCM_TOOLS_PATH+"/conversations/message_detail",success:function(e){var f=a("div[data-conversation-message-id="+c.cnvMessageParentID+"]");if(f.length){f.after(e),d.$replyholder.appendTo(d.$element),d.$replyholder.hide(),d.$replyholder.find(".conversation-editor").val("");try{d.$replyholder.find(".redactor_conversation_editor_"+d.options.cnvID).redactor("set","")}catch(g){}}else{"date_desc"==d.options.orderBy?d.$messages.prepend(e):d.$messages.append(e),d.$element.find(".ccm-conversation-no-messages").hide(),d.$newmessageform.find(".conversation-editor").val("");try{d.$newmessageform.find(".redactor_conversation_editor_"+d.options.cnvID).redactor("set","")}catch(g){}}d.publish("conversationAddMessageFromJSON",{json:c,form:b}),d.updateCount();var h=a("a#cnv"+d.options.cnvID+"Message"+c.cnvMessageID).offset();a(".dropdown-toggle").dropdown(),a("html, body").animate({scrollTop:h.top},800,"linear")}})},updateMessageFromJSON:function(b,c){var d=this,e=""!=d.options.posttoken?1:0,f=[{name:"cnvMessageID",value:c.cnvMessageID},{name:"enablePosting",value:e},{name:"displayMode",value:d.options.displayMode},{name:"enableCommentRating",value:d.options.enableCommentRating}];a.ajax({type:"post",data:f,url:CCM_TOOLS_PATH+"/conversations/message_detail",success:function(b){var d=a("div[data-conversation-message-id="+c.cnvMessageID+"]");d.after(b).remove(),a(".dropdown-toggle").dropdown()}})},updateCount:function(){var a=this;a.publish("conversationBeforeUpdateCount"),a.$messagecnt.load(CCM_TOOLS_PATH+"/conversations/count_header",{cnvID:a.options.cnvID},function(){a.publish("conversationUpdateCount")})},submitForm:function(b){var c=this;c.publish("conversationBeforeSubmitForm");var d=b.closest("form");b.prop("disabled",!0),d.parent().addClass("ccm-conversation-form-submitted");var e=d.serializeArray(),f=b.attr("data-post-parent-id");e.push({name:"token",value:c.options.posttoken},{name:"cnvID",value:c.options.cnvID},{name:"cnvMessageParentID",value:f},{name:"enableRating",value:f}),a.ajax({dataType:"json",type:"post",data:e,url:CCM_TOOLS_PATH+"/conversations/add_message",success:function(b){return b?b.error?(c.handlePostError(d,b.errors),!1):(a(".preview.processing").each(function(){a('input[rel="'+a(this).attr("rel")+'"]').remove()}),a("form.dropzone").each(function(){var b=a(this).data("dropzone");a.each(b.files,function(a,c){b.removeFile(c)})}),c.addMessageFromJSON(d,b),void c.publish("conversationSubmitForm",{form:d,response:b})):(c.handlePostError(d),!1)},error:function(a){return c.handlePostError(d),!1},complete:function(a){b.prop("disabled",!1),d.parent().closest(".ccm-conversation-form-submitted").removeClass("ccm-conversation-form-submitted")}})},submitUpdateForm:function(b){var c=this;c.publish("conversationBeforeSubmitForm");var d=b.closest("form");b.prop("disabled",!0),d.parent().addClass("ccm-conversation-form-submitted");var e=d.serializeArray(),f=b.attr("data-post-message-id");e.push({name:"token",value:c.options.posttoken},{name:"cnvMessageID",value:f}),a.ajax({dataType:"json",type:"post",data:e,url:CCM_TOOLS_PATH+"/conversations/update_message",success:function(b){return b?b.error?(c.handlePostError(d,b.errors),!1):(a(".preview.processing").each(function(){a('input[rel="'+a(this).attr("rel")+'"]').remove()}),c.updateMessageFromJSON(d,b),void c.publish("conversationSubmitForm",{form:d,response:b})):(c.handlePostError(d),!1)},error:function(a){return c.handlePostError(d),!1},complete:function(a){b.prop("disabled",!1),d.parent().closest(".ccm-conversation-form-submitted").removeClass("ccm-conversation-form-submitted")}})},tool:{setCaretPosition:function(a,b){if(null!=a)if(a.createTextRange){var c=a.createTextRange();c.move("character",b),c.select()}else a.selectionStart?(a.focus(),a.setSelectionRange(b,b)):a.focus()},getCaretPosition:function(a){if(a.selectionStart)return a.selectionStart;if(document.selection){a.focus();var b=document.selection.createRange();if(null==b)return 0;var c=a.createTextRange(),d=c.duplicate();return c.moveToBookmark(b.getBookmark()),d.setEndPoint("EndToStart",c),d.text.length}return 0},testMentionString:function(a){return/^@[a-z0-9]+$/.test(a)},getMentionMatches:function(a,b){return b.filter(function(b){return b.indexOf(a)>=0})},isSameConversation:function(a,b){return a.options.blockID===b.options.blockID&&a.options.cnvID===b.options.cnvID},MentionUser:function(a){this.getName=function(){return a}}}}}(jQuery,window),function(a,b){var c={Too_many_files:"Too many files",Invalid_file_extension:"Invalid file extension",Max_file_size_exceeded:"Max file size exceeded",Error_deleting_attachment:"Something went wrong while deleting this attachment, please refresh and try again.",Confirm_remove_attachment:"Remove this attachment?"},d={init:function(b){var d=b;return d.$element.on("click.cnv","a[data-toggle=conversation-reply]",function(){a(".ccm-conversation-wrapper").concreteConversationAttachments("clearDropzoneQueues")}),d.$element.on("click.cnv","a.attachment-delete",function(b){b.preventDefault(),a(this).concreteConversationAttachments("attachmentDeleteTrigger",d)}),d.$editMessageHolder&&!d.$editMessageHolder.find(".dropzone").attr("data-dropzone-applied")&&d.$editMessageHolder.find(".dropzone").not('[data-drozpone-applied="true"]').dropzone({url:CCM_TOOLS_PATH+"/conversations/add_file",success:function(b,c){var e=this;a(b.previewTemplate).click(function(){e.removeFile(b),a('input[rel="'+a(this).attr("rel")+'"]').remove()});var f=JSON.parse(c);if(f.error){var g=a('.preview.processing[rel="'+f.timestamp+'"]').closest("form");d.handlePostError(g,[f.error]),a('.preview.processing[rel="'+f.timestamp+'"]').remove(),g.children(".ccm-conversation-errors").delay(3e3).fadeOut("slow",function(){a(this).html("")})}else a(this.element).closest("div.ccm-conversation-edit-message").find("form.aux-reply-form").append('<input rel="'+f.timestamp+'" type="hidden" name="attachments[]" value="'+f.id+'" />')},accept:function(b,e){var f=[],g=this.files.length;d.options.maxFiles>0&&g>d.options.maxFiles&&f.push(c.Too_many_files);var h=d.options.fileExtensions.split(",");if(b.name.split(".").pop().toLowerCase()&&-1==h.indexOf(b.name.split(".").pop().toLowerCase())&&""!=h&&f.push(c.Invalid_file_extension),d.options.maxFileSize>0&&b.size>1e6*d.options.maxFileSize&&f.push(c.Max_file_size_exceeded),f.length>0){var i=this;a('input[rel="'+a(b.previewTemplate).attr("rel")+'"]').remove();var j=a(b.previewTemplate).parent(".dropzone");i.removeFile(b),d.handlePostError(j,f),j.children(".ccm-conversation-errors").delay(3e3).fadeOut("slow",function(){a(this).html("")}),g=-1,e("error")}else e()},sending:function(b,c,e){a(b.previewTemplate).attr("rel",(new Date).getTime()),e.append("timestamp",a(b.previewTemplate).attr("rel")),e.append("tag",a(d.$editMessageHOlder).parent("div").attr("rel")),e.append("fileCount",a(d.$editMessageHolder).find('[name="attachments[]"]').length)},init:function(){a(this.element).data("dropzone",this)}}),d.$newmessageform.dropzone&&!a(d.$newmessageform).attr("data-dropzone-applied")&&(d.$newmessageform.dropzone({accept:function(b,e){var f=[],g=this.files.length;d.options.maxFiles>0&&g>d.options.maxFiles&&f.push(c.Too_many_files);var h=d.options.fileExtensions.split(",");if(b.name.split(".").pop().toLowerCase()&&-1==h.indexOf(b.name.split(".").pop().toLowerCase())&&""!=h&&f.push(c.Invalid_file_extension),d.options.maxFileSize>0&&b.size>1e6*d.options.maxFileSize&&f.push(c.Max_file_size_exceeded),f.length>0){var i=this;a('input[rel="'+a(b.previewTemplate).attr("rel")+'"]').remove();var j=a(b.previewTemplate).parent(".dropzone");i.removeFile(b),d.handlePostError(j,f),j.children(".ccm-conversation-errors").delay(3e3).fadeOut("slow",function(){a(this).html("")}),g=-1,e("error")}else e()},url:CCM_TOOLS_PATH+"/conversations/add_file",success:function(b,c){var e=this;a(b.previewTemplate).click(function(){a('input[rel="'+a(this).attr("rel")+'"]').remove(),e.removeFile(b)});var f=JSON.parse(c);if(f.error){var g=a('.preview.processing[rel="'+f.timestamp+'"]').closest("form");d.handlePostError(g,[f.error]),a('.preview.processing[rel="'+f.timestamp+'"]').remove(),g.children(".ccm-conversation-errors").delay(3e3).fadeOut("slow",function(){a(this).html("")})}else a('div[rel="'+f.tag+'"] form.main-reply-form').append('<input rel="'+f.timestamp+'" type="hidden" name="attachments[]" value="'+f.id+'" />')},sending:function(b,c,e){a(b.previewTemplate).attr("rel",(new Date).getTime()),e.append("timestamp",a(b.previewTemplate).attr("rel")),e.append("tag",a(d.$newmessageform).parent("div").attr("rel")),e.append("fileCount",this.files.length)},init:function(){a(this.element).data("dropzone",this)}}),a(d.$newmessageform).attr("data-dropzone-applied","true")),a(d.$replyholder.find(".dropzone")).attr("data-dropzone-applied")||d.$replyholder.find(".dropzone").not('[data-drozpone-applied="true"]').dropzone({url:CCM_TOOLS_PATH+"/conversations/add_file",success:function(b,c){var e=this;a(b.previewTemplate).click(function(){e.removeFile(b),a('input[rel="'+a(this).attr("rel")+'"]').remove()});var f=JSON.parse(c);if(f.error){var g=a('.preview.processing[rel="'+f.timestamp+'"]').closest("form");d.handlePostError(g,[f.error]),a('.preview.processing[rel="'+f.timestamp+'"]').remove(),g.children(".ccm-conversation-errors").delay(3e3).fadeOut("slow",function(){a(this).html("")})}else a(this.element).closest("div.ccm-conversation-add-reply").find("form.aux-reply-form").append('<input rel="'+f.timestamp+'" type="hidden" name="attachments[]" value="'+f.id+'" />')},accept:function(b,e){var f=[],g=this.files.length;d.options.maxFiles>0&&g>d.options.maxFiles&&f.push(c.Too_many_files);var h=d.options.fileExtensions.split(",");if(b.name.split(".").pop().toLowerCase()&&-1==h.indexOf(b.name.split(".").pop().toLowerCase())&&""!=h&&f.push(c.Invalid_file_extension),d.options.maxFileSize>0&&b.size>1e6*d.options.maxFileSize&&f.push(c.Max_file_size_exceeded),f.length>0){var i=this;a('input[rel="'+a(b.previewTemplate).attr("rel")+'"]').remove();var j=a(b.previewTemplate).parent(".dropzone");i.removeFile(b),d.handlePostError(j,f),j.children(".ccm-conversation-errors").delay(3e3).fadeOut("slow",function(){a(this).html("")}),g=-1,e("error")}else e()},sending:function(b,c,e){a(b.previewTemplate).attr("rel",(new Date).getTime()),e.append("timestamp",a(b.previewTemplate).attr("rel")),e.append("tag",a(d.$newmessageform).parent("div").attr("rel")),e.append("fileCount",a(d.$replyHolder).find('[name="attachments[]"]').length)},init:function(){a(this.element).data("dropzone",this)}}),a(d.$replyholder.find(".dropzone")).attr("data-dropzone-applied","true"),a.each(a(this),function(b,c){a(this).find(".ccm-conversation-attachment-container").each(function(){a(this).is(":visible")&&a(this).toggle()})})},attachmentDeleteTrigger:function(d){var e=d,f=a(this);return e.$attachmentdeletetdialog=e.$attachmentdeleteholder.clone(),e.$attachmentdeletetdialog.dialog?e.$attachmentdeletetdialog.dialog({modal:!0,dialogClass:"ccm-conversation-dialog",title:e.$attachmentdeletetdialog.attr("data-dialog-title"),buttons:[{text:e.$attachmentdeleteholder.attr("data-cancel-button-title"),"class":"btn pull-left",click:function(){e.$attachmentdeletetdialog.dialog("close")}},{text:e.$attachmentdeleteholder.attr("data-confirm-button-title"),"class":"btn pull-right btn-danger",click:function(){a(this).concreteConversationAttachments("deleteAttachment",{cnvMessageAttachmentID:f.attr("rel"),cnvObj:e,dialogObj:e.$attachmentdeletetdialog})}}]}):b.confirm(c.Confirm_remove_attachment)&&a(this).concreteConversationAttachments("deleteAttachment",{cnvMessageAttachmentID:f.attr("rel"),cnvObj:e,dialogObj:e.$attachmentdeletetdialog}),!1},clearDropzoneQueues:function(){a(".preview.processing").each(function(){a('input[rel="'+a(this).attr("rel")+'"]').remove()}),a("form.dropzone").each(function(){var b=a(this).data("dropzone");a.each(b.files,function(a,c){b.removeFile(c)})})},deleteAttachment:function(d){var e=d.cnvMessageAttachmentID,f=d.cnvObj,g=d.dialogObj,h=[{name:"cnvMessageAttachmentID",value:e}];a.ajax({type:"post",data:h,url:CCM_TOOLS_PATH+"/conversations/delete_file",success:function(b){var c=JSON.parse(b);a('p[rel="'+c.attachmentID+'"]').parent(".attachment-container").fadeOut(300,function(){a(this).remove()}),g.dialog&&(g.dialog("close"),f.publish("conversationDeleteAttachment",{cnvMessageAttachmentID:e}))},error:function(a){f.publish("conversationDeleteAttachmentError",{cnvMessageAttachmentID:e,error:arguments}),b.alert(c.Error_deleting_attachment)}})}};a.fn.concreteConversationAttachments=function(b){return d[b]?d[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on concreteConversationAttachments"):d.init.apply(this,arguments)},a.fn.concreteConversationAttachments.localize=function(b){a.extend(!0,c,b)}}(jQuery,window);

jQuery.fn.concreteConversation.localize({
  Confirm_remove_message: "\u3053\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f\u3053\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3078\u306e\u8fd4\u4fe1\u306f\u524a\u9664\u3055\u308c\u307e\u305b\u3093\u3002",
  Confirm_mark_as_spam: "\u672c\u5f53\u306b\u3053\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30b9\u30d1\u30e0\u3068\u5831\u544a\u3057\u3066\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",
  Warn_currently_editing: "\u3053\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u7de8\u96c6\u3059\u308b\u524d\u306b\u3001\u7de8\u96c6\u4e2d\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u7de8\u96c6\u3092\u5b8c\u4e86\u3059\u308b\u304b\u30ad\u30e3\u30f3\u30bb\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\u3002",
  Unspecified_error_occurred: "\u4e88\u671f\u305b\u306c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002",
  Error_deleting_message: "\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u524a\u9664\u3059\u308b\u969b\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u518d\u8aad\u307f\u8fbc\u307f\u3057\u3066\u304b\u3089\u3001\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002",
  Error_flagging_message: "\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5831\u544a\u3059\u308b\u969b\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u518d\u8aad\u307f\u8fbc\u307f\u3057\u3066\u304b\u3089\u3001\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"});
jQuery.fn.concreteConversationAttachments.localize({
  Too_many_files: "\u30d5\u30a1\u30a4\u30eb\u304c\u591a\u3059\u304e\u307e\u3059",
  Invalid_file_extension: "\u7121\u52b9\u306a\u30d5\u30a1\u30a4\u30eb\u62e1\u5f35\u5b50\u3067\u3059",
  Max_file_size_exceeded: "\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c\u5236\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059",
  Error_deleting_attachment: "\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\u969b\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u518d\u8aad\u307f\u8fbc\u307f\u3057\u3066\u304b\u3089\u3001\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002",
  Confirm_remove_attachment: "\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f"});
        

!function(a,b){"use strict";b("a[data-concrete5-link-lightbox=image]").each(function(){var a=b(this);a.magnificPopup({type:"image",removalDelay:500,callbacks:{beforeOpen:function(){this.st.image.markup=this.st.image.markup.replace("mfp-figure","mfp-figure mfp-with-anim"),this.st.mainClass="mfp-zoom-in"}},closeOnContentClick:!0,midClick:!0})}),b("a[data-concrete5-link-lightbox=iframe]").each(function(){var a=b(this),c=500,d=400;b(this).attr("data-concrete5-link-lightbox-width")&&b(this).attr("data-concrete5-link-lightbox-height")&&(c=b(this).attr("data-concrete5-link-lightbox-width"),d=b(this).attr("data-concrete5-link-lightbox-height")),a.magnificPopup({type:"iframe",callbacks:{beforeOpen:function(){this.st.iframe.markup=this.st.iframe.markup.replace("mfp-figure","mfp-figure mfp-with-anim"),this.st.mainClass="mfp-zoom-in";var a=b.magnificPopup.instance;b(a.contentContainer).css("maxWidth",c+"px").css("maxHeight",d+"px")}},iframe:{patterns:{website:{index:"",src:"%id%"}}},closeOnContentClick:!0,midClick:!0})})}(this,$);

