!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a(window.jQuery)}(function(a){"use strict";var b=0;a.ajaxTransport("iframe",function(c){if(c.async){var d,e,f,g=c.initialIframeSrc||"javascript:false;";return{send:function(h,i){d=a('<form style="display:none;"></form>'),d.attr("accept-charset",c.formAcceptCharset),f=/\?/.test(c.url)?"&":"?","DELETE"===c.type?(c.url=c.url+f+"_method=DELETE",c.type="POST"):"PUT"===c.type?(c.url=c.url+f+"_method=PUT",c.type="POST"):"PATCH"===c.type&&(c.url=c.url+f+"_method=PATCH",c.type="POST"),b+=1,e=a('<iframe src="'+g+'" name="iframe-transport-'+b+'"></iframe>').bind("load",function(){var b,f=a.isArray(c.paramName)?c.paramName:[c.paramName];e.unbind("load").bind("load",function(){var b;try{if(b=e.contents(),!b.length||!b[0].firstChild)throw new Error}catch(c){b=void 0}i(200,"success",{iframe:b}),a('<iframe src="'+g+'"></iframe>').appendTo(d),window.setTimeout(function(){d.remove()},0)}),d.prop("target",e.prop("name")).prop("action",c.url).prop("method",c.type),c.formData&&a.each(c.formData,function(b,c){a('<input type="hidden"/>').prop("name",c.name).val(c.value).appendTo(d)}),c.fileInput&&c.fileInput.length&&"POST"===c.type&&(b=c.fileInput.clone(),c.fileInput.after(function(a){return b[a]}),c.paramName&&c.fileInput.each(function(b){a(this).prop("name",f[b]||c.paramName)}),d.append(c.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")),d.submit(),b&&b.length&&c.fileInput.each(function(c,d){var e=a(b[c]);a(d).prop("name",e.prop("name")),e.replaceWith(d)})}),d.append(e).appendTo(document.body)},abort:function(){e&&e.unbind("load").prop("src",g),d&&d.remove()}}}}),a.ajaxSetup({converters:{"iframe text":function(b){return b&&a(b[0].body).text()},"iframe json":function(b){return b&&a.parseJSON(a(b[0].body).text())},"iframe html":function(b){return b&&a(b[0].body).html()},"iframe xml":function(b){var c=b&&b[0];return c&&a.isXMLDoc(c)?c:a.parseXML(c.XMLDocument&&c.XMLDocument.xml||a(c.body).html())},"iframe script":function(b){return b&&a.globalEval(a(b[0].body).text())}}})}),function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],a):a(window.jQuery)}(function(a){"use strict";a.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||a('<input type="file">').prop("disabled")),a.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),a.support.xhrFormDataFileUpload=!!window.FormData,a.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),a.widget("blueimp.fileupload",{options:{dropZone:a(document),pasteZone:a(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(b,c){return b=this.messages[b]||b.toString(),c&&a.each(c,function(a,c){b=b.replace("{"+a+"}",c)}),b},formData:function(a){return a.serializeArray()},add:function(b,c){return b.isDefaultPrevented()?!1:void((c.autoUpload||c.autoUpload!==!1&&a(this).fileupload("option","autoUpload"))&&c.process().done(function(){c.submit()}))},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:a.support.blobSlice&&function(){var a=this.slice||this.webkitSlice||this.mozSlice;return a.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(a,b,c){var d=a-this.timestamp;return(!this.bitrate||!c||d>c)&&(this.bitrate=(b-this.loaded)*(1e3/d)*8,this.loaded=b,this.timestamp=a),this.bitrate}},_isXHRUpload:function(b){return!b.forceIframeTransport&&(!b.multipart&&a.support.xhrFileUpload||a.support.xhrFormDataFileUpload)},_getFormData:function(b){var c;return"function"===a.type(b.formData)?b.formData(b.form):a.isArray(b.formData)?b.formData:"object"===a.type(b.formData)?(c=[],a.each(b.formData,function(a,b){c.push({name:a,value:b})}),c):[]},_getTotal:function(b){var c=0;return a.each(b,function(a,b){c+=b.size||1}),c},_initProgressObject:function(b){var c={loaded:0,total:0,bitrate:0};b._progress?a.extend(b._progress,c):b._progress=c},_initResponseObject:function(a){var b;if(a._response)for(b in a._response)a._response.hasOwnProperty(b)&&delete a._response[b];else a._response={}},_onProgress:function(b,c){if(b.lengthComputable){var d,e=Date.now?Date.now():(new Date).getTime();if(c._time&&c.progressInterval&&e-c._time<c.progressInterval&&b.loaded!==b.total)return;c._time=e,d=Math.floor(b.loaded/b.total*(c.chunkSize||c._progress.total))+(c.uploadedBytes||0),this._progress.loaded+=d-c._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(e,this._progress.loaded,c.bitrateInterval),c._progress.loaded=c.loaded=d,c._progress.bitrate=c.bitrate=c._bitrateTimer.getBitrate(e,d,c.bitrateInterval),this._trigger("progress",a.Event("progress",{delegatedEvent:b}),c),this._trigger("progressall",a.Event("progressall",{delegatedEvent:b}),this._progress)}},_initProgressListener:function(b){var c=this,d=b.xhr?b.xhr():a.ajaxSettings.xhr();d.upload&&(a(d.upload).bind("progress",function(a){var d=a.originalEvent;a.lengthComputable=d.lengthComputable,a.loaded=d.loaded,a.total=d.total,c._onProgress(a,b)}),b.xhr=function(){return d})},_isInstanceOf:function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},_initXHRData:function(b){var c,d=this,e=b.files[0],f=b.multipart||!a.support.xhrFileUpload,g=b.paramName[0];b.headers=a.extend({},b.headers),b.contentRange&&(b.headers["Content-Range"]=b.contentRange),f&&!b.blob&&this._isInstanceOf("File",e)||(b.headers["Content-Disposition"]='attachment; filename="'+encodeURI(e.name)+'"'),f?a.support.xhrFormDataFileUpload&&(b.postMessage?(c=this._getFormData(b),b.blob?c.push({name:g,value:b.blob}):a.each(b.files,function(a,d){c.push({name:b.paramName[a]||g,value:d})})):(d._isInstanceOf("FormData",b.formData)?c=b.formData:(c=new FormData,a.each(this._getFormData(b),function(a,b){c.append(b.name,b.value)})),b.blob?c.append(g,b.blob,e.name):a.each(b.files,function(a,e){(d._isInstanceOf("File",e)||d._isInstanceOf("Blob",e))&&c.append(b.paramName[a]||g,e,e.uploadName||e.name)})),b.data=c):(b.contentType=e.type,b.data=b.blob||e),b.blob=null},_initIframeSettings:function(b){var c=a("<a></a>").prop("href",b.url).prop("host");b.dataType="iframe "+(b.dataType||""),b.formData=this._getFormData(b),b.redirect&&c&&c!==location.host&&b.formData.push({name:b.redirectParamName||"redirect",value:b.redirect})},_initDataSettings:function(a){this._isXHRUpload(a)?(this._chunkedUpload(a,!0)||(a.data||this._initXHRData(a),this._initProgressListener(a)),a.postMessage&&(a.dataType="postmessage "+(a.dataType||""))):this._initIframeSettings(a)},_getParamName:function(b){var c=a(b.fileInput),d=b.paramName;return d?a.isArray(d)||(d=[d]):(d=[],c.each(function(){for(var b=a(this),c=b.prop("name")||"files[]",e=(b.prop("files")||[1]).length;e;)d.push(c),e-=1}),d.length||(d=[c.prop("name")||"files[]"])),d},_initFormSettings:function(b){b.form&&b.form.length||(b.form=a(b.fileInput.prop("form")),b.form.length||(b.form=a(this.options.fileInput.prop("form")))),b.paramName=this._getParamName(b),b.url||(b.url=b.form.prop("action")||location.href),b.type=(b.type||"string"===a.type(b.form.prop("method"))&&b.form.prop("method")||"").toUpperCase(),"POST"!==b.type&&"PUT"!==b.type&&"PATCH"!==b.type&&(b.type="POST"),b.formAcceptCharset||(b.formAcceptCharset=b.form.attr("accept-charset"))},_getAJAXSettings:function(b){var c=a.extend({},this.options,b);return this._initFormSettings(c),this._initDataSettings(c),c},_getDeferredState:function(a){return a.state?a.state():a.isResolved()?"resolved":a.isRejected()?"rejected":"pending"},_enhancePromise:function(a){return a.success=a.done,a.error=a.fail,a.complete=a.always,a},_getXHRPromise:function(b,c,d){var e=a.Deferred(),f=e.promise();return c=c||this.options.context||f,b===!0?e.resolveWith(c,d):b===!1&&e.rejectWith(c,d),f.abort=e.promise,this._enhancePromise(f)},_addConvenienceMethods:function(b,c){var d=this,e=function(b){return a.Deferred().resolveWith(d,b).promise()};c.process=function(b,f){return(b||f)&&(c._processQueue=this._processQueue=(this._processQueue||e([this])).pipe(function(){return c.errorThrown?a.Deferred().rejectWith(d,[c]).promise():e(arguments)}).pipe(b,f)),this._processQueue||e([this])},c.submit=function(){return"pending"!==this.state()&&(c.jqXHR=this.jqXHR=d._trigger("submit",a.Event("submit",{delegatedEvent:b}),this)!==!1&&d._onSend(b,this)),this.jqXHR||d._getXHRPromise()},c.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",d._trigger("fail",null,this),d._getXHRPromise(!1))},c.state=function(){return this.jqXHR?d._getDeferredState(this.jqXHR):this._processQueue?d._getDeferredState(this._processQueue):void 0},c.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===d._getDeferredState(this._processQueue)},c.progress=function(){return this._progress},c.response=function(){return this._response}},_getUploadedBytes:function(a){var b=a.getResponseHeader("Range"),c=b&&b.split("-"),d=c&&c.length>1&&parseInt(c[1],10);return d&&d+1},_chunkedUpload:function(b,c){b.uploadedBytes=b.uploadedBytes||0;var d,e,f=this,g=b.files[0],h=g.size,i=b.uploadedBytes,j=b.maxChunkSize||h,k=this._blobSlice,l=a.Deferred(),m=l.promise();return this._isXHRUpload(b)&&k&&(i||h>j)&&!b.data?c?!0:i>=h?(g.error=b.i18n("uploadedBytes"),this._getXHRPromise(!1,b.context,[null,"error",g.error])):(e=function(){var c=a.extend({},b),m=c._progress.loaded;c.blob=k.call(g,i,i+j,g.type),c.chunkSize=c.blob.size,c.contentRange="bytes "+i+"-"+(i+c.chunkSize-1)+"/"+h,f._initXHRData(c),f._initProgressListener(c),d=(f._trigger("chunksend",null,c)!==!1&&a.ajax(c)||f._getXHRPromise(!1,c.context)).done(function(d,g,j){i=f._getUploadedBytes(j)||i+c.chunkSize,m+c.chunkSize-c._progress.loaded&&f._onProgress(a.Event("progress",{lengthComputable:!0,loaded:i-c.uploadedBytes,total:i-c.uploadedBytes}),c),b.uploadedBytes=c.uploadedBytes=i,c.result=d,c.textStatus=g,c.jqXHR=j,f._trigger("chunkdone",null,c),f._trigger("chunkalways",null,c),h>i?e():l.resolveWith(c.context,[d,g,j])}).fail(function(a,b,d){c.jqXHR=a,c.textStatus=b,c.errorThrown=d,f._trigger("chunkfail",null,c),f._trigger("chunkalways",null,c),l.rejectWith(c.context,[a,b,d])})},this._enhancePromise(m),m.abort=function(){return d.abort()},e(),m):!1},_beforeSend:function(a,b){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(b),this._initProgressObject(b),b._progress.loaded=b.loaded=b.uploadedBytes||0,b._progress.total=b.total=this._getTotal(b.files)||1,b._progress.bitrate=b.bitrate=0,this._active+=1,this._progress.loaded+=b.loaded,this._progress.total+=b.total},_onDone:function(b,c,d,e){var f=e._progress.total,g=e._response;e._progress.loaded<f&&this._onProgress(a.Event("progress",{lengthComputable:!0,loaded:f,total:f}),e),g.result=e.result=b,g.textStatus=e.textStatus=c,g.jqXHR=e.jqXHR=d,this._trigger("done",null,e)},_onFail:function(a,b,c,d){var e=d._response;d.recalculateProgress&&(this._progress.loaded-=d._progress.loaded,this._progress.total-=d._progress.total),e.jqXHR=d.jqXHR=a,e.textStatus=d.textStatus=b,e.errorThrown=d.errorThrown=c,this._trigger("fail",null,d)},_onAlways:function(a,b,c,d){this._trigger("always",null,d)},_onSend:function(b,c){c.submit||this._addConvenienceMethods(b,c);var d,e,f,g,h=this,i=h._getAJAXSettings(c),j=function(){return h._sending+=1,i._bitrateTimer=new h._BitrateTimer,d=d||((e||h._trigger("send",a.Event("send",{delegatedEvent:b}),i)===!1)&&h._getXHRPromise(!1,i.context,e)||h._chunkedUpload(i)||a.ajax(i)).done(function(a,b,c){h._onDone(a,b,c,i)}).fail(function(a,b,c){h._onFail(a,b,c,i)}).always(function(a,b,c){if(h._onAlways(a,b,c,i),h._sending-=1,h._active-=1,i.limitConcurrentUploads&&i.limitConcurrentUploads>h._sending)for(var d=h._slots.shift();d;){if("pending"===h._getDeferredState(d)){d.resolve();break}d=h._slots.shift()}0===h._active&&h._trigger("stop")})};return this._beforeSend(b,i),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(f=a.Deferred(),this._slots.push(f),g=f.pipe(j)):(this._sequence=this._sequence.pipe(j,j),g=this._sequence),g.abort=function(){return e=[void 0,"abort","abort"],d?d.abort():(f&&f.rejectWith(i.context,e),j())},this._enhancePromise(g)):j()},_onAdd:function(b,c){var d,e,f,g,h=this,i=!0,j=a.extend({},this.options,c),k=c.files,l=k.length,m=j.limitMultiFileUploads,n=j.limitMultiFileUploadSize,o=j.limitMultiFileUploadSizeOverhead,p=0,q=this._getParamName(j),r=0;if(!n||l&&void 0!==k[0].size||(n=void 0),(j.singleFileUploads||m||n)&&this._isXHRUpload(j))if(j.singleFileUploads||n||!m)if(!j.singleFileUploads&&n)for(f=[],d=[],g=0;l>g;g+=1)p+=k[g].size+o,(g+1===l||p+k[g+1].size+o>n)&&(f.push(k.slice(r,g+1)),e=q.slice(r,g+1),e.length||(e=q),d.push(e),r=g+1,p=0);else d=q;else for(f=[],d=[],g=0;l>g;g+=m)f.push(k.slice(g,g+m)),e=q.slice(g,g+m),e.length||(e=q),d.push(e);else f=[k],d=[q];return c.originalFiles=k,a.each(f||k,function(e,g){var j=a.extend({},c);return j.files=f?g:[g],j.paramName=d[e],h._initResponseObject(j),h._initProgressObject(j),h._addConvenienceMethods(b,j),i=h._trigger("add",a.Event("add",{delegatedEvent:b}),j)}),i},_replaceFileInput:function(b){var c=b.clone(!0);a("<form></form>").append(c)[0].reset(),b.after(c).detach(),a.cleanData(b.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(a,d){return d===b[0]?c[0]:d}),b[0]===this.element[0]&&(this.element=c)},_handleFileTreeEntry:function(b,c){var d,e=this,f=a.Deferred(),g=function(a){a&&!a.entry&&(a.entry=b),f.resolve([a])};return c=c||"",b.isFile?b._file?(b._file.relativePath=c,f.resolve(b._file)):b.file(function(a){a.relativePath=c,f.resolve(a)},g):b.isDirectory?(d=b.createReader(),d.readEntries(function(a){e._handleFileTreeEntries(a,c+b.name+"/").done(function(a){f.resolve(a)}).fail(g)},g)):f.resolve([]),f.promise()},_handleFileTreeEntries:function(b,c){var d=this;return a.when.apply(a,a.map(b,function(a){return d._handleFileTreeEntry(a,c)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(b){b=b||{};var c=b.items;return c&&c.length&&(c[0].webkitGetAsEntry||c[0].getAsEntry)?this._handleFileTreeEntries(a.map(c,function(a){var b;return a.webkitGetAsEntry?(b=a.webkitGetAsEntry(),b&&(b._file=a.getAsFile()),b):a.getAsEntry()})):a.Deferred().resolve(a.makeArray(b.files)).promise()},_getSingleFileInputFiles:function(b){b=a(b);var c,d,e=b.prop("webkitEntries")||b.prop("entries");if(e&&e.length)return this._handleFileTreeEntries(e);if(c=a.makeArray(b.prop("files")),c.length)void 0===c[0].name&&c[0].fileName&&a.each(c,function(a,b){b.name=b.fileName,b.size=b.fileSize});else{if(d=b.prop("value"),!d)return a.Deferred().resolve([]).promise();c=[{name:d.replace(/^.*\\/,"")}]}return a.Deferred().resolve(c).promise()},_getFileInputFiles:function(b){return b instanceof a&&1!==b.length?a.when.apply(a,a.map(b,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(b)},_onChange:function(b){var c=this,d={fileInput:a(b.target),form:a(b.target.form)};this._getFileInputFiles(d.fileInput).always(function(e){d.files=e,c.options.replaceFileInput&&c._replaceFileInput(d.fileInput),c._trigger("change",a.Event("change",{delegatedEvent:b}),d)!==!1&&c._onAdd(b,d)})},_onPaste:function(b){var c=b.originalEvent&&b.originalEvent.clipboardData&&b.originalEvent.clipboardData.items,d={files:[]};c&&c.length&&(a.each(c,function(a,b){var c=b.getAsFile&&b.getAsFile();c&&d.files.push(c)}),this._trigger("paste",a.Event("paste",{delegatedEvent:b}),d)!==!1&&this._onAdd(b,d))},_onDrop:function(b){b.dataTransfer=b.originalEvent&&b.originalEvent.dataTransfer;var c=this,d=b.dataTransfer,e={};d&&d.files&&d.files.length&&(b.preventDefault(),this._getDroppedFiles(d).always(function(d){e.files=d,c._trigger("drop",a.Event("drop",{delegatedEvent:b}),e)!==!1&&c._onAdd(b,e)}))},_onDragOver:function(b){b.dataTransfer=b.originalEvent&&b.originalEvent.dataTransfer;var c=b.dataTransfer;c&&-1!==a.inArray("Files",c.types)&&this._trigger("dragover",a.Event("dragover",{delegatedEvent:b}))!==!1&&(b.preventDefault(),c.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),a.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(b,c){var d=-1!==a.inArray(b,this._specialOptions);d&&this._destroyEventHandlers(),this._super(b,c),d&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var b=this.options;void 0===b.fileInput?b.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):b.fileInput instanceof a||(b.fileInput=a(b.fileInput)),b.dropZone instanceof a||(b.dropZone=a(b.dropZone)),b.pasteZone instanceof a||(b.pasteZone=a(b.pasteZone))},_getRegExp:function(a){var b=a.split("/"),c=b.pop();return b.shift(),new RegExp(b.join("/"),c)},_isRegExpOption:function(b,c){return"url"!==b&&"string"===a.type(c)&&/^\/.*\/[igm]{0,3}$/.test(c)},_initDataAttributes:function(){var b=this,c=this.options;a.each(a(this.element[0].cloneNode(!1)).data(),function(a,d){b._isRegExpOption(a,d)&&(d=b._getRegExp(d)),c[a]=d})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(b){var c=this;b&&!this.options.disabled&&(b.fileInput&&!b.files?this._getFileInputFiles(b.fileInput).always(function(a){b.files=a,c._onAdd(null,b)}):(b.files=a.makeArray(b.files),this._onAdd(null,b)))},send:function(b){if(b&&!this.options.disabled){if(b.fileInput&&!b.files){var c,d,e=this,f=a.Deferred(),g=f.promise();return g.abort=function(){return d=!0,c?c.abort():(f.reject(null,"abort","abort"),g)},this._getFileInputFiles(b.fileInput).always(function(a){if(!d){if(!a.length)return void f.reject();b.files=a,c=e._onSend(null,b).then(function(a,b,c){f.resolve(a,b,c)},function(a,b,c){f.reject(a,b,c)})}}),this._enhancePromise(g)}if(b.files=a.makeArray(b.files),b.files.length)return this._onSend(null,b)}return this._getXHRPromise(!1,b&&b.context)}})});

!function(a,b){"use strict";function c(a,c){var e=this;c=b.extend({mode:"menu",uploadElement:"body",bulkParameterName:"fID"},c),e.options=c,e._templateFileProgress=_.template('<div id="ccm-file-upload-progress" class="ccm-ui"><div id="ccm-file-upload-progress-bar"><div class="progress progress-striped active"><div class="progress-bar" style="width: <%=progress%>%;"></div></div></div></div>'),e._templateSearchResultsMenu=_.template(d.get()),ConcreteAjaxSearch.call(e,a,c),e.setupFileDownloads(),e.setupFileUploads(),e.setupEvents(),"menu"===c.mode&&b('.ccm-search-bulk-action option[value="choose"]').remove()}c.prototype=Object.create(ConcreteAjaxSearch.prototype),c.prototype.setupFileDownloads=function(){var a=this;b("#ccm-file-manager-download-target").length?a.$downloadTarget=b("#ccm-file-manager-download-target"):a.$downloadTarget=b("<iframe />",{name:"ccm-file-manager-download-target",id:"ccm-file-manager-download-target"}).appendTo(document.body)},c.prototype.setupFileUploads=function(){var a=this,c=b(".ccm-file-manager-upload"),d=c.filter("#ccm-file-manager-upload-prompt"),e=[],f=[],g=_.template("<ul><% _(errors).each(function(error) { %><li><strong><%- error.name %></strong><p><%- error.error %></p></li><% }) %></ul>"),h={url:CCM_DISPATCHER_FILENAME+"/ccm/system/file/upload",dataType:"json",formData:{ccm_token:CCM_SECURITY_TOKEN},error:function(a){var b=a.responseText;try{b=jQuery.parseJSON(b).errors;var c=this.files[0].name;_(b).each(function(a){e.push({name:c,error:a})})}catch(d){}},progressall:function(c,d){var e=parseInt(d.loaded/d.total*100,10);b("#ccm-file-upload-progress-wrapper").html(a._templateFileProgress({progress:e}))},start:function(){e=[],b("#ccm-file-upload-progress-wrapper").remove(),b("<div />",{id:"ccm-file-upload-progress-wrapper"}).html(a._templateFileProgress({progress:100})).appendTo(document.body),b.fn.dialog.open({title:ccmi18n_filemanager.uploadProgress,width:400,height:50,element:b("#ccm-file-upload-progress-wrapper"),modal:!0})},done:function(a,b){f.push(b.result[0])},stop:function(){jQuery.fn.dialog.closeTop(),e.length?ConcreteAlert.dialog(ccmi18n_filemanager.uploadFailed,g({errors:e})):(a._launchUploadCompleteDialog(f),f=[])}};d=d.length?d:c.first(),d.fileupload(h)},c.prototype._launchUploadCompleteDialog=function(a){var b=this;c.launchUploadCompleteDialog(a,b)},c.prototype.setupEvents=function(){var a=this;ConcreteEvent.unsubscribe("FileManagerAddFilesComplete"),ConcreteEvent.subscribe("FileManagerAddFilesComplete",function(b,c){a._launchUploadCompleteDialog(c.files)}),ConcreteEvent.unsubscribe("FileManagerDeleteFilesComplete"),ConcreteEvent.subscribe("FileManagerDeleteFilesComplete",function(b,c){a.refreshResults()})},c.prototype.setupStarredResults=function(){var a=this;a.$element.unbind(".concreteFileManagerStar").on("click.concreteFileManagerStar","a[data-search-toggle=star]",function(){var c=b(this),d={fID:b(this).attr("data-search-toggle-file-id")};return a.ajaxUpdate(c.attr("data-search-toggle-url"),d,function(a){a.star?c.parent().addClass("ccm-file-manager-search-results-star-active"):c.parent().removeClass("ccm-file-manager-search-results-star-active")}),!1})},c.prototype.updateResults=function(a){var c=this;ConcreteAjaxSearch.prototype.updateResults.call(c,a),c.setupStarredResults(),"choose"==c.options.mode&&(c.$element.unbind(".concreteFileManagerHoverFile"),c.$element.on("mouseover.concreteFileManagerHoverFile","tr[data-file-manager-file]",function(){b(this).addClass("ccm-search-select-hover")}),c.$element.on("mouseout.concreteFileManagerHoverFile","tr[data-file-manager-file]",function(){b(this).removeClass("ccm-search-select-hover")}),c.$element.unbind(".concreteFileManagerChooseFile").on("click.concreteFileManagerChooseFile","tr[data-file-manager-file]",function(a){return"checkbox"!==b(a.target).prop("type")?(ConcreteEvent.publish("FileManagerBeforeSelectFile",{fID:b(this).attr("data-file-manager-file")}),ConcreteEvent.publish("FileManagerSelectFile",{fID:b(this).attr("data-file-manager-file")}),c.$downloadTarget.remove(),!1):void 0}))},c.prototype.handleSelectedBulkAction=function(a,c,d,e){var f=this,g=[];if(b.each(e,function(a,c){g.push({name:"item[]",value:b(c).val()})}),"choose"==a){var h=g.map(function(a){return a.value});ConcreteEvent.publish("FileManagerBeforeSelectFile",{fID:h}),ConcreteEvent.publish("FileManagerSelectFile",{fID:h})}else"download"==a?f.$downloadTarget.get(0).src=CCM_TOOLS_PATH+"/files/download?"+jQuery.param(g):ConcreteAjaxSearch.prototype.handleSelectedBulkAction.call(this,a,c,d,e)},ConcreteAjaxSearch.prototype.createMenu=function(a){var c=this;a.concreteFileMenu({container:c,menu:b("[data-search-menu="+a.attr("data-launch-search-menu")+"]")})},c.launchDialog=function(a,c){var d,e=b(window).width()-53,f={},g={filters:[],multipleSelection:!1};if(b.extend(g,c),g.filters.length>0)for(f["field[]"]=[],d=0;d<g.filters.length;d++){var h=b.extend(!0,{},g.filters[d]);f["field[]"].push(h.field),delete h.field,b.extend(f,h)}b.fn.dialog.open({width:e,height:"100%",href:CCM_DISPATCHER_FILENAME+"/ccm/system/dialogs/file/search",modal:!0,data:f,title:ccmi18n_filemanager.title,onOpen:function(c){ConcreteEvent.unsubscribe("FileManagerSelectFile"),ConcreteEvent.subscribe("FileManagerSelectFile",function(c,d){var e="[object Array]"===Object.prototype.toString.call(d.fID);if(g.multipleSelection&&!e)d.fID=[d.fID];else if(!g.multipleSelection&&e){if(d.fID.length>1)return b(".ccm-search-bulk-action option:first-child").prop("selected","selected"),void alert(ccmi18n_filemanager.chosenTooMany);d.fID=d.fID[0]}jQuery.fn.dialog.closeTop(),a(d)})}})},c.launchUploadCompleteDialog=function(a,c){if(a&&a.length&&a.length>0){var d="";_.each(a,function(a){d+="fID[]="+a.fID+"&"}),d=d.substring(0,d.length-1),b.fn.dialog.open({width:"660",height:"500",href:CCM_DISPATCHER_FILENAME+"/ccm/system/dialogs/file/upload_complete",modal:!0,data:d,onClose:function(){var a={filemanager:c};ConcreteEvent.publish("FileManagerUploadCompleteDialogClose",a)},onOpen:function(){var a={filemanager:c};ConcreteEvent.publish("FileManagerUploadCompleteDialogOpen",a)},title:ccmi18n_filemanager.uploadComplete})}},c.getFileDetails=function(a,c){b.ajax({type:"post",dataType:"json",url:CCM_DISPATCHER_FILENAME+"/ccm/system/file/get_json",data:{fID:a},error:function(a){ConcreteAlert.dialog("Error",a.responseText)},success:function(a){c(a)}})};var d={get:function(){return'<div class="ccm-ui"><div class="ccm-popover-file-menu popover fade" data-search-file-menu="<%=item.fID%>" data-search-menu="<%=item.fID%>"><div class="arrow"></div><div class="popover-inner"><ul class="dropdown-menu"><% if (typeof(displayClear) != \'undefined\' && displayClear) { %><li><a href="#" data-file-manager-action="clear">'+ccmi18n_filemanager.clear+'</a></li><li class="divider"></li><% } %><% if (item.canViewFile && item.canRead) { %><li><a class="dialog-launch" dialog-modal="false" dialog-append-buttons="true" dialog-width="90%" dialog-height="75%" dialog-title="'+ccmi18n_filemanager.view+'" href="'+CCM_TOOLS_PATH+'/files/view?fID=<%=item.fID%>">'+ccmi18n_filemanager.view+"</a></li><% } %><% if (item.canRead) { %><li><a href=\"#\" onclick=\"window.frames['ccm-file-manager-download-target'].location='"+CCM_TOOLS_PATH+"/files/download?fID=<%=item.fID%>'; return false\">"+ccmi18n_filemanager.download+'</a></li><% } %><% if (item.canEditFile && item.canEditFileContents) { %><li><a class="dialog-launch" dialog-modal="true" dialog-width="90%" dialog-height="70%" dialog-title="'+ccmi18n_filemanager.edit+'" href="'+CCM_TOOLS_PATH+'/files/edit?fID=<%=item.fID%>">'+ccmi18n_filemanager.edit+'</a></li><% } %><li><a class="dialog-launch" dialog-modal="true" dialog-width="850" dialog-height="450" dialog-title="'+ccmi18n_filemanager.properties+'" href="'+CCM_DISPATCHER_FILENAME+'/ccm/system/dialogs/file/properties?fID=<%=item.fID%>">'+ccmi18n_filemanager.properties+'</a></li><% if (item.canReplaceFile) { %><li><a class="dialog-launch" dialog-modal="true" dialog-width="500" dialog-height="200" dialog-title="'+ccmi18n_filemanager.replace+'" href="'+CCM_TOOLS_PATH+'/files/replace?fID=<%=item.fID%>">'+ccmi18n_filemanager.replace+'</a></li><% } %><% if (item.canCopyFile) { %><li><a href="#" data-file-manager-action="duplicate">'+ccmi18n_filemanager.duplicate+'</a></li><% } %><li><a class="dialog-launch" dialog-modal="true" dialog-width="500" dialog-height="400" dialog-title="'+ccmi18n_filemanager.sets+'" href="'+CCM_DISPATCHER_FILENAME+'/ccm/system/dialogs/file/sets?fID=<%=item.fID%>">'+ccmi18n_filemanager.sets+'</a></li><% if (item.canDeleteFile || item.canEditFilePermissions) { %><li class="divider"></li><% } %><% if (item.canEditFilePermissions) { %><li><a class="dialog-launch" dialog-modal="true" dialog-width="520" dialog-height="450" dialog-title="'+ccmi18n_filemanager.permissions+'" href="'+CCM_TOOLS_PATH+'/files/permissions?fID=<%=item.fID%>">'+ccmi18n_filemanager.permissions+'</a></li><% } %><% if (item.canDeleteFile) { %><li><a class="dialog-launch" dialog-modal="true" dialog-width="500" dialog-height="200" dialog-title="'+ccmi18n_filemanager.deleteFile+'" href="'+CCM_TOOLS_PATH+'/files/delete?fID=<%=item.fID%>">'+ccmi18n_filemanager.deleteFile+"</a></li><% } %></ul></div></div>"}};b.fn.concreteFileManager=function(a){return b.each(b(this),function(d,e){new c(b(this),a)})},a.ConcreteFileManager=c,a.ConcreteFileManagerMenu=d}(window,$),!function(a,b){"use strict";function c(a,c){var d=this,c=b.extend({chooseText:ccmi18n_filemanager.chooseNew,inputName:"concreteFile",fID:!1,filters:[]},c),e={};e.filters=c.filters,d.$element=a,d.options=c,d._chooseTemplate=_.template(d.chooseTemplate,{options:d.options}),d._loadingTemplate=_.template(d.loadingTemplate),d._fileLoadedTemplate=_.template(d.fileLoadedTemplate),d._fileMenuTemplate=_.template(ConcreteFileManagerMenu.get()),d.$element.append(d._chooseTemplate),d.$element.on("click","div.ccm-file-selector-choose-new",function(){return ConcreteFileManager.launchDialog(function(a){d.loadFile(a.fID)},e),!1}),d.options.fID&&d.loadFile(d.options.fID)}c.prototype={chooseTemplate:'<div class="ccm-file-selector-choose-new"><input type="hidden" name="<%=options.inputName%>" value="0" /><%=options.chooseText%></div>',loadingTemplate:'<div class="ccm-file-selector-loading"><img src="'+CCM_IMAGE_PATH+'/throbber_white_16.gif" /></div>',fileLoadedTemplate:'<div class="ccm-file-selector-file-selected"><input type="hidden" name="<%=inputName%>" value="<%=file.fID%>" /><div class="ccm-file-selector-file-selected-thumbnail"><%=file.resultsThumbnailImg%></div><div class="ccm-file-selector-file-selected-title"><div><%=file.title%></div></div><div class="clearfix"></div></div>',loadFile:function(a){var c=this;c.$element.html(c._loadingTemplate),ConcreteFileManager.getFileDetails(a,function(a){var d=a.files[0];c.$element.html(c._fileLoadedTemplate({inputName:c.options.inputName,file:d})),c.$element.append(c._fileMenuTemplate({displayClear:!0,item:d})),c.$element.find(".ccm-file-selector-file-selected").concreteFileMenu({container:c,menu:b("[data-search-file-menu="+d.fID+"]"),menuLauncherHoverClass:"ccm-file-manager-menu-item-hover"})})}},b.fn.concreteFileSelector=function(a){return b.each(b(this),function(d,e){new c(b(this),a)})},a.ConcreteFileSelector=c}(this,$),!function(a,b,c){"use strict";function d(a,c){var d=this,c=c||{};c=b.extend({container:!1},c),ConcreteMenu.call(d,a,c)}d.prototype=Object.create(ConcreteMenu.prototype),d.prototype.setupMenuOptions=function(a){var d=this,e=ConcreteMenu.prototype,f=a.attr("data-search-file-menu"),g=d.options.container;e.setupMenuOptions(a),a.find("a[data-file-manager-action=clear]").on("click",function(){var a=ConcreteMenuManager.getActiveMenu();return a&&a.hide(),c.defer(function(){g.$element.html(g._chooseTemplate)}),!1}),a.find("a[data-file-manager-action=duplicate]").on("click",function(){return b.concreteAjax({url:CCM_DISPATCHER_FILENAME+"/ccm/system/file/duplicate",data:{fID:f},success:function(a){"undefined"!=typeof g.refreshResults&&g.refreshResults()}}),!1})},b.fn.concreteFileMenu=function(a){return b.each(b(this),function(c,e){new d(b(this),a)})},a.ConcreteFileMenu=d}(this,$,_);

var Kinetic={};!function(){Kinetic={version:"4.7.2",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,UA:function(){var a=navigator.userAgent.toLowerCase(),b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}}(),Filters:{},Node:function(a){this._init(a)},Shape:function(a){this.__init(a)},Container:function(a){this.__init(a)},Stage:function(a){this.___init(a)},Layer:function(a){this.___init(a)},Group:function(a){this.___init(a)},isDragging:function(){var a=Kinetic.DD;return a?a.isDragging:!1},isDragReady:function(){var a=Kinetic.DD;return a?!!a.node:!1},_addId:function(a,b){void 0!==b&&(this.ids[b]=a)},_removeId:function(a){void 0!==a&&delete this.ids[a]},_addName:function(a,b){void 0!==b&&(void 0===this.names[b]&&(this.names[b]=[]),this.names[b].push(a))},_removeName:function(a,b){if(void 0!==a){var c=this.names[a];if(void 0!==c){for(var d=0;d<c.length;d++){var e=c[d];e._id===b&&c.splice(d,1)}0===c.length&&delete this.names[a]}}}}}(),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.returnExports=b()}(this,function(){return Kinetic}),function(){Kinetic.Collection=function(){var a=[].slice.call(arguments),b=a.length,c=0;for(this.length=b;b>c;c++)this[c]=a[c];return this},Kinetic.Collection.prototype=[],Kinetic.Collection.prototype.each=function(a){for(var b=0;b<this.length;b++)a(this[b],b)},Kinetic.Collection.prototype.toArray=function(){var a,b=[],c=this.length;for(a=0;c>a;a++)b.push(this[a]);return b},Kinetic.Collection.toCollection=function(a){var b,c=new Kinetic.Collection,d=a.length;for(b=0;d>b;b++)c.push(a[b]);return c},Kinetic.Collection.mapMethods=function(a){var b,c=a.length;for(b=0;c>b;b++)!function(b){var c=a[b];Kinetic.Collection.prototype[c]=function(){var a,b=this.length;for(args=[].slice.call(arguments),a=0;b>a;a++)this[a][c].apply(this[a],args)}}(b)},Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]},Kinetic.Transform.prototype={translate:function(a,b){this.m[4]+=this.m[0]*a+this.m[2]*b,this.m[5]+=this.m[1]*a+this.m[3]*b},scale:function(a,b){this.m[0]*=a,this.m[1]*=a,this.m[2]*=b,this.m[3]*=b},rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=this.m[0]*b+this.m[2]*c,e=this.m[1]*b+this.m[3]*c,f=this.m[0]*-c+this.m[2]*b,g=this.m[1]*-c+this.m[3]*b;this.m[0]=d,this.m[1]=e,this.m[2]=f,this.m[3]=g},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(a,b){var c=this.m[0]+this.m[2]*b,d=this.m[1]+this.m[3]*b,e=this.m[2]+this.m[0]*a,f=this.m[3]+this.m[1]*a;this.m[0]=c,this.m[1]=d,this.m[2]=e,this.m[3]=f},multiply:function(a){var b=this.m[0]*a.m[0]+this.m[2]*a.m[1],c=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],e=this.m[1]*a.m[2]+this.m[3]*a.m[3],f=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],g=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},invert:function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=this.m[3]*a,c=-this.m[1]*a,d=-this.m[2]*a,e=this.m[0]*a,f=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),g=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},getMatrix:function(){return this.m},setAbsolutePosition:function(a,b){var c=this.m[0],d=this.m[1],e=this.m[2],f=this.m[3],g=this.m[4],h=this.m[5],i=(c*(b-h)-d*(a-g))/(c*f-d*e),j=(a-g-e*i)/c;this.translate(j,i)}};var a="canvas",b="2d",c="[object Array]",d="[object Number]",e="[object String]",f=Math.PI/180,g=180/Math.PI,h="#",i="",j="0",k="Kinetic warning: ",l="Kinetic error: ",m="rgb(",n={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},o=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(a){return!(!a||1!=a.nodeType)},_isFunction:function(a){return!!(a&&a.constructor&&a.call&&a.apply)},_isObject:function(a){return!!a&&a.constructor==Object},_isArray:function(a){return Object.prototype.toString.call(a)==c},_isNumber:function(a){return Object.prototype.toString.call(a)==d},_isString:function(a){return Object.prototype.toString.call(a)==e},_hasMethods:function(a){var b,c=[];for(b in a)this._isFunction(a[b])&&c.push(b);return c.length>0},_isInDocument:function(a){for(;a=a.parentNode;)if(a==document)return!0;return!1},_simplifyArray:function(a){var b,c,d=[],e=a.length,f=Kinetic.Util;for(b=0;e>b;b++)c=a[b],f._isNumber(c)?c=Math.round(1e3*c)/1e3:f._isString(c)||(c=c.toString()),d.push(c);return d},_getXY:function(a){if(this._isNumber(a))return{x:a,y:a};if(this._isArray(a)){if(1===a.length){var b=a[0];if(this._isNumber(b))return{x:b,y:b};if(this._isArray(b))return{x:b[0],y:b[1]};if(this._isObject(b))return b}else if(a.length>=2)return{x:a[0],y:a[1]}}else if(this._isObject(a))return a;return null},_getSize:function(a){if(this._isNumber(a))return{width:a,height:a};if(this._isArray(a))if(1===a.length){var b=a[0];if(this._isNumber(b))return{width:b,height:b};if(this._isArray(b)){if(b.length>=4)return{width:b[2],height:b[3]};if(b.length>=2)return{width:b[0],height:b[1]}}else if(this._isObject(b))return b}else{if(a.length>=4)return{width:a[2],height:a[3]};if(a.length>=2)return{width:a[0],height:a[1]}}else if(this._isObject(a))return a;return null},_getPoints:function(a){var b,c,d=[];if(void 0===a)return[];if(c=a.length,this._isArray(a[0])){for(b=0;c>b;b++)d.push({x:a[b][0],y:a[b][1]});return d}if(this._isObject(a[0]))return a;for(b=0;c>b;b+=2)d.push({x:a[b],y:a[b+1]});return d},_getImage:function(c,d){var e,f,g;c?this._isElement(c)?d(c):this._isString(c)?(e=new Image,e.onload=function(){d(e)},e.src=c):c.data?(f=document.createElement(a),f.width=c.width,f.height=c.height,_context=f.getContext(b),_context.putImageData(c,0,0),g=f.toDataURL(),e=new Image,e.onload=function(){d(e)},e.src=g):d(null):d(null)},_rgbToHex:function(a,b,c){return((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)},_hexToRgb:function(a){a=a.replace(h,i);var b=parseInt(a,16);return{r:b>>16&255,g:b>>8&255,b:255&b}},getRandomColor:function(){for(var a=(16777215*Math.random()<<0).toString(16);a.length<6;)a=j+a;return h+a},get:function(a,b){return void 0===a?b:a},getRGB:function(a){var b;return a in n?(b=n[a],{r:b[0],g:b[1],b:b[2]}):a[0]===h?this._hexToRgb(a.substring(1)):a.substr(0,4)===m?(b=o.exec(a.replace(/ /g,"")),{r:parseInt(b[1],10),g:parseInt(b[2],10),b:parseInt(b[3],10)}):{r:0,g:0,b:0}},_merge:function(a,b){var c=this._clone(b);for(var d in a)this._isObject(a[d])?c[d]=this._merge(a[d],c[d]):c[d]=a[d];return c},_clone:function(a){var b={};for(var c in a)this._isObject(a[c])?b[c]=this._clone(a[c]):b[c]=a[c];return b},_degToRad:function(a){return a*f},_radToDeg:function(a){return a*g},_capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},error:function(a){throw new Error(l+a)},warn:function(a){window.console&&console.warn&&console.warn(k+a)},extend:function(a,b){for(var c in b.prototype)c in a.prototype||(a.prototype[c]=b.prototype[c])},addMethods:function(a,b){var c;for(c in b)a.prototype[c]=b[c]},_getControlPoints:function(a,b,c,d){var e=a.x,f=a.y,g=b.x,h=b.y,i=c.x,j=c.y,k=Math.sqrt(Math.pow(g-e,2)+Math.pow(h-f,2)),l=Math.sqrt(Math.pow(i-g,2)+Math.pow(j-h,2)),m=d*k/(k+l),n=d*l/(k+l),o=g-m*(i-e),p=h-m*(j-f),q=g+n*(i-e),r=h+n*(j-f);return[{x:o,y:p},{x:q,y:r}]},_expandPoints:function(a,b){var c,d,e=a.length,f=[];for(c=1;e-1>c;c++)d=Kinetic.Util._getControlPoints(a[c-1],a[c],a[c+1],b),f.push(d[0]),f.push(a[c]),f.push(d[1]);return f},_removeLastLetter:function(a){return a.substring(0,a.length-1)}}}(),function(){var a=document.createElement("canvas"),b=a.getContext("2d"),c=window.devicePixelRatio||1,d=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1,e=c/d;Kinetic.Canvas=function(a){this.init(a)},Kinetic.Canvas.prototype={init:function(a){a=a||{};var b=a.pixelRatio||Kinetic.pixelRatio||e;this.pixelRatio=b,this._canvas=document.createElement("canvas"),this._canvas.style.padding=0,this._canvas.style.margin=0,this._canvas.style.border=0,this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top=0,this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(a){this.pixelRatio=a,this.setSize(this.getWidth(),this.getHeight())},setWidth:function(a){this.width=this._canvas.width=a*this.pixelRatio,this._canvas.style.width=a+"px"},setHeight:function(a){this.height=this._canvas.height=a*this.pixelRatio,this._canvas.style.height=a+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(a,b){this.setWidth(a),this.setHeight(b)},toDataURL:function(a,b){try{return this._canvas.toDataURL(a,b)}catch(c){try{return this._canvas.toDataURL()}catch(d){return Kinetic.Util.warn("Unable to get data URL. "+d.message),""}}}},Kinetic.SceneCanvas=function(a){a=a||{};var b=a.width||0,c=a.height||0;Kinetic.Canvas.call(this,a),this.context=new Kinetic.SceneContext(this),this.setSize(b,c)},Kinetic.SceneCanvas.prototype={setWidth:function(a){var b=this.pixelRatio,c=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,a),c.scale(b,b)},setHeight:function(a){var b=this.pixelRatio,c=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,a),c.scale(b,b)}},Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas),Kinetic.HitCanvas=function(a){a=a||{};var b=a.width||0,c=a.height||0;Kinetic.Canvas.call(this,a),this.context=new Kinetic.HitContext(this),this.setSize(b,c)},Kinetic.Util.extend(Kinetic.HitCanvas,Kinetic.Canvas)}(),function(){var a=",",b="(",c=")",d="([",e="])",f=";",g="()",h="=",i=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];Kinetic.Context=function(a){this.init(a)},Kinetic.Context.prototype={init:function(a){this.canvas=a,this._context=a._canvas.getContext("2d"),Kinetic.enableTrace&&(this.traceArr=[],this._enableTrace())},fillShape:function(a){a.getFillEnabled()&&this._fill(a)},strokeShape:function(a){a.getStrokeEnabled()&&this._stroke(a)},fillStrokeShape:function(a){var b=a.getFillEnabled();b&&this._fill(a),a.getStrokeEnabled()&&this._stroke(a)},getTrace:function(i){var j,k,l,m,n=this.traceArr,o=n.length,p="";for(j=0;o>j;j++)k=n[j],l=k.method,l?(m=k.args,p+=l,p+=i?g:Kinetic.Util._isArray(m[0])?d+m.join(a)+e:b+m.join(a)+c):(p+=k.property,i||(p+=h+k.val)),p+=f;return p},clearTrace:function(){this.traceArr=[]},_trace:function(a){var b,c=this.traceArr;c.push(a),b=c.length,b>=Kinetic.traceArrMax&&c.shift()},reset:function(){var a=this.getCanvas().getPixelRatio();this.setTransform(1*a,0,0,1*a,0,0)},getCanvas:function(){return this.canvas},clear:function(){var a,b,c=[].slice.call(arguments),d=this.getCanvas();c.length?(a=Kinetic.Util._getXY(c),b=Kinetic.Util._getSize(c),this.clearRect(a.x||0,a.y||0,b.width,b.height)):this.clearRect(0,0,d.getWidth(),d.getHeight())},_applyLineCap:function(a){var b=a.getLineCap();b&&this.setAttr("lineCap",b)},_applyOpacity:function(a){var b=a.getAbsoluteOpacity();1!==b&&this.setAttr("globalAlpha",b)},_applyLineJoin:function(a){var b=a.getLineJoin();b&&this.setAttr("lineJoin",b)},_applyAncestorTransforms:function(a){var b=a.getAbsoluteTransform().getMatrix();this.transform(b[0],b[1],b[2],b[3],b[4],b[5])},_clip:function(a){var b=a.getClipX()||0,c=a.getClipY()||0,d=a.getClipWidth(),e=a.getClipHeight();this.save(),this._applyAncestorTransforms(a),this.beginPath(),this.rect(b,c,d,e),this.clip(),this.reset(),a._drawChildren(this.getCanvas()),this.restore()},setAttr:function(a,b){this._context[a]=b},arc:function(){var a=arguments;this._context.arc(a[0],a[1],a[2],a[3],a[4],a[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var a=arguments;this._context.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])},clearRect:function(){var a=arguments;this._context.clearRect(a[0],a[1],a[2],a[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createLinearGradient:function(){var a=arguments;return this._context.createLinearGradient(a[0],a[1],a[2],a[3])},createPattern:function(){var a=arguments;return this._context.createPattern(a[0],a[1])},createRadialGradient:function(){var a=arguments;return this._context.createRadialGradient(a[0],a[1],a[2],a[3],a[4],a[5])},drawImage:function(){var a=arguments,b=this._context;3===a.length?b.drawImage(a[0],a[1],a[2]):5===a.length?b.drawImage(a[0],a[1],a[2],a[3],a[4]):9===a.length&&b.drawImage(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},fill:function(){this._context.fill()},fillText:function(){var a=arguments;this._context.fillText(a[0],a[1],a[2])},getImageData:function(){var a=arguments;return this._context.getImageData(a[0],a[1],a[2],a[3])},lineTo:function(){var a=arguments;this._context.lineTo(a[0],a[1])},moveTo:function(){var a=arguments;this._context.moveTo(a[0],a[1])},rect:function(){var a=arguments;this._context.rect(a[0],a[1],a[2],a[3])},putImageData:function(){var a=arguments;this._context.putImageData(a[0],a[1],a[2])},quadraticCurveTo:function(){var a=arguments;this._context.quadraticCurveTo(a[0],a[1],a[2],a[3])},restore:function(){this._context.restore()},rotate:function(){var a=arguments;this._context.rotate(a[0])},save:function(){this._context.save()},scale:function(){var a=arguments;this._context.scale(a[0],a[1])},setLineDash:function(){var a=arguments,b=this._context;this._context.setLineDash?b.setLineDash(a[0]):"mozDash"in b?b.mozDash=a[0]:"webkitLineDash"in b&&(b.webkitLineDash=a[0])},setTransform:function(){var a=arguments;this._context.setTransform(a[0],a[1],a[2],a[3],a[4],a[5])},stroke:function(){this._context.stroke()},strokeText:function(){var a=arguments;this._context.strokeText(a[0],a[1],a[2])},transform:function(){var a=arguments;this._context.transform(a[0],a[1],a[2],a[3],a[4],a[5])},translate:function(){var a=arguments;this._context.translate(a[0],a[1])},_enableTrace:function(){var a,b,c=this,d=i.length,e=Kinetic.Util._simplifyArray,f=this.setAttr;for(a=0;d>a;a++)!function(a){var d,f=c[a];c[a]=function(){return b=e(Array.prototype.slice.call(arguments,0)),d=f.apply(c,arguments),c._trace({method:a,args:b}),d}}(i[a]);c.setAttr=function(){f.apply(c,arguments),c._trace({property:arguments[0],val:arguments[1]})}}},Kinetic.SceneContext=function(a){Kinetic.Context.call(this,a)},Kinetic.SceneContext.prototype={_fillColor:function(a){var b=a.getFill();this.setAttr("fillStyle",b),a._fillFunc(this)},_fillPattern:function(a){var b=a.getFillPatternImage(),c=a.getFillPatternX(),d=a.getFillPatternY(),e=a.getFillPatternScale(),f=a.getFillPatternRotation(),g=a.getFillPatternOffset(),h=a.getFillPatternRepeat();(c||d)&&this.translate(c||0,d||0),f&&this.rotate(f),e&&this.scale(e.x,e.y),g&&this.translate(-1*g.x,-1*g.y),this.setAttr("fillStyle",this.createPattern(b,h||"repeat")),this.fill()},_fillLinearGradient:function(a){var b=a.getFillLinearGradientStartPoint(),c=a.getFillLinearGradientEndPoint(),d=a.getFillLinearGradientColorStops(),e=this.createLinearGradient(b.x,b.y,c.x,c.y);if(d){for(var f=0;f<d.length;f+=2)e.addColorStop(d[f],d[f+1]);this.setAttr("fillStyle",e),this.fill()}},_fillRadialGradient:function(a){for(var b=a.getFillRadialGradientStartPoint(),c=a.getFillRadialGradientEndPoint(),d=a.getFillRadialGradientStartRadius(),e=a.getFillRadialGradientEndRadius(),f=a.getFillRadialGradientColorStops(),g=this.createRadialGradient(b.x,b.y,d,c.x,c.y,e),h=0;h<f.length;h+=2)g.addColorStop(f[h],f[h+1]);this.setAttr("fillStyle",g),this.fill()},_fill:function(a){var b=a.getFill(),c=a.getFillPatternImage(),d=a.getFillLinearGradientColorStops(),e=a.getFillRadialGradientColorStops(),f=a.getFillPriority();b&&"color"===f?this._fillColor(a):c&&"pattern"===f?this._fillPattern(a):d&&"linear-gradient"===f?this._fillLinearGradient(a):e&&"radial-gradient"===f?this._fillRadialGradient(a):b?this._fillColor(a):c?this._fillPattern(a):d?this._fillLinearGradient(a):e&&this._fillRadialGradient(a)},_stroke:function(a){var b=a.getStroke(),c=a.getStrokeWidth(),d=a.getDashArray(),e=a.getStrokeScaleEnabled();a.hasStroke()&&(e||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(a),d&&a.getDashArrayEnabled()&&this.setLineDash(d),this.setAttr("lineWidth",c||2),this.setAttr("strokeStyle",b||"black"),a._strokeFunc(this),e||this.restore())},_applyShadow:function(a){var b=Kinetic.Util,c=a.getAbsoluteOpacity(),d=b.get(a.getShadowColor(),"black"),e=b.get(a.getShadowBlur(),5),f=b.get(a.getShadowOpacity(),0),g=b.get(a.getShadowOffset(),{x:0,y:0});f&&this.setAttr("globalAlpha",f*c),this.setAttr("shadowColor",d),this.setAttr("shadowBlur",e),this.setAttr("shadowOffsetX",g.x),this.setAttr("shadowOffsetY",g.y)}},Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context),Kinetic.HitContext=function(a){Kinetic.Context.call(this,a)},Kinetic.HitContext.prototype={_fill:function(a){this.save(),this.setAttr("fillStyle",a.colorKey),a._fillFuncHit(this),this.restore()},_stroke:function(a){var b=a.getStroke(),c=a.getStrokeWidth();(b||c)&&(this._applyLineCap(a),this.setAttr("lineWidth",c||2),this.setAttr("strokeStyle",a.colorKey),a._strokeFuncHit(this))}},Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)}(),function(){var a="add",b="b",c="Deg",d="g",e="get",f="#",g="r",h="RGB",i="set",j="B",k="G",l="Height",m="R",n="Width",o="X",p="Y";Kinetic.Factory={addGetterSetter:function(a,b,c){this.addGetter(a,b,c),this.addSetter(a,b)},addPointGetterSetter:function(a,b,c){this.addPointGetter(a,b,c),this.addPointSetter(a,b),this.addGetter(a,b+o,c),this.addGetter(a,b+p,c),this.addSetter(a,b+o),this.addSetter(a,b+p)},addBoxGetterSetter:function(a,b,c){this.addBoxGetter(a,b,c),this.addBoxSetter(a,b),this.addGetter(a,b+o,c),this.addGetter(a,b+p,c),this.addGetter(a,b+n,c),this.addGetter(a,b+l,c),this.addSetter(a,b+o),this.addSetter(a,b+p),this.addSetter(a,b+n),this.addSetter(a,b+l)},addPointsGetterSetter:function(a,b){this.addPointsGetter(a,b),this.addPointsSetter(a,b),this.addPointAdder(a,b)},addRotationGetterSetter:function(a,b,c){this.addRotationGetter(a,b,c),this.addRotationSetter(a,b)},addColorGetterSetter:function(a,c){this.addGetter(a,c),this.addSetter(a,c),this.addColorRGBGetter(a,c),this.addColorComponentGetter(a,c,g),this.addColorComponentGetter(a,c,d),this.addColorComponentGetter(a,c,b),this.addColorRGBSetter(a,c),this.addColorComponentSetter(a,c,g),this.addColorComponentSetter(a,c,d),this.addColorComponentSetter(a,c,b)},addColorRGBGetter:function(a,b){var c=e+Kinetic.Util._capitalize(b)+h;a.prototype[c]=function(){return Kinetic.Util.getRGB(this.attrs[b])}},addColorComponentGetter:function(a,b,c){var d=e+Kinetic.Util._capitalize(b),f=d+Kinetic.Util._capitalize(c);a.prototype[f]=function(){return this[d+h]()[c]}},addPointsGetter:function(a,b){var c=e+Kinetic.Util._capitalize(b);a.prototype[c]=function(){var a=this.attrs[b];return void 0===a?[]:a}},addGetter:function(a,b,c){var d=e+Kinetic.Util._capitalize(b);a.prototype[d]=function(){var a=this.attrs[b];return void 0===a?c:a}},addPointGetter:function(a,b){var c=e+Kinetic.Util._capitalize(b);a.prototype[c]=function(){var a=this;return{x:a[c+o](),y:a[c+p]()}}},addBoxGetter:function(a,b){var c=e+Kinetic.Util._capitalize(b);a.prototype[c]=function(){var a=this;return{x:a[c+o](),y:a[c+p](),width:a[c+n](),height:a[c+l]()}}},addRotationGetter:function(a,b,d){var f=e+Kinetic.Util._capitalize(b);a.prototype[f]=function(){var a=this.attrs[b];return void 0===a&&(a=d),a},a.prototype[f+c]=function(){var a=this.attrs[b];return void 0===a&&(a=d),Kinetic.Util._radToDeg(a)}},addColorRGBSetter:function(a,b){var c=i+Kinetic.Util._capitalize(b)+h;a.prototype[c]=function(a){var c=a&&void 0!==a.r?0|a.r:this.getAttr(b+m),d=a&&void 0!==a.g?0|a.g:this.getAttr(b+k),e=a&&void 0!==a.b?0|a.b:this.getAttr(b+j);this._setAttr(b,f+Kinetic.Util._rgbToHex(c,d,e))}},addColorComponentSetter:function(a,b,c){var d=i+Kinetic.Util._capitalize(b),e=d+Kinetic.Util._capitalize(c);a.prototype[e]=function(a){var b={};b[c]=a,this[d+h](b)}},addPointsSetter:function(a,b){var c=i+Kinetic.Util._capitalize(b);a.prototype[c]=function(a){var b=Kinetic.Util._getPoints(a);this._setAttr("points",b)}},addSetter:function(a,b){var c=i+Kinetic.Util._capitalize(b);a.prototype[c]=function(a){this._setAttr(b,a)}},addPointSetter:function(a,b){var c=i+Kinetic.Util._capitalize(b);a.prototype[c]=function(){var a=Kinetic.Util._getXY([].slice.call(arguments)),d=this.attrs[b],e=0,f=0;a&&(e=a.x,f=a.y,this._fireBeforeChangeEvent(b,d,a),void 0!==e&&this[c+o](e),void 0!==f&&this[c+p](f),this._fireChangeEvent(b,d,a))}},addBoxSetter:function(a,b){var c=i+Kinetic.Util._capitalize(b);a.prototype[c]=function(){var a,d,e,f,g=[].slice.call(arguments),h=Kinetic.Util._getXY(g),i=Kinetic.Util._getSize(g),j=Kinetic.Util._merge(h,i),k=this.attrs[b];j&&(a=j.x,d=j.y,e=j.width,f=j.height,this._fireBeforeChangeEvent(b,k,j),void 0!==a&&this[c+o](a),void 0!==d&&this[c+p](d),void 0!==e&&this[c+n](e),void 0!==f&&this[c+l](f),this._fireChangeEvent(b,k,j))}},addRotationSetter:function(a,b){var d=i+Kinetic.Util._capitalize(b);a.prototype[d]=function(a){this._setAttr(b,a)},a.prototype[d+c]=function(a){this._setAttr(b,Kinetic.Util._degToRad(a))}},addPointAdder:function(b,c){var d=a+Kinetic.Util._removeLastLetter(Kinetic.Util._capitalize(c));b.prototype[d]=function(){var a=Kinetic.Util._getXY([].slice.call(arguments)),b=this.attrs[c];a&&(this._fireBeforeChangeEvent(c,b,a),this.attrs[c].push(a),this._fireChangeEvent(c,b,a))}}}}(),function(){var a="absoluteOpacity",b="absoluteTransform",c="before",d="Change",e="children",f=".",g="",h="get",i="id",j="kinetic",k="listening",l="mouseenter",m="mouseleave",n="name",o="set",p="Shape",q=" ",r="stage",s="transform",t="Stage",u="visible",v=["xChange.kinetic","yChange.kinetic","scaleXChange.kinetic","scaleYChange.kinetic","skewXChange.kinetic","skewYChange.kinetic","rotationChange.kinetic","offsetXChange.kinetic","offsetYChange.kinetic"].join(q);Kinetic.Util.addMethods(Kinetic.Node,{_init:function(c){var d=this;this._id=Kinetic.idCounter++,this.eventListeners={},this.attrs={},this.cache={},this.setAttrs(c),this.on(v,function(){this._clearCache(s),d._clearSelfAndChildrenCache(b)}),this.on("visibleChange.kinetic",function(){d._clearSelfAndChildrenCache(u)}),this.on("listeningChange.kinetic",function(){d._clearSelfAndChildrenCache(k)}),this.on("opacityChange.kinetic",function(){d._clearSelfAndChildrenCache(a)})},clearCache:function(){this.cache={}},_clearCache:function(a){delete this.cache[a]},_getCache:function(a,b){var c=this.cache[a];return void 0===c&&(this.cache[a]=b.call(this)),this.cache[a]},_clearSelfAndChildrenCache:function(a){this._clearCache(a),this.children&&this.getChildren().each(function(b){b._clearSelfAndChildrenCache(a)})},on:function(a,b){var c,d,e,h,i,j=a.split(q),k=j.length;for(c=0;k>c;c++)d=j[c],e=d.split(f),h=e[0],i=e[1]||g,this.eventListeners[h]||(this.eventListeners[h]=[]),this.eventListeners[h].push({name:i,handler:b});return this},off:function(a){var b,c,d,e,g,h,i=a.split(q),j=i.length;for(b=0;j>b;b++)if(d=i[b],e=d.split(f),g=e[0],h=e[1],g)this.eventListeners[g]&&this._off(g,h);else for(c in this.eventListeners)this._off(c,h);return this},remove:function(){var c=this.getParent();return c&&c.children&&(c.children.splice(this.index,1),c._setChildrenIndices(),delete this.parent),this._clearSelfAndChildrenCache(r),this._clearSelfAndChildrenCache(b),this._clearSelfAndChildrenCache(u),this._clearSelfAndChildrenCache(k),this._clearSelfAndChildrenCache(a),this},destroy:function(){Kinetic._removeId(this.getId()),Kinetic._removeName(this.getName(),this._id),this.remove()},getAttr:function(a){var b=h+Kinetic.Util._capitalize(a);return Kinetic.Util._isFunction(this[b])?this[b]():this.attrs[a]},getAncestors:function(){for(var a=this.getParent(),b=new Kinetic.Collection;a;)b.push(a),a=a.getParent();return b},setAttr:function(){var a=Array.prototype.slice.call(arguments),b=a[0],c=o+Kinetic.Util._capitalize(b),d=this[c];return a.shift(),Kinetic.Util._isFunction(d)?d.apply(this,a):this.attrs[b]=a[0],this},getAttrs:function(){return this.attrs||{}},setAttrs:function(a){var b,c;if(a)for(b in a)b===e||(c=o+Kinetic.Util._capitalize(b),Kinetic.Util._isFunction(this[c])?this[c](a[b]):this._setAttr(b,a[b]));return this},isListening:function(){return this._getCache(k,this._isListening)},_isListening:function(){var a=this.getListening(),b=this.getParent();return a&&b&&!b.isListening()?!1:a},isVisible:function(){return this._getCache(u,this._isVisible)},_isVisible:function(){var a=this.getVisible(),b=this.getParent();return a&&b&&!b.isVisible()?!1:a},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function a(i){for(b=[],c=i.length,d=0;c>d;d++)e=i[d],h++,e.nodeType!==p&&(b=b.concat(e.getChildren().toArray())),e._id===g._id&&(d=c);b.length>0&&b[0].getLevel()<=f&&a(b)}var b,c,d,e,f=this.getLevel(),g=this,h=0;return g.nodeType!==t&&a(g.getStage().getChildren()),h},getLevel:function(){for(var a=0,b=this.parent;b;)a++,b=b.parent;return a},setPosition:function(){var a=Kinetic.Util._getXY([].slice.call(arguments));return this.setX(a.x),this.setY(a.y),this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var a=this.getAbsoluteTransform().getMatrix(),b=new Kinetic.Transform,c=this.getOffset();return b.m=a.slice(),b.translate(c.x,c.y),b.getTranslation()},setAbsolutePosition:function(){var a,b=Kinetic.Util._getXY([].slice.call(arguments)),c=this._clearTransform();return this.attrs.x=c.x,this.attrs.y=c.y,delete c.x,delete c.y,a=this.getAbsoluteTransform(),a.invert(),a.translate(b.x,b.y),b={x:this.attrs.x+a.getTranslation().x,y:this.attrs.y+a.getTranslation().y},this.setPosition(b.x,b.y),this._setTransform(c),this},_setTransform:function(a){var c;for(c in a)this.attrs[c]=a[c];this._clearCache(s),this._clearSelfAndChildrenCache(b)},_clearTransform:function(){var a={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache(s),this._clearSelfAndChildrenCache(b),a},move:function(){var a=Kinetic.Util._getXY([].slice.call(arguments)),b=this.getX(),c=this.getY();return void 0!==a.x&&(b+=a.x),void 0!==a.y&&(c+=a.y),this.setPosition(b,c),this},_eachAncestorReverse:function(a,b){var c,d,e=[],f=this.getParent();for(b&&e.unshift(this);f;)e.unshift(f),f=f.parent;for(c=e.length,d=0;c>d;d++)a(e[d])},rotate:function(a){return this.setRotation(this.getRotation()+a),this},rotateDeg:function(a){return this.setRotation(this.getRotation()+Kinetic.Util._degToRad(a)),this},moveToTop:function(){var a=this.index;return this.parent.children.splice(a,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){var a=this.index,b=this.parent.getChildren().length;return b-1>a?(this.parent.children.splice(a,1),this.parent.children.splice(a+1,0,this),this.parent._setChildrenIndices(),!0):!1},moveDown:function(){var a=this.index;return a>0?(this.parent.children.splice(a,1),this.parent.children.splice(a-1,0,this),this.parent._setChildrenIndices(),!0):!1},moveToBottom:function(){var a=this.index;return a>0?(this.parent.children.splice(a,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},setZIndex:function(a){var b=this.index;return this.parent.children.splice(b,1),this.parent.children.splice(a,0,this),this.parent._setChildrenIndices(),this},getAbsoluteOpacity:function(){return this._getCache(a,this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var a=this.getOpacity();return this.getParent()&&(a*=this.getParent().getAbsoluteOpacity()),a},moveTo:function(a){return Kinetic.Node.prototype.remove.call(this),a.add(this),this},toObject:function(){var a,b,c=Kinetic.Util,d={},e=this.getAttrs();d.attrs={};for(a in e)b=e[a],c._isFunction(b)||c._isElement(b)||c._isObject(b)&&c._hasMethods(b)||(d.attrs[a]=b);return d.className=this.getClassName(),d},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){return this.getParent().getLayer()},getStage:function(){return this._getCache(r,this._getStage)},_getStage:function(){var a=this.getParent();return a?a.getStage():void 0},fire:function(a,b,c){return c?this._fireAndBubble(a,b||{}):this._fire(a,b||{}),this},getAbsoluteTransform:function(){return this._getCache(b,this._getAbsoluteTransform)},_getAbsoluteTransform:function(){var a,b=new Kinetic.Transform;return this._eachAncestorReverse(function(c){a=c.getTransform(),b.multiply(a)},!0),b},_getTransform:function(){var a=new Kinetic.Transform,b=this.getX(),c=this.getY(),d=this.getRotation(),e=this.getScaleX(),f=this.getScaleY(),g=this.getSkewX(),h=this.getSkewY(),i=this.getOffsetX(),j=this.getOffsetY();return(0!==b||0!==c)&&a.translate(b,c),0!==d&&a.rotate(d),(0!==g||0!==h)&&a.skew(g,h),(1!==e||1!==f)&&a.scale(e,f),(0!==i||0!==j)&&a.translate(-1*i,-1*j),a},clone:function(a){var b,c,d,e,f,g=this.getClassName(),h=new Kinetic[g](this.attrs);for(b in this.eventListeners)for(c=this.eventListeners[b],d=c.length,e=0;d>e;e++)f=c[e],f.name.indexOf(j)<0&&(h.eventListeners[b]||(h.eventListeners[b]=[]),h.eventListeners[b].push(f));return h.setAttrs(a),h},toDataURL:function(a){a=a||{};var b=a.mimeType||null,c=a.quality||null,d=this.getStage(),e=a.x||0,f=a.y||0,g=new Kinetic.SceneCanvas({width:a.width||d.getWidth(),height:a.height||d.getHeight(),pixelRatio:1}),h=g.getContext();return h.save(),(e||f)&&h.translate(-1*e,-1*f),this.drawScene(g),h.restore(),g.toDataURL(b,c)},toImage:function(a){Kinetic.Util._getImage(this.toDataURL(a),function(b){a.callback(b)})},setSize:function(){var a=Kinetic.Util._getSize(Array.prototype.slice.call(arguments));return this.setWidth(a.width),this.setHeight(a.height),this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},_get:function(a){return this.nodeType===a?[this]:[]},_off:function(a,b){var c,d,e=this.eventListeners[a];for(c=0;c<e.length;c++)if(d=e[c].name,!("kinetic"===d&&"kinetic"!==b||b&&d!==b)){if(e.splice(c,1),0===e.length){delete this.eventListeners[a];break}c--}},_fireBeforeChangeEvent:function(a,b,e){this._fire(c+Kinetic.Util._capitalize(a)+d,{oldVal:b,newVal:e})},_fireChangeEvent:function(a,b,c){this._fire(a+d,{oldVal:b,newVal:c})},setId:function(a){var b=this.getId();return Kinetic._removeId(b),Kinetic._addId(this,a),this._setAttr(i,a),this},setName:function(a){var b=this.getName();return Kinetic._removeName(b,this._id),Kinetic._addName(this,a),this._setAttr(n,a),this},_setAttr:function(a,b){var c;void 0!==b&&(c=this.attrs[a],this._fireBeforeChangeEvent(a,c,b),this.attrs[a]=b,this._fireChangeEvent(a,c,b))},_fireAndBubble:function(a,b,c){var d=!0;b&&this.nodeType===p&&(b.targetNode=this),a===l&&c&&this._id===c._id?d=!1:a===m&&c&&this._id===c._id&&(d=!1),d&&(this._fire(a,b),b&&!b.cancelBubble&&this.parent&&(c&&c.parent?this._fireAndBubble.call(this.parent,a,b,c.parent):this._fireAndBubble.call(this.parent,a,b)))},_fire:function(a,b){var c,d,e=this.eventListeners[a];if(e)for(c=e.length,d=0;c>d;d++)e[d].handler.call(this,b)},draw:function(){return this.drawScene(),this.drawHit(),this},shouldDrawHit:function(){return this.isListening()&&this.isVisible()&&!Kinetic.isDragging()},isDraggable:function(){return!1},getTransform:function(){return this._getCache(s,this._getTransform)}}),Kinetic.Node.create=function(a,b){return this._createNode(JSON.parse(a),b)},Kinetic.Node._createNode=function(a,b){var c,d,e,f=Kinetic.Node.prototype.getClassName.call(a),g=a.children;if(b&&(a.attrs.container=b),c=new Kinetic[f](a.attrs),g)for(d=g.length,e=0;d>e;e++)c.add(this._createNode(g[e]));return c},Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1),Kinetic.Factory.addGetter(Kinetic.Node,"name"),Kinetic.Factory.addGetter(Kinetic.Node,"id"),Kinetic.Factory.addRotationGetterSetter(Kinetic.Node,"rotation",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Node,"scale",1),Kinetic.Factory.addPointGetterSetter(Kinetic.Node,"skew",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Node,"offset",0),Kinetic.Factory.addSetter(Kinetic.Node,"width"),Kinetic.Factory.addSetter(Kinetic.Node,"height"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening",!0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"visible",!0),Kinetic.Collection.mapMethods(["on","off","remove","destroy","show","hide","move","rotate","moveToTop","moveUp","moveDown","moveToBottom","moveTo","fire","draw"])}(),function(){function a(a){window.setTimeout(a,1e3/60)}var b=500;Kinetic.Animation=function(a,b){this.func=a,this.setLayers(b),this.id=Kinetic.Animation.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:(new Date).getTime()}},Kinetic.Animation.prototype={setLayers:function(a){var b=[];b=a?a.length>0?a:[a]:[],this.layers=b},getLayers:function(){return this.layers},addLayer:function(a){var b,c,d=this.layers;if(d){for(b=d.length,c=0;b>c;c++)if(d[c]._id===a._id)return!1}else this.layers=[];return this.layers.push(a),!0},isRunning:function(){for(var a=Kinetic.Animation,b=a.animations,c=0;c<b.length;c++)if(b[c].id===this.id)return!0;return!1},start:function(){this.stop(),this.frame.timeDiff=0,this.frame.lastTime=(new Date).getTime(),Kinetic.Animation._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(a){this.frame.timeDiff=a-this.frame.lastTime,this.frame.lastTime=a,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation._addAnimation=function(a){this.animations.push(a),this._handleAnimation()},Kinetic.Animation._removeAnimation=function(a){for(var b=a.id,c=this.animations,d=c.length,e=0;d>e;e++)if(c[e].id===b){this.animations.splice(e,1);break}},Kinetic.Animation._runFrames=function(){var a,b,c,d,e,f,g,h,i={},j=this.animations;for(d=0;d<j.length;d++){for(a=j[d],b=a.layers,c=a.func,a._updateFrameObject((new Date).getTime()),f=b.length,e=0;f>e;e++)g=b[e],void 0!==g._id&&(i[g._id]=g);c&&c.call(a,a.frame)}for(h in i)i[h].draw()},Kinetic.Animation._animationLoop=function(){var a=this;this.animations.length>0?(this._runFrames(),Kinetic.Animation.requestAnimFrame(function(){a._animationLoop()})):this.animRunning=!1},Kinetic.Animation._handleAnimation=function(){var a=this;this.animRunning||(this.animRunning=!0,a._animationLoop())},RAF=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||a}(),Kinetic.Animation.requestAnimFrame=function(b){var c=Kinetic.DD&&Kinetic.DD.isDragging?a:RAF;c(b)};var c=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(a){c.call(this,a)},Kinetic.Layer.prototype.batchDraw=function(){var a=this;this.batchAnim||(this.batchAnim=new Kinetic.Animation(function(){a.lastBatchDrawTime&&(new Date).getTime()-a.lastBatchDrawTime>b&&a.batchAnim.stop()},this)),this.lastBatchDrawTime=(new Date).getTime(),this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())},Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(a){a.batchDraw()})}}(),function(){var a={node:1,duration:1,easing:1,onFinish:1,yoyo:1},b=1,c=2,d=3,e=0;Kinetic.Tween=function(b){var c,d=this,g=b.node,h=g._id,i=b.duration||1,j=b.easing||Kinetic.Easings.Linear,k=!!b.yoyo;this.node=g,this._id=e++,this.anim=new Kinetic.Animation(function(){d.tween.onEnterFrame()},g.getLayer()||g.getLayers()),this.tween=new f(c,function(a){d._tweenFunc(a)},j,0,1,1e3*i,k),this._addListeners(),Kinetic.Tween.attrs[h]||(Kinetic.Tween.attrs[h]={}),Kinetic.Tween.attrs[h][this._id]||(Kinetic.Tween.attrs[h][this._id]={}),Kinetic.Tween.tweens[h]||(Kinetic.Tween.tweens[h]={});for(c in b)void 0===a[c]&&this._addAttr(c,b[c]);this.reset(),this.onFinish=b.onFinish,this.onReset=b.onReset},Kinetic.Tween.attrs={},Kinetic.Tween.tweens={},Kinetic.Tween.prototype={_addAttr:function(a,b){var c,d,e,f,g,h,i,j=this.node,k=j._id;if(e=Kinetic.Tween.tweens[k][a],e&&delete Kinetic.Tween.attrs[k][e][a],c=j.getAttr(a),Kinetic.Util._isArray(b))for(b=Kinetic.Util._getPoints(b),d=[],g=b.length,f=0;g>f;f++)h=c[f],i=b[f],d.push({x:i.x-h.x,y:i.y-h.y});else d=b-c;Kinetic.Tween.attrs[k][this._id][a]={start:c,diff:d},Kinetic.Tween.tweens[k][a]=this._id},_tweenFunc:function(a){var b,c,d,e,f,g,h,i,j,k=this.node,l=Kinetic.Tween.attrs[k._id][this._id];for(b in l){if(c=l[b],d=c.start,e=c.diff,Kinetic.Util._isArray(d))for(f=[],h=d.length,g=0;h>g;g++)i=d[g],j=e[g],f.push({x:i.x+j.x*a,y:i.y+j.y*a});else f=d+e*a;k.setAttr(b,f)}},_addListeners:function(){var a=this;this.tween.onPlay=function(){a.anim.start()},this.tween.onReverse=function(){a.anim.start()},this.tween.onPause=function(){a.anim.stop()},this.tween.onFinish=function(){a.onFinish&&a.onFinish()},this.tween.onReset=function(){a.onReset&&a.onReset()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){var a=this.node;return this.tween.reset(),(a.getLayer()||a.getLayers()).draw(),this},seek:function(a){var b=this.node;return this.tween.seek(1e3*a),(b.getLayer()||b.getLayers()).draw(),this},pause:function(){return this.tween.pause(),this},finish:function(){var a=this.node;return this.tween.finish(),(a.getLayer()||a.getLayers()).draw(),this},destroy:function(){var a,b=this.node._id,c=this._id,d=Kinetic.Tween.tweens[b];this.pause();for(a in d)delete Kinetic.Tween.tweens[b][a];delete Kinetic.Tween.attrs[b][c]}};var f=function(a,b,c,d,e,f,g){this.prop=a,this.propFunc=b,this.begin=d,this._pos=d,this.duration=f,this._change=0,this.prevPos=0,this.yoyo=g,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=c,this._change=e-this.begin,this.pause()};f.prototype={fire:function(a){var b=this[a];b&&b()},setTime:function(a){a>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>a?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=a,this.update())},getTime:function(){return this._time},setPosition:function(a){this.prevPos=this._pos,this.propFunc(a),this._pos=a},getPosition:function(a){return void 0===a&&(a=this._time),this.func(a,this.begin,this._change,this.duration)},play:function(){this.state=c,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},reverse:function(){this.state=d,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},seek:function(a){this.pause(),this._time=a,this.update(),this.fire("onSeek")},reset:function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},finish:function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var a=this.getTimer()-this._startTime;this.state===c?this.setTime(a):this.state===d&&this.setTime(this.duration-a)},pause:function(){this.state=b,this.fire("onPause")},getTimer:function(){return(new Date).getTime()}},Kinetic.Easings={BackEaseIn:function(a,b,c,d,e,f){var g=1.70158;return c*(a/=d)*a*((g+1)*a-g)+b},BackEaseOut:function(a,b,c,d,e,f){var g=1.70158;return c*((a=a/d-1)*a*((g+1)*a+g)+1)+b},BackEaseInOut:function(a,b,c,d,e,f){var g=1.70158;return(a/=d/2)<1?c/2*(a*a*(((g*=1.525)+1)*a-g))+b:c/2*((a-=2)*a*(((g*=1.525)+1)*a+g)+2)+b},ElasticEaseIn:function(a,b,c,d,e,f){var g=0;return 0===a?b:1==(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),-(e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*(2*Math.PI)/f))+b)},ElasticEaseOut:function(a,b,c,d,e,f){var g=0;return 0===a?b:1==(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin((a*d-g)*(2*Math.PI)/f)+c+b)},ElasticEaseInOut:function(a,b,c,d,e,f){var g=0;return 0===a?b:2==(a/=d/2)?b+c:(f||(f=d*(.3*1.5)),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),1>a?-.5*(e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*(2*Math.PI)/f))+b:e*Math.pow(2,-10*(a-=1))*Math.sin((a*d-g)*(2*Math.PI)/f)*.5+c+b)},BounceEaseOut:function(a,b,c,d){return(a/=d)<1/2.75?c*(7.5625*a*a)+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},BounceEaseIn:function(a,b,c,d){return c-Kinetic.Easings.BounceEaseOut(d-a,0,c,d)+b},BounceEaseInOut:function(a,b,c,d){return d/2>a?.5*Kinetic.Easings.BounceEaseIn(2*a,0,c,d)+b:.5*Kinetic.Easings.BounceEaseOut(2*a-d,0,c,d)+.5*c+b},EaseIn:function(a,b,c,d){return c*(a/=d)*a+b},EaseOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},EaseInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},StrongEaseIn:function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},StrongEaseOut:function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},StrongEaseInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b},Linear:function(a,b,c,d){return c*a/d+b}}}(),function(){Kinetic.DD={anim:new Kinetic.Animation,isDragging:!1,offset:{x:0,y:0},node:null,_drag:function(a){var b=Kinetic.DD,c=b.node;c&&(c._setDragPosition(a),b.isDragging||(b.isDragging=!0,c.fire("dragstart",a,!0)),c.fire("dragmove",a,!0))},_endDragBefore:function(a){var b,c,d=Kinetic.DD,e=d.node;e&&(b=e.nodeType,c=e.getLayer(),d.anim.stop(),d.isDragging&&(d.isDragging=!1,Kinetic.listenClickTap=!1,a&&(a.dragEndNode=e)),delete d.node,(c||e).draw())},_endDragAfter:function(a){a=a||{};var b=a.dragEndNode;a&&b&&b.fire("dragend",a,!0)}},Kinetic.Node.prototype.startDrag=function(){var a=Kinetic.DD,b=this.getStage(),c=this.getLayer(),d=b.getPointerPosition(),e=this.getAbsolutePosition();d&&(a.node&&a.node.stopDrag(),a.node=this,a.offset.x=d.x-e.x,a.offset.y=d.y-e.y,a.anim.setLayers(c||this.getLayers()),a.anim.start(),this._setDragPosition())},Kinetic.Node.prototype._setDragPosition=function(a){var b=Kinetic.DD,c=this.getStage().getPointerPosition(),d=this.getDragBoundFunc(),e={x:c.x-b.offset.x,y:c.y-b.offset.y};void 0!==d&&(e=d.call(this,e,a)),this.setAbsolutePosition(e)},Kinetic.Node.prototype.stopDrag=function(){var a=Kinetic.DD,b={};a._endDragBefore(b),a._endDragAfter(b)},Kinetic.Node.prototype.setDraggable=function(a){this._setAttr("draggable",a),this._dragChange()};var a=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var b=Kinetic.DD;b.node&&b.node._id===this._id&&this.stopDrag(),a.call(this)},Kinetic.Node.prototype.isDragging=function(){var a=Kinetic.DD;return a.node&&a.node._id===this._id&&a.isDragging},Kinetic.Node.prototype._listenDrag=function(){var a=this;this._dragCleanup(),"Stage"===this.getClassName()?this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(b){Kinetic.DD.node||a.startDrag(b)}):this.on("mousedown.kinetic touchstart.kinetic",function(b){Kinetic.DD.node||a.startDrag(b)})},Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var a=this.getStage(),b=Kinetic.DD;a&&b.node&&b.node._id===this._id&&b.node.stopDrag()}},Kinetic.Node.prototype._dragCleanup=function(){this.off("mousedown.kinetic"),this.off("touchstart.kinetic")},Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc"),Kinetic.Factory.addGetter(Kinetic.Node,"draggable",!1),Kinetic.Node.prototype.isDraggable=Kinetic.Node.prototype.getDraggable;var b=document.getElementsByTagName("html")[0];b.addEventListener("mouseup",Kinetic.DD._endDragBefore,!0),b.addEventListener("touchend",Kinetic.DD._endDragBefore,!0),b.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1),b.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)}(),function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(a){this.children=new Kinetic.Collection,Kinetic.Node.call(this,a)},getChildren:function(){return this.children},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){for(var a,b=this.children;b.length>0;)a=b[0],a.hasChildren()&&a.removeChildren(),a.remove();return this},destroyChildren:function(){for(var a=this.children;a.length>0;)a[0].destroy();return this},add:function(a){var b=this.children;return this._validateAdd(a),a.index=b.length,a.parent=this,b.push(a),this._fire("add",{child:a}),this},destroy:function(){this.hasChildren()&&this.destroyChildren(),Kinetic.Node.prototype.destroy.call(this)},find:function(a){var b,c,d,e,f,g,h,i=[],j=a.replace(/ /g,"").split(","),k=j.length;for(b=0;k>b;b++)if(d=j[b],"#"===d.charAt(0))f=this._getNodeById(d.slice(1)),f&&i.push(f);else if("."===d.charAt(0))e=this._getNodesByName(d.slice(1)),i=i.concat(e);else for(g=this.getChildren(),h=g.length,c=0;h>c;c++)i=i.concat(g[c]._get(d));return Kinetic.Collection.toCollection(i)},_getNodeById:function(a){var b=Kinetic.ids[a];return void 0!==b&&this.isAncestorOf(b)?b:null},_getNodesByName:function(a){var b=Kinetic.names[a]||[];return this._getDescendants(b)},_get:function(a){for(var b=Kinetic.Node.prototype._get.call(this,a),c=this.getChildren(),d=c.length,e=0;d>e;e++)b=b.concat(c[e]._get(a));return b},toObject:function(){var a=Kinetic.Node.prototype.toObject.call(this);a.children=[];for(var b=this.getChildren(),c=b.length,d=0;c>d;d++){var e=b[d];a.children.push(e.toObject())}return a},_getDescendants:function(a){for(var b=[],c=a.length,d=0;c>d;d++){var e=a[d];this.isAncestorOf(e)&&b.push(e)}return b},isAncestorOf:function(a){for(var b=a.getParent();b;){if(b._id===this._id)return!0;b=b.getParent()}return!1},clone:function(a){var b=Kinetic.Node.prototype.clone.call(this,a);return this.getChildren().each(function(a){b.add(a.clone())}),b},getAllIntersections:function(){for(var a=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),b=[],c=this.find("Shape"),d=c.length,e=0;d>e;e++){var f=c[e];f.isVisible()&&f.intersects(a)&&b.push(f)}return b},_setChildrenIndices:function(){this.children.each(function(a,b){a.index=b})},drawScene:function(a){var b=this.getLayer(),c=this.getClipWidth()&&this.getClipHeight();return!a&&b&&(a=b.getCanvas()),this.isVisible()&&(c?a.getContext()._clip(this):this._drawChildren(a)),this},_drawChildren:function(a){this.children.each(function(b){b.drawScene(a)})},drawHit:function(){var a,b=this.getClipWidth()&&this.getClipHeight()&&"Stage"!==this.nodeType,c=0,d=0,e=[];if(this.shouldDrawHit()){for(b&&(a=this.getLayer().hitCanvas,a.getContext()._clip(this)),e=this.children,d=e.length,c=0;d>c;c++)e[c].drawHit();b&&a.getContext()._context.restore()}return this}}),Kinetic.Util.extend(Kinetic.Container,Kinetic.Node),Kinetic.Container.prototype.get=Kinetic.Container.prototype.find,Kinetic.Factory.addBoxGetterSetter(Kinetic.Container,"clip")}(),function(){function a(a){a.fill()}function b(a){a.stroke()}function c(a){a.fill()}function d(a){a.stroke()}function e(){this._clearCache(f)}var f="hasShadow";Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(f){this.nodeType="Shape",this._fillFunc=a,this._strokeFunc=b,this._fillFuncHit=c,this._strokeFuncHit=d;for(var g,h=Kinetic.shapes;;)if(g=Kinetic.Util.getRandomColor(),g&&!(g in h))break;this.colorKey=g,h[g]=this,Kinetic.Node.call(this,f),this._setDrawFuncs(),this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic",e)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(f,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return!(!this.getStroke()&&!this.getStrokeWidth())},_get:function(a){return this.className===a||this.nodeType===a?[this]:[]},intersects:function(){var a,b=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),c=this.getStage(),d=c.bufferHitCanvas;return d.getContext().clear(),this.drawScene(d),a=d.context.getImageData(0|b.x,0|b.y,1,1).data,a[3]>0},enableFill:function(){return this._setAttr("fillEnabled",!0),this},disableFill:function(){return this._setAttr("fillEnabled",!1),this},enableStroke:function(){return this._setAttr("strokeEnabled",!0),this},disableStroke:function(){return this._setAttr("strokeEnabled",!1),this},enableStrokeScale:function(){return this._setAttr("strokeScaleEnabled",!0),this},disableStrokeScale:function(){return this._setAttr("strokeScaleEnabled",!1),this},enableShadow:function(){return this._setAttr("shadowEnabled",!0),this},disableShadow:function(){return this._setAttr("shadowEnabled",!1),this},enableDashArray:function(){return this._setAttr("dashArrayEnabled",!0),this},disableDashArray:function(){return this._setAttr("dashArrayEnabled",!1),this},destroy:function(){return Kinetic.Node.prototype.destroy.call(this),delete Kinetic.shapes[this.colorKey],this},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasFill()&&this.hasStroke()},drawScene:function(a){var b,c,d,e=a||this.getLayer().getCanvas(),f=e.getContext(),g=this.getDrawFunc(),h=this.hasShadow();return g&&this.isVisible()&&(this._useBufferCanvas()?(b=this.getStage(),c=b.bufferCanvas,d=c.getContext(),d.clear(),d.save(),d._applyLineJoin(this),d._applyAncestorTransforms(this),g.call(this,d),d.restore(),f.save(),h&&(f.save(),f._applyShadow(this),f.drawImage(c._canvas,0,0),f.restore()),f._applyOpacity(this),f.drawImage(c._canvas,0,0),f.restore()):(f.save(),f._applyLineJoin(this),f._applyAncestorTransforms(this),h&&(f.save(),f._applyShadow(this),g.call(this,f),f.restore()),f._applyOpacity(this),g.call(this,f),f.restore())),this},drawHit:function(){var a=this.getAttrs(),b=a.drawHitFunc||a.drawFunc,c=this.getLayer().hitCanvas,d=c.getContext();return b&&this.shouldDrawHit()&&(d.save(),d._applyLineJoin(this),d._applyAncestorTransforms(this),b.call(this,d),d.restore()),this},_setDrawFuncs:function(){!this.attrs.drawFunc&&this.drawFunc&&this.setDrawFunc(this.drawFunc),!this.attrs.drawHitFunc&&this.drawHitFunc&&this.setDrawHitFunc(this.drawHitFunc)}}),Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Factory.addColorGetterSetter(Kinetic.Shape,"stroke"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"drawFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"drawHitFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashArray"),Kinetic.Factory.addColorGetterSetter(Kinetic.Shape,"shadowColor"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOpacity"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage"),Kinetic.Factory.addColorGetterSetter(Kinetic.Shape,"fill"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRepeat"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashArrayEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",!0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillPatternOffset",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillPatternScale",1),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"shadowOffset",0),Kinetic.Factory.addRotationGetterSetter(Kinetic.Shape,"fillPatternRotation",0)}(),function(){function a(a,b){a.content.addEventListener(b,function(c){a[I+b](c)},!1)}var b="Stage",c="string",d="px",e="mouseout",f="mouseleave",g="mouseover",h="mouseenter",i="mousemove",j="mousedown",k="mouseup",l="click",m="dblclick",n="touchstart",o="touchend",p="tap",q="dbltap",r="touchmove",s="contentMouseout",t="contentMouseover",u="contentMousemove",v="contentMousedown",w="contentMouseup",x="contentClick",y="contentDblclick",z="contentTouchstart",A="contentTouchend",B="contentDbltap",C="contentTouchmove",D="div",E="relative",F="inline-block",G="kineticjs-content",H=" ",I="_",J="container",K="",L=[j,i,k,e,n,r,o,g],M=L.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(a){this.nodeType=b,Kinetic.Container.call(this,a),this._id=Kinetic.idCounter++,this._buildDOM(),this._bindContentEvents(),Kinetic.stages.push(this)},_validateAdd:function(a){"Layer"!==a.getType()&&Kinetic.Util.error("You may only add layers to the stage.")},setContainer:function(a){return typeof a===c&&(a=document.getElementById(a)),this._setAttr(J,a),this},draw:function(){return Kinetic.Node.prototype.draw.call(this),this},setHeight:function(a){return Kinetic.Node.prototype.setHeight.call(this,a),this._resizeDOM(),this},setWidth:function(a){return Kinetic.Node.prototype.setWidth.call(this,a),this._resizeDOM(),this},clear:function(){var a,b=this.children,c=b.length;for(a=0;c>a;a++)b[a].clear();return this},destroy:function(){var a=this.content;Kinetic.Container.prototype.destroy.call(this),a&&Kinetic.Util._isInDocument(a)&&this.getContainer().removeChild(a)},getMousePosition:function(){return this.mousePos},getTouchPosition:function(){return this.touchPos},getPointerPosition:function(){return this.getTouchPosition()||this.getMousePosition()},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(a){function b(e){var f=i[e],j=f.toDataURL(),k=new Image;k.onload=function(){h.drawImage(k,0,0),e<i.length-1?b(e+1):a.callback(g.toDataURL(c,d))},k.src=j}a=a||{};var c=a.mimeType||null,d=a.quality||null,e=a.x||0,f=a.y||0,g=new Kinetic.SceneCanvas({width:a.width||this.getWidth(),height:a.height||this.getHeight(),pixelRatio:1}),h=g.getContext()._context,i=this.children;(e||f)&&h.translate(-1*e,-1*f),b(0)},toImage:function(a){var b=a.callback;a.callback=function(a){Kinetic.Util._getImage(a,function(a){b(a)})},this.toDataURL(a)},getIntersection:function(){var a,b,c=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),d=this.getChildren(),e=d.length,f=e-1;for(a=f;a>=0;a--)if(b=d[a].getIntersection(c))return b;return null},_resizeDOM:function(){if(this.content){var a,b,c=this.getWidth(),e=this.getHeight(),f=this.getChildren(),g=f.length;for(this.content.style.width=c+d,this.content.style.height=e+d,this.bufferCanvas.setSize(c,e),this.bufferHitCanvas.setSize(c,e),a=0;g>a;a++)b=f[a],b.getCanvas().setSize(c,e),b.hitCanvas.setSize(c,e),b.draw()}},add:function(a){return Kinetic.Container.prototype.add.call(this,a),a.canvas.setSize(this.attrs.width,this.attrs.height),a.hitCanvas.setSize(this.attrs.width,this.attrs.height),a.draw(),this.content.appendChild(a.canvas._canvas),this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_setPointerPosition:function(a){a||(a=window.event),this._setMousePosition(a),this._setTouchPosition(a)},_bindContentEvents:function(){var b;for(b=0;M>b;b++)a(this,L[b])},_mouseover:function(a){this._fire(t,a)},_mouseout:function(a){this._setPointerPosition(a);var b=this.targetShape;b&&!Kinetic.isDragging()&&(b._fireAndBubble(e,a),b._fireAndBubble(f,a),this.targetShape=null),this.mousePos=void 0,this._fire(s,a)},_mousemove:function(a){this._setPointerPosition(a);var b=Kinetic.DD,c=this.getIntersection(this.getPointerPosition()),d=c&&c.shape?c.shape:void 0;d?Kinetic.isDragging()||255!==c.pixel[3]||this.targetShape&&this.targetShape._id===d._id?d._fireAndBubble(i,a):(this.targetShape&&(this.targetShape._fireAndBubble(e,a,d),this.targetShape._fireAndBubble(f,a,d)),d._fireAndBubble(g,a,this.targetShape),d._fireAndBubble(h,a,this.targetShape),this.targetShape=d):this.targetShape&&!Kinetic.isDragging()&&(this.targetShape._fireAndBubble(e,a),this.targetShape._fireAndBubble(f,a),this.targetShape=null),this._fire(u,a),b&&b._drag(a),a.preventDefault&&a.preventDefault()},_mousedown:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),c=b&&b.shape?b.shape:void 0;Kinetic.listenClickTap=!0,c&&(this.clickStartShape=c,c._fireAndBubble(j,a)),this._fire(v),a.preventDefault&&a.preventDefault()},_mouseup:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),c=b&&b.shape?b.shape:void 0,d=!1;Kinetic.inDblClickWindow?(d=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),c&&(c._fireAndBubble(k,a),Kinetic.listenClickTap&&c._id===this.clickStartShape._id&&(c._fireAndBubble(l,a),d&&c._fireAndBubble(m,a))),this._fire(w),Kinetic.listenClickTap&&(this._fire(x,a),d&&this._fire(y,a)),Kinetic.listenClickTap=!1,a.preventDefault&&a.preventDefault()},_touchstart:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),c=b&&b.shape?b.shape:void 0;Kinetic.listenClickTap=!0,c&&(this.tapStartShape=c,c._fireAndBubble(n,a),c.isListening()&&a.preventDefault&&a.preventDefault()),this._fire(z,a)},_touchend:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),c=b&&b.shape?b.shape:void 0,d=!1;Kinetic.inDblClickWindow?(d=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),c&&(c._fireAndBubble(o,a),Kinetic.listenClickTap&&c._id===this.tapStartShape._id&&(c._fireAndBubble(p,a),d&&c._fireAndBubble(q,a)),c.isListening()&&a.preventDefault&&a.preventDefault()),Kinetic.listenClickTap&&(this._fire(A,a),d&&this._fire(B,a)),Kinetic.listenClickTap=!1},_touchmove:function(a){this._setPointerPosition(a);var b=Kinetic.DD,c=this.getIntersection(this.getPointerPosition()),d=c&&c.shape?c.shape:void 0;d&&(d._fireAndBubble(r,a),d.isListening()&&a.preventDefault&&a.preventDefault()),this._fire(C,a),b&&b._drag(a)},_setMousePosition:function(a){var b=this._getContentPosition(),c=a.offsetX,d=a.clientX,e=0,f=0;void 0!==c?(e=c,f=a.offsetY):"mozilla"===Kinetic.UA.browser?(e=a.layerX,f=a.layerY):void 0!==d&&b&&(e=d-b.left,f=a.clientY-b.top),this.mousePos={x:e,y:f}},_setTouchPosition:function(a){var b,c,d,e=this._getContentPosition();void 0!==a.touches&&1===a.touches.length&&(b=a.touches[0],c=b.clientX-e.left,d=b.clientY-e.top,this.touchPos={x:c,y:d})},_getContentPosition:function(){var a=this.content.getBoundingClientRect();return{top:a.top,left:a.left}},_buildDOM:function(){var a=this.getContainer();a.innerHTML=K,this.content=document.createElement(D),this.content.style.position=E,this.content.style.display=F,this.content.className=G,a.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas,this.bufferHitCanvas=new Kinetic.HitCanvas,this._resizeDOM()},_onContent:function(a,b){var c,d,e=a.split(H),f=e.length;for(c=0;f>c;c++)d=e[c],this.content.addEventListener(d,b,!1)}}),Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Factory.addGetter(Kinetic.Stage,"container")}(),function(){var a="#",b="beforeDraw",c="draw";Kinetic.Util.addMethods(Kinetic.Layer,{___init:function(a){this.nodeType="Layer",this.canvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,Kinetic.Container.call(this,a)},_validateAdd:function(a){var b=a.getType();"Group"!==b&&"Shape"!==b&&Kinetic.Util.error("You may only add groups and shapes to a layer.")},getIntersection:function(){var b,c,d,e=Kinetic.Util._getXY(Array.prototype.slice.call(arguments));if(this.isVisible()&&this.isListening()){if(b=this.hitCanvas.context._context.getImageData(0|e.x,0|e.y,1,1).data,255===b[3])return c=Kinetic.Util._rgbToHex(b[0],b[1],b[2]),d=Kinetic.shapes[a+c],{shape:d,pixel:b};if(b[0]>0||b[1]>0||b[2]>0||b[3]>0)return{pixel:b}}return null},drawScene:function(a){return a=a||this.getCanvas(),this._fire(b,{node:this}),this.getClearBeforeDraw()&&a.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,a),this._fire(c,{node:this}),this},drawHit:function(){var a=this.getLayer();return a&&a.getClearBeforeDraw()&&a.getHitCanvas().getContext().clear(),Kinetic.Container.prototype.drawHit.call(this),this},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(){var a=this.getContext(),b=this.getHitCanvas().getContext();return a.clear.apply(a,arguments),b.clear.apply(b,arguments),this},setVisible:function(a){return Kinetic.Node.prototype.setVisible.call(this,a),a?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this},setZIndex:function(a){Kinetic.Node.prototype.setZIndex.call(this,a);var b=this.getStage();return b&&(b.content.removeChild(this.getCanvas()._canvas),a<b.getChildren().length-1?b.content.insertBefore(this.getCanvas()._canvas,b.getChildren()[a+1].getCanvas()._canvas):b.content.appendChild(this.getCanvas()._canvas)),this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),a.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),this.index<a.getChildren().length-1?a.content.insertBefore(this.getCanvas()._canvas,a.getChildren()[this.index+1].getCanvas()._canvas):a.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var a=this.getStage();if(a){var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas),a.content.insertBefore(this.getCanvas()._canvas,b[this.index+1].getCanvas()._canvas);}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var a=this.getStage();if(a){var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas),a.content.insertBefore(this.getCanvas()._canvas,b[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var a=this.getStage(),b=this.getCanvas(),c=b._canvas;return Kinetic.Node.prototype.remove.call(this),a&&c&&Kinetic.Util._isInDocument(c)&&a.content.removeChild(c),this},getStage:function(){return this.parent}}),Kinetic.Util.extend(Kinetic.Layer,Kinetic.Container),Kinetic.Factory.addGetterSetter(Kinetic.Layer,"clearBeforeDraw",!0)}(),function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(a){this.nodeType="Group",Kinetic.Container.call(this,a)},_validateAdd:function(a){var b=a.getType();"Group"!==b&&"Shape"!==b&&Kinetic.Util.error("You may only add groups and shapes to groups.")}}),Kinetic.Util.extend(Kinetic.Group,Kinetic.Container)}(),function(){Kinetic.Rect=function(a){this.___init(a)},Kinetic.Rect.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Rect"},drawFunc:function(a){var b=this.getCornerRadius(),c=this.getWidth(),d=this.getHeight();a.beginPath(),b?(a.moveTo(b,0),a.lineTo(c-b,0),a.arc(c-b,b,b,3*Math.PI/2,0,!1),a.lineTo(c,d-b),a.arc(c-b,d-b,b,0,Math.PI/2,!1),a.lineTo(b,d),a.arc(b,d-b,b,Math.PI/2,Math.PI,!1),a.lineTo(0,b),a.arc(b,b,b,Math.PI,3*Math.PI/2,!1)):a.rect(0,0,c,d),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0)}(),function(){var a=2*Math.PI-1e-4,b="Circle";Kinetic.Circle=function(a){this.___init(a)},Kinetic.Circle.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className=b},drawFunc:function(b){b.beginPath(),b.arc(0,0,this.getRadius(),0,a,!1),b.closePath(),b.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a),this.setRadius(a/2)},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a),this.setRadius(a/2)}},Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Circle,"radius",0)}(),function(){var a=2*Math.PI-1e-4,b="Ellipse";Kinetic.Ellipse=function(a){this.___init(a)},Kinetic.Ellipse.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className=b},drawFunc:function(b){var c=this.getRadius();b.beginPath(),b.save(),c.x!==c.y&&b.scale(1,c.y/c.x),b.arc(0,0,c.x,0,a,!1),b.restore(),b.closePath(),b.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius().x},getHeight:function(){return 2*this.getRadius().y},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a),this.setRadius({x:a/2})},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a),this.setRadius({y:a/2})}},Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Factory.addPointGetterSetter(Kinetic.Ellipse,"radius",0)}(),function(){Kinetic.Wedge=function(a){this.___init(a)},Kinetic.Wedge.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Wedge"},drawFunc:function(a){a.beginPath(),a.arc(0,0,this.getRadius(),0,this.getAngle(),this.getClockwise()),a.lineTo(0,0),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"radius",0),Kinetic.Factory.addRotationGetterSetter(Kinetic.Wedge,"angle",0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"clockwise",!1)}(),function(){var a="Image",b="set";Kinetic.Image=function(a){this.___init(a)},Kinetic.Image.prototype={___init:function(b){Kinetic.Shape.call(this,b),this.className=a},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},drawFunc:function(a){var b,c,d,e=this.getWidth(),f=this.getHeight();this.getFilter()&&this._applyFilter&&(this.applyFilter(),this._applyFilter=!1),this.filterCanvas?(d=this.filterCanvas._canvas,c=[d,0,0,e,f]):(d=this.getImage(),d&&(b=this.getCrop(),b?(b.x=b.x||0,b.y=b.y||0,b.width=b.width||d.width-b.x,b.height=b.height||d.height-b.y,c=[d,b.x,b.y,b.width,b.height,0,0,e,f]):c=[d,0,0,e,f])),a.beginPath(),a.rect(0,0,e,f),a.closePath(),a.fillStrokeShape(this),d&&a.drawImage.apply(a,c)},drawHitFunc:function(a){var b=this.getWidth(),c=this.getHeight(),d=this.imageHitRegion;d?(a.drawImage(d,0,0,b,c),a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.strokeShape(this)):(a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.fillStrokeShape(this))},applyFilter:function(){var a,b,c,d=this.getImage(),e=(this.getWidth(),this.getHeight(),this.getFilter()),f=this.getCrop()||{};f.x=f.x||0,f.y=f.y||0,f.width=f.width||d.width-f.x,f.height=f.height||d.height-f.y,this.filterCanvas&&this.filterCanvas.getWidth()===f.width&&this.filterCanvas.getHeight()===f.height?(a=this.filterCanvas,a.getContext().clear()):a=this.filterCanvas=new Kinetic.SceneCanvas({width:f.width,height:f.height,pixelRatio:1}),b=a.getContext();try{b.drawImage(d,f.x,f.y,f.width,f.height,0,0,f.width,f.height),c=b.getImageData(0,0,f.width,f.height),e.call(this,c),b.putImageData(c,0,0)}catch(g){this.clearFilter(),Kinetic.Util.warn("Unable to apply filter. "+g.message)}},clearFilter:function(){this.filterCanvas=null,this._applyFilter=!1},createImageHitRegion:function(a){var b,c,d,e,f,g=this,h=this.getWidth(),i=this.getHeight(),j=new Kinetic.SceneCanvas({width:h,height:i}),k=j.getContext()._context,l=this.getImage();k.drawImage(l,0,0);try{for(b=k.getImageData(0,0,h,i),c=b.data,f=c.length,d=Kinetic.Util._hexToRgb(this.colorKey),e=0;f>e;e+=4)c[e+3]>0&&(c[e]=d.r,c[e+1]=d.g,c[e+2]=d.b);Kinetic.Util._getImage(b,function(b){g.imageHitRegion=b,a&&a()})}catch(m){Kinetic.Util.warn("Unable to create image hit region. "+m.message)}},clearImageHitRegion:function(){delete this.imageHitRegion},getWidth:function(){var a=this.getImage();return this.attrs.width||(a?a.width:0)},getHeight:function(){var a=this.getImage();return this.attrs.height||(a?a.height:0)}},Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Factory.addFilterGetterSetter=function(a,b,c){this.addGetter(a,b,c),this.addFilterSetter(a,b)},Kinetic.Factory.addFilterSetter=function(a,c){var d=b+Kinetic.Util._capitalize(c);a.prototype[d]=function(a){this._setAttr(c,a),this._applyFilter=!0}},Kinetic.Factory.addGetterSetter(Kinetic.Image,"image"),Kinetic.Factory.addBoxGetterSetter(Kinetic.Image,"crop"),Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filter")}(),function(){Kinetic.Polygon=function(a){this.___init(a)},Kinetic.Polygon.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Polygon"},drawFunc:function(a){var b=this.getPoints(),c=b.length;a.beginPath(),a.moveTo(b[0].x,b[0].y);for(var d=1;c>d;d++)a.lineTo(b[d].x,b[d].y);a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Polygon,Kinetic.Shape),Kinetic.Factory.addPointsGetterSetter(Kinetic.Polygon,"points")}(),function(){function a(a){a.fillText(this.partialText,0,0)}function b(a){a.strokeText(this.partialText,0,0)}var c="auto",d="Calibri",e="canvas",f="center",g="Change.kinetic",h="2d",i="-",j="",k="left",l="text",m="Text",n="middle",o="normal",p="px ",q=" ",r="right",s="word",t="char",u="none",v=["fontFamily","fontSize","fontStyle","padding","align","lineHeight","text","width","height","wrap"],w=v.length,x=document.createElement(e).getContext(h);Kinetic.Text=function(a){this.___init(a)},Kinetic.Text.prototype={___init:function(d){var e=this;void 0===d.width&&(d.width=c),void 0===d.height&&(d.height=c),Kinetic.Shape.call(this,d),this._fillFunc=a,this._strokeFunc=b,this.className=m;for(var f=0;w>f;f++)this.on(v[f]+g,e._setTextData);this._setTextData()},drawFunc:function(a){var b=this.getPadding(),c=(this.getFontStyle(),this.getFontSize(),this.getFontFamily(),this.getTextHeight()),d=this.getLineHeight()*c,e=this.textArr,g=e.length,h=this.getWidth();a.setAttr("font",this._getContextFont()),a.setAttr("textBaseline",n),a.setAttr("textAlign",k),a.save(),a.translate(b,0),a.translate(0,b+c/2);for(var i=0;g>i;i++){var j=e[i],l=j.text,m=j.width;a.save(),this.getAlign()===r?a.translate(h-m-2*b,0):this.getAlign()===f&&a.translate((h-m-2*b)/2,0),this.partialText=l,a.fillStrokeShape(this),a.restore(),a.translate(0,d)}a.restore()},drawHitFunc:function(a){var b=this.getWidth(),c=this.getHeight();a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.fillStrokeShape(this)},setText:function(a){var b=Kinetic.Util._isString(a)?a:a.toString();this._setAttr(l,b)},getWidth:function(){return this.attrs.width===c?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return this.attrs.height===c?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(a){var b,c=x,d=this.getFontSize();return c.save(),c.font=this._getContextFont(),b=c.measureText(a),c.restore(),{width:b.width,height:parseInt(d,10)}},_getContextFont:function(){return this.getFontStyle()+q+this.getFontSize()+p+this.getFontFamily()},_addTextLine:function(a,b,c){return this.textArr.push({text:a,width:b})},_getTextWidth:function(a){return x.measureText(a).width},_setTextData:function(){var a=this.getText().split("\n"),b=+this.getFontSize(),d=0,e=this.getLineHeight()*b,f=this.attrs.width,g=this.attrs.height,h=f!==c,j=g!==c,k=this.getPadding(),l=f-2*k,m=g-2*k,n=0,o=this.getWrap(),r=o!==u,s=o!==t&&r;this.textArr=[],x.save(),x.font=this.getFontStyle()+q+b+p+this.getFontFamily();for(var v=0,w=a.length;w>v;++v){var y=a[v],z=this._getTextWidth(y);if(h&&z>l)for(;y.length>0;){for(var A=0,B=y.length,C="",D=0;B>A;){var E=A+B>>>1,F=y.slice(0,E+1),G=this._getTextWidth(F);l>=G?(A=E+1,C=F,D=G):B=E}if(!C)break;if(s){var H=Math.max(C.lastIndexOf(q),C.lastIndexOf(i))+1;H>0&&(A=H,C=C.slice(0,A),D=this._getTextWidth(C))}if(this._addTextLine(C,D),n+=e,!r||j&&n+e>m)break;if(y=y.slice(A),y.length>0&&(z=this._getTextWidth(y),l>=z)){this._addTextLine(y,z),n+=e;break}}else this._addTextLine(y,z),n+=e,d=Math.max(d,z);if(j&&n+e>m)break}x.restore(),this.textHeight=b,this.textWidth=d}},Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily",d),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle",o),Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0),Kinetic.Factory.addGetterSetter(Kinetic.Text,"align",k),Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",1),Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap",s),Kinetic.Factory.addGetter(Kinetic.Text,l,j),Kinetic.Factory.addSetter(Kinetic.Text,"width"),Kinetic.Factory.addSetter(Kinetic.Text,"height")}(),function(){Kinetic.Line=function(a){this.___init(a)},Kinetic.Line.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Line"},drawFunc:function(a){var b,c,d=this.getPoints(),e=d.length;for(a.beginPath(),a.moveTo(d[0].x,d[0].y),b=1;e>b;b++)c=d[b],a.lineTo(c.x,c.y);a.strokeShape(this)}},Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape),Kinetic.Factory.addPointsGetterSetter(Kinetic.Line,"points")}(),function(){Kinetic.Spline=function(a){this.___init(a)},Kinetic.Spline.prototype={___init:function(a){var b=this;Kinetic.Shape.call(this,a),this.className="Spline",this.on("pointsChange.kinetic tensionChange.kinetic",function(){b._setAllPoints()}),this._setAllPoints()},drawFunc:function(a){var b,c,d,e,f=this.getPoints(),g=f.length,h=this.getTension();if(a.beginPath(),a.moveTo(f[0].x,f[0].y),0!==h&&g>2){for(b=this.allPoints,c=b.length,d=2,a.quadraticCurveTo(b[0].x,b[0].y,b[1].x,b[1].y);c-1>d;)a.bezierCurveTo(b[d].x,b[d++].y,b[d].x,b[d++].y,b[d].x,b[d++].y);a.quadraticCurveTo(b[c-1].x,b[c-1].y,f[g-1].x,f[g-1].y)}else for(d=1;g>d;d++)e=f[d],a.lineTo(e.x,e.y);a.strokeShape(this)},_setAllPoints:function(){this.allPoints=Kinetic.Util._expandPoints(this.getPoints(),this.getTension())}},Kinetic.Util.extend(Kinetic.Spline,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Spline,"tension",1),Kinetic.Factory.addPointsGetterSetter(Kinetic.Spline,"points")}(),function(){Kinetic.Blob=function(a){this.___init(a)},Kinetic.Blob.prototype={___init:function(a){var b=this;Kinetic.Shape.call(this,a),this.className="Blob",this.on("pointsChange.kinetic tensionChange.kinetic",function(){b._setAllPoints()}),this._setAllPoints()},drawFunc:function(a){var b,c,d,e,f=this.getPoints(),g=f.length,h=this.getTension();if(a.beginPath(),a.moveTo(f[0].x,f[0].y),0!==h&&g>2)for(b=this.allPoints,c=b.length,d=0;c-1>d;)a.bezierCurveTo(b[d].x,b[d++].y,b[d].x,b[d++].y,b[d].x,b[d++].y);else for(d=1;g>d;d++)e=f[d],a.lineTo(e.x,e.y);a.closePath(),a.fillStrokeShape(this)},_setAllPoints:function(){var a=this.getPoints(),b=a.length,c=this.getTension(),d=Kinetic.Util,e=d._getControlPoints(a[b-1],a[0],a[1],c),f=d._getControlPoints(a[b-2],a[b-1],a[0],c);this.allPoints=Kinetic.Util._expandPoints(this.getPoints(),this.getTension()),this.allPoints.unshift(e[1]),this.allPoints.push(f[0]),this.allPoints.push(a[b-1]),this.allPoints.push(f[1]),this.allPoints.push(e[0]),this.allPoints.push(a[0])}},Kinetic.Util.extend(Kinetic.Blob,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Blob,"tension",1),Kinetic.Factory.addPointsGetterSetter(Kinetic.Blob,"points")}(),function(){Kinetic.Sprite=function(a){this.___init(a)},Kinetic.Sprite.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Sprite",this.anim=new Kinetic.Animation;var b=this;this.on("animationChange.kinetic",function(){b.setIndex(0)})},drawFunc:function(a){var b=this.getAnimation(),c=this.getIndex(),d=this.getAnimations()[b][c],e=this.getImage();e&&a.drawImage(e,d.x,d.y,d.width,d.height,0,0,d.width,d.height)},drawHitFunc:function(a){var b=this.getAnimation(),c=this.getIndex(),d=this.getAnimations()[b][c];a.beginPath(),a.rect(0,0,d.width,d.height),a.closePath(),a.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},start:function(){var a=this,b=this.getLayer();this.anim.setLayers(b),this.interval=setInterval(function(){var b=a.getIndex();a._updateIndex(),a.afterFrameFunc&&b===a.afterFrameIndex&&(a.afterFrameFunc(),delete a.afterFrameFunc,delete a.afterFrameIndex)},1e3/this.getFrameRate()),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},afterFrame:function(a,b){this.afterFrameIndex=a,this.afterFrameFunc=b},_updateIndex:function(){var a=this.getIndex(),b=this.getAnimation(),c=this.getAnimations(),d=c[b],e=d.length;e-1>a?this.setIndex(a+1):this.setIndex(0)}},Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animation"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animations"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"image"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"index",0),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameRate",17)}(),function(){Kinetic.Path=function(a){this.___init(a)},Kinetic.Path.prototype={___init:function(a){this.dataArray=[];var b=this;Kinetic.Shape.call(this,a),this.className="Path",this.dataArray=Kinetic.Path.parsePathData(this.getData()),this.on("dataChange.kinetic",function(){b.dataArray=Kinetic.Path.parsePathData(this.getData())})},drawFunc:function(a){var b=this.dataArray,c=!1;a.beginPath();for(var d=0;d<b.length;d++){var e=b[d].command,f=b[d].points;switch(e){case"L":a.lineTo(f[0],f[1]);break;case"M":a.moveTo(f[0],f[1]);break;case"C":a.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5]);break;case"Q":a.quadraticCurveTo(f[0],f[1],f[2],f[3]);break;case"A":var g=f[0],h=f[1],i=f[2],j=f[3],k=f[4],l=f[5],m=f[6],n=f[7],o=i>j?i:j,p=i>j?1:i/j,q=i>j?j/i:1;a.translate(g,h),a.rotate(m),a.scale(p,q),a.arc(0,0,o,k,k+l,1-n),a.scale(1/p,1/q),a.rotate(-m),a.translate(-g,-h);break;case"z":a.closePath(),c=!0}}c?a.fillStrokeShape(this):a.strokeShape(this)}},Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))},Kinetic.Path.getPointOnLine=function(a,b,c,d,e,f,g){void 0===f&&(f=b),void 0===g&&(g=c);var h=(e-c)/(d-b+1e-8),i=Math.sqrt(a*a/(1+h*h));b>d&&(i*=-1);var j,k=h*i;if(d===b)j={x:f,y:g+k};else if((g-c)/(f-b+1e-8)===h)j={x:f+i,y:g+k};else{var l,m,n=this.getLineLength(b,c,d,e);if(1e-8>n)return void 0;var o=(f-b)*(d-b)+(g-c)*(e-c);o/=n*n,l=b+o*(d-b),m=c+o*(e-c);var p=this.getLineLength(f,g,l,m),q=Math.sqrt(a*a-p*p);i=Math.sqrt(q*q/(1+h*h)),b>d&&(i*=-1),k=h*i,j={x:l+i,y:m+k}}return j},Kinetic.Path.getPointOnCubicBezier=function(a,b,c,d,e,f,g,h,i){function j(a){return a*a*a}function k(a){return 3*a*a*(1-a)}function l(a){return 3*a*(1-a)*(1-a)}function m(a){return(1-a)*(1-a)*(1-a)}var n=h*j(a)+f*k(a)+d*l(a)+b*m(a),o=i*j(a)+g*k(a)+e*l(a)+c*m(a);return{x:n,y:o}},Kinetic.Path.getPointOnQuadraticBezier=function(a,b,c,d,e,f,g){function h(a){return a*a}function i(a){return 2*a*(1-a)}function j(a){return(1-a)*(1-a)}var k=f*h(a)+d*i(a)+b*j(a),l=g*h(a)+e*i(a)+c*j(a);return{x:k,y:l}},Kinetic.Path.getPointOnEllipticalArc=function(a,b,c,d,e,f){var g=Math.cos(f),h=Math.sin(f),i={x:c*Math.cos(e),y:d*Math.sin(e)};return{x:a+(i.x*g-i.y*h),y:b+(i.x*h+i.y*g)}},Kinetic.Path.parsePathData=function(a){if(!a)return[];var b=a,c=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];b=b.replace(new RegExp(" ","g"),",");for(var d=0;d<c.length;d++)b=b.replace(new RegExp(c[d],"g"),"|"+c[d]);var e=b.split("|"),f=[],g=0,h=0;for(d=1;d<e.length;d++){var i=e[d],j=i.charAt(0);i=i.slice(1),i=i.replace(new RegExp(",-","g"),"-"),i=i.replace(new RegExp("-","g"),",-"),i=i.replace(new RegExp("e,-","g"),"e-");var k=i.split(",");k.length>0&&""===k[0]&&k.shift();for(var l=0;l<k.length;l++)k[l]=parseFloat(k[l]);for(;k.length>0&&!isNaN(k[0]);){var m,n,o,p,q,r,s,t,u,v,w=null,x=[],y=g,z=h;switch(j){case"l":g+=k.shift(),h+=k.shift(),w="L",x.push(g,h);break;case"L":g=k.shift(),h=k.shift(),x.push(g,h);break;case"m":g+=k.shift(),h+=k.shift(),w="M",x.push(g,h),j="l";break;case"M":g=k.shift(),h=k.shift(),w="M",x.push(g,h),j="L";break;case"h":g+=k.shift(),w="L",x.push(g,h);break;case"H":g=k.shift(),w="L",x.push(g,h);break;case"v":h+=k.shift(),w="L",x.push(g,h);break;case"V":h=k.shift(),w="L",x.push(g,h);break;case"C":x.push(k.shift(),k.shift(),k.shift(),k.shift()),g=k.shift(),h=k.shift(),x.push(g,h);break;case"c":x.push(g+k.shift(),h+k.shift(),g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),w="C",x.push(g,h);break;case"S":n=g,o=h,m=f[f.length-1],"C"===m.command&&(n=g+(g-m.points[2]),o=h+(h-m.points[3])),x.push(n,o,k.shift(),k.shift()),g=k.shift(),h=k.shift(),w="C",x.push(g,h);break;case"s":n=g,o=h,m=f[f.length-1],"C"===m.command&&(n=g+(g-m.points[2]),o=h+(h-m.points[3])),x.push(n,o,g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),w="C",x.push(g,h);break;case"Q":x.push(k.shift(),k.shift()),g=k.shift(),h=k.shift(),x.push(g,h);break;case"q":x.push(g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),w="Q",x.push(g,h);break;case"T":n=g,o=h,m=f[f.length-1],"Q"===m.command&&(n=g+(g-m.points[0]),o=h+(h-m.points[1])),g=k.shift(),h=k.shift(),w="Q",x.push(n,o,g,h);break;case"t":n=g,o=h,m=f[f.length-1],"Q"===m.command&&(n=g+(g-m.points[0]),o=h+(h-m.points[1])),g+=k.shift(),h+=k.shift(),w="Q",x.push(n,o,g,h);break;case"A":p=k.shift(),q=k.shift(),r=k.shift(),s=k.shift(),t=k.shift(),u=g,v=h,g=k.shift(),h=k.shift(),w="A",x=this.convertEndpointToCenterParameterization(u,v,g,h,s,t,p,q,r);break;case"a":p=k.shift(),q=k.shift(),r=k.shift(),s=k.shift(),t=k.shift(),u=g,v=h,g+=k.shift(),h+=k.shift(),w="A",x=this.convertEndpointToCenterParameterization(u,v,g,h,s,t,p,q,r)}f.push({command:w||j,points:x,start:{x:y,y:z},pathLength:this.calcLength(y,z,w||j,x)})}("z"===j||"Z"===j)&&f.push({command:"z",points:[],start:void 0,pathLength:0})}return f},Kinetic.Path.calcLength=function(a,b,c,d){var e,f,g,h=Kinetic.Path;switch(c){case"L":return h.getLineLength(a,b,d[0],d[1]);case"C":for(e=0,f=h.getPointOnCubicBezier(0,a,b,d[0],d[1],d[2],d[3],d[4],d[5]),t=.01;t<=1;t+=.01)g=h.getPointOnCubicBezier(t,a,b,d[0],d[1],d[2],d[3],d[4],d[5]),e+=h.getLineLength(f.x,f.y,g.x,g.y),f=g;return e;case"Q":for(e=0,f=h.getPointOnQuadraticBezier(0,a,b,d[0],d[1],d[2],d[3]),t=.01;t<=1;t+=.01)g=h.getPointOnQuadraticBezier(t,a,b,d[0],d[1],d[2],d[3]),e+=h.getLineLength(f.x,f.y,g.x,g.y),f=g;return e;case"A":e=0;var i=d[4],j=d[5],k=d[4]+j,l=Math.PI/180;if(Math.abs(i-k)<l&&(l=Math.abs(i-k)),f=h.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],i,0),0>j)for(t=i-l;t>k;t-=l)g=h.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],t,0),e+=h.getLineLength(f.x,f.y,g.x,g.y),f=g;else for(t=i+l;t<k;t+=l)g=h.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],t,0),e+=h.getLineLength(f.x,f.y,g.x,g.y),f=g;return g=h.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],k,0),e+=h.getLineLength(f.x,f.y,g.x,g.y)}return 0},Kinetic.Path.convertEndpointToCenterParameterization=function(a,b,c,d,e,f,g,h,i){var j=i*(Math.PI/180),k=Math.cos(j)*(a-c)/2+Math.sin(j)*(b-d)/2,l=-1*Math.sin(j)*(a-c)/2+Math.cos(j)*(b-d)/2,m=k*k/(g*g)+l*l/(h*h);m>1&&(g*=Math.sqrt(m),h*=Math.sqrt(m));var n=Math.sqrt((g*g*(h*h)-g*g*(l*l)-h*h*(k*k))/(g*g*(l*l)+h*h*(k*k)));e==f&&(n*=-1),isNaN(n)&&(n=0);var o=n*g*l/h,p=n*-h*k/g,q=(a+c)/2+Math.cos(j)*o-Math.sin(j)*p,r=(b+d)/2+Math.sin(j)*o+Math.cos(j)*p,s=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])},t=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(s(a)*s(b))},u=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(t(a,b))},v=u([1,0],[(k-o)/g,(l-p)/h]),w=[(k-o)/g,(l-p)/h],x=[(-1*k-o)/g,(-1*l-p)/h],y=u(w,x);return t(w,x)<=-1&&(y=Math.PI),t(w,x)>=1&&(y=0),0===f&&y>0&&(y-=2*Math.PI),1==f&&0>y&&(y+=2*Math.PI),[q,r,g,h,v,y,j,f]},Kinetic.Factory.addGetterSetter(Kinetic.Path,"data")}(),function(){function a(a){a.fillText(this.partialText,0,0)}function b(a){a.strokeText(this.partialText,0,0)}var c="",d="Calibri",e="normal";Kinetic.TextPath=function(a){this.___init(a)},Kinetic.TextPath.prototype={___init:function(c){var d=this;this.dummyCanvas=document.createElement("canvas"),this.dataArray=[],Kinetic.Shape.call(this,c),this._fillFunc=a,this._strokeFunc=b,this.className="TextPath",this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange.kinetic",function(){d.dataArray=Kinetic.Path.parsePathData(this.attrs.data)}),this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",d._setTextData),d._setTextData()},drawFunc:function(a){this.charArr;a.setAttr("font",this._getContextFont()),a.setAttr("textBaseline","middle"),a.setAttr("textAlign","left"),a.save();for(var b=this.glyphInfo,c=0;c<b.length;c++){a.save();var d=b[c].p0;b[c].p1,parseFloat(this.attrs.fontSize);a.translate(d.x,d.y),a.rotate(b[c].rotation),this.partialText=b[c].text,a.fillStrokeShape(this),a.restore()}a.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(a){Kinetic.Text.prototype.setText.call(this,a)},_getTextSize:function(a){var b=this.dummyCanvas,c=b.getContext("2d");c.save(),c.font=this._getContextFont();var d=c.measureText(a);return c.restore(),{width:d.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var a=this,b=this._getTextSize(this.attrs.text);this.textWidth=b.width,this.textHeight=b.height,this.glyphInfo=[];for(var c,d,e,f=this.attrs.text.split(""),g=-1,h=0,i=function(){h=0;for(var b=a.dataArray,d=g+1;d<b.length;d++){if(b[d].pathLength>0)return g=d,b[d];"M"==b[d].command&&(c={x:b[d].points[0],y:b[d].points[1]})}return{}},j=function(b,f){var g=a._getTextSize(b).width,j=0,k=0;for(d=void 0;Math.abs(g-j)/g>.01&&25>k;){k++;for(var l=j;void 0===e;)e=i(),e&&l+e.pathLength<g&&(l+=e.pathLength,e=void 0);if(e==={}||void 0===c)return void 0;var m=!1;switch(e.command){case"L":Kinetic.Path.getLineLength(c.x,c.y,e.points[0],e.points[1])>g?d=Kinetic.Path.getPointOnLine(g,c.x,c.y,e.points[0],e.points[1],c.x,c.y):e=void 0;break;case"A":var n=e.points[4],o=e.points[5],p=e.points[4]+o;0===h?h=n+1e-8:g>j?h+=Math.PI/180*o/Math.abs(o):h-=Math.PI/360*o/Math.abs(o),(0>o&&p>h||o>=0&&h>p)&&(h=p,m=!0),d=Kinetic.Path.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],h,e.points[6]);break;case"C":0===h?h=g>e.pathLength?1e-8:g/e.pathLength:g>j?h+=(g-j)/e.pathLength:h-=(j-g)/e.pathLength,h>1&&(h=1,m=!0),d=Kinetic.Path.getPointOnCubicBezier(h,e.start.x,e.start.y,e.points[0],e.points[1],e.points[2],e.points[3],e.points[4],e.points[5]);break;case"Q":0===h?h=g/e.pathLength:g>j?h+=(g-j)/e.pathLength:h-=(j-g)/e.pathLength,h>1&&(h=1,m=!0),d=Kinetic.Path.getPointOnQuadraticBezier(h,e.start.x,e.start.y,e.points[0],e.points[1],e.points[2],e.points[3])}void 0!==d&&(j=Kinetic.Path.getLineLength(c.x,c.y,d.x,d.y)),m&&(m=!1,e=void 0)}},k=0;k<f.length&&(j(f[k]),void 0!==c&&void 0!==d);k++){var l=Kinetic.Path.getLineLength(c.x,c.y,d.x,d.y),m=0,n=Kinetic.Path.getPointOnLine(m+l/2,c.x,c.y,d.x,d.y),o=Math.atan2(d.y-c.y,d.x-c.x);this.glyphInfo.push({transposeX:n.x,transposeY:n.y,text:f[k],rotation:o,p0:c,p1:d}),c=d}}},Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont,Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontFamily",d),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontStyle",e),Kinetic.Factory.addGetter(Kinetic.TextPath,"text",c)}(),function(){Kinetic.RegularPolygon=function(a){this.___init(a)},Kinetic.RegularPolygon.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="RegularPolygon"},drawFunc:function(a){var b,c,d,e=this.attrs.sides,f=this.attrs.radius;for(a.beginPath(),a.moveTo(0,0-f),b=1;e>b;b++)c=f*Math.sin(2*b*Math.PI/e),d=-1*f*Math.cos(2*b*Math.PI/e),a.lineTo(c,d);a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"radius",0),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0)}(),function(){Kinetic.Star=function(a){this.___init(a)},Kinetic.Star.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Star"},drawFunc:function(a){var b=a._context,c=this.attrs.innerRadius,d=this.attrs.outerRadius,e=this.attrs.numPoints;b.beginPath(),b.moveTo(0,0-this.attrs.outerRadius);for(var f=1;2*e>f;f++){var g=f%2===0?d:c,h=g*Math.sin(f*Math.PI/e),i=-1*g*Math.cos(f*Math.PI/e);b.lineTo(h,i)}b.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Star,"numPoints",0),Kinetic.Factory.addGetterSetter(Kinetic.Star,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Star,"outerRadius",0)}(),function(){var a=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],b="Change.kinetic",c="none",d="up",e="right",f="down",g="left",h="Label",i=a.length;Kinetic.Label=function(a){this.____init(a)},Kinetic.Label.prototype={____init:function(a){var b=this;this.className=h,Kinetic.Group.call(this,a),this.on("add.kinetic",function(a){b._addListeners(a.child),b._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(c){var d,e=this,f=function(){e._sync()};for(d=0;i>d;d++)c.on(a[d]+b,f)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var a,b,c,h,i,j,k=this.getText(),l=this.getTag();if(k&&l){switch(a=k.getWidth(),b=k.getHeight(),c=l.getPointerDirection(),h=l.getPointerWidth(),pointerHeight=l.getPointerHeight(),i=0,j=0,c){case d:i=a/2,j=-1*pointerHeight;break;case e:i=a+h,j=b/2;break;case f:i=a/2,j=b+pointerHeight;break;case g:i=-1*h,j=b/2}l.setAttrs({x:-1*i,y:-1*j,width:a,height:b}),k.setAttrs({x:-1*i,y:-1*j})}}},Kinetic.Util.extend(Kinetic.Label,Kinetic.Group),Kinetic.Tag=function(a){this.___init(a)},Kinetic.Tag.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Tag"},drawFunc:function(a){var b=this.getWidth(),c=this.getHeight(),h=this.getPointerDirection(),i=this.getPointerWidth(),j=this.getPointerHeight();this.getCornerRadius();a.beginPath(),a.moveTo(0,0),h===d&&(a.lineTo((b-i)/2,0),a.lineTo(b/2,-1*j),a.lineTo((b+i)/2,0)),a.lineTo(b,0),h===e&&(a.lineTo(b,(c-j)/2),a.lineTo(b+i,c/2),a.lineTo(b,(c+j)/2)),a.lineTo(b,c),h===f&&(a.lineTo((b+i)/2,c),a.lineTo(b/2,c+j),a.lineTo((b-i)/2,c)),a.lineTo(0,c),h===g&&(a.lineTo(0,(c+j)/2),a.lineTo(-1*i,c/2),a.lineTo(0,(c-j)/2)),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerDirection",c),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerWidth",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerHeight",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"cornerRadius",0)}(),function(){Kinetic.Filters.Grayscale=function(a){for(var b=a.data,c=0;c<b.length;c+=4){var d=.34*b[c]+.5*b[c+1]+.16*b[c+2];b[c]=d,b[c+1]=d,b[c+2]=d}}}(),function(){Kinetic.Filters.Brighten=function(a){for(var b=this.getFilterBrightness(),c=a.data,d=0;d<c.length;d+=4)c[d]+=b,c[d+1]+=b,c[d+2]+=b},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterBrightness",0)}(),function(){Kinetic.Filters.Invert=function(a){for(var b=a.data,c=0;c<b.length;c+=4)b[c]=255-b[c],b[c+1]=255-b[c+1],b[c+2]=255-b[c+2]}}(),function(){function a(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function b(b,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=b.data,E=b.width,F=b.height,G=e+e+1,H=E-1,I=F-1,J=e+1,K=J*(J+1)/2,L=new a,M=null,N=L,O=null,P=null,Q=c[e],R=d[e];for(h=1;G>h;h++)N=N.next=new a,h==J&&(M=N);for(N.next=L,l=k=0,g=0;F>g;g++){for(u=v=w=x=m=n=o=p=0,q=J*(y=D[k]),r=J*(z=D[k+1]),s=J*(A=D[k+2]),t=J*(B=D[k+3]),m+=K*y,n+=K*z,o+=K*A,p+=K*B,N=L,h=0;J>h;h++)N.r=y,N.g=z,N.b=A,N.a=B,N=N.next;for(h=1;J>h;h++)i=k+((h>H?H:h)<<2),m+=(N.r=y=D[i])*(C=J-h),n+=(N.g=z=D[i+1])*C,o+=(N.b=A=D[i+2])*C,p+=(N.a=B=D[i+3])*C,u+=y,v+=z,w+=A,x+=B,N=N.next;for(O=L,P=M,f=0;E>f;f++)D[k+3]=B=p*Q>>R,0!==B?(B=255/B,D[k]=(m*Q>>R)*B,D[k+1]=(n*Q>>R)*B,D[k+2]=(o*Q>>R)*B):D[k]=D[k+1]=D[k+2]=0,m-=q,n-=r,o-=s,p-=t,q-=O.r,r-=O.g,s-=O.b,t-=O.a,i=l+((i=f+e+1)<H?i:H)<<2,u+=O.r=D[i],v+=O.g=D[i+1],w+=O.b=D[i+2],x+=O.a=D[i+3],m+=u,n+=v,o+=w,p+=x,O=O.next,q+=y=P.r,r+=z=P.g,s+=A=P.b,t+=B=P.a,u-=y,v-=z,w-=A,x-=B,P=P.next,k+=4;l+=E}for(f=0;E>f;f++){for(v=w=x=u=n=o=p=m=0,k=f<<2,q=J*(y=D[k]),r=J*(z=D[k+1]),s=J*(A=D[k+2]),t=J*(B=D[k+3]),m+=K*y,n+=K*z,o+=K*A,p+=K*B,N=L,h=0;J>h;h++)N.r=y,N.g=z,N.b=A,N.a=B,N=N.next;for(j=E,h=1;e>=h;h++)k=j+f<<2,m+=(N.r=y=D[k])*(C=J-h),n+=(N.g=z=D[k+1])*C,o+=(N.b=A=D[k+2])*C,p+=(N.a=B=D[k+3])*C,u+=y,v+=z,w+=A,x+=B,N=N.next,I>h&&(j+=E);for(k=f,O=L,P=M,g=0;F>g;g++)i=k<<2,D[i+3]=B=p*Q>>R,B>0?(B=255/B,D[i]=(m*Q>>R)*B,D[i+1]=(n*Q>>R)*B,D[i+2]=(o*Q>>R)*B):D[i]=D[i+1]=D[i+2]=0,m-=q,n-=r,o-=s,p-=t,q-=O.r,r-=O.g,s-=O.b,t-=O.a,i=f+((i=g+J)<I?i:I)*E<<2,m+=u+=O.r=D[i],n+=v+=O.g=D[i+1],o+=w+=O.b=D[i+2],p+=x+=O.a=D[i+3],O=O.next,q+=y=P.r,r+=z=P.g,s+=A=P.b,t+=B=P.a,u-=y,v-=z,w-=A,x-=B,P=P.next,k+=E}}var c=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],d=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];Kinetic.Filters.Blur=function(a){var c=0|this.getFilterRadius();c>0&&b(a,c)},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterRadius",0)}(),function(){function a(a,b,c){var d=4*(c*a.width+b),e=[];return e.push(a.data[d++],a.data[d++],a.data[d++],a.data[d++]),e}function b(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))}function c(a){for(var b=[0,0,0],c=0;c<a.length;c++)b[0]+=a[c][0],b[1]+=a[c][1],b[2]+=a[c][2];return b[0]/=a.length,b[1]/=a.length,b[2]/=a.length,b}function d(d,e){var f=a(d,0,0),g=a(d,d.width-1,0),h=a(d,0,d.height-1),i=a(d,d.width-1,d.height-1),j=e||10;if(b(f,g)<j&&b(g,i)<j&&b(i,h)<j&&b(h,f)<j){for(var k=c([g,f,i,h]),l=[],m=0;m<d.width*d.height;m++){var n=b(k,[d.data[4*m],d.data[4*m+1],d.data[4*m+2]]);l[m]=j>n?0:255}return l}}function e(a,b){for(var c=0;c<a.width*a.height;c++)a.data[4*c+3]=b[c]}function f(a,b,c){for(var d=[1,1,1,1,0,1,1,1,1],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[],h=0;c>h;h++)for(var i=0;b>i;i++){for(var j=h*b+i,k=0,l=0;e>l;l++)for(var m=0;e>m;m++){var n=h+l-f,o=i+m-f;if(n>=0&&c>n&&o>=0&&b>o){var p=n*b+o,q=d[l*e+m];k+=a[p]*q}}g[j]=2040===k?255:0}return g}function g(a,b,c){for(var d=[1,1,1,1,1,1,1,1,1],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[],h=0;c>h;h++)for(var i=0;b>i;i++){for(var j=h*b+i,k=0,l=0;e>l;l++)for(var m=0;e>m;m++){var n=h+l-f,o=i+m-f;if(n>=0&&c>n&&o>=0&&b>o){var p=n*b+o,q=d[l*e+m];k+=a[p]*q}}g[j]=k>=1020?255:0}return g}function h(a,b,c){for(var d=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[],h=0;c>h;h++)for(var i=0;b>i;i++){for(var j=h*b+i,k=0,l=0;e>l;l++)for(var m=0;e>m;m++){var n=h+l-f,o=i+m-f;if(n>=0&&c>n&&o>=0&&b>o){var p=n*b+o,q=d[l*e+m];k+=a[p]*q}}g[j]=k}return g}Kinetic.Filters.Mask=function(a){var b=this.getFilterThreshold(),c=d(a,b);return c&&(c=f(c,a.width,a.height),c=g(c,a.width,a.height),c=h(c,a.width,a.height),e(a,c)),a},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterThreshold",0)}(),function(){var a=function(a,b,c){a/=255,b/=255,c/=255;var d=Math.max(a,b,c),e=Math.min(a,b,c),f=d-e,g=f/2,h=f/(1-Math.abs(2*g-1)),i=0;return d==a?i=(b-c)/f%6:d==b?i=(c-a)/f+2:d==c&&(i=(a-b)/f+4),[(60*i+360)%360,h,g]},b=function(a,b,c,d){a/=255,b/=255,c/=255;var e=Math.max(a,b,c),f=Math.min(a,b,c),g=e-f,h=g/2,i=(g/(1-Math.abs(2*h-1)),0);e==a?i=(b-c)/g%6:e==b?i=(c-a)/g+2:e==c&&(i=(a-b)/g+4),i*=60,i%=360,i+=d,i%=360,i/=60;var j=0,k=0,l=0,m=g*(1-Math.abs(i%2-1)),n=h-g/2;return i>=0&&1>i?(j=g,k=m):i>=1&&2>i?(k=g,j=m):i>=2&&3>i?(k=g,l=m):i>=3&&4>i?(l=g,k=m):i>=4&&5>i?(l=g,j=m):i>=5&&6>i&&(j=g,l=m),j+=n,k+=n,l+=n,j=255*j,k=255*k,l=255*l,[j,k,l]},c=function(a,c){for(var d,e=a.data,f=0;f<e.length;f+=4)d=b(e[f+0],e[f+1],e[f+2],c),e[f+0]=d[0],e[f+1]=d[1],e[f+2]=d[2]};Kinetic.Filters.ShiftHue=function(a){c(a,this.getFilterHueShiftDeg()%360)},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterHueShiftDeg",0),Kinetic.Filters.Colorize=function(b){for(var d=b.data,e=this.getFilterColorizeColor(),f=a(e[0],e[1],e[2]),g=f[0],h=0;h<d.length;h+=4)d[h+1]=0,d[h+2]=0;c(b,g)},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterColorizeColor",[255,0,0])}(),function(){var a=function(a,b){var c=a.data,d=a.width,e=a.height,f=d*e,g=[];g.length=d*e*4;var h,i,j,k,l,m,n,o,p,q,r,s=b.length,t=b[0].length,u=Math.floor(b.length/2),v=Math.floor(b[0].length/2);for(m=0;e>m;m+=1)for(l=0;d>l;l+=1){for(h=0,i=0,j=0,k=0,q=0;s>q;q+=1)for(r=0;t>r;r+=1)n=(l+q-u)%d,n=n>0?n:-n,o=(m+q-v)%e,o=o>0?o:-o,p=4*(o*d+n),h+=b[r][q]*c[p+0],i+=b[r][q]*c[p+1],j+=b[r][q]*c[p+2];p=4*(m*d+l),g[p+0]=h,g[p+1]=i,g[p+2]=j}var w=4*f;for(p=0;w>p;p+=4)c[p+0]=g[p+0],c[p+1]=g[p+1],c[p+2]=g[p+2]},b=function(a,b,c){var d=a-b;return Math.pow(Math.E,-d*d/(2*c*c))},c=function(a,c,d){a%2===0&&(a+=1);var e,f,g,h=[];for(e=0;a>e;e+=1){for(g=[],f=0;a>f;f+=1)g.push(c*b(e,a/2,d)*b(f,a/2,d));h.push(g)}return h},d=function(a,b){var d=c(a,b,1),e=Math.floor(a/2);return d[e][e]+=1-b,d},e=function(a,b){var d=c(a,-b,1),e=Math.floor(a/2);return d[e][e]+=1+b,d};Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterAmount",50),Kinetic.Filters.UnsharpMask=function(b){a(b,e(5,this.getFilterAmount()/100))},Kinetic.Filters.SoftBlur=function(b){a(b,d(5,this.getFilterAmount()/100))},Kinetic.Filters.Edge=function(b){var c=this.getFilterAmount()/100;0!==c&&a(b,[[0,-1*c,0],[-1*c,1-c+4*c,-1*c],[0,-1*c,0]])},Kinetic.Filters.Emboss=function(b){var c=this.getFilterAmount()/100;0!==c&&a(b,[[-1*c,-.5*c,0],[-.5*c,1+.5*c,.5*c],[0,.5*c,1*c]])}}();

var ccmi18n_imageeditor = {
  loadingControlSets: "\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30bb\u30c3\u30c8\u3092\u8aad\u307f\u8fbc\u307f\u4e2d...",
  loadingComponents: "\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u8aad\u307f\u8fbc\u307f\u4e2d...",
  loadingFilters: "\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u8aad\u307f\u8fbc\u307f\u4e2d...",
  loadingImage: "\u753b\u50cf\u3092\u8aad\u307f\u8fbc\u307f\u4e2d...",
  areYouSure: "\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f"};
        

Kinetic.Node.prototype.closest=function(a){for(var b=this.parent;void 0!==b;){if(b.nodeType===a)return b;b=b.parent}return!1},Kinetic.Stage.prototype.createCopy=function(){var a,b=[],c=this.getChildren();for(a=0;a<c.length;a++)b.push(c[a].clone());return b},Kinetic.Stage.prototype.getScaledWidth=function(){return Math.ceil(this.getWidth()/this.getScale().x)},Kinetic.Stage.prototype.getScaledHeight=function(){return Math.ceil(this.getHeight()/this.getScale().y)},Kinetic.Stage.prototype.getSaveWidth=function(){return this.im.saveWidth},Kinetic.Stage.prototype.getSaveHeight=function(){return this.im.saveHeight},Kinetic.Stage.prototype.getTotalDimensions=function(){var a=(this.getSaveHeight()/2-this.im.center.y)*this.getScale().y,b=a+this.getHeight()-this.getSaveHeight()*this.getScale().y,c=(this.getSaveWidth()/2-this.im.center.x)*this.getScale().x,d=c+this.getWidth()-this.getSaveWidth()*this.getScale().x;return{min:{x:c,y:a},max:{x:d,y:b},width:this.getScaledWidth(),height:this.getScaledHeight(),visibleWidth:Math.max(this.getSaveWidth(),2*this.getScaledWidth()-this.getSaveWidth()),visibleHeight:Math.max(this.getSaveHeight(),2*this.getScaledHeight()-this.getSaveHeight())}},Kinetic.Stage.prototype.loadCopy=function(a){var b;for(this.removeChildren(),b=0;b<a.length;b++)this.add(a[b]);this.draw()},Kinetic.Stage.prototype.elementType="stage",Kinetic.Image.prototype.getImageData=function(){var a=new Kinetic.Canvas(this.attrs.image.width,this.attrs.image.height),b=a.getContext();b.drawImage(this.attrs.image,0,0);try{var c=b.getImageData(0,0,a.getWidth(),a.getHeight());return c}catch(d){Kinetic.Util.warn("Unable to get imageData.")}},Kinetic.Layer.prototype._cacheddraw=(new Kinetic.Layer).draw,Kinetic.Layer.prototype.draw=function(){if("undefined"==typeof im||"undefined"==typeof im.trigger)return this._cacheddraw();var a=this._cacheddraw();return a},Kinetic.Layer.prototype.elementType="layer",Kinetic.Group.prototype.elementType="group",Kinetic.Text.prototype.rasterize=function(a){var b=this.parent,c=this;this.toImage({callback:function(d){var e=new Kinetic.Image({image:d,x:c.getPosition().x,y:c.getPosition().y});c.remove(),b.add(e).draw(),a.callback(e)}})};var control_sets=[],components=[],filters=[],ImageEditor=function(a){"use strict";if(void 0===a)return this;a.pixelRatio=1;var b=this,c=function(a){return Math.round(a)};b.saveData=a.saveData||{},b.saveUrl=a.saveUrl,b.width=a.width,b.height=a.height,b.strictSize="undefined"!=typeof a.strictSize?!!a.strictSize:a.saveWidth>0,b.saveWidth=a.saveWidth||(b.strictSize?0:c(b.width/2)),b.saveHeight=a.saveHeight||(b.strictSize?0:c(b.height/2)),b.stage=new Kinetic.Stage(a),b.namespaces={},b.controlSets={},b.components={},b.settings=a,b.filters={},b.fileId=b.settings.fID,b.scale=1,b.crosshair=new Image,b.uniqid=b.stage.getContainer().id,b.editorContext=$(b.stage.getContainer()).parent(),b.domContext=b.editorContext.parent(),b.controlContext=b.domContext.children("div.controls"),b.controlSetNamespaces=[],b.showLoader=$.fn.dialog.showLoader,b.hideLoader=$.fn.dialog.hideLoader,b.stage.im=b,b.stage.elementType="stage",b.crosshair.src=CCM_IMAGE_PATH+"/image_editor/crosshair.png",b.center={x:Math.round(b.width/2),y:Math.round(b.height/2)},b.centerOffset={x:b.center.x,y:b.center.y};var d=function(a){return $(a,b.domContext)},e=function(){if(a.debug===!0&&"undefined"!=typeof console){var b=arguments;1==b.length&&(b=b[0]),console.log(b)}},f=function(){if(a.debug===!0&&"undefined"!=typeof console){var b=arguments;1==b.length&&(b=b[0]),console.warn(b)}},g=function(){if("undefined"!=typeof console){var a=arguments;1==a.length&&(a=a[0]),console.error("Image Editor Error: "+a)}};b.stage._setDraggable=b.stage.setDraggable,b.stage.setDraggable=function(a){return f("setting draggable to "+a),b.stage._setDraggable(a)},b.bindEvent=b.bind=b.on=function(a,c,d){var e=d||b.stage.getContainer();e instanceof jQuery&&(e=e[0]),ConcreteEvent.sub(a,c,e)},b.fireEvent=b.fire=b.trigger=function(a,c,d){var e=d||b.stage.getContainer();e instanceof jQuery&&(e=e[0]),ConcreteEvent.pub(a,c,e)},b.addElement=function(a,c){var d=new Kinetic.Layer;a.elementType=c,d.elementType=c,d.add(a),b.stage.add(d),d.moveDown(),b.stage.draw()},b.on("backgroundBuilt",function(){void 0!==b.activeElement&&void 0!==b.activeElement.doppelganger&&(b.foreground.add(b.activeElement.doppelganger),b.activeElement.doppelganger.setPosition(b.activeElement.getPosition()))}),b.setActiveElement=function(a){return a.defer?b.setActiveElement(a.defer):void(b.activeElement!=a&&(void 0!==b.activeElement&&void 0!==b.activeElement.doppelganger&&b.activeElement.doppelganger.remove(),a===b.stage||"Stage"==a.nodeType?(b.trigger("ChangeActiveAction",b.controlSetNamespaces.length?b.controlSetNamespaces[0]:void 0),$("div.control-sets",b.controlContext).find("h4.active").removeClass("active")):void 0!==a.doppelganger&&(b.foreground.add(a.doppelganger),b.foreground.draw()),b.trigger("beforeChangeActiveElement",b.activeElement),b.alterCore("activeElement",a),b.trigger("changeActiveElement",a),b.stage.draw()))},b.bind("ClickedElement",function(a,c){b.setActiveElement(c)}),b.bind("stageChanged",function(a){(b.activeElement.getWidth()>b.stage.getScaledWidth()||b.activeElement.getHeight()>b.stage.getScaledHeight())&&b.setActiveElement(b.stage)});var h=d(b.stage.getContainer()).parent().children(".bottomBar");h.attr("unselectable","on");var i={};i.zoomIn=d("<div class='bottombarbutton plus'><i class='fa fa-plus'></i></div>"),i.zoomOut=d("<div class='bottombarbutton'><i class='fa fa-minus'></i></div>"),i.zoomIn.appendTo(h),i.zoomOut.appendTo(h),i.zoomIn.click(function(a){b.fire("zoomInClick",a)}),i.zoomOut.click(function(a){b.fire("zoomOutClick",a)});var j=d("<div></div>").addClass("scale").text("100%");b.on("scaleChange",function(a){j.text(Math.round(1e4*b.scale)/100+"%")}),j.click(function(){b.scale=1,b.stage.setScale(b.scale);var a=b.stage.getDragBoundFunc()({x:b.stage.getX(),y:b.stage.getY()});b.stage.setX(a.x),b.stage.setY(a.y),b.fire("scaleChange"),b.buildBackground(),b.stage.draw()}),j.appendTo(h);var k=5/6;b.on("zoomInClick",function(a){var c=(-b.stage.getX()+b.stage.getWidth()/2)/b.scale,d=(-b.stage.getY()+b.stage.getHeight()/2)/b.scale;b.scale/=k,b.scale=Math.round(1e3*b.scale)/1e3,b.alterCore("scale",b.scale);var e=(-b.stage.getX()+b.stage.getWidth()/2)/b.scale,f=(-b.stage.getY()+b.stage.getHeight()/2)/b.scale;b.stage.setX(b.stage.getX()-(c-e)*b.scale),b.stage.setY(b.stage.getY()-(d-f)*b.scale),b.stage.setScale(b.scale);var g=b.stage.getDragBoundFunc()({x:b.stage.getX(),y:b.stage.getY()});b.stage.setX(g.x),b.stage.setY(g.y),b.fire("scaleChange"),b.buildBackground(),b.stage.draw()}),b.on("zoomOutClick",function(a){var c=(-b.stage.getX()+b.stage.getWidth()/2)/b.scale,d=(-b.stage.getY()+b.stage.getHeight()/2)/b.scale;b.scale*=k,b.scale=Math.round(1e3*b.scale)/1e3,b.alterCore("scale",b.scale);var e=(-b.stage.getX()+b.stage.getWidth()/2)/b.scale,f=(-b.stage.getY()+b.stage.getHeight()/2)/b.scale;b.stage.setX(b.stage.getX()-(c-e)*b.scale),b.stage.setY(b.stage.getY()-(d-f)*b.scale),b.stage.setScale(b.scale);var g=b.stage.getDragBoundFunc()({x:b.stage.getX(),y:b.stage.getY()});b.stage.setX(g.x),b.stage.setY(g.y),b.fire("scaleChange"),b.buildBackground(),b.stage.draw()});var l={};if(l.width=d("<span/>").addClass("saveWidth"),l.height=d("<span/>").addClass("saveHeight"),l.crop=d('<div><i class="icon-resize-full"/></div>').addClass("bottombarbutton").addClass("crop"),l.both=l.height.add(l.width).width(32).attr("contenteditable",!0),l.area=d("<span/>").css({"float":"right"}),b.on("adjustedsavers",function(){l.width.text(b.saveWidth),l.height.text(b.saveHeight)}),l.crop.click(function(){b.adjustSavers()}),b.strictSize?l.both.attr("disabled","true"):l.both.keyup(function(a){b.fire("editedSize",a)}),b.bind("editedSize",function(a){b.saveWidth=parseInt(l.width.text()),b.saveHeight=parseInt(l.height.text()),isNaN(b.saveWidth)&&(b.saveWidth=0),isNaN(b.saveHeight)&&(b.saveHeight=0),b.buildBackground()}),b.bind("saveSizeChange",function(){l.width.text(b.saveWidth),l.height.text(b.saveHeight)}),b.setCursor=function(a){$(b.stage.getContainer()).css("cursor",a)},b.save=function(){b.fire("ChangeActiveAction"),b.fire("ImageEditorWillSave"),$.fn.dialog.showLoader(),b.stage.toDataURL({callback:function(c){var d=$("<img />").addClass("fake_canvas").appendTo(b.editorContext.children(".Editor"));d.attr("src",c),d.css({position:"absolute",top:0,left:0,backgroundColor:"white"});var e=b.stage.getPosition(),f=b.scale,g=b.stage.getWidth(),h=b.stage.getHeight();b.stage.setPosition(-b.saveArea.getX(),-b.saveArea.getY()),b.stage.setScale(1),b.background.hide(),b.foreground.hide(),b.stage.setHeight(b.saveHeight+100),b.stage.setWidth(b.saveWidth+100),b.stage.draw();var i=a.mime;"image/jpeg"!==i&&"image/png"!==i&&(i="image/png"),b.stage.toDataURL({mimeType:i,quality:a.jpegCompression,width:b.saveWidth,height:b.saveHeight,callback:function(a){b.stage.setPosition(e),b.background.show(),b.foreground.show(),b.stage.setScale(f),b.stage.setHeight(h),b.stage.setWidth(g),b.stage.draw(),d.remove(),$.post(b.saveUrl,_.extend(b.saveData,{fID:b.fileId,imgData:a}),function(c){$.fn.dialog.hideLoader();var d=JSON.parse(c);1===d.error?(alert(d.message),$("button.save[disabled]").attr("disabled",!1)):0===d.error&&(b.fire("ImageEditorDidSave",_.extend(b.saveData,{fID:b.fileId,imgData:a})),Concrete.event.fire("ImageEditorDidSave",_.extend(b.saveData,{fID:b.fileId,imgData:a})))})}})}})},b.actualPosition=function(a,c,d,e,f){var g=c-e,h=a-d,i=b.activeElement.getRotation()+Math.atan2(g,h),j=Math.sqrt(Math.pow(h,2)+Math.pow(g,2));return[d+j*Math.cos(i),e+j*Math.sin(i)]},b.getActualRect=function(a,c,d){var e=[],f=d.getRotation();return e.push(b.actualPosition(d.getX(),d.getY(),a,c,f)),e.push(b.actualPosition(d.getX()+d.getWidth()*d.getScaleX(),d.getY(),a,c,f)),e.push(b.actualPosition(d.getX()+d.getWidth()*d.getScaleX(),d.getY()+d.getHeight()*d.getScaleY(),a,c,f)),e.push(b.actualPosition(d.getX(),d.getY()+d.getHeight()*d.getScaleY(),a,c,f)),e},b.adjustSavers=function(a){if("Stage"!==b.activeElement.nodeType){b.foreground.autoCrop=!1,b.background.autoCrop=!1;var c,c,d,e={min:{x:!1,y:!1},max:{x:!1,y:!1}},f=b.activeElement,g=f.parent,h=b.getActualRect(0,0,f);for(c=h.length-1;c>=0;c--){var i=h[c],j=i[0]+g.getX(),k=i[1]+g.getY();(j>e.max.x||e.max.x===!1)&&(e.max.x=j),(j<e.min.x||e.min.x===!1)&&(e.min.x=j),(k>e.max.y||e.max.y===!1)&&(e.max.y=k),(k<e.min.y||e.min.y===!1)&&(e.min.y=k)}d={width:e.max.x-e.min.x,height:e.max.y-e.min.y},b.strictSize||(b.alterCore("saveWidth",Math.round(d.width)),b.alterCore("saveHeight",Math.round(d.height)),b.buildBackground());var l=[b.center.x-b.activeElement.getWidth()*b.activeElement.getScaleX()/2,b.center.y-b.activeElement.getHeight()*b.activeElement.getScaleY()/2],m=b.actualPosition(l[0],l[1],b.center.x,b.center.y,b.activeElement.getRotation());b.activeElement.parent.setPosition(m.map(Math.round)),a!==!1&&b.fire("adjustedsavers"),b.stage.draw()}},b.bind("imageLoad",function(){setTimeout(b.adjustSavers,0)}),b.extend=function(a,b){this[a]=b},b.alterCore=function(a,c){var d,e=b;if(b.namespace){e.namespace;e=b.realIm}b[a]=c;for(d in b.controlSets)b.controlSets[d].im.extend(a,c);for(d in b.filters)b.filters[d].im.extend(a,c);for(d in b.components)b.components[d].im.extend(a,c)},b.clone=function(a){var c,d=new ImageEditor;d.realIm=b;for(c in b)d[c]=b[c];return d.namespace=a,d},b.addControlSet=function(a,c,d){jQuery&&d instanceof jQuery&&(d=d[0]),d.controlSet=function(b,c){b.disable=function(){b.enabled=!1,$(d).parent().parent().addClass("disabled")},b.enable=function(){b.enabled=!0,$(d).parent().parent().removeClass("disabled")},this.im=b,this.$=$,f("Loading ControlSet",b);try{new Function("im","$",c).call(this,b,$)}catch(e){console.log(e.stack);var h=e.stack.replace(/[\S\s]+at HTMLDivElement.eval.+?<anonymous>:(\d+:\d+)[\S\s]+/,"$1").split(":");if(h[1]&&!isNaN(parseInt(h[1]))){var i=c.split("\n"),j="Parse error at line #"+h[0]+" char #"+h[1]+" within "+a;j+="\n"+i[parseInt(h[0])-1],j+="\n"+new Array(parseInt(h[1])).join(" ")+"^",g(j)}else g('"'+e.message+'" in "'+b.namespace+'"')}return this};var e=b.clone(a),h=d.controlSet.call(d,e,c);return b.controlSets[a]=h,h},b.addFilter=function(a,c){var d=function(b,c){this.namespace=b.namespace,this.im=b;try{new Function("im","$",c).call(this,b,$)}catch(d){g(d),window.lastError=d;var e=d.stack.replace(/[\S\s]+at HTMLDivElement.eval.+?<anonymous>:(\d+:\d+)[\S\s]+/,"$1").split(":");if(2!=e.length)g(d.message),g(d.stack);else{var f=c.split("\n"),h="Parse error at line #"+e[0]+" char #"+e[1]+" within "+a;h+="\n"+f[parseInt(e[0])-1],h+="\n"+new Array(parseInt(e[1])||0).join(" ")+"^",g(h)}}return this},e=b.clone(a),f=new d(e,c);return b.filters[a]=f,f},b.addComponent=function(a,c,d){jQuery&&d instanceof jQuery&&(d=d[0]),d.component=function(b,c){b.disable=function(){$(this).parent().parent().addClass("disabled")},b.enable=function(){$(this).parent().parent().removeClass("disabled")},this.im=b,f("Loading component",b);try{new Function("im","$",c).call(this,b,$)}catch(d){var e=d.stack.replace(/[\S\s]+at HTMLDivElement.eval.+?<anonymous>:(\d+:\d+)[\S\s]+/,"$1").split(":");if(e[1]&&!isNaN(parseInt(e[1]))){var h=c.split("\n"),i="Parse error at line #"+e[0]+" char #"+e[1]+" within "+a;i+="\n"+h[parseInt(e[0])-1],i+="\n"+new Array(parseInt(e[1])).join(" ")+"^",g(i)}else g('"'+d.message+'" in "'+b.namespace+'"')}return this};var e=b.clone(a),h=d.component.call(d,e,c);return b.components[a]=h,h},b.background=new Kinetic.Layer,b.foreground=new Kinetic.Layer,b.stage.add(b.background),b.stage.add(b.foreground),b.bgimage=new Image,b.saveArea=new Kinetic.Rect,b.background.add(b.saveArea),b.bind("load",function(){b.saveArea.setFillPatternImage(b.bgimage),b.saveArea.setFillPatternOffset([-(b.saveWidth/2),-(b.saveHeight/2)]),b.saveArea.setFillPatternScale(1/b.scale),b.saveArea.setFillPatternX(0),b.saveArea.setFillPatternY(0),b.saveArea.setFillPatternRepeat("repeat"),b.background.on("click",function(){b.setActiveElement(b.stage)})},b.bgimage),b.bgimage.src=CCM_REL+"/concrete/images/testbg.png",b.buildBackground=function(){var a=b.stage.getTotalDimensions();b.saveArea.setFillPatternOffset([-(b.saveWidth/2)*b.scale,-(b.saveHeight/2)*b.scale]),b.saveArea.setX(Math.round(b.center.x-b.saveWidth/2)),b.saveArea.setY(Math.round(b.center.y-b.saveHeight/2)),b.saveArea.setFillPatternScale(1/b.scale),b.saveArea.setWidth(b.saveWidth),b.saveArea.setHeight(b.saveHeight),b.coverLayer||(b.coverLayer=new Kinetic.Rect,b.coverLayer.setStroke("rgba(150,150,150,.5)"),b.coverLayer.setFill("transparent"),b.coverLayer.setListening(!1),b.coverLayer.setStrokeWidth(Math.max(a.width,a.height,500)),b.foreground.add(b.coverLayer));var c=2*Math.max(a.width,a.height);b.coverLayer.setPosition(b.saveArea.getX()-c/2,b.saveArea.getY()-c/2),b.coverLayer.setSize(b.saveArea.getWidth()+c,b.saveArea.getHeight()+c),b.coverLayer.setStrokeWidth(c),b.fire("backgroundBuilt"),b.saveArea.draw(),b.coverLayer.draw()},b.buildBackground(),b.on("stageChanged",b.buildBackground),b.stage.setDragBoundFunc(function(a){var c=b.stage.getTotalDimensions(),d=Math.max(c.max.x,c.min.x)+100,e=Math.min(c.max.x,c.min.x)-100,f=Math.max(c.max.y,c.min.y)+100,g=Math.min(c.max.y,c.min.y)-100;return a.x=Math.floor(a.x),a.y=Math.floor(a.y),a.x>d&&(a.x=d),a.x<e&&(a.x=e),a.y>f&&(a.y=f),a.y<g&&(a.y=g),a.x=Math.floor(a.x),a.y=Math.floor(a.y),a}),b.setActiveElement(b.stage),b.stage.setDraggable(!0),b.autoCrop=!0,b.on("imageLoad",function(){var a=50,c=b.stage.getWidth()-2*a,d=b.stage.getHeight()-2*a;if(!(b.saveWidth<c&&b.saveHeight<d)){var e=Math.max(b.saveWidth/c,b.saveHeight/d);b.scale=1/e,b.scale=Math.round(100*b.scale)/100,b.alterCore("scale",b.scale),b.stage.setScale(b.scale),b.stage.setX((b.stage.getWidth()-b.stage.getWidth()*b.stage.getScale().x)/2),b.stage.setY((b.stage.getHeight()-b.stage.getHeight()*b.stage.getScale().y)/2);var f=b.stage.getDragBoundFunc()({x:b.stage.getX(),y:b.stage.getY()});b.stage.setX(f.x),b.stage.setY(f.y),b.fire("scaleChange"),b.fire("stageChanged"),b.buildBackground()}}),b.fit=function(a,c){if(c===!1)return{width:b.saveWidth,height:b.saveHeight};var d=a.height,e=a.width;return e>b.saveWidth&&(d/=e/b.saveWidth,e=b.saveWidth),d>b.saveHeight&&(e/=d/b.saveHeight,d=b.saveHeight),{width:e,height:d}},a.src){b.showLoader(ccmi18n_imageeditor.loadingImage);var m=new Image,n=!1;b.bind("ControlSetsLoaded",function(){n=!0}),b.bind("load",function(){function a(){_.defer(function(){b.stage.draw(),b.setActiveElement(d),b.fire("changeActiveAction",b.controlSetNamespaces[0])})}b.strictSize?(0==b.saveWidth||0==b.saveHeight)&&(0==b.saveWidth?0==b.saveHeight?(b.saveWidth=m.width,b.saveHeight=m.height,b.fire("saveSizeChange"),b.buildBackground()):(b.saveWidth=Math.floor(m.width/m.height*b.saveHeight),b.fire("saveSizeChange"),b.buildBackground()):0==b.saveHeight&&(b.saveHeight=Math.floor(m.height/m.width*b.saveWidth),b.fire("saveSizeChange"),b.buildBackground())):(b.saveWidth=m.width,b.saveHeight=m.height,b.fire("saveSizeChange"),b.buildBackground());var c={x:Math.floor(b.center.x-m.width/2),y:Math.floor(b.center.y-m.height/2)},d=new Kinetic.Image({image:m,x:0,y:0});d.setPosition(c),b.addElement(d,"image"),_.defer(function(){b.fire("imageload")}),n?a():b.bind("ControlSetsLoaded",a)},m),m.src=a.src}else b.fire("imageload");return b.bind("imageload",function(){var c,d=a.controlsets||{},f=(a.filters||{},0);e("Loading ControlSets"),b.showLoader(ccmi18n_imageeditor.loadingControlSets),b.fire("LoadingControlSets");for(c in d){var g="ControlSet_"+c;b.controlSetNamespaces.push(g),$.ajax(d[c].src,{dataType:"text",cache:!1,namespace:c,myns:g,beforeSend:function(){f++},success:function(a){f--;var c=b.addControlSet(this.myns,a,d[this.namespace].element);e(c),b.fire("controlSetLoad",c),0==f&&b.trigger("ControlSetsLoaded")},error:function(a,c,d){f--,0==f&&b.trigger("ControlSetsLoaded")}})}}),b.bind("ControlSetsLoaded",function(){b.fire("LoadingComponents"),b.showLoader(ccmi18n_imageeditor.loadingComponents);var c,d=a.components||{},f=0;e("Loading Components");for(c in d){var g="Component_"+c;$.ajax(d[c].src,{dataType:"text",cache:!1,namespace:c,myns:g,beforeSend:function(){f++},success:function(a){f--;var c=b.addComponent(this.myns,a,d[this.namespace].element);e(c),b.fire("ComponentLoad",c),0==f&&b.trigger("ComponentsLoaded")},error:function(a,c,d){f--,0==f&&b.trigger("ComponentsLoaded")}})}0==f&&b.trigger("ComponentsLoaded")}),b.bind("ComponentsLoaded",function(){e("Loading Filters"),b.showLoader(ccmi18n_imageeditor.loadingFilters);var c,d,f=a.filters||{},g=0;b.fire("LoadingFilters");for(c in f)f.hasOwnProperty(c)&&!function(a){var c=_.clone(f[a]),e="Filter_"+a,h=c.name;d||(d=e),g++,$.ajax(f[a].src,{dataType:"text",cache:!1,namespace:a,myns:e,name:h,success:function(a){var d=b.addFilter(this.myns,a);d.name=this.name,d.settings=c,b.fire("filterLoad",d),g--,0===g&&b.trigger("FiltersLoaded")},error:function(a,c,d){g--,0===g&&b.trigger("FiltersLoaded")}})}(c)}),b.bind("ChangeActiveAction",function(a,c){if(c!==b.activeControlSet){for(var e in b.controlSets)d(b.controlSets[e]),e!==c&&d(b.controlSets[e]).slideUp();if(b.activeControlSet=c,b.alterCore("activeControlSet",c),!c)return void $("div.control-sets",b.controlContext).find("h4.active").removeClass("active");var f=$(b.controlSets[c]),g=f.show().height();0!=f.length&&f.hide().height(g).slideDown(function(){$(this).height("")})}}),b.bind("ChangeActiveComponent",function(a,c){if(c!==b.activeComponent){for(var e in b.components)e!==c&&d(b.components[e]).slideUp();if(b.activeComponent=c,b.alterCore("activeComponent",c),c){var f=$(b.components[c]),g=f.show().height();0!=f.length&&f.hide().height(g).slideDown(function(){$(this).height("")})}}}),b.bind("ChangeNavTab",function(a,c){b.trigger("ChangeActiveAction",c),b.trigger("ChangeActiveComponent",c);var e=d("div.editorcontrols");switch(c){case"add":e.children("div.control-sets").hide(),e.children("div.components").show();break;case"edit":e.children("div.components").hide(),e.children("div.control-sets").show()}}),b.bind("FiltersLoaded",function(){b.hideLoader()}),b.slideOut=$("<div/>").addClass("slideOut").css({width:0,"float":"right",height:"100%","overflow-x":"hidden",right:b.controlContext.width()-1,position:"absolute",background:"white","box-shadow":"black -20px 0 20px -25px"}),b.slideOutContents=$("<div/>").appendTo(b.slideOut).width(300),b.showSlideOut=function(a,c){b.hideSlideOut(function(){b.slideOut.empty(),b.slideOutContents=a.width(300),b.slideOut.append(b.slideOutContents),b.slideOut.addClass("active").addClass("sliding"),b.slideOut.stop(1).slideOut(300,function(){b.slideOut.removeClass("sliding"),"function"==typeof c&&c()})})},b.hideSlideOut=function(a){b.slideOut.addClass("sliding"),b.slideOut.slideIn(300,function(){b.slideOut.css("border-right","0"),b.slideOut.removeClass("active").removeClass("sliding"),"function"==typeof a&&a()})},b.controlContext.after(b.slideOut),b.setActiveElement(b.stage),window.c5_image_editor=b,window.im=b,b};$.fn.ImageEditor=function(a){void 0===a&&(a={}),a.imageload=$.fn.dialog.hideLoader;var b=$(this);if(a.container=b[0],0==b.height())return void setTimeout(function(){b.ImageEditor(a)},50);b.closest(".ui-dialog").find(".ui-resizable-handle").hide(),b.height("-=30"),$("div.editorcontrols").height(b.height()-90),b.width("-=330").parent().width("-=330").children("div.bottomBar").width("-=330"),void 0===a.width&&(a.width=b.width()),void 0===a.height&&(a.height=b.height()),$.fn.dialog.showLoader();var c=new ImageEditor(a),d=c.domContext;return $("div.control-sets > div.controlset",d).each(function(){var a=$(this),b=a.data("namespace");a.find("h4").click(function(){a.hasClass("active")||c.fire("ChangeActiveAction","ControlSet_"+b)}),c.bind("ChangeActiveAction",function(c,e){if(e==="ControlSet_"+b){d.find("div.controlset.active").removeClass("active").children(".control").slideUp(250),a.addClass("active");var f=a.children(".control").height("auto");f.slideDown(250)}})}),$("div.controls > div.controlscontainer",d).children("div.save").children("button.save").click(function(){$(this).attr("disabled",!0),c.save()}).end().children("button.cancel").click(function(){confirm(ccmi18n_imageeditor.areYouSure)&&$.fn.dialog.closeTop()}),c.on("ChangeActiveAction",function(a,b){b||$("h4.active",d).removeClass("active")}),c.on("ChangeActiveComponent",function(a,b){b||$("div.controlset.active",d).removeClass("active")}),c.bind("imageload",$.fn.dialog.hideLoader),c},$.fn.slideOut=function(a,b){var c=$(this),d=c.width(),e=255;return c.css("overflow-y","auto"),d==e?(c.animate({width:e},0,b),this):(c.width(d).animate({width:e},a||300,b||function(){}),this)},$.fn.slideIn=function(a,b){var c=$(this);return c.css("overflow-y","hidden"),0===c.width()?(c.animate({width:0},0,b),this):(c.animate({width:0},a||300,b||function(){}),this)},ImageEditor.prototype=ImageEditor.fn={filter:{grayscale:Kinetic.Filters.Grayscale,sepia:function(a){var b,c=a.data;for(b=0;b<c.length;b+=4)c[b]=.393*c[b]+.769*c[b+1]+.189*c[b+2],c[b+1]=.349*c[b]+.686*c[b+1]+.168*c[b+2],c[b+2]=.272*c[b]+.534*c[b+1]+.131*c[b+2]},brightness:function(a,b){for(var c=b.level,d=a.data,e=0;e<d.length;e+=4)d[e]+=c,d[e+1]+=c,d[e+2]+=c},invert:function(a,b){for(var c=a.data,d=0;d<c.length;d+=4)c[d]=255-c[d],c[d+1]=255-c[d+1],c[d+2]=255-c[d+2]},restore:function(a,b){for(var c=(b.level,a.data),d=b.imageData.data,e=0;e<c.length;e+=4)c[e]=d[e],c[e+1]=d[e+1],c[e+2]=d[e+2]}}};


/*!
 * jQuery UI Touch Punch 0.2.3
 *
 * Copyright 2011–2014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
!function(a){function f(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var e,b=a.ui.mouse.prototype,c=b._mouseInit,d=b._mouseDestroy;b._touchStart=function(a){var b=this;!e&&b._mouseCapture(a.originalEvent.changedTouches[0])&&(e=!0,b._touchMoved=!1,f(a,"mouseover"),f(a,"mousemove"),f(a,"mousedown"))},b._touchMove=function(a){e&&(this._touchMoved=!0,f(a,"mousemove"))},b._touchEnd=function(a){e&&(f(a,"mouseup"),f(a,"mouseout"),this._touchMoved||f(a,"click"),e=!1)},b._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),c.call(b)},b._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),d.call(b)}}}(jQuery);

var ConcreteDashboard=function(){setupResultMessages=function(){if($("#ccm-dashboard-result-message").length>0){if($(".ccm-pane").length>0){var a=$(".ccm-pane").parent().attr("class"),b=$(".ccm-pane").parent().parent().attr("class"),c=$("#ccm-dashboard-result-message").html();$("#ccm-dashboard-result-message").html('<div class="'+b+'"><div class="'+a+'">'+c+"</div></div>").fadeIn(400)}}else $("#ccm-dashboard-result-message").fadeIn(200)};var a=function(){0==$("#ccm-tooltip-holder").length&&$("<div />").attr("id","ccm-tooltip-holder").attr("class","ccm-ui").prependTo(document.body),$(".launch-tooltip").tooltip({container:"#ccm-tooltip-holder"})},b=function(){$(".dialog-launch").dialog()};return{start:function(c){a(),setupResultMessages(),b()}}}();

+function(a){"use strict";function b(b){a(d).remove(),a(e).each(function(){var d=c(a(this)),e={relatedTarget:this};d.hasClass("open")&&(d.trigger(b=a.Event("hide.bs.dropdown",e)),b.isDefaultPrevented()||d.removeClass("open").trigger("hidden.bs.dropdown",e))})}function c(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}var d=".dropdown-backdrop",e="[data-toggle=dropdown]",f=function(b){a(b).on("click.bs.dropdown",this.toggle)};f.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=c(e),g=f.hasClass("open");if(b(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a('<div class="dropdown-backdrop"/>').insertAfter(a(this)).on("click",b);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.bs.dropdown",h)),d.isDefaultPrevented())return;f.toggleClass("open").trigger("shown.bs.dropdown",h),e.focus()}return!1}},f.prototype.keydown=function(b){if(/(38|40|27)/.test(b.keyCode)){var d=a(this);if(b.preventDefault(),b.stopPropagation(),!d.is(".disabled, :disabled")){var f=c(d),g=f.hasClass("open");if(!g||g&&27==b.keyCode)return 27==b.which&&f.find(e).focus(),d.click();var h=" li:not(.divider):visible a",i=f.find("[role=menu]"+h+", [role=listbox]"+h);if(i.length){var j=i.index(i.filter(":focus"));38==b.keyCode&&j>0&&j--,40==b.keyCode&&j<i.length-1&&j++,~j||(j=0),i.eq(j).focus()}}}};var g=a.fn.dropdown;a.fn.dropdown=function(b){return this.each(function(){var c=a(this),d=c.data("bs.dropdown");d||c.data("bs.dropdown",d=new f(this)),"string"==typeof b&&d[b].call(c)})},a.fn.dropdown.Constructor=f,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=g,this},a(document).on("click.bs.dropdown.data-api",b).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",e,f.prototype.toggle).on("keydown.bs.dropdown.data-api",e+", [role=menu], [role=listbox]",f.prototype.keydown)}(jQuery);

+function(a){"use strict";var b=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");b.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),b.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),b.prototype.constructor=b,b.prototype.getDefaults=function(){return b.DEFAULTS},b.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content")[this.options.html?"string"==typeof c?"html":"append":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},b.prototype.hasContent=function(){return this.getTitle()||this.getContent()},b.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},b.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},b.prototype.tip=function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip};var c=a.fn.popover;a.fn.popover=function(c){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof c&&c;(e||"destroy"!=c)&&(e||d.data("bs.popover",e=new b(this,f)),"string"==typeof c&&e[c]())})},a.fn.popover.Constructor=b,a.fn.popover.noConflict=function(){return a.fn.popover=c,this}}(jQuery);

+function(a){"use strict";function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one(a.support.transition.end,function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b()})}(jQuery);

+function(a){"use strict";var b='[data-dismiss="alert"]',c=function(c){a(c).on("click",b,this.close)};c.prototype.close=function(b){function c(){f.trigger("closed.bs.alert").remove()}var d=a(this),e=d.attr("data-target");e||(e=d.attr("href"),e=e&&e.replace(/.*(?=#[^\s]*$)/,""));var f=a(e);b&&b.preventDefault(),f.length||(f=d.hasClass("alert")?d:d.parent()),f.trigger(b=a.Event("close.bs.alert")),b.isDefaultPrevented()||(f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one(a.support.transition.end,c).emulateTransitionEnd(150):c())};var d=a.fn.alert;a.fn.alert=function(b){return this.each(function(){var d=a(this),e=d.data("bs.alert");e||d.data("bs.alert",e=new c(this)),"string"==typeof b&&e[b].call(d)})},a.fn.alert.Constructor=c,a.fn.alert.noConflict=function(){return a.fn.alert=d,this},a(document).on("click.bs.alert.data-api",b,c.prototype.close)}(jQuery);

if(function(a){"use strict";function b(a,c){return new b.prototype.init(a,c)}Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a)}});var c=0;a.fn.redactor=function(c){var d=[],e=Array.prototype.slice.call(arguments,1);return"string"==typeof c?this.each(function(){var b,f=a.data(this,"redactor");if("-1"!=c.search(/\./)?(b=c.split("."),"undefined"!=typeof f[b[0]]&&(b=f[b[0]][b[1]])):b=f[c],"undefined"!=typeof f&&a.isFunction(b)){var g=b.apply(f,e);void 0!==g&&g!==f&&d.push(g)}else a.error('No such method "'+c+'" for Redactor')}):this.each(function(){a.data(this,"redactor",{}),a.data(this,"redactor",b(this,c))}),0===d.length?this:1===d.length?d[0]:d},a.Redactor=b,a.Redactor.VERSION="10.2.2",a.Redactor.modules=["alignment","autosave","block","buffer","build","button","caret","clean","code","core","dropdown","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","linkify","list","modal","observe","paragraphize","paste","placeholder","progress","selection","shortcuts","tabifier","tidy","toolbar","upload","utils"],a.Redactor.opts={lang:"en",direction:"ltr",plugins:!1,focus:!1,focusEnd:!1,placeholder:!1,visual:!0,tabindex:!1,minHeight:!1,maxHeight:!1,linebreaks:!1,replaceDivs:!0,paragraphize:!0,cleanStyleOnEnter:!1,enterKey:!0,cleanOnPaste:!0,cleanSpaces:!0,pastePlainText:!1,autosave:!1,autosaveName:!1,autosaveInterval:60,autosaveOnChange:!1,autosaveFields:!1,linkTooltip:!0,linkProtocol:"http",linkNofollow:!1,linkSize:50,imageEditable:!0,imageLink:!0,imagePosition:!0,imageFloatMargin:"10px",imageResizable:!0,imageUpload:null,imageUploadParam:"file",uploadImageField:!1,dragImageUpload:!0,fileUpload:null,fileUploadParam:"file",dragFileUpload:!0,s3:!1,convertLinks:!0,convertUrlLinks:!0,convertImageLinks:!0,convertVideoLinks:!0,preSpaces:4,tabAsSpaces:!1,tabKey:!0,scrollTarget:!1,toolbar:!0,toolbarFixed:!1,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarOverflow:!1,source:!0,buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","link","alignment","horizontalrule"],buttonsHide:[],buttonsHideOnMobile:[],formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,tabifier:!0,deniedTags:["script","style"],allowedTags:!1,paragraphizeBlocks:["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],removeComments:!1,replaceTags:[["strike","del"],["b","strong"]],replaceStyles:[["font-weight:\\s?bold","strong"],["font-style:\\s?italic","em"],["text-decoration:\\s?underline","u"],["text-decoration:\\s?line-through","del"]],removeDataAttr:!1,removeAttr:!1,allowedAttr:!1,removeWithoutAttr:["span"],removeEmpty:["p"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,concrete5:{filemanager:!1,sitemap:!1,lightbox:!1},buffer:[],rebuffer:[],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",imageTypes:["image/png","image/jpeg","image/gif"],indentValue:20,verifiedTags:["a","img","b","strong","sub","sup","i","em","u","small","strike","del","cite","ul","ol","li"],inlineTags:["strong","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],alignmentTags:["P","H1","H2","H3","H4","H5","H6","DL","DT","DD","DIV","TD","BLOCKQUOTE","OUTPUT","FIGCAPTION","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],blockLevelElements:["PRE","UL","OL","LI"],highContrast:!1,observe:{dropdowns:[]},langs:{en:{html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",link_edit:"Edit link",unlink:"Unlink",formatting:"Formatting",paragraph:"Normal text",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",header5:"Header 5",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",center:"Center",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code or Youtube/Vimeo Link",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",link_same_window:"Open link in same window",in_lightbox:"Open link in Lightbox",lightbox_link_type:"Link Type",lightbox_link_type_iframe:"Web Page",lightbox_link_type_image:"Image",lightbox_link_type_iframe_options:"Frame Options",lightbox_link_type_iframe_width:"Width",lightbox_link_type_iframe_height:"Height",customStyles:"Custom Styles",remove_font:"Remove font",change_font_family:"Change font family",remove_font_size:"Remove font size",change_font_size:"Change font size",remove_style:"Remove Style",insert_character:"Insert Character",undo:"Undo",redo:"Redo",remove_font_family:"Remove Font Family",underline:"Underline",alignment:"Alignment",filename:"Name (optional)",edit:"Edit",upload_label:"Drop file here or "}},linkify:{regexps:{youtube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,vimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,image:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi}},codemirror:!1},b.fn=a.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(b,d){if(this.$element=a(b),this.uuid=c++,this.rtePaste=!1,this.$pasteBox=!1,this.loadOptions(d),this.loadModules(),this.formatting={},a.merge(this.opts.blockLevelElements,this.opts.alignmentTags),this.reIsBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i"),this.tidy.setupAllowed(),this.opts.deniedTags!==!1)for(var e=["html","head","link","body","meta","applet"],f=0;f<e.length;f++)this.opts.deniedTags.push(e[f]);this.lang.load(),a.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.core.setCallback("start"),this.start=!0,this.build.run()},loadOptions:function(b){this.opts=a.extend({},a.extend(!0,{},a.Redactor.opts),this.$element.data(),b)},getModuleMethods:function(a){return Object.getOwnPropertyNames(a).filter(function(b){return"function"==typeof a[b]})},loadModules:function(){for(var b=a.Redactor.modules.length,c=0;b>c;c++)this.bindModuleMethods(a.Redactor.modules[c])},bindModuleMethods:function(a){if("undefined"!=typeof this[a]){this[a]=this[a]();for(var b=this.getModuleMethods(this[a]),c=b.length,d=0;c>d;d++)this[a][b[d]]=this[a][b[d]].bind(this)}},alignment:function(){return{left:function(){this.alignment.set("")},right:function(){this.alignment.set("right")},center:function(){this.alignment.set("center")},justify:function(){this.alignment.set("justify")},set:function(a){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save(),this.alignment.blocks=this.selection.getBlocks(),this.alignment.type=a,this.alignment.isLinebreaksOrNoBlocks()?this.alignment.setText():this.alignment.setBlocks(),this.selection.restore(),this.code.sync()},setText:function(){var b=this.selection.wrap("div");a(b).attr("data-tagblock","redactor").css("text-align",this.alignment.type)},setBlocks:function(){a.each(this.alignment.blocks,a.proxy(function(a,b){var c=this.utils.getAlignmentElement(b);c&&(this.alignment.isNeedReplaceElement(c)?this.alignment.replaceElement(c):this.alignment.alignElement(c))},this))},isLinebreaksOrNoBlocks:function(){return this.opts.linebreaks&&this.alignment.blocks[0]===!1},isNeedReplaceElement:function(a){return""===this.alignment.type&&"undefined"!=typeof a.data("tagblock")},replaceElement:function(a){a.replaceWith(a.html())},alignElement:function(a){a.css("text-align",this.alignment.type),this.utils.removeEmptyAttr(a,"style")}}},autosave:function(){return{html:!1,enable:function(){this.opts.autosave&&(this.autosave.name=this.opts.autosaveName?this.opts.autosaveName:this.$textarea.attr("name"),this.opts.autosaveOnChange||(this.autosaveInterval=setInterval(this.autosave.load,1e3*this.opts.autosaveInterval)))},onChange:function(){this.opts.autosaveOnChange&&this.autosave.load()},load:function(){if(this.autosave.source=this.code.get(),this.autosave.html!==this.autosave.source){var b={};b.name=this.autosave.name,b[this.autosave.name]=this.autosave.source,b=this.autosave.getHiddenFields(b);var c=a.ajax({url:this.opts.autosave,type:"post",data:b});c.done(this.autosave.success)}},getHiddenFields:function(b){return this.opts.autosaveFields===!1||"object"!=typeof this.opts.autosaveFields?b:(a.each(this.opts.autosaveFields,a.proxy(function(c,d){null!==d&&0===d.toString().indexOf("#")&&(d=a(d).val()),b[c]=d},this)),b)},success:function(b){var c;try{c=a.parseJSON(b)}catch(d){c=b}var e="undefined"==typeof c.error?"autosave":"autosaveError";this.core.setCallback(e,this.autosave.name,c),this.autosave.html=this.autosave.source},disable:function(){clearInterval(this.autosaveInterval)}}},block:function(){return{formatting:function(a){this.block.clearStyle=!1;var b,c;"undefined"!=typeof this.formatting[a].data?b="data":"undefined"!=typeof this.formatting[a].attr?b="attr":"undefined"!=typeof this.formatting[a]["class"]&&(b="class"),"undefined"!=typeof this.formatting[a].clear&&(this.block.clearStyle=!0),b&&(c=this.formatting[a][b]),this.block.format(this.formatting[a].tag,b,c)},format:function(b,c,d){"quote"==b&&(b="blockquote");var e=["p","pre","blockquote","h1","h2","h3","h4","h5","h6"];if(-1!=a.inArray(b,e)){this.block.isRemoveInline="pre"==b||-1!=b.search(/h[1-6]/i),this.utils.browser("msie")||this.$editor.focus();var f=a.trim(this.$editor.html());if(this.block.isEmpty=this.utils.isEmpty(f),this.utils.browser("mozilla")&&!this.focus.isFocused()&&this.block.isEmpty){var g;this.opts.linebreaks||(g=this.$editor.children().first(),this.caret.setEnd(g))}this.block.blocks=this.selection.getBlocks(),this.block.blocksSize=this.block.blocks.length,this.block.type=c,this.block.value=d,this.buffer.set(),this.selection.save(),this.block.set(b),this.selection.restore(),this.code.sync(),this.observe.load()}},set:function(a){this.selection.get(),this.block.containerTag=this.range.commonAncestorContainer.tagName,this.range.collapsed?this.block.setCollapsed(a):this.block.setMultiple(a)},setCollapsed:function(b){if(this.opts.linebreaks&&this.block.isEmpty&&"p"!=b){var c=document.createElement(b);return this.$editor.html(c),void this.caret.setEnd(c)}var d=this.block.blocks[0];if(d!==!1){if("LI"==d.tagName){if("blockquote"!=b)return;return void this.block.formatListToBlockquote()}var e="TD"==this.block.containerTag||"TH"==this.block.containerTag;if(e&&!this.opts.linebreaks)document.execCommand("formatblock",!1,"<"+b+">"),d=this.selection.getBlock(),this.block.toggle(a(d));else if(d.tagName.toLowerCase()!=b)if(this.opts.linebreaks&&"p"==b)a(d).append("<br>"),this.utils.replaceWithContents(d);else{var f=this.utils.replaceToTag(d,b);this.block.toggle(f),"p"!=b&&"blockquote"!=b&&f.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(f),("p"==b||this.block.headTag)&&f.find("p").contents().unwrap(),this.block.formatTableWrapping(f)}else if("blockquote"==b&&d.tagName.toLowerCase()==b)if(this.opts.linebreaks)a(d).append("<br>"),this.utils.replaceWithContents(d);else{var g=this.utils.replaceToTag(d,"p");this.block.toggle(g)}else d.tagName.toLowerCase()==b&&this.block.toggle(a(d));"undefined"==typeof this.block.type&&"undefined"==typeof this.block.value&&a(d).removeAttr("class").removeAttr("style")}},setMultiple:function(b){var c=this.block.blocks[0],d="TD"==this.block.containerTag||"TH"==this.block.containerTag;if(c!==!1&&1===this.block.blocksSize)if(c.tagName.toLowerCase()==b&&"blockquote"==b)if(this.opts.linebreaks)a(c).append("<br>"),this.utils.replaceWithContents(c);else{var e=this.utils.replaceToTag(c,"p");this.block.toggle(e)}else if("LI"==c.tagName){if("blockquote"!=b)return;this.block.formatListToBlockquote()}else if("BLOCKQUOTE"==this.block.containerTag)this.block.formatBlockquote(b);else if(this.opts.linebreaks&&(d||this.range.commonAncestorContainer!=c))this.block.formatWrap(b);else if(this.opts.linebreaks&&"p"==b)a(c).prepend("<br>").append("<br>"),this.utils.replaceWithContents(c);else if("TD"===c.tagName)this.block.formatWrap(b);else{var f=this.utils.replaceToTag(c,b);this.block.toggle(f),this.block.isRemoveInline&&this.utils.removeInlineTags(f),("p"==b||this.block.headTag)&&f.find("p").contents().unwrap()}else if(this.opts.linebreaks||"p"!=b){if("blockquote"==b){for(var g=0,h=0;h<this.block.blocksSize;h++)"BLOCKQUOTE"==this.block.blocks[h].tagName&&g++;if(g==this.block.blocksSize)return void a.each(this.block.blocks,a.proxy(function(b,c){var d=!1;this.opts.linebreaks?(a(c).prepend("<br>").append("<br>"),d=this.utils.replaceWithContents(c)):d=this.utils.replaceToTag(c,"p"),d&&"undefined"==typeof this.block.type&&"undefined"==typeof this.block.value&&d.removeAttr("class").removeAttr("style")},this))}this.block.formatWrap(b)}else{var i=0,j=!1;"class"==this.block.type&&(j="toggle",i=a(this.block.blocks).filter("."+this.block.value).length,this.block.blocksSize==i?j="toggle":this.block.blocksSize>i?j="set":0===i&&(j="set"));var k=["ul","ol","li","td","th","dl","dt","dd"];a.each(this.block.blocks,a.proxy(function(c,d){if(-1==a.inArray(d.tagName.toLowerCase(),k)){var e=this.utils.replaceToTag(d,b);j?"toggle"==j?this.block.toggle(e):"remove"==j?this.block.remove(e):"set"==j&&this.block.setForce(e):this.block.toggle(e),"p"!=b&&"blockquote"!=b&&e.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(e),("p"==b||this.block.headTag)&&e.find("p").contents().unwrap(),"undefined"==typeof this.block.type&&"undefined"==typeof this.block.value&&e.removeAttr("class").removeAttr("style")}},this))}},setForce:function(a){return this.block.clearStyle&&a.removeAttr("class").removeAttr("style"),"class"==this.block.type?void a.addClass(this.block.value):"attr"==this.block.type||"data"==this.block.type?void a.attr(this.block.value.name,this.block.value.value):void 0},toggle:function(a){return this.block.clearStyle&&a.removeAttr("class").removeAttr("style"),"class"==this.block.type?void a.toggleClass(this.block.value):"attr"==this.block.type||"data"==this.block.type?void(a.attr(this.block.value.name)==this.block.value.value?a.removeAttr(this.block.value.name):a.attr(this.block.value.name,this.block.value.value)):void a.removeAttr("style class")},remove:function(a){a.removeClass(this.block.value)},formatListToBlockquote:function(){var b=a(this.block.blocks[0]).closest("ul, ol",this.$editor[0]);a(b).find("ul, ol").contents().unwrap(),a(b).find("li").append(a("<br>")).contents().unwrap();var c=this.utils.replaceToTag(b,"blockquote");this.block.toggle(c)},formatBlockquote:function(b){document.execCommand("outdent"),document.execCommand("formatblock",!1,b),this.clean.clearUnverified(),this.$editor.find("p:empty").remove();var c=this.selection.getBlock();"p"!=b&&a(c).find("img").remove(),this.opts.linebreaks||this.block.toggle(a(c)),this.$editor.find("ul, ol, tr, blockquote, p").each(a.proxy(this.utils.removeEmpty,this)),this.opts.linebreaks&&"p"==b&&this.utils.replaceWithContents(c)},formatWrap:function(b){if("UL"==this.block.containerTag||"OL"==this.block.containerTag){if("blockquote"!=b)return;this.block.formatListToBlockquote()}var c=this.selection.wrap(b);if(c!==!1){var d=a(c);this.block.formatTableWrapping(d);var e=d.find(this.opts.blockLevelElements.join(",")+", td, table, thead, tbody, tfoot, th, tr");if(e.contents().unwrap(),"p"!=b&&"blockquote"!=b&&d.find("img").remove(),a.each(this.block.blocks,a.proxy(this.utils.removeEmpty,this)),d.append(this.selection.getMarker(2)),this.opts.linebreaks||this.block.toggle(d),this.$editor.find("ul, ol, tr, blockquote, p").each(a.proxy(this.utils.removeEmpty,this)),d.find("blockquote:empty").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(d),this.opts.linebreaks&&"p"==b&&this.utils.replaceWithContents(d),this.opts.linebreaks){var f=d.next().next();0!=f.size()&&"BR"===f[0].tagName&&f.remove()}}},formatTableWrapping:function(a){0!==a.closest("table",this.$editor[0]).length&&(0===a.closest("tr",this.$editor[0]).length&&a.wrap("<tr>"),0===a.closest("td",this.$editor[0]).length&&0===a.closest("th").length&&a.wrap("<td>"))},removeData:function(b,c){var d=this.selection.getBlocks();a(d).removeAttr("data-"+b),this.code.sync()},setData:function(b,c){var d=this.selection.getBlocks();a(d).attr("data-"+b,c),this.code.sync()},toggleData:function(b,c){var d=this.selection.getBlocks();a.each(d,function(){a(this).attr("data-"+b)?a(this).removeAttr("data-"+b):a(this).attr("data-"+b,c)})},removeAttr:function(b,c){var d=this.selection.getBlocks();a(d).removeAttr(b),this.code.sync()},setAttr:function(b,c){var d=this.selection.getBlocks();a(d).attr(b,c),this.code.sync()},toggleAttr:function(b,c){var d=this.selection.getBlocks();a.each(d,function(){a(this).attr(name)?a(this).removeAttr(name):a(this).attr(name,c)})},removeClass:function(b){var c=this.selection.getBlocks();a(c).removeClass(b),this.utils.removeEmptyAttr(c,"class"),this.code.sync()},setClass:function(b){var c=this.selection.getBlocks();a(c).addClass(b),this.code.sync()},toggleClass:function(b){var c=this.selection.getBlocks();a(c).toggleClass(b),this.code.sync()}}},buffer:function(){return{set:function(a){"undefined"==typeof a||"undo"==a?this.buffer.setUndo():this.buffer.setRedo()},setUndo:function(){this.selection.save(),this.opts.buffer.push(this.$editor.html()),this.selection.restore()},setRedo:function(){this.selection.save(),this.opts.rebuffer.push(this.$editor.html()),this.selection.restore()},getUndo:function(){this.$editor.html(this.opts.buffer.pop())},getRedo:function(){this.$editor.html(this.opts.rebuffer.pop())},add:function(){this.opts.buffer.push(this.$editor.html())},undo:function(){0!==this.opts.buffer.length&&(this.buffer.set("redo"),this.buffer.getUndo(),this.selection.restore(),setTimeout(a.proxy(this.observe.load,this),50))},redo:function(){0!==this.opts.rebuffer.length&&(this.buffer.set("undo"),this.buffer.getRedo(),this.selection.restore(),setTimeout(a.proxy(this.observe.load,this),50))}}},build:function(){return{run:function(){this.build.createContainerBox(),this.build.loadContent(),this.build.loadEditor(),this.build.enableEditor(),this.build.setCodeAndCall()},isTextarea:function(){return"TEXTAREA"===this.$element[0].tagName},createContainerBox:function(){this.$box=a('<div class="redactor-box" role="application" />')},createTextarea:function(){this.$textarea=a("<textarea />").attr("name",this.build.getTextareaName())},getTextareaName:function(){return"undefined"==typeof name?"content-"+this.uuid:this.$element.attr("id")},loadContent:function(){var b=this.build.isTextarea()?"val":"html";this.content=a.trim(this.$element[b]())},enableEditor:function(){this.$editor.attr({contenteditable:!0,dir:this.opts.direction})},loadEditor:function(){var a=this.build.isTextarea()?"fromTextarea":"fromElement";this.build[a]()},fromTextarea:function(){this.$editor=a("<div />"),this.$textarea=this.$element,this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element),this.$editor.addClass("redactor-editor"),this.$element.hide()},fromElement:function(){this.$editor=this.$element,this.build.createTextarea(),this.$box.insertAfter(this.$editor).append(this.$editor).append(this.$textarea),this.$editor.addClass("redactor-editor"),this.$textarea.hide()},setCodeAndCall:function(){this.code.set(this.content),this.build.setOptions(),this.build.callEditor(),this.opts.visual||setTimeout(a.proxy(this.code.showCode,this),200)},callEditor:function(){this.build.disableMozillaEditing(),this.build.disableIeLinks(),this.build.setEvents(),this.build.setHelpers(),this.opts.toolbar&&(this.opts.toolbar=this.toolbar.init(),this.toolbar.build()),this.modal.loadTemplates(),this.build.plugins(),setTimeout(a.proxy(this.observe.load,this),4),this.core.setCallback("init")},setOptions:function(){a(this.$textarea).attr("dir",this.opts.direction),this.opts.linebreaks&&this.$editor.addClass("redactor-linebreaks"),this.opts.tabindex&&this.$editor.attr("tabindex",this.opts.tabindex),this.opts.minHeight&&this.$editor.css("minHeight",this.opts.minHeight),this.opts.maxHeight&&this.$editor.css("maxHeight",this.opts.maxHeight)},setEventDropUpload:function(a){if(a.preventDefault(),this.opts.dragImageUpload&&this.opts.dragFileUpload){var b=a.dataTransfer.files;this.upload.directUpload(b[0],a)}},setEventDrop:function(a){this.code.sync(),setTimeout(this.clean.clearUnverified,1),this.core.setCallback("drop",a)},setEvents:function(){this.$editor.on("drop.redactor",a.proxy(function(a){return a=a.originalEvent||a,void 0!==window.FormData&&a.dataTransfer?0===a.dataTransfer.files.length?this.build.setEventDrop(a):(this.build.setEventDropUpload(a),setTimeout(this.clean.clearUnverified,1),void this.core.setCallback("drop",a)):!0},this)),this.$editor.on("click.redactor",a.proxy(function(a){var b=this.core.getEvent(),c="click"==b||"arrow"==b?!1:"click";this.core.addEvent(c),this.utils.disableSelectAll(),this.core.setCallback("click",a)},this)),this.$editor.on("paste.redactor",a.proxy(this.paste.init,this)),this.$editor.on("cut.redactor",a.proxy(this.code.sync,this)),this.$editor.on("keydown.redactor",a.proxy(this.keydown.init,this)),this.$editor.on("keyup.redactor",a.proxy(this.keyup.init,this)),a.isFunction(this.opts.codeKeydownCallback)&&this.$textarea.on("keydown.redactor-textarea",a.proxy(this.opts.codeKeydownCallback,this)),a.isFunction(this.opts.codeKeyupCallback)&&this.$textarea.on("keyup.redactor-textarea",a.proxy(this.opts.codeKeyupCallback,this)),a.isFunction(this.opts.focusCallback)&&this.$editor.on("focus.redactor",a.proxy(this.opts.focusCallback,this)),a(document).on("mousedown.redactor."+this.uuid,a.proxy(function(a){this.blurClickedElement=a.target},this)),this.$editor.on("blur.redactor",a.proxy(function(b){this.start||this.rtePaste||this.build.isBlured()&&(this.utils.disableSelectAll(),a.isFunction(this.opts.blurCallback)&&this.core.setCallback("blur",b))},this))},isBlured:function(){if(this.blurClickedElement===!0)return!0;var b=a(this.blurClickedElement);return!b.hasClass("redactor-toolbar, redactor-dropdown")&&!b.is("#redactor-modal")&&0===b.parents(".redactor-toolbar, .redactor-dropdown, #redactor-modal").length},setHelpers:function(){this.linkify.isEnabled()&&this.linkify.format(),this.placeholder.enable(),this.opts.focus&&setTimeout(this.focus.setStart,100),this.opts.focusEnd&&setTimeout(this.focus.setEnd,100)},plugins:function(){this.opts.plugins&&a.each(this.opts.plugins,a.proxy(function(c,d){var e="undefined"!=typeof RedactorPlugins&&"undefined"!=typeof RedactorPlugins[d]?RedactorPlugins:b.fn;if(a.isFunction(e[d])){this[d]=e[d]();for(var f=this.getModuleMethods(this[d]),g=f.length,h=0;g>h;h++)this[d][f[h]]=this[d][f[h]].bind(this);a.isFunction(this[d].init)&&this[d].init()}},this))},disableMozillaEditing:function(){if(this.utils.browser("mozilla"))try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(a){}},disableIeLinks:function(){this.utils.browser("msie")&&document.execCommand("AutoUrlDetect",!1,!1)}}},button:function(){return{getClass:function(a){switch(a){case"html":return"fa fa-code";case"formatting":case"formatting-concrete5":return"fa fa-paragraph";case"orderedlist":return"fa fa-list-ol";case"unorderedlist":return"fa fa-list-ul";case"video":return"fa fa-file-video-o";case"alignment":return"fa fa-align-left";case"horizontalrule":return"fa fa-minus";case"deleted":return"fa fa-strikethrough";case"fontfamily":return"fa fa-font";case"fontsize":return"fa fa-text-height";case"fontcolor":return"fa fa-tint";case"backcolor":return"fa fa-tint";case"bold":return"fa fa-bold";case"italic":return"fa fa-italic";case"outdent":return"fa fa-outdent";case"indent":return"fa fa-indent";case"image":return"fa fa-image";case"link":return"fa fa-link"}},build:function(b,c){var d=a('<a href="#" class="'+this.button.getClass(b)+" re-icon re-"+b+'" rel="'+b+'" />').attr("tabindex","-1");if((c.func||c.command||c.dropdown)&&this.button.setEvent(d,b,c),c.dropdown){var e=a('<ul class="dropdown-menu redactor-dropdown redactor-dropdown-'+ +this.uuid+" redactor-dropdown-box-"+b+'" style="display: none;">');d.data("dropdown",e),this.dropdown.build(b,e,c.dropdown)}return this.utils.isDesktop()&&this.button.createTooltip(d,b,c.title),d},setEvent:function(b,c,d){b.on("touchstart click",a.proxy(function(a){if(b.hasClass("redactor-button-disabled"))return!1;var e="func",f=d.func;d.command?(e="command",f=d.command):d.dropdown&&(e="dropdown",f=!1),this.button.onClick(a,c,e,f)},this))},createTooltip:function(b,c,d){var e=a("<span>").addClass("redactor-toolbar-tooltip redactor-toolbar-tooltip-"+this.uuid+" redactor-toolbar-tooltip-"+c).hide().html(d);e.appendTo("body"),b.on("mouseover",function(){if(!a(this).hasClass("redactor-button-disabled")){var c=b.offset();e.show(),e.css({top:c.top+b.innerHeight()+"px",left:c.left+b.innerWidth()/2-e.innerWidth()/2+"px"})}}),b.on("mouseout",function(){e.hide()})},onClick:function(a,b,c,d){this.button.caretOffset=this.caret.getOffset(),a.preventDefault(),this.utils.browser("msie")&&(a.returnValue=!1),"command"==c?this.inline.format(d):"dropdown"==c?this.dropdown.show(a,b):this.button.onClickCallback(a,d,b)},onClickCallback:function(b,c,d){var e;if(this.blurClickedElement=!0,a.isFunction(c))c.call(this,d);else if("-1"!=c.search(/\./)){if(e=c.split("."),"undefined"==typeof this[e[0]])return;this[e[0]][e[1]](d)}else this[c](d);this.observe.buttons(b,d)},get:function(a){return this.$toolbar.find("a.re-"+a)},setActive:function(a){this.button.get(a).addClass("redactor-act")},setInactive:function(a){this.button.get(a).removeClass("redactor-act")},setInactiveAll:function(a){"undefined"==typeof a?this.$toolbar.find("a.re-icon").removeClass("redactor-act"):this.$toolbar.find("a.re-icon").not(".re-"+a).removeClass("redactor-act")},setActiveInVisual:function(){this.$toolbar.find("a.re-icon").not("a.re-html, a.re-fullscreen").removeClass("redactor-button-disabled")},setInactiveInCode:function(){this.$toolbar.find("a.re-icon").not("a.re-html, a.re-fullscreen").addClass("redactor-button-disabled")},changeIcon:function(a,b){this.button.get(a).addClass("re-"+b)},removeIcon:function(a,b){this.button.get(a).removeClass("re-"+b)},setAwesome:function(a,b){var c=this.button.get(a);c.removeClass("redactor-btn-image").addClass("fa "+b)},addCallback:function(b,c){if("buffer"!=b){var d="dropdown"==c?"dropdown":"func",e=b.attr("rel");b.on("touchstart click",a.proxy(function(a){return b.hasClass("redactor-button-disabled")?!1:void this.button.onClick(a,e,d,c)},this))}},addDropdown:function(b,c){b.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0);var d=b.attr("rel");this.button.addCallback(b,"dropdown");var e=a('<ul class="dropdown-menu redactor-dropdown redactor-dropdown-'+ +this.uuid+" redactor-dropdown-box-"+d+'" style="display: none;">');return b.data("dropdown",e),c&&this.dropdown.build(d,e,c),e},add:function(b,c){if(this.opts.toolbar){if(this.button.isMobileUndoRedo(b))return"buffer";var d=this.button.build(b,{title:c});return d.addClass("redactor-btn-image"),this.$toolbar.append(a("<li>").append(d)),d}},addFirst:function(b,c){if(this.opts.toolbar){if(this.button.isMobileUndoRedo(b))return"buffer";var d=this.button.build(b,{title:c});return d.addClass("redactor-btn-image"),this.$toolbar.prepend(a("<li>").append(d)),d}},addAfter:function(b,c,d){if(this.opts.toolbar){if(this.button.isMobileUndoRedo(c))return"buffer";var e=this.button.build(c,{title:d});e.addClass("redactor-btn-image");var f=this.button.get(b);return 0!==f.length?f.parent().after(a("<li>").append(e)):this.$toolbar.append(a("<li>").append(e)),e}},addBefore:function(b,c,d){if(this.opts.toolbar){if(this.button.isMobileUndoRedo(c))return"buffer";var e=this.button.build(c,{title:d});e.addClass("redactor-btn-image");var f=this.button.get(b);return 0!==f.length?f.parent().before(a("<li>").append(e)):this.$toolbar.append(a("<li>").append(e)),e}},remove:function(a){this.button.get(a).parent().remove()},isMobileUndoRedo:function(a){return("undo"==a||"redo"==a)&&!this.utils.isDesktop()}}},caret:function(){return{setStart:function(b){if(this.utils.isBlock(b))this.caret.set(b,0,b,0);else{var c=this.utils.createSpaceElement();a(b).prepend(c),this.caret.setEnd(c)}},setEnd:function(a){return a=a[0]||a,1==a.lastChild.nodeType?this.caret.setAfter(a.lastChild):void this.caret.set(a,1,a,1)},set:function(b,c,d,e){if(b=b[0]||b,d=d[0]||d,this.utils.isBlockTag(b.tagName)&&""===b.innerHTML&&(b.innerHTML=this.opts.invisibleSpace),"BR"==b.tagName&&this.opts.linebreaks===!1){var f=a(this.opts.emptyHtml)[0];a(b).replaceWith(f),b=f,d=b}this.selection.get();try{this.range.setStart(b,c),this.range.setEnd(d,e)}catch(g){}this.selection.addRange()},setAfter:function(b){try{var c=a(b)[0].tagName;if("BR"==c||this.utils.isBlock(b))"BR"!=c&&this.utils.browser("msie")?this.caret.setStart(a(b).next()):this.caret.setAfterOrBefore(b,"after");else{var d=this.utils.createSpaceElement();a(b).after(d),this.caret.setEnd(d)}}catch(e){var d=this.utils.createSpaceElement();a(b).after(d),this.caret.setEnd(d)}},setBefore:function(b){this.utils.isBlock(b)?this.caret.setEnd(a(b).prev()):this.caret.setAfterOrBefore(b,"before")},setAfterOrBefore:function(a,b){if(this.utils.browser("msie")||this.$editor.focus(),a=a[0]||a,this.selection.get(),"after"==b)try{this.range.setStartAfter(a),this.range.setEndAfter(a)}catch(c){}else try{this.range.setStartBefore(a),this.range.setEndBefore(a)}catch(c){}this.range.collapse(!1),this.selection.addRange()},getOffsetOfElement:function(b){b=b[0]||b,this.selection.get();var c=this.range.cloneRange();return c.selectNodeContents(b),c.setEnd(this.range.endContainer,this.range.endOffset),a.trim(c.toString()).length},getOffset:function(){var a=0,b=window.getSelection();if(b.rangeCount>0){var c=window.getSelection().getRangeAt(0),d=c.cloneRange();d.selectNodeContents(this.$editor[0]),d.setEnd(c.endContainer,c.endOffset),a=d.toString().length}return a},setOffset:function(a,b){"undefined"==typeof b&&(b=a),this.focus.isFocused()||this.focus.setStart();for(var c,d=(this.selection.get(),0),e=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);c==e.nextNode();)if(d+=c.nodeValue.length,
d>a&&(this.range.setStart(c,c.nodeValue.length+a-d),a=1/0),d>=b){this.range.setEnd(c,c.nodeValue.length+b-d);break}this.range.collapse(!1),this.selection.addRange()},setToPoint:function(a,b){this.caret.setOffset(a,b)},getCoords:function(){return this.caret.getOffset()}}},clean:function(){return{onSet:function(b){b=this.clean.savePreCode(b),b=b.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" style="display: none;" $1>$2</pre>'),b=b.replace(/\$/g,"&#36;"),b=b.replace(/<a href="(.*?[^>]?)®(.*?[^>]?)">/gi,'<a href="$1&reg$2">'),this.opts.replaceDivs&&(b=this.clean.replaceDivs(b)),this.opts.linebreaks&&(b=this.clean.replaceParagraphsToBr(b)),b=this.clean.saveFormTags(b);var c=a("<div>");c.html(b);var d=c.find("font[style]");return 0!==d.length&&(d.replaceWith(function(){var b=a(this),c=a("<span>").attr("style",b.attr("style"));return c.append(b.contents())}),b=c.html()),c.remove(),b=b.replace(/<font(.*?[^<])>/gi,""),b=b.replace(/<\/font>/gi,""),b=this.tidy.load(b),this.opts.paragraphize&&(b=this.paragraphize.load(b)),b=this.clean.setVerified(b),b=this.clean.convertInline(b),b=b.replace(/&amp;/g,"&")},onSync:function(b){if(b=b.replace(/\u200B/g,""),b=b.replace(/&#x200b;/gi,""),this.opts.cleanSpaces&&(b=b.replace(/&nbsp;/gi," ")),-1!=b.search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i))return"";b=b.replace(/<pre class="redactor-script-tag" style="display: none;"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2</script>"),b=this.clean.restoreFormTags(b);var c={"™":"&trade;","©":"&copy;","…":"&hellip;","—":"&mdash;","‐":"&dash;"};a.each(c,function(a,c){b=b.replace(new RegExp(a,"g"),c)}),this.utils.browser("mozilla")&&(b=b.replace(/<br\s?\/?>$/gi,"")),b=b.replace(new RegExp("<br\\s?/?></li>","gi"),"</li>"),b=b.replace(new RegExp("</li><br\\s?/?>","gi"),"</li>"),b=b.replace(/<(.*?)rel="\s*?"(.*?[^>]?)>/gi,'<$1$2">'),b=b.replace(/<(.*?)style="\s*?"(.*?[^>]?)>/gi,'<$1$2">'),b=b.replace(/="">/gi,">"),b=b.replace(/""">/gi,'">'),b=b.replace(/"">/gi,'">'),b=b.replace(/<div(.*?[^>]) data-tagblock="redactor"(.*?[^>])>/gi,"<div$1$2>"),b=b.replace(/<(.*?) data-verified="redactor"(.*?[^>])>/gi,"<$1$2>");var d=a("<div/>").html(a.parseHTML(b,document,!0));return d.find("span").removeAttr("rel"),d.find("pre .redactor-invisible-space").each(function(){a(this).contents().unwrap()}),b=d.html(),b=b.replace(/<img(.*?[^>])rel="(.*?[^>])"(.*?[^>])>/gi,"<img$1$3>"),b=b.replace(/<span class="redactor-invisible-space">(.*?)<\/span>/gi,"$1"),b=b.replace(/ data-save-url="(.*?[^>])"/gi,""),b=b.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>"),b=b.replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,""),b=b.replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,""),b=b.replace(/<font(.*?[^<])>/gi,""),b=b.replace(/<\/font>/gi,""),b=this.tidy.load(b),this.opts.linkNofollow&&(b=b.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>"),b=b.replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">')),b=b.replace(/\sdata-redactor-(tag|class|style)="(.*?[^>])"/gi,""),b=b.replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>',"gi"),"<$1$2>"),b=b.replace(new RegExp('<(.*?) data-verified="redactor">',"gi"),"<$1>"),b=b.replace(/&amp;/g,"&")},onPaste:function(b,c){if(b=a.trim(b),b=b.replace(/\$/g,"&#36;"),b=b.replace(/<span class="s[0-9]">/gi,"<span>"),b=b.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," "),b=b.replace(/<span class="Apple-tab-span"[^>]*>\t<\/span>/gi,"	"),b=b.replace(/<span[^>]*>(\s|&nbsp;)<\/span>/gi," "),this.opts.pastePlainText)return this.clean.getPlainText(b);if(!this.utils.isSelectAll()&&"undefined"==typeof c){if(this.utils.isCurrentOrParent(["FIGCAPTION","A"]))return this.clean.getPlainText(b,!1);if(this.utils.isCurrentOrParent("PRE"))return b=b.replace(/”/g,'"'),b=b.replace(/“/g,'"'),b=b.replace(/‘/g,"'"),b=b.replace(/’/g,"'"),this.clean.getPreCode(b);if(this.utils.isCurrentOrParent(["BLOCKQUOTE","H1","H2","H3","H4","H5","H6"])){if(b=this.clean.getOnlyImages(b),!this.utils.browser("msie")){var d=this.selection.getBlock();d&&"P"==d.tagName&&(b=b.replace(/<img(.*?)>/gi,"<p><img$1></p>"))}return b}if(this.utils.isCurrentOrParent(["TD"]))return b=this.clean.onPasteTidy(b,"td"),this.opts.linebreaks&&(b=this.clean.replaceParagraphsToBr(b)),b=this.clean.replaceDivsToBr(b);if(this.utils.isCurrentOrParent(["LI"]))return this.clean.onPasteTidy(b,"li")}return b=this.clean.isSingleLine(b,c),this.clean.singleLine||(this.opts.linebreaks&&(b=this.clean.replaceParagraphsToBr(b)),this.opts.replaceDivs&&(b=this.clean.replaceDivs(b)),b=this.clean.saveFormTags(b)),b=this.clean.onPasteWord(b),b=this.clean.onPasteExtra(b),b=this.clean.onPasteTidy(b,"all"),!this.clean.singleLine&&this.opts.paragraphize&&(b=this.paragraphize.load(b)),b=this.clean.removeDirtyStyles(b),b=this.clean.onPasteRemoveSpans(b),b=this.clean.onPasteRemoveEmpty(b),b=this.clean.convertInline(b)},onPasteWord:function(b){if(b=b.replace(/<!--[\s\S]*?-->/gi,""),b=b.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,""),b=b.replace(/<o\:p[^>]*>[\s\S]*?<\/o\:p>/gi,""),b.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)){b=b.replace(/<!--[\s\S]+?-->/gi,""),b=b.replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,""),b=b.replace(/<(\/?)s>/gi,"<$1strike>"),b=b.replace(/ /gi," "),b=b.replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(a,b){return b.length>0?b.replace(/./," ").slice(Math.floor(b.length/2)).split("").join(" "):""}),b=this.clean.onPasteIeFixLinks(b),b=b.replace(/<img(.*?)v:shapes=(.*?)>/gi,""),b=b.replace(/src="file\:\/\/(.*?)"/,'src=""');var c=a("<div/>").html(b),d=!1,e=1,f=[];c.find("p[style]").each(function(){var b=a(this).attr("style").match(/mso\-list\:l([0-9]+)\slevel([0-9]+)/);if(b){var g=parseInt(b[1]),h=parseInt(b[2]),i=a(this).html().match(/^[\w]+\./)?"ol":"ul",j=a("<li/>").html(a(this).html());if(j.html(j.html().replace(/^([\w\.]+)</,"<")),j.find("span:first").remove(),1==h&&-1==a.inArray(g,f)){var k=a("<"+i+"/>").attr({"data-level":h,"data-list":g}).html(j);a(this).replaceWith(k),d=g,f.push(g)}else{if(h>e){for(var l=c.find('[data-level="'+e+'"][data-list="'+d+'"]'),m=l,n=e;h>n;n++)k=a("<"+i+"/>"),k.appendTo(m.find("li").last()),m=k;m.attr({"data-level":h,"data-list":g}).html(j)}else{var l=c.find('[data-level="'+h+'"][data-list="'+g+'"]').last();l.append(j)}e=h,d=g,a(this).remove()}}}),c.find("[data-level][data-list]").removeAttr("data-level data-list"),b=c.html(),b=b.replace(/·/g,""),b=b.replace(/<p class="Mso(.*?)"/gi,"<p"),b=b.replace(/ class=\"(mso[^\"]*)\"/gi,""),b=b.replace(/ class=(mso\w+)/gi,""),b=b.replace(/<o:p(.*?)>([\w\W]*?)<\/o:p>/gi,"$2"),b=b.replace(/\n/g," "),b=b.replace(/<p>\n?<li>/gi,"<li>")}return b},onPasteExtra:function(a){return a=a.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),a=a.replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3"),a=a.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>/gi,'<span style="font-weight: bold;"><span style="font-style: italic;">'),a=a.replace(/<span[^>]*font-style: italic[^>]*>/gi,'<span style="font-style: italic;">'),a=a.replace(/<span[^>]*font-weight: bold[^>]*>/gi,'<span style="font-weight: bold;">'),a=a.replace(/<span[^>]*text-decoration: underline[^>]*>/gi,'<span style="text-decoration: underline;">'),a=a.replace(/<img>/gi,""),a=a.replace(/\n{3,}/gi,"\n"),a=a.replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2"),a=a.replace(/<p><p>/gi,"<p>"),a=a.replace(/<\/p><\/p>/gi,"</p>"),a=a.replace(/<li>(\s*|\t*|\n*)<p>/gi,"<li>"),a=a.replace(/<\/p>(\s*|\t*|\n*)<\/li>/gi,"</li>"),a=a.replace(/<\/p>\s<p/gi,"</p><p"),a=a.replace(/<img src="webkit-fake-url\:\/\/(.*?)"(.*?)>/gi,""),a=a.replace(/<p>•([\w\W]*?)<\/p>/gi,"<li>$1</li>"),this.utils.browser("mozilla")&&(a=a.replace(/<br\s?\/?>$/gi,"")),a},onPasteTidy:function(a,b){var c=["span","a","pre","blockquote","small","em","strong","code","kbd","mark","address","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","p","br","video","audio","iframe","embed","param","object","img","table","td","th","tr","tbody","tfoot","thead","h1","h2","h3","h4","h5","h6"],d=!1,e=[["a","*"],["img",["src","alt"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]];"all"==b?(d=["p","span","h1","h2","h3","h4","h5","h6"],e=[["table","class"],["td",["colspan","rowspan"]],["a","*"],["img",["src","alt","data-redactor-inserted-image"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]]):"td"==b?c=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","br","iframe","video","audio","embed","param","object","img","h1","h2","h3","h4","h5","h6"]:"li"==b&&(c=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","br","iframe","video","audio","embed","param","object","img"]);var f={deniedTags:this.opts.deniedTags?this.opts.deniedTags:!1,allowedTags:this.opts.allowedTags?this.opts.allowedTags:c,removeComments:!0,removePhp:!0,removeAttr:this.opts.removeAttr?this.opts.removeAttr:!1,allowedAttr:this.opts.allowedAttr?this.opts.allowedAttr:e,removeEmpty:d};return this.tidy.load(a,f)},onPasteRemoveEmpty:function(a){return a=a.replace(/<(p|h[1-6])>(|\s|\n|\t|<br\s?\/?>)<\/(p|h[1-6])>/gi,""),this.opts.linebreaks||(a=a.replace(/<br>$/i,"")),a},onPasteRemoveSpans:function(a){return a=a.replace(/<span>(.*?)<\/span>/gi,"$1"),a=a.replace(/<span[^>]*>\s|&nbsp;<\/span>/gi," ")},onPasteIeFixLinks:function(b){if(!this.utils.browser("msie"))return b;var c=a.trim(b);return 0===c.search(/^<a(.*?)>(.*?)<\/a>$/i)&&(b=b.replace(/^<a(.*?)>(.*?)<\/a>$/i,"$2")),b},isSingleLine:function(a,b){if(this.clean.singleLine=!1,!this.utils.isSelectAll()&&"undefined"==typeof b){var c=this.opts.blockLevelElements.join("|").replace("P|","").replace("DIV|",""),d=a.match(new RegExp("</("+c+")>","gi")),e=a.match(/<\/(p|div)>/gi);if(!d&&(null===e||e&&e.length<=1)){var f=a.match(/<br\s?\/?>/gi);f||(this.clean.singleLine=!0,a=a.replace(/<\/?(p|div)(.*?)>/gi,""))}}return a},stripTags:function(a,b){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return a.replace(c,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""})},savePreCode:function(a){return a=this.clean.savePreFormatting(a),a=this.clean.saveCodeFormatting(a),a=this.clean.restoreSelectionMarker(a)},savePreFormatting:function(b){var c=b.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null!==c&&a.each(c,a.proxy(function(a,c){var d=c.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);d[2]=d[2].replace(/<br\s?\/?>/g,"\n"),d[2]=d[2].replace(/&nbsp;/g," "),this.opts.preSpaces&&(d[2]=d[2].replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),d[2]=this.clean.encodeEntities(d[2]),d[2]=d[2].replace(/\$/g,"&#36;"),b=b.replace(c,"<pre"+d[1]+">"+d[2]+"</pre>")},this)),b},saveCodeFormatting:function(b){var c=b.match(/<code(.*?)>([\w\W]*?)<\/code>/gi);return null!==c&&a.each(c,a.proxy(function(a,c){var d=c.match(/<code(.*?)>([\w\W]*?)<\/code>/i);d[2]=d[2].replace(/&nbsp;/g," "),d[2]=this.clean.encodeEntities(d[2]),d[2]=d[2].replace(/\$/g,"&#36;"),b=b.replace(c,"<code"+d[1]+">"+d[2]+"</code>")},this)),b},restoreSelectionMarker:function(a){return a=a.replace(/&lt;span id=&quot;selection-marker-([0-9])&quot; class=&quot;redactor-selection-marker&quot; data-verified=&quot;redactor&quot;&gt;​&lt;\/span&gt;/g,'<span id="selection-marker-$1" class="redactor-selection-marker" data-verified="redactor">​</span>')},getTextFromHtml:function(b){b=b.replace(/<br\s?\/?>|<\/H[1-6]>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n");var c=document.createElement("div");return c.innerHTML=b,b=c.textContent||c.innerText,a.trim(b)},getPlainText:function(a,b){return a=this.clean.getTextFromHtml(a),a=a.replace(/\n/g,"<br />"),this.opts.paragraphize&&"undefined"==typeof b&&!this.utils.browser("mozilla")&&(a=this.paragraphize.load(a)),a},getPreCode:function(a){return a=a.replace(/<img(.*?) style="(.*?)"(.*?[^>])>/gi,"<img$1$3>"),a=a.replace(/<img(.*?)>/gi,"&lt;img$1&gt;"),a=this.clean.getTextFromHtml(a),this.opts.preSpaces&&(a=a.replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),a=this.clean.encodeEntities(a)},getOnlyImages:function(a){return a=a.replace(/<img(.*?)>/gi,"[img$1]"),a=a.replace(/<([Ss]*?)>/gi,""),a=a.replace(/\[img(.*?)\]/gi,"<img$1>")},getOnlyLinksAndImages:function(a){return a=a.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]'),a=a.replace(/<img(.*?)>/gi,"[img$1]"),a=a.replace(/<(.*?)>/gi,""),a=a.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),a=a.replace(/\[img(.*?)\]/gi,"<img$1>")},encodeEntities:function(a){return a=String(a).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},removeDirtyStyles:function(b){if(this.utils.browser("msie"))return b;var c=document.createElement("div");return c.innerHTML=b,this.clean.clearUnverifiedRemove(a(c)),b=c.innerHTML,a(c).remove(),b},clearUnverified:function(){if(!this.utils.browser("msie")){this.clean.clearUnverifiedRemove(this.$editor);var a=this.$editor.find("h1, h2, h3, h4, h5, h6");a.find("span").removeAttr("style"),a.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),this.code.sync()}},clearUnverifiedRemove:function(b){b.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),b.find("span").not('[data-verified="redactor"]').removeAttr("style"),b.find('span[data-verified="redactor"], img[data-verified="redactor"]').each(function(b,c){var d=a(c);d.attr("style",d.attr("rel"))})},cleanEmptyParagraph:function(){},setVerified:function(a){if(this.utils.browser("msie"))return a;a=a.replace(new RegExp("<img(.*?[^>])>","gi"),'<img$1 data-verified="redactor">'),a=a.replace(new RegExp("<span(.*?[^>])>","gi"),'<span$1 data-verified="redactor">');var b=a.match(new RegExp('<(span|img)(.*?)style="(.*?)"(.*?[^>])>',"gi"));if(b)for(var c=b.length,d=0;c>d;d++)try{var e=b[d].replace(/style="(.*?)"/i,'style="$1" rel="$1"');a=a.replace(b[d],e)}catch(f){}return a},convertInline:function(b){var c=a("<div />").html(b),d=this.opts.inlineTags;return d.push("span"),c.find(d.join(",")).each(function(){var b=a(this),c=this.tagName.toLowerCase();b.attr("data-redactor-tag",c),"span"==c&&(b.attr("style")?b.attr("data-redactor-style",b.attr("style")):b.attr("class")&&b.attr("data-redactor-class",b.attr("class")))}),b=c.html(),c.remove(),b},normalizeLists:function(){this.$editor.find("li").each(function(b,c){var d=a(c).next();0===d.length||"UL"!=d[0].tagName&&"OL"!=d[0].tagName||a(c).append(d)})},removeSpaces:function(a){return a=a.replace(/\n/g,""),a=a.replace(/[\t]*/g,""),a=a.replace(/\n\s*\n/g,"\n"),a=a.replace(/^[\s\n]*/g," "),a=a.replace(/[\s\n]*$/g," "),a=a.replace(/>\s{2,}</g,"> <"),a=a.replace(/\n\n/g,"\n"),a=a.replace(/\u200B/g,"")},replaceDivs:function(a){return this.opts.linebreaks?(a=a.replace(/<div><br\s?\/?><\/div>/gi,"<br />"),a=a.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2<br />")):a=a.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>"),a=a.replace(/<div(.*?[^>])>/gi,""),a=a.replace(/<\/div>/gi,"")},replaceDivsToBr:function(a){return a=a.replace(/<div\s(.*?)>/gi,"<p>"),a=a.replace(/<div><br\s?\/?><\/div>/gi,"<br /><br />"),a=a.replace(/<div>([\w\W]*?)<\/div>/gi,"$1<br /><br />")},replaceParagraphsToBr:function(a){return a=a.replace(/<p\s(.*?)>/gi,"<p>"),a=a.replace(/<p><br\s?\/?><\/p>/gi,"<br />"),a=a.replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br /><br />"),a=a.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>")},saveFormTags:function(a){return a.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(a){return a.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")}}},code:function(){return{set:function(b){b=a.trim(b.toString()),b=this.clean.onSet(b),this.utils.browser("msie")&&(b=b.replace(/<span(.*?)id="selection-marker-(1|2)"(.*?)><\/span>;/gi,"")),this.$editor.html(b),this.code.sync(),""!==b&&this.placeholder.remove(),setTimeout(a.proxy(this.buffer.add,this),15),this.start===!1&&this.observe.load()},get:function(){var a=this.$textarea.val();return this.opts.replaceDivs&&(a=this.clean.replaceDivs(a)),this.opts.linebreaks&&(a=this.clean.replaceParagraphsToBr(a)),a=this.tabifier.get(a)},sync:function(){setTimeout(a.proxy(this.code.startSync,this),10)},startSync:function(){var a=this.$editor.html();this.code.syncCode&&this.code.syncCode==a||(this.code.syncCode=a,a=this.core.setCallback("syncBefore",a),a=this.clean.onSync(a),this.$textarea.val(a),this.core.setCallback("sync",a),this.start===!1&&this.core.setCallback("change",a),this.start=!1,0==this.autosave.html&&(this.autosave.html=this.code.get()),this.opts.codemirror&&this.$textarea.next(".CodeMirror").each(function(b,c){c.CodeMirror.setValue(a)}),this.autosave.onChange(),this.autosave.enable())},toggle:function(){this.opts.visual?this.code.showCode():this.code.showVisual()},showCode:function(){this.selection.save(),this.code.offset=this.caret.getOffset();var b=a(window).scrollTop(),c=(this.$editor.innerWidth(),this.$editor.innerHeight());this.$editor.hide();var d=this.$textarea.val();this.modified=this.clean.removeSpaces(d),d=this.tabifier.get(d);var e=0,f=0,g=a("<div/>").append(a.parseHTML(this.clean.onSync(this.$editor.html()),document,!0)),h=g.find("span.redactor-selection-marker");if(h.length>0){var i=this.tabifier.get(g.html()).replace(/&amp;/g,"&");1==h.length?(e=this.utils.strpos(i,g.find("#selection-marker-1").prop("outerHTML")),f=e):2==h.length&&(e=this.utils.strpos(i,g.find("#selection-marker-1").prop("outerHTML")),f=this.utils.strpos(i,g.find("#selection-marker-2").prop("outerHTML"))-g.find("#selection-marker-1").prop("outerHTML").toString().length)}this.selection.removeMarkers(),this.$textarea.val(d),this.opts.codemirror?this.$textarea.next(".CodeMirror").each(function(b,g){a(g).show(),g.CodeMirror.setValue(d),g.CodeMirror.setSize("100%",c),g.CodeMirror.refresh(),e==f?g.CodeMirror.setCursor(g.CodeMirror.posFromIndex(e).line,g.CodeMirror.posFromIndex(f).ch):g.CodeMirror.setSelection({line:g.CodeMirror.posFromIndex(e).line,ch:g.CodeMirror.posFromIndex(e).ch},{line:g.CodeMirror.posFromIndex(f).line,ch:g.CodeMirror.posFromIndex(f).ch}),g.CodeMirror.focus()}):(this.$textarea.height(c).show().focus(),this.$textarea.on("keydown.redactor-textarea-indenting",this.code.textareaIndenting),a(window).scrollTop(b),this.$textarea[0].setSelectionRange&&this.$textarea[0].setSelectionRange(e,f),this.$textarea[0].scrollTop=0),this.opts.visual=!1,this.button.setInactiveInCode(),this.button.setActive("html"),this.core.setCallback("source",d)},showVisual:function(){var a;if(!this.opts.visual){var b=0,c=0;if(this.opts.codemirror){var d;this.$textarea.next(".CodeMirror").each(function(e,f){d=f.CodeMirror.listSelections(),b=f.CodeMirror.indexFromPos(d[0].anchor),c=f.CodeMirror.indexFromPos(d[0].head),a=f.CodeMirror.getValue()})}else b=this.$textarea.get(0).selectionStart,c=this.$textarea.get(0).selectionEnd,a=this.$textarea.hide().val();if(b>c&&c>0){var e=c,f=b;b=e,c=f}if(b=this.code.enlargeOffset(a,b),c=this.code.enlargeOffset(a,c),a=a.substr(0,b)+this.selection.getMarkerAsHtml(1)+a.substr(b),c>b){var g=this.selection.getMarkerAsHtml(1).toString().length;a=a.substr(0,c+g)+this.selection.getMarkerAsHtml(2)+a.substr(c+g)}this.modified!==this.clean.removeSpaces(a)&&this.code.set(a),this.opts.codemirror&&this.$textarea.next(".CodeMirror").hide(),this.$editor.show(),this.utils.isEmpty(a)||this.placeholder.remove(),this.selection.restore(),this.$textarea.off("keydown.redactor-textarea-indenting"),this.button.setActiveInVisual(),this.button.setInactive("html"),this.observe.load(),this.opts.visual=!0,this.core.setCallback("visual",a)}},textareaIndenting:function(a){if(9!==a.keyCode)return!0;var b=this.$textarea,c=b.get(0).selectionStart;return b.val(b.val().substring(0,c)+"	"+b.val().substring(b.get(0).selectionEnd)),b.get(0).selectionStart=b.get(0).selectionEnd=c+1,!1},enlargeOffset:function(a,b){var c=a.length,d=0;if(">"==a[b])d++;else for(var e=b;c>=e&&(d++,">"!=a[e]);e++)if("<"==a[e]||e==c){d=0;break}return b+d}}},core:function(){return{getObject:function(){return a.extend({},this)},getEditor:function(){return this.$editor},getBox:function(){return this.$box},getElement:function(){return this.$element},getTextarea:function(){return this.$textarea},getToolbar:function(){return this.$toolbar?this.$toolbar:!1},addEvent:function(a){this.core.event=a},getEvent:function(){return this.core.event},setCallback:function(b,c,d){var e=b+"Callback",f="redactor",g=this.opts[e];if(this.$textarea){var h=!1,i=a._data(this.$textarea[0],"events");if("undefined"!=typeof i&&"undefined"!=typeof i[e]&&a.each(i[e],a.proxy(function(a,b){if(b.namespace==f){var d="undefined"==typeof d?[c]:[c,d];h="undefined"==typeof d?b.handler.call(this,c):b.handler.call(this,c,d)}},this)),h)return h}return a.isFunction(g)?"undefined"==typeof d?g.call(this,c):g.call(this,c,d):"undefined"==typeof d?c:d},destroy:function(){this.opts.destroyed=!0,this.core.setCallback("destroy"),this.$element.off(".redactor").removeData("redactor"),this.$editor.off(".redactor"),a(document).off("mousedown.redactor."+this.uuid),a(document).off("click.redactor-image-delete."+this.uuid),a(document).off("click.redactor-image-resize-hide."+this.uuid),a(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid),a("body").off("scroll.redactor."+this.uuid),a(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid),this.$editor.removeClass("redactor-editor redactor-linebreaks redactor-placeholder"),this.$editor.removeAttr("contenteditable");var b=this.code.get();this.opts.toolbar&&this.$toolbar.find("a").each(function(){var b=a(this);b.data("dropdown")&&(b.data("dropdown").remove(),b.data("dropdown",{}))}),this.build.isTextarea()?(this.$box.after(this.$element),this.$box.remove(),this.$element.val(b).show()):(this.$box.after(this.$editor),this.$box.remove(),this.$element.html(b).show()),this.$pasteBox&&this.$pasteBox.remove(),this.$modalBox&&this.$modalBox.remove(),this.$modalOverlay&&this.$modalOverlay.remove(),a(".redactor-toolbar-tooltip-"+this.uuid).remove(),clearInterval(this.autosaveInterval)}}},dropdown:function(){return{build:function(b,c,d){"formatting"==b&&this.opts.formattingAdd&&a.each(this.opts.formattingAdd,a.proxy(function(a,b){var c,e=b.tag;"undefined"!=typeof b["class"]&&(e=e+"-"+b["class"]),b.type=this.utils.isBlockTag(b.tag)?"block":"inline",c="undefined"!=typeof b.func?b.func:"inline"==b.type?"inline.formatting":"block.formatting",this.opts.linebreaks&&"block"==b.type&&"p"==b.tag||(this.formatting[e]={tag:b.tag,style:b.style,"class":b["class"],attr:b.attr,data:b.data,clear:b.clear},d[e]={func:c,title:b.title})},this)),a.each(d,a.proxy(function(d,e){var f="";e.className&&(f=e.className);var g=a('<li><a href="#" class="'+f+" redactor-dropdown-"+d+'">'+e.title+"</a></li>");"formatting"==b&&g.addClass("redactor-formatting-"+d),g.on("click",a.proxy(function(b){b.preventDefault();var c="func",f=e.func;e.command?(c="command",f=e.command):e.dropdown&&(c="dropdown",f=e.dropdown),a(b.target).hasClass("redactor-dropdown-link-inactive")||(this.button.onClick(b,d,c,f),this.dropdown.hideAll())},this)),this.observe.addDropdown(g,d,e),c.append(g)},this))},show:function(b,c){if(!this.opts.visual)return b.preventDefault(),!1;var d=this.button.get(c);0==a("#redactor-dropdown-holder").length&&a(document.body).append('<div id="redactor-dropdown-holder" class="ccm-ui" />');var e=a("#redactor-dropdown-holder"),f=d.data("dropdown").appendTo(e);if(this.opts.highContrast&&f.addClass("redactor-dropdown-contrast"),d.hasClass("dropact"))this.dropdown.hideAll();else{this.dropdown.hideAll(),this.observe.dropdowns(),this.core.setCallback("dropdownShow",{dropdown:f,key:c,button:d}),this.button.setActive(c),d.addClass("dropact");var g=d.offset(),h=f.width();g.left+h>a(document).width()&&(g.left=Math.max(0,g.left-h));var i=g.left+"px";if(this.$toolbar.hasClass("toolbar-fixed-box")){var j=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset,k="fixed";this.opts.toolbarFixedTarget!==document&&(j=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,k="absolute"),f.css({position:k,left:i,top:j+"px"}).show()}else{var j=d.innerHeight()+g.top+"px";f.css({position:"absolute",left:i,top:j}).show()}this.core.setCallback("dropdownShown",{dropdown:f,key:c,button:d}),this.$dropdown=f}a(document).one("click.redactor-dropdown",a.proxy(this.dropdown.hide,this)),this.$editor.one("click.redactor-dropdown",a.proxy(this.dropdown.hide,this)),a(document).one("keyup.redactor-dropdown",a.proxy(this.dropdown.closeHandler,this)),f.on("mouseover.redactor-dropdown",a.proxy(this.utils.disableBodyScroll,this)).on("mouseout.redactor-dropdown",a.proxy(this.utils.enableBodyScroll,this)),b.stopPropagation()},closeHandler:function(a){a.which==this.keyCode.ESC&&(this.dropdown.hideAll(),this.$editor.focus())},hideAll:function(){this.$toolbar.find("a.dropact").removeClass("redactor-act").removeClass("dropact"),this.utils.enableBodyScroll(),a(".redactor-dropdown-"+this.uuid).hide(),a(".redactor-dropdown-link-selected").removeClass("redactor-dropdown-link-selected"),this.$dropdown&&(this.$dropdown.off(".redactor-dropdown"),this.core.setCallback("dropdownHide",this.$dropdown),this.$dropdown=!1)},hide:function(b){var c=a(b.target);c.hasClass("dropact")||c.hasClass("redactor-dropdown-link-inactive")||(c.removeClass("dropact"),c.off("mouseover mouseout"),this.dropdown.hideAll())}}},file:function(){return{show:function(){this.modal.load("file",this.lang.get("file"),700),this.modal.createCancelButton(),this.file.buttonSave=this.modal.createActionButton(this.lang.get("save")),this.opts.concrete5.filemanager?a("a[data-action=choose-image-from-file-manager]").on("click",function(b){b.preventDefault(),ConcreteFileManager.launchDialog(function(b){jQuery.fn.dialog.showLoader(),ConcreteFileManager.getFileDetails(b.fID,function(b){jQuery.fn.dialog.hideLoader();var c=b.files[0];a("#redactor-file-link").val(c.urlDownload)})})}):a("a[data-action=choose-image-from-file-manager]").remove(),this.file.buttonSave.on("click",a.proxy(function(){var b=a("#redactor-file-link").val();if(""!==b){var c=a("#redactor-filename").val(),d='<a href="'+b+'" id="filelink-marker">'+c+"</a>";this.file.insert(d,!1)}else this.modal.close()},this)),this.selection.save(),this.selection.get();var b=this.sel.toString();a("#redactor-filename").val(b),this.modal.show()},insert:function(b,c,d){if("undefined"!=typeof b.error)return this.modal.close(),this.selection.restore(),void this.core.setCallback("fileUploadError",b);var e;if("string"==typeof b)e=b;else{var f=a("#redactor-filename").val();("undefined"==typeof f||""===f)&&(f=b.filename),e='<a href="'+b.filelink+'" id="filelink-marker">'+f+"</a>"}if(c){this.selection.removeMarkers();var g=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(d,g)}else this.modal.close();if(this.selection.restore(),this.buffer.set(),this.insert.htmlWithoutClean(e),"string"!=typeof b){var h=a(this.$editor.find("a#filelink-marker"));0!==h.length?h.removeAttr("id").removeAttr("style"):h=!1,this.core.setCallback("fileUpload",h,b)}}}},focus:function(){return{setStart:function(){this.$editor.focus();var a=this.$editor.children().first();if(0!==a.length&&0!==a[0].length&&"BR"!=a[0].tagName&&3!=a[0].nodeType){if("UL"==a[0].tagName||"OL"==a[0].tagName){var b=a.find("li").first();if(!this.utils.isBlock(b)&&""===b.text())return void this.caret.setStart(b)}return this.opts.linebreaks&&!this.utils.isBlockTag(a[0].tagName)?(this.selection.get(),this.range.setStart(this.$editor[0],0),this.range.setEnd(this.$editor[0],0),void this.selection.addRange()):void this.caret.setStart(a)}},setEnd:function(){var a=this.$editor.children().last();this.$editor.focus(),0!==a.size()&&(this.utils.isEmpty(this.$editor.html())?(this.selection.get(),this.range.collapse(!0),this.range.setStartAfter(a[0]),this.range.setEnd(a[0],0),this.selection.addRange()):(this.selection.get(),this.range.selectNodeContents(a[0]),this.range.collapse(!1),this.selection.addRange()))},isFocused:function(){var b=document.getSelection().focusNode;return null===b?!1:this.opts.linebreaks&&a(b.parentNode).hasClass("redactor-linebreaks")?!0:this.utils.isRedactorParent(b.parentNode)?this.$editor.is(":focus"):!1}}},image:function(){return{show:function(){this.modal.load("image",this.lang.get("image"),700),this.modal.createCancelButton(),this.image.buttonSave=this.modal.createActionButton(this.lang.get("save")),this.opts.concrete5.filemanager?a("a[data-action=choose-image-from-file-manager]").on("click",function(b){b.preventDefault(),ConcreteFileManager.launchDialog(function(b){jQuery.fn.dialog.showLoader(),ConcreteFileManager.getFileDetails(b.fID,function(b){jQuery.fn.dialog.hideLoader();var c=b.files[0];a("#redactor-image-link").val(c.urlInline)})})}):a("a[data-action=choose-image-from-file-manager]").remove(),this.image.buttonSave.on("click",a.proxy(function(){var b=a("#redactor-image-link").val();if(""!==b){var c='<img id="image-marker" src="'+b+'" />';this.opts.linebreaks===!1&&(c="<p>"+c+"</p>"),this.image.insert(c,!1)}else this.modal.close()},this)),this.selection.save(),this.modal.show()},showEdit:function(b){var c=b.closest("a",this.$editor[0]);this.modal.load("imageEdit",this.lang.get("edit"),705),this.image.linkLightboxType="image",this.image.linkLightboxIframeWidth="600",this.image.linkLightboxIframeHeight="400";var d=c.attr("data-concrete5-link-lightbox");"_blank"==c.attr("target")?this.image.linkType="blank":"image"==d||"iframe"==d?(this.image.linkType="lightbox",this.image.linkLightboxType=d,this.image.linkLightboxIframeWidth=c.attr("data-concrete5-link-lightbox-width"),this.image.linkLightboxIframeHeight=c.attr("data-concrete5-link-lightbox-height")):this.image.linkType="same",this.image.$selectUrlOpen=a("#redactor-link-url-open"),this.opts.concrete5.lightbox||this.image.$selectUrlOpen.find("option[value=lightbox]").remove(),this.image.$selectUrlLightboxFieldGroup=a("div[data-field-group=lightbox]"),this.image.$selectUrlLightboxIframeFieldGroup=a("div[data-field-group=lightbox-iframe]"),this.image.$selectUrlLightboxFieldGroupSelect=a("div[data-field-group=lightbox] select"),this.image.$selectUrlLightboxIframeWidth=a("#redactor-link-lightbox-iframe-width"),this.image.$selectUrlLightboxIframeHeight=a("#redactor-link-lightbox-iframe-height"),this.image.$selectUrlOpen.val(this.image.linkType),this.image.$selectUrlLightboxIframeWidth.val(this.image.linkLightboxIframeWidth),this.image.$selectUrlLightboxIframeHeight.val(this.image.linkLightboxIframeHeight);var e=this.image;if(this.image.$selectUrlOpen.on("change",function(){"lightbox"==a(this).val()?e.$selectUrlLightboxFieldGroup.show():(e.$selectUrlLightboxFieldGroup.hide(),e.$selectUrlLightboxFieldGroupSelect.val("image").trigger("change"))}).trigger("change"),this.image.$selectUrlLightboxFieldGroupSelect.val(this.image.linkLightboxType),this.image.$selectUrlLightboxFieldGroupSelect.on("change",function(){"iframe"==a(this).val()?e.$selectUrlLightboxIframeFieldGroup.show():e.$selectUrlLightboxIframeFieldGroup.hide()}).trigger("change"),this.opts.concrete5.filemanager?a("a[data-action=choose-file-from-file-manager]").on("click",function(b){b.preventDefault(),ConcreteFileManager.launchDialog(function(b){jQuery.fn.dialog.showLoader(),ConcreteFileManager.getFileDetails(b.fID,function(b){jQuery.fn.dialog.hideLoader();var c=b.files[0];a("#redactor-image-link").val(c.urlInline);
})})}):a("a[data-action=choose-file-from-file-manager]").remove(),this.opts.concrete5.sitemap?a("a[data-action=choose-link-from-sitemap]").on("click",function(b){b.preventDefault(),jQuery.fn.dialog.open({width:"90%",height:"70%",modal:!1,title:ccmi18n_sitemap.choosePage,href:CCM_TOOLS_PATH+"/sitemap_search_selector"}),ConcreteEvent.unsubscribe("SitemapSelectPage"),ConcreteEvent.subscribe("SitemapSelectPage",function(b,c){jQuery.fn.dialog.closeTop();var d=CCM_APPLICATION_URL+"/index.php?cID="+c.cID;a("#redactor-image-link").val(d),this.link.$inputUrl.val(d),this.link.$inputText.val(d)})}):a("a[data-action=choose-link-from-sitemap]").remove(),this.opts.concrete5.sitemap||this.opts.concrete5.filemanager||a("#redactor-image-link").parent().removeClass(),this.modal.createCancelButton(),this.image.buttonDelete=this.modal.createDeleteButton(this.lang.get("_delete")),this.image.buttonSave=this.modal.createActionButton(this.lang.get("save")),this.image.buttonDelete.on("click",a.proxy(function(){this.image.remove(b)},this)),this.image.buttonSave.on("click",a.proxy(function(){this.image.update(b)},this)),a(".redactor-link-tooltip").remove(),a("#redactor-image-title").val(b.attr("alt")),this.opts.imageLink){var f=a("#redactor-image-link");f.attr("href",b.attr("src")),0!==c.length&&(f.val(c.attr("href")),"_blank"==c.attr("target")&&a("#redactor-image-link-blank").prop("checked",!0))}else a(".redactor-image-link-option").hide();if(this.opts.imagePosition){var g="block"==b.css("display")&&"none"==b.css("float")?"center":b.css("float");a("#redactor-image-align").val(g)}else a(".redactor-image-position-option").hide();this.modal.show(),a("#redactor-image-title").focus()},setFloating:function(b){var c=a("#redactor-image-align").val(),d="",e="",f="";switch(c){case"left":d="left",f="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":d="right",f="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":e="block",f="auto"}b.css({"float":d,display:e,margin:f}),b.attr("rel",b.attr("style"))},update:function(b){this.image.hideResize(),this.buffer.set();var c=b.closest("a",this.$editor[0]),d=a("#redactor-image-title").val().replace(/(<([^>]+)>)/gi,"");b.attr("alt",d),this.image.setFloating(b);var e=a.trim(a("#redactor-image-link").val()),e=e.replace(/(<([^>]+)>)/gi,"");if(""!==e){var f="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",g=new RegExp("^(http|ftp|https)://"+f,"i"),h=new RegExp("^"+f,"i");-1==e.search(g)&&0===e.search(h)&&this.opts.linkProtocol&&(e=this.opts.linkProtocol+"://"+e);var i,j,k,l=!1;if("blank"==a("#redactor-link-url-open").val()&&(l=!0),"lightbox"==a("#redactor-link-url-open").val()&&(i=a("#redactor-link-lightbox-type").val(),"iframe"==i&&(j=a("#redactor-link-lightbox-iframe-width").val(),k=a("#redactor-link-lightbox-iframe-height").val())),0===c.length){var m=a('<a href="'+e+'">'+this.utils.getOuterHtml(b)+"</a>");l&&m.attr("target","_blank"),i&&(m.attr("data-concrete5-link-lightbox",i),"iframe"==i&&j&&k&&(m.attr("data-concrete5-link-lightbox-width",j),m.attr("data-concrete5-link-lightbox-height",k))),b.replaceWith(m)}else c.removeAttr("data-concrete5-link-lightbox"),c.removeAttr("data-concrete5-link-lightbox-width"),c.removeAttr("data-concrete5-link-lightbox-height"),c.attr("href",e),l?c.attr("target","_blank"):c.removeAttr("target"),i&&(c.attr("data-concrete5-link-lightbox",i),"iframe"==i&&j&&k&&(c.attr("data-concrete5-link-lightbox-width",j),c.attr("data-concrete5-link-lightbox-height",k)))}else 0!==c.length&&c.replaceWith(this.utils.getOuterHtml(b));this.modal.close(),this.observe.images(),this.code.sync()},setEditable:function(b){this.opts.imageEditable&&b.on("dragstart",a.proxy(this.image.onDrag,this));var c=a.proxy(function(c){this.observe.image=b,this.image.resizer=this.image.loadEditableControls(b),a(document).on("mousedown.redactor-image-resize-hide."+this.uuid,a.proxy(this.image.hideResize,this)),this.opts.imageResizable&&this.image.resizer.on("mousedown.redactor touchstart.redactor",a.proxy(function(a){this.image.setResizable(a,b)},this))},this);b.off("mousedown.redactor").on("mousedown.redactor",a.proxy(this.image.hideResize,this)),b.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",c)},setResizable:function(a,b){a.preventDefault(),this.image.resizeHandle={x:a.pageX,y:a.pageY,el:b,ratio:b.width()/b.height(),h:b.height()},a=a.originalEvent||a,a.targetTouches&&(this.image.resizeHandle.x=a.targetTouches[0].pageX,this.image.resizeHandle.y=a.targetTouches[0].pageY),this.image.startResize()},startResize:function(){a(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",a.proxy(this.image.moveResize,this)),a(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",a.proxy(this.image.stopResize,this))},moveResize:function(a){a.preventDefault(),a=a.originalEvent||a;var b=this.image.resizeHandle.h;b+=a.targetTouches?a.targetTouches[0].pageY-this.image.resizeHandle.y:a.pageY-this.image.resizeHandle.y;var c=Math.round(b*this.image.resizeHandle.ratio);if(!(50>b||100>c)){var b=Math.round(this.image.resizeHandle.el.width()/this.image.resizeHandle.ratio);this.image.resizeHandle.el.attr({width:c,height:b}),this.image.resizeHandle.el.width(c),this.image.resizeHandle.el.height(b),this.code.sync()}},stopResize:function(){this.handle=!1,a(document).off(".redactor-image-resize"),this.image.hideResize()},onDrag:function(b){return 0!==this.$editor.find("#redactor-image-box").length?(b.preventDefault(),!1):void this.$editor.on("drop.redactor-image-inside-drop",a.proxy(function(){setTimeout(a.proxy(this.image.onDrop,this),1)},this))},onDrop:function(){this.image.fixImageSourceAfterDrop(),this.observe.images(),this.$editor.off("drop.redactor-image-inside-drop"),this.clean.clearUnverified(),this.code.sync()},fixImageSourceAfterDrop:function(){this.$editor.find("img[data-save-url]").each(function(){var b=a(this);b.attr("src",b.attr("data-save-url")),b.removeAttr("data-save-url")})},hideResize:function(b){if(!b||0===a(b.target).closest("#redactor-image-box",this.$editor[0]).length){if(b&&"IMG"==b.target.tagName){var c=a(b.target);c.attr("data-save-url",c.attr("src"))}var d=this.$editor.find("#redactor-image-box");0!==d.length&&(a("#redactor-image-editter").remove(),a("#redactor-image-resizer").remove(),d.find("img").css({marginTop:d[0].style.marginTop,marginBottom:d[0].style.marginBottom,marginLeft:d[0].style.marginLeft,marginRight:d[0].style.marginRight}),d.css("margin",""),d.find("img").css("opacity",""),d.replaceWith(function(){return a(this).contents()}),a(document).off("mousedown.redactor-image-resize-hide."+this.uuid),"undefined"!=typeof this.image.resizeHandle&&this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style")),this.code.sync())}},loadResizableControls:function(b,c){if(this.opts.imageResizable&&!this.utils.isMobile()){var d=a('<span id="redactor-image-resizer" data-redactor="verified"></span>');return this.utils.isDesktop()||d.css({width:"15px",height:"15px"}),d.attr("contenteditable",!1),c.append(d),c.append(b),d}return c.append(b),!1},loadEditableControls:function(b){var c=a('<span id="redactor-image-box" data-redactor="verified">');if(c.css("float",b.css("float")).attr("contenteditable",!1),"auto"!=b[0].style.margin?(c.css({marginTop:b[0].style.marginTop,marginBottom:b[0].style.marginBottom,marginLeft:b[0].style.marginLeft,marginRight:b[0].style.marginRight}),b.css("margin","")):c.css({display:"block",margin:"auto"}),b.css("opacity",".5").after(c),this.opts.imageEditable){this.image.editter=a('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>"),this.image.editter.attr("contenteditable",!1),this.image.editter.on("click",a.proxy(function(){this.image.showEdit(b)},this)),c.append(this.image.editter);var d=this.image.editter.innerWidth();this.image.editter.css("margin-left","-"+d/2+"px")}return this.image.loadResizableControls(b,c)},remove:function(b){var c=a(b),d=c.closest("a",this.$editor[0]),e=c.closest("figure",this.$editor[0]),f=c.parent();0!==a("#redactor-image-box").length&&(f=a("#redactor-image-box").parent());var g;0!==e.length?(g=e.next(),e.remove()):0!==d.length?(f=d.parent(),d.remove()):c.remove(),a("#redactor-image-box").remove(),0!==e.length?this.caret.setStart(g):this.caret.setStart(f),this.core.setCallback("imageDelete",c[0].src,c),this.modal.close(),this.code.sync()},insert:function(b,c,d){if("undefined"!=typeof b.error)return this.modal.close(),this.selection.restore(),void this.core.setCallback("imageUploadError",b);var e;"string"==typeof b?e=a(b).attr("data-redactor-inserted-image","true"):(e=a("<img>"),e.attr("src",b.filelink).attr("data-redactor-inserted-image","true"));var f=e,g=this.utils.isCurrentOrParent("P");if(g&&(f=a("<blockquote />").append(e)),c){this.selection.removeMarkers();var h=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(d,h)}else this.modal.close();this.selection.restore(),this.buffer.set(),this.insert.html(this.utils.getOuterHtml(f),!1);var i=this.$editor.find("img[data-redactor-inserted-image=true]").removeAttr("data-redactor-inserted-image");g?i.parent().contents().unwrap().wrap("<p />"):this.opts.linebreaks&&(this.utils.isEmpty(this.code.get())||i.before("<br>"),i.after("<br>")),"string"!=typeof b&&this.core.setCallback("imageUpload",i,b)}}},indent:function(){return{increase:function(){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var a=this.selection.getBlock();a&&"LI"==a.tagName?this.indent.increaseLists():a===!1&&this.opts.linebreaks?this.indent.increaseText():this.indent.increaseBlocks(),this.selection.restore(),this.code.sync()},increaseLists:function(){document.execCommand("indent"),this.indent.fixEmptyIndent(),this.clean.normalizeLists(),this.clean.clearUnverified()},increaseBlocks:function(){a.each(this.selection.getBlocks(),a.proxy(function(a,b){if("TD"!==b.tagName&&"TH"!==b.tagName){var c=this.utils.getAlignmentElement(b),d=this.utils.normalize(c.css("margin-left"))+this.opts.indentValue;c.css("margin-left",d+"px")}},this))},increaseText:function(){var b=this.selection.wrap("div");a(b).attr("data-tagblock","redactor"),a(b).css("margin-left",this.opts.indentValue+"px")},decrease:function(){this.buffer.set(),this.selection.save();var a=this.selection.getBlock();a&&"LI"==a.tagName?this.indent.decreaseLists():this.indent.decreaseBlocks(),this.selection.restore(),this.code.sync()},decreaseLists:function(){document.execCommand("outdent");var b=this.selection.getCurrent(),c=a(b).closest("li",this.$editor[0]);this.indent.fixEmptyIndent(),this.opts.linebreaks||0!==c.length||(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote, p").each(a.proxy(this.utils.removeEmpty,this))),this.clean.clearUnverified()},decreaseBlocks:function(){a.each(this.selection.getBlocks(),a.proxy(function(a,b){var c=this.utils.getAlignmentElement(b),d=this.utils.normalize(c.css("margin-left"))-this.opts.indentValue;0>=d?this.opts.linebreaks&&"undefined"!=typeof c.data("tagblock")?c.replaceWith(c.html()+"<br />"):(c.css("margin-left",""),this.utils.removeEmptyAttr(c,"style")):c.css("margin-left",d+"px")},this))},fixEmptyIndent:function(){var b=this.selection.getBlock();if(this.range.collapsed&&b&&"LI"==b.tagName&&this.utils.isEmpty(a(b).text())){var c=a(b);c.find("span").not(".redactor-selection-marker").contents().unwrap(),c.append("<br>")}}}},inline:function(){return{formatting:function(a){var b,c;"undefined"!=typeof this.formatting[a].style?b="style":"undefined"!=typeof this.formatting[a]["class"]&&(b="class"),b&&(c=this.formatting[a][b]),this.inline.format(this.formatting[a].tag,b,c)},format:function(b,c,d){var e=this.selection.getCurrent();if(!(e&&"TR"===e.tagName||(this.blurClickedElement=!0,this.utils.isCurrentOrParent("PRE")||this.utils.isCurrentOrParentHeader()))){for(var f=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],g=["strong","strong","em","em","u","del","del","sup","sub"],h=0;h<f.length;h++)b==f[h]&&(b=g[h]);if(this.opts.allowedTags){if(-1==a.inArray(b,this.opts.allowedTags))return}else if(-1!==a.inArray(b,this.opts.deniedTags))return;this.inline.type=c||!1,this.inline.value=d||!1,this.buffer.set(),this.utils.browser("msie")||this.$editor.focus(),this.selection.get(),this.range.collapsed?this.inline.formatCollapsed(b):this.inline.formatMultiple(b)}},formatCollapsed:function(b){var c=this.selection.getCurrent(),d=a(c).closest(b+"[data-redactor-tag="+b+"]",this.$editor[0]);if(0!==d.length&&"style"!=this.inline.type&&"SPAN"!=d[0].tagName)return void(this.utils.isEmpty(d.text())?(this.caret.setAfter(d[0]),d.remove(),this.code.sync()):this.utils.isEndOfElement(d)&&this.caret.setAfter(d[0]));var e=a("<"+b+">").attr("data-verified","redactor").attr("data-redactor-tag",b);e.html(this.opts.invisibleSpace),e=this.inline.setFormat(e);var e=this.insert.node(e);this.caret.setEnd(e),this.code.sync()},formatMultiple:function(b){if(this.inline.formatConvert(b),this.selection.save(),document.execCommand("strikethrough"),this.$editor.find("strike").each(a.proxy(function(c,d){var e=a(d);this.inline.formatRemoveSameChildren(e,b);var f;this.inline.type?(f=a("<span>").attr("data-redactor-tag",b).attr("data-verified","redactor"),f=this.inline.setFormat(f)):f=a("<"+b+">").attr("data-redactor-tag",b).attr("data-verified","redactor"),e.replaceWith(f.html(e.contents()));var g=f.parent();if(g&&"U"===g[0].tagName&&f.parent().replaceWith(f),"span"==b&&g&&"SPAN"===g[0].tagName&&"style"===this.inline.type)for(var h=this.inline.value.split(";"),i=0;i<h.length;i++){if(""===h[i])return;var j=h[i].split(":");g.css(j[0],""),this.utils.removeEmptyAttr(g,"style")&&g.replaceWith(g.contents())}},this)),"span"!=b&&this.$editor.find(this.opts.inlineTags.join(", ")).each(a.proxy(function(b,c){var d=a(c);if("U"===c.tagName&&0===c.attributes.length)return void d.replaceWith(d.contents());var e=d.css("text-decoration");"line-through"===e&&(d.css("text-decoration",""),this.utils.removeEmptyAttr(d,"style"))},this)),"del"!=b){var c=this;this.$editor.find("inline").each(function(a,b){c.utils.replaceToTag(b,"del")})}this.selection.restore(),this.code.sync()},formatRemoveSameChildren:function(b,c){var d=this;b.children(c).each(function(){var b=a(this);if(!b.hasClass("redactor-selection-marker"))if("style"==d.inline.type)for(var c=d.inline.value.split(";"),e=0;e<c.length;e++){if(""===c[e])return;var f=c[e].split(":");b.css(f[0],""),d.utils.removeEmptyAttr(b,"style")&&b.replaceWith(b.contents())}else b.contents().unwrap()})},formatConvert:function(b){this.selection.save();var c="";"class"==this.inline.type?c='[data-redactor-class="'+this.inline.value+'"]':"style"==this.inline.type&&(c='[data-redactor-style="'+this.inline.value+'"]');var d=this;"del"!=b&&this.$editor.find("del").each(function(a,b){d.utils.replaceToTag(b,"inline")}),"span"!=b&&this.$editor.find(b).each(function(){var b=a(this);b.replaceWith(a("<strike />").html(b.contents()))}),this.$editor.find('[data-redactor-tag="'+b+'"]'+c).each(function(){if(""!==c||"span"!=b||this.tagName.toLowerCase()!=b){var d=a(this);d.replaceWith(a("<strike />").html(d.contents()))}}),this.selection.restore()},setFormat:function(a){switch(this.inline.type){case"class":a.hasClass(this.inline.value)?(a.removeClass(this.inline.value),a.removeAttr("data-redactor-class")):(a.addClass(this.inline.value),a.attr("data-redactor-class",this.inline.value));break;case"style":a[0].style.cssText=this.inline.value,a.attr("data-redactor-style",this.inline.value)}return a},removeStyle:function(){this.buffer.set();var b=this.selection.getCurrent(),c=this.selection.getInlines();if(this.selection.save(),b&&"SPAN"===b.tagName){var d=a(b);d.removeAttr("style"),0===d[0].attributes.length&&d.replaceWith(d.contents())}a.each(c,a.proxy(function(b,c){var d=a(c);-1==a.inArray(c.tagName.toLowerCase(),this.opts.inlineTags)||d.hasClass("redactor-selection-marker")||(d.removeAttr("style"),0===d[0].attributes.length&&d.replaceWith(d.contents()))},this)),this.selection.restore(),this.code.sync()},removeStyleRule:function(b){this.buffer.set();var c=this.selection.getParent(),d=this.selection.getInlines();if(this.selection.save(),c&&"SPAN"===c.tagName){var e=a(c);e.css(b,""),this.utils.removeEmptyAttr(e,"style"),0===e[0].attributes.length&&e.replaceWith(e.contents())}a.each(d,a.proxy(function(c,d){var e=a(d);-1==a.inArray(d.tagName.toLowerCase(),this.opts.inlineTags)||e.hasClass("redactor-selection-marker")||(e.css(b,""),this.utils.removeEmptyAttr(e,"style"),0===e[0].attributes.length&&e.replaceWith(e.contents()))},this)),this.selection.restore(),this.code.sync()},removeFormat:function(){this.buffer.set();var b=this.selection.getCurrent();this.selection.save(),document.execCommand("removeFormat"),b&&"SPAN"===b.tagName&&a(b).replaceWith(a(b).contents()),a.each(this.selection.getNodes(),a.proxy(function(b,c){var d=a(c);-1==a.inArray(c.tagName.toLowerCase(),this.opts.inlineTags)||d.hasClass("redactor-selection-marker")||d.replaceWith(d.contents())},this)),this.selection.restore(),this.code.sync()},toggleClass:function(a){this.inline.format("span","class",a)},toggleStyle:function(a){this.inline.format("span","style",a)}}},insert:function(){return{set:function(b,c){this.placeholder.remove(),b=this.clean.setVerified(b),"undefined"==typeof c&&(b=this.clean.onPaste(b,!1)),this.$editor.html(b),this.selection.remove(),this.focus.setEnd(),this.clean.normalizeLists(),this.code.sync(),this.observe.load(),"undefined"==typeof c&&setTimeout(a.proxy(this.clean.clearUnverified,this),10)},text:function(b){if(this.placeholder.remove(),b=b.toString(),b=a.trim(b),b=this.clean.getPlainText(b,!1),this.$editor.focus(),this.utils.browser("msie"))this.insert.htmlIe(b);else{this.selection.get(),this.range.deleteContents();var c=document.createElement("div");c.innerHTML=b;for(var d,e,f=document.createDocumentFragment();d=c.firstChild;)e=f.appendChild(d);if(this.range.insertNode(f),e){var g=this.range.cloneRange();g.setStartAfter(e),g.collapse(!0),this.sel.removeAllRanges(),this.sel.addRange(g)}}this.code.sync(),this.clean.clearUnverified()},htmlWithoutClean:function(a){this.insert.html(a,!1)},html:function(b,c){this.placeholder.remove(),"undefined"==typeof c&&(c=!0),this.$editor.focus(),b=this.clean.setVerified(b),c&&(b=this.clean.onPaste(b)),this.utils.browser("msie")?this.insert.htmlIe(b):(this.clean.singleLine?this.insert.execHtml(b):document.execCommand("insertHTML",!1,b),this.insert.htmlFixMozilla()),this.clean.normalizeLists(),this.opts.linebreaks||this.$editor.find("p").each(a.proxy(this.utils.removeEmpty,this)),this.code.sync(),this.observe.load(),c&&this.clean.clearUnverified()},htmlFixMozilla:function(){if(this.utils.browser("mozilla")){var b=a(this.selection.getBlock()).next();b.length>0&&"P"==b[0].tagName&&""===b.html()&&b.remove()}},htmlIe:function(b){if(this.utils.isIe11()){var c=this.utils.isCurrentOrParent("P"),d=a("<div>").append(b),e=d.contents().is("p, :header, dl, ul, ol, div, table, td, blockquote, pre, address, section, header, footer, aside, article");return void(c&&e?this.insert.ie11FixInserting(c,b):this.insert.ie11PasteFrag(b))}document.selection.createRange().pasteHTML(b)},execHtml:function(a){a=this.clean.setVerified(a),this.selection.get(),this.range.deleteContents();var b=document.createElement("div");b.innerHTML=a;for(var c,d,e=document.createDocumentFragment();c=b.firstChild;)d=e.appendChild(c);this.range.insertNode(e),this.range.collapse(!0),this.caret.setAfter(d)},node:function(b,c){b=b[0]||b;var d=this.utils.getOuterHtml(b);return d=this.clean.setVerified(d),null!==d.match(/</g)&&(b=a(d)[0]),this.selection.get(),c!==!1&&this.range.deleteContents(),this.range.insertNode(b),this.range.collapse(!1),this.selection.addRange(),b},nodeToPoint:function(a,b,c){a=a[0]||a,this.selection.get();var d;if(document.caretPositionFromPoint){var e=document.caretPositionFromPoint(b,c);this.range.setStart(e.offsetNode,e.offset),this.range.collapse(!0),this.range.insertNode(a)}else if(document.caretRangeFromPoint)d=document.caretRangeFromPoint(b,c),d.insertNode(a);else if("undefined"!=typeof document.body.createTextRange){d=document.body.createTextRange(),d.moveToPoint(b,c);var f=d.duplicate();f.moveToPoint(b,c),d.setEndPoint("EndToEnd",f),d.select()}},nodeToCaretPositionFromPoint:function(a,b){b=b[0]||b;var c,d=a.clientX,e=a.clientY;if(document.caretPositionFromPoint){var f=document.caretPositionFromPoint(d,e),g=document.getSelection();c=g.getRangeAt(0),c.setStart(f.offsetNode,f.offset),c.collapse(!0),c.insertNode(b)}else if(document.caretRangeFromPoint)c=document.caretRangeFromPoint(d,e),c.insertNode(b);else if("undefined"!=typeof document.body.createTextRange){c=document.body.createTextRange(),c.moveToPoint(d,e);var h=c.duplicate();h.moveToPoint(d,e),c.setEndPoint("EndToEnd",h),c.select()}},ie11FixInserting:function(b,c){var d=document.createElement("span");d.className="redactor-ie-paste",this.insert.node(d);var e=a(b).html();e="<p>"+e.replace(/<span class="redactor-ie-paste"><\/span>/gi,"</p>"+c+"<p>")+"</p>",e=e.replace(/<p><\/p>/gi,""),a(b).replaceWith(e)},ie11PasteFrag:function(a){this.selection.get(),this.range.deleteContents();var b=document.createElement("div");b.innerHTML=a;for(var c,d,e=document.createDocumentFragment();c=b.firstChild;)d=e.appendChild(c);this.range.insertNode(e),this.range.collapse(!1),this.selection.addRange()}}},keydown:function(){return{init:function(b){if(!this.rtePaste){var c=b.which,d=c>=37&&40>=c;this.keydown.ctrl=b.ctrlKey||b.metaKey,this.keydown.current=this.selection.getCurrent(),this.keydown.parent=this.selection.getParent(),this.keydown.block=this.selection.getBlock(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.shortcuts.init(b,c),this.utils.isDesktop()&&(this.keydown.checkEvents(d,c),this.keydown.setupBuffer(b,c)),this.keydown.addArrowsEvent(d),this.keydown.setupSelectAll(b,c);var e=this.core.setCallback("keydown",b);if(e===!1)return b.preventDefault(),!1;if(this.opts.enterKey&&(this.utils.browser("msie")||this.utils.browser("mozilla"))&&(c===this.keyCode.DOWN||c===this.keyCode.RIGHT)){var f=!1,g=!1;if(this.keydown.block&&"TD"===this.keydown.block.tagName&&(g=a(this.keydown.block).closest("table",this.$editor[0])),g&&g.find("td").last()[0]===this.keydown.block&&(f=!0),this.utils.isEndOfElement()&&f){var h=a(this.opts.emptyHtml);g.after(h),this.caret.setStart(h)}}if(this.opts.enterKey&&c===this.keyCode.DOWN&&this.keydown.onArrowDown(),!this.opts.enterKey&&c===this.keyCode.ENTER)return b.preventDefault(),void(this.range.collapsed||this.range.deleteContents());if(c==this.keyCode.ENTER&&!b.shiftKey&&!b.ctrlKey&&!b.metaKey){var i=this.core.setCallback("enter",b);if(i===!1)return b.preventDefault(),!1;if(this.keydown.blockquote&&this.keydown.exitFromBlockquote(b)===!0)return!1;var j,k;if(this.keydown.pre)return this.keydown.insertNewLine(b);if(this.keydown.blockquote||this.keydown.figcaption)return j=this.selection.getCurrent(),k=a(j).next(),0!==k.length&&"BR"==k[0].tagName?this.keydown.insertBreakLine(b):this.utils.isEndOfElement()&&j&&"SPAN"!=j?this.keydown.insertDblBreakLine(b):this.keydown.insertBreakLine(b);if(this.opts.linebreaks&&!this.keydown.block)return j=this.selection.getCurrent(),k=a(this.keydown.current).next(),0!==k.length&&"BR"==k[0].tagName?this.keydown.insertBreakLine(b):j!==!1&&a(j).hasClass("redactor-invisible-space")?(this.caret.setAfter(j),a(j).contents().unwrap(),this.keydown.insertDblBreakLine(b)):this.utils.isEndOfEditor()?this.keydown.insertDblBreakLine(b):0===k.length&&j===!1&&"undefined"!=typeof k.context?this.keydown.insertBreakLine(b):this.keydown.insertBreakLine(b);if(this.opts.linebreaks&&this.keydown.block)setTimeout(a.proxy(this.keydown.replaceDivToBreakLine,this),1);else if(!this.opts.linebreaks&&this.keydown.block){if(setTimeout(a.proxy(this.keydown.replaceDivToParagraph,this),1),"LI"===this.keydown.block.tagName){j=this.selection.getCurrent();var l=a(j).closest("li",this.$editor[0]),m=l.closest("ul,ol",this.$editor[0]);if(0!==l.length&&this.utils.isEmpty(l.html())&&0===m.next().length&&this.utils.isEmpty(m.find("li").last().html())){m.find("li").last().remove();var h=a(this.opts.emptyHtml);return m.after(h),this.caret.setStart(h),!1}}}else if(!this.opts.linebreaks&&!this.keydown.block)return this.keydown.insertParagraph(b)}if(c===this.keyCode.ENTER&&(b.ctrlKey||b.shiftKey))return this.keydown.onShiftEnter(b);if(c===this.keyCode.TAB||b.metaKey&&221===c||b.metaKey&&219===c)return this.keydown.onTab(b,c);if(c===this.keyCode.BACKSPACE||c===this.keyCode.DELETE){var n=this.selection.getNodes();if(n)for(var o,p=n.length,q=0;p>q;q++){var r=a(n[q]).children("img");if(0!==r.length){var s=this;a.each(r,function(b,c){var d=a(c);"none"==d.css("float")&&(s.core.setCallback("imageDelete",c.src,d),o=c)})}else"IMG"==n[q].tagName&&o!=n[q]&&(this.core.setCallback("imageDelete",n[q].src,a(n[q])),o=n[q])}}if(c===this.keyCode.BACKSPACE){var t=this.selection.getBlock(),u="0px"!==a(t).css("margin-left");if(t&&u&&this.range.collapsed&&this.utils.isStartOfElement())return this.indent.decrease(),void b.preventDefault();if(this.utils.browser("mozilla")){var v=this.selection.getPrev(),w=a(v).prev()[0];v&&"HR"===v.tagName&&a(v).remove(),w&&"HR"===w.tagName&&a(w).remove()}this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(b)}this.code.sync()}},checkEvents:function(a,b){a||"click"!=this.core.getEvent()&&"arrow"!=this.core.getEvent()||(this.core.addEvent(!1),this.keydown.checkKeyEvents(b)&&this.buffer.set())},checkKeyEvents:function(b){var c=this.keyCode,d=[c.BACKSPACE,c.DELETE,c.ENTER,c.SPACE,c.ESC,c.TAB,c.CTRL,c.META,c.ALT,c.SHIFT];return-1==a.inArray(b,d)?!0:!1},addArrowsEvent:function(a){return a?"click"==this.core.getEvent()||"arrow"==this.core.getEvent()?void this.core.addEvent(!1):void this.core.addEvent("arrow"):void 0},setupBuffer:function(a,b){return this.keydown.ctrl&&90===b&&!a.shiftKey&&!a.altKey&&this.opts.buffer.length?(a.preventDefault(),void this.buffer.undo()):this.keydown.ctrl&&90===b&&a.shiftKey&&!a.altKey&&0!==this.opts.rebuffer.length?(a.preventDefault(),void this.buffer.redo()):void(this.keydown.ctrl||(b==this.keyCode.BACKSPACE||b==this.keyCode.DELETE||b==this.keyCode.ENTER&&!a.ctrlKey&&!a.shiftKey||b==this.keyCode.SPACE)&&this.buffer.set())},setupSelectAll:function(a,b){this.keydown.ctrl&&65===b?this.utils.enableSelectAll():b==this.keyCode.LEFT_WIN||this.keydown.ctrl||this.utils.disableSelectAll()},onArrowDown:function(){for(var a=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],b=0;b<a.length;b++)if(a[b])return this.keydown.insertAfterLastElement(a[b]),!1},onShiftEnter:function(a){return this.buffer.set(),this.utils.isEndOfElement()?this.keydown.insertDblBreakLine(a):this.keydown.insertBreakLine(a)},onTab:function(a,b){if(!this.opts.tabKey)return!0;if(this.utils.isEmpty(this.code.get())&&this.opts.tabAsSpaces===!1)return!0;a.preventDefault();var c;return this.keydown.pre&&!a.shiftKey?(c=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join(" ")):document.createTextNode("	"),this.insert.node(c),this.code.sync()):this.opts.tabAsSpaces!==!1?(c=document.createTextNode(Array(this.opts.tabAsSpaces+1).join(" ")),this.insert.node(c),this.code.sync()):a.metaKey&&219===b?this.indent.decrease():a.metaKey&&221===b?this.indent.increase():a.shiftKey?this.indent.decrease():this.indent.increase(),!1},replaceDivToBreakLine:function(){var b=this.selection.getBlock(),c=b.innerHTML.replace(/<br\s?\/?>/gi,"");if(("DIV"===b.tagName||"P"===b.tagName)&&""===c&&!a(b).hasClass("redactor-editor")){var d=document.createElement("br");return a(b).replaceWith(d),this.caret.setBefore(d),this.code.sync(),!1}},replaceDivToParagraph:function(){var b=this.selection.getBlock(),c=b.innerHTML.replace(/<br\s?\/?>/gi,"");if("DIV"===b.tagName&&this.utils.isEmpty(c)&&!a(b).hasClass("redactor-editor")){var d=document.createElement("p");return d.innerHTML=this.opts.invisibleSpace,a(b).replaceWith(d),this.caret.setStart(d),this.code.sync(),!1}this.opts.cleanStyleOnEnter&&"P"==b.tagName&&a(b).removeAttr("class").removeAttr("style")},insertParagraph:function(a){a.preventDefault(),this.selection.get();var b=document.createElement("p");return b.innerHTML=this.opts.invisibleSpace,this.range.deleteContents(),this.range.insertNode(b),this.caret.setStart(b),this.code.sync(),!1},exitFromBlockquote:function(b){if(this.utils.isEndOfElement()){var c=a.trim(a(this.keydown.block).html());if(-1!=c.search(/(<br\s?\/?>){2}$/i)){if(b.preventDefault(),this.opts.linebreaks){var d=document.createElement("br");a(this.keydown.blockquote).after(d),this.caret.setBefore(d),a(this.keydown.block).html(c.replace(/<br\s?\/?>$/i,""))}else{var e=a(this.opts.emptyHtml);a(this.keydown.blockquote).after(e),this.caret.setStart(e)}return!0}}},insertAfterLastElement:function(b){if(this.utils.isEndOfElement())if(this.buffer.set(),this.opts.linebreaks){var c=a("<div>").append(a.trim(this.$editor.html())).contents(),d=c.last()[0];if("SPAN"==d.tagName&&""===d.innerHTML&&(d=c.prev()[0]),this.utils.getOuterHtml(d)!=this.utils.getOuterHtml(b))return;var e=document.createElement("br");a(b).after(e),this.caret.setAfter(e)}else{if(this.$editor.contents().last()[0]!==b)return;var f=a(this.opts.emptyHtml);a(b).after(f),this.caret.setStart(f)}},insertNewLine:function(a){a.preventDefault();var b=document.createTextNode("\n");return this.selection.get(),this.range.deleteContents(),this.range.insertNode(b),this.caret.setAfter(b),this.code.sync(),!1},insertBreakLine:function(a){return this.keydown.insertBreakLineProcessing(a)},insertDblBreakLine:function(a){return this.keydown.insertBreakLineProcessing(a,!0)},insertBreakLineProcessing:function(b,c){b.stopPropagation(),this.selection.get();var d=document.createElement("br");this.utils.browser("msie")?(this.range.collapse(!1),this.range.setEnd(this.range.endContainer,this.range.endOffset)):this.range.deleteContents(),this.range.insertNode(d);var e=a(d).parent("a");if(e.length>0&&(e.find(d).remove(),e.after(d)),c===!0){var f=a(d).next();if(0!==f.length&&"BR"===f[0].tagName&&this.utils.isEndOfEditor())return this.caret.setAfter(d),this.code.sync(),!1;var g=document.createElement("br");this.range.insertNode(g),this.caret.setAfter(g)}else if(this.utils.browser("msie")){var h=document.createElement("span");h.innerHTML="&#x200b;",a(d).after(h),this.caret.setAfter(h),a(h).remove()}else{var i=document.createRange();i.setStartAfter(d),i.collapse(!0);var j=window.getSelection();j.removeAllRanges(),j.addRange(i)}return this.code.sync(),!1},removeInvisibleSpace:function(){var b=a(this.keydown.current);0===b.text().search(/^\u200B$/g)&&b.remove()},removeEmptyListInTable:function(b){var c=a(this.keydown.current),d=a(this.keydown.parent),e=c.closest("td",this.$editor[0]);if(0!==e.length&&c.closest("li",this.$editor[0])&&1===d.children("li").length){if(!this.utils.isEmpty(c.text()))return;b.preventDefault(),c.remove(),d.remove(),this.caret.setStart(e)}}}},keyup:function(){return{init:function(b){if(!this.rtePaste){var c=b.which;this.keyup.current=this.selection.getCurrent(),this.keyup.parent=this.selection.getParent();var d=this.utils.isRedactorParent(a(this.keyup.parent).parent()),e=this.core.setCallback("keyup",b);if(e===!1)return b.preventDefault(),!1;if(!this.opts.linebreaks&&3==this.keyup.current.nodeType&&this.keyup.current.length<=1&&(this.keyup.parent===!1||"BODY"==this.keyup.parent.tagName)&&this.keyup.replaceToParagraph(),!this.opts.linebreaks&&this.utils.isRedactorParent(this.keyup.current)&&"DIV"===this.keyup.current.tagName&&this.keyup.replaceToParagraph(!1),this.opts.linebreaks||!a(this.keyup.parent).hasClass("redactor-invisible-space")||d!==!1&&"BODY"!=d[0].tagName||(a(this.keyup.parent).contents().unwrap(),this.keyup.replaceToParagraph()),this.linkify.isEnabled()&&this.linkify.isKey(c)&&this.linkify.format(),
c===this.keyCode.DELETE||c===this.keyCode.BACKSPACE){if(this.utils.browser("mozilla")){var f=a(this.keydown.current).closest("td",this.$editor[0]);if(0!==f.size()&&""!==f.text())return b.preventDefault(),!1}return this.clean.clearUnverified(),this.observe.image?(b.preventDefault(),this.image.hideResize(),this.buffer.set(),this.image.remove(this.observe.image),this.observe.image=!1,!1):(this.$editor.find("p").each(a.proxy(function(b,c){this.utils.removeEmpty(b,a(c).html())},this)),this.opts.linebreaks&&this.keyup.current&&"DIV"==this.keyup.current.tagName&&this.utils.isEmpty(this.keyup.current.innerHTML)&&(a(this.keyup.current).after(this.selection.getMarkerAsHtml()),this.selection.restore(),a(this.keyup.current).remove()),this.keyup.formatEmpty(b))}}},replaceToParagraph:function(b){var c,d=a(this.keyup.current);c=b===!1?a("<p>").append(d.html()):a("<p>").append(d.clone()),d.replaceWith(c);var e=a(c).next();"undefined"!=typeof e[0]&&"BR"==e[0].tagName&&e.remove(),this.caret.setEnd(c)},formatEmpty:function(b){var c=a.trim(this.$editor.html());if(this.utils.isEmpty(c))return b.preventDefault(),this.opts.linebreaks?(this.$editor.html(this.selection.getMarkerAsHtml()),this.selection.restore()):(this.$editor.html(this.opts.emptyHtml),this.focus.setStart()),this.code.sync(),!1}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(a){return"undefined"!=typeof this.opts.curLang[a]?this.opts.curLang[a]:""}}},line:function(){return{insert:function(){this.buffer.set();var a=this.selection.getBlocks();return a[0]!==!1&&this.line.isExceptLastOrFirst(a)?void(this.utils.browser("msie")||this.$editor.focus()):void(this.utils.browser("msie")?this.line.insertInIe():this.line.insertInOthersBrowsers())},isExceptLastOrFirst:function(b){var c=["li","td","th","blockquote","figcaption","pre","dl","dt","dd"],d=b[0].tagName.toLowerCase(),e=this.selection.getLastBlock();e="undefined"==typeof e?d:e.tagName.toLowerCase();var f=-1!=a.inArray(d,c),g=-1!=a.inArray(e,c);return f&&g||f?!0:void 0},insertInIe:function(){this.utils.saveScroll(),this.buffer.set(),this.insert.node(document.createElement("hr")),this.utils.restoreScroll(),this.code.sync()},insertInOthersBrowsers:function(){this.buffer.set();var a='<p id="redactor-insert-line"><br /></p>';this.opts.linebreaks&&(a='<br id="redactor-insert-line">'),document.execCommand("insertHtml",!1,"<hr>"+a),this.line.setFocus(),this.code.sync()},setFocus:function(){var b=this.$editor.find("#redactor-insert-line"),c=a(b).next()[0],d=c;this.utils.browser("mozilla")&&c&&""===c.innerHTML&&(d=a(c).next()[0],a(c).remove()),d?(b.remove(),this.opts.linebreaks||(this.$editor.focus(),this.line.setStart(d))):(b.removeAttr("id"),this.line.setStart(b[0]))},setStart:function(a){if("undefined"!=typeof a){var b=document.createTextNode("​");this.selection.get(),this.range.setStart(a,0),this.range.insertNode(b),this.range.collapse(!0),this.selection.addRange()}}}},link:function(){return{show:function(b){"undefined"!=typeof b&&b.preventDefault&&b.preventDefault(),this.observe.isCurrent("a")?this.modal.load("link",this.lang.get("link_edit"),600):this.modal.load("link",this.lang.get("link_insert"),600),this.modal.createCancelButton();var c=this.observe.isCurrent("a")?this.lang.get("edit"):this.lang.get("insert");this.link.buttonInsert=this.modal.createActionButton(c),this.selection.get(),this.link.getData(),this.link.cleanUrl(),this.link.$selectUrlOpen=a("#redactor-link-url-open"),this.opts.concrete5.lightbox||this.link.$selectUrlOpen.find("option[value=lightbox]").remove(),this.link.$selectUrlLightboxFieldGroup=a("div[data-field-group=lightbox]"),this.link.$selectUrlLightboxIframeFieldGroup=a("div[data-field-group=lightbox-iframe]"),this.link.$selectUrlLightboxFieldGroupSelect=a("div[data-field-group=lightbox] select"),this.link.$selectUrlLightboxIframeWidth=a("#redactor-link-lightbox-iframe-width"),this.link.$selectUrlLightboxIframeHeight=a("#redactor-link-lightbox-iframe-height"),this.link.$selectUrlOpen.val(this.link.linkType),this.link.$selectUrlLightboxIframeWidth.val(this.link.linkLightboxIframeWidth),this.link.$selectUrlLightboxIframeHeight.val(this.link.linkLightboxIframeHeight);var d=this.link;this.link.$selectUrlOpen.on("change",function(){"lightbox"==a(this).val()?d.$selectUrlLightboxFieldGroup.show():(d.$selectUrlLightboxFieldGroup.hide(),d.$selectUrlLightboxFieldGroupSelect.val("image").trigger("change"))}).trigger("change"),this.link.$selectUrlLightboxFieldGroupSelect.val(this.link.linkLightboxType),this.link.$selectUrlLightboxFieldGroupSelect.on("change",function(){"iframe"==a(this).val()?d.$selectUrlLightboxIframeFieldGroup.show():d.$selectUrlLightboxIframeFieldGroup.hide()}).trigger("change"),this.link.$inputUrl=a("#redactor-link-url"),this.link.$inputText=a("#redactor-link-url-text"),this.link.$inputText.val(this.link.text),this.link.$inputUrl.val(this.link.url),this.link.buttonInsert.on("click",a.proxy(this.link.insert,this)),a(".redactor-link-tooltip").remove(),this.opts.concrete5.filemanager?a("a[data-action=choose-file-from-file-manager]").on("click",function(b){b.preventDefault(),ConcreteFileManager.launchDialog(function(b){jQuery.fn.dialog.showLoader(),ConcreteFileManager.getFileDetails(b.fID,function(b){jQuery.fn.dialog.hideLoader();var c=b.files[0];a("#redactor-link-url").val(c.urlDownload)})})}):a("a[data-action=choose-file-from-file-manager]").remove(),this.opts.concrete5.sitemap?a("a[data-action=choose-link-from-sitemap]").on("click",function(b){b.preventDefault(),jQuery.fn.dialog.open({width:"90%",height:"70%",modal:!1,title:ccmi18n_sitemap.choosePage,href:CCM_TOOLS_PATH+"/sitemap_search_selector"}),ConcreteEvent.unsubscribe("SitemapSelectPage"),ConcreteEvent.subscribe("SitemapSelectPage",function(b,c){jQuery.fn.dialog.closeTop();var d=CCM_APPLICATION_URL+"/index.php?cID="+c.cID;a("#redactor-link-url").val(d),this.link.$inputUrl.val(d),this.link.$inputText.val(d)})}):a("a[data-action=choose-link-from-sitemap]").remove(),this.opts.concrete5.sitemap||this.opts.concrete5.filemanager||a("#redactor-link-url").parent().removeClass(),this.selection.save(),this.modal.show(),this.link.$inputUrl.focus()},cleanUrl:function(){var a=self.location.href.replace(/\/$/i,"");if("undefined"!=typeof this.link.url&&(this.link.url=this.link.url.replace(a,""),this.link.url=this.link.url.replace(/^\/#/,"#"),this.link.url=this.link.url.replace("mailto:",""),!this.opts.linkProtocol)){var b=new RegExp("^(http|ftp|https)://"+self.location.host,"i");this.link.url=this.link.url.replace(b,"")}},getData:function(){this.link.$node=!1;var b=a(this.selection.getCurrent()).closest("a",this.$editor[0]);if(0!==b.length&&"A"===b[0].tagName){this.link.$node=b,this.link.url=b.attr("href"),this.link.text=b.text(),this.link.target=b.attr("target");var c=b.attr("data-concrete5-link-lightbox");this.link.linkLightboxType="image",this.link.linkLightboxIframeWidth="600",this.link.linkLightboxIframeHeight="400","_blank"==this.link.target?this.link.linkType="blank":"image"==c||"iframe"==c?(this.link.linkType="lightbox",this.link.linkLightboxType=c,this.link.linkLightboxIframeWidth=b.attr("data-concrete5-link-lightbox-width"),this.link.linkLightboxIframeHeight=b.attr("data-concrete5-link-lightbox-height")):this.link.linkType="same"}else this.link.text=this.sel.toString(),this.link.url="",this.link.target="",this.link.linkType="same",this.link.linkLightboxType="image",this.link.linkLightboxIframeWidth="600",this.link.linkLightboxIframeHeight="400"},insert:function(){this.placeholder.remove();var b="",c=this.link.$inputUrl.val(),d=this.link.$inputText.val().replace(/(<([^>]+)>)/gi,""),e=null,f=null,g=null;if(""===a.trim(c))return void this.link.$inputUrl.addClass("redactor-input-error").on("keyup",function(){a(this).removeClass("redactor-input-error"),a(this).off("keyup")});if(-1!=c.search("@")&&/(http|ftp|https):\/\//i.test(c)===!1)c="mailto:"+c;else if(0!==c.search("#")){"blank"==a("#redactor-link-url-open").val()&&(b="_blank"),"lightbox"==a("#redactor-link-url-open").val()&&(e=a("#redactor-link-lightbox-type").val(),"iframe"==e&&(f=a("#redactor-link-lightbox-iframe-width").val(),g=a("#redactor-link-lightbox-iframe-height").val()));var h="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",i=new RegExp("^(http|ftp|https)://"+h,"i"),j=new RegExp("^"+h,"i"),k=new RegExp(".(html|php)$","i");-1==c.search(i)&&-1==c.search(k)&&0===c.search(j)&&this.opts.linkProtocol&&(c=this.opts.linkProtocol+"://"+c)}this.link.set(d,c,b,e,f,g),this.modal.close()},set:function(b,c,d,e,f,g){b=a.trim(b.replace(/<|>/g,"")),this.selection.restore();var h=this.selection.getBlocks();if(""!==b||""!==c){if(""===b&&""!==c&&(b=c),this.link.$node){this.buffer.set();var i=this.link.$node,j=i.children();if(j.length>0){for(;j.length;)j=j.children();j=j.end()}else j=i;i.attr("href",c),j.text(b),i.removeAttr("data-concrete5-link-lightbox"),i.removeAttr("data-concrete5-link-lightbox-width"),i.removeAttr("data-concrete5-link-lightbox-height"),""!==d?i.attr("target",d):(i.removeAttr("target"),e&&(i.attr("data-concrete5-link-lightbox",e),"iframe"==e&&f&&g&&(i.attr("data-concrete5-link-lightbox-width",f),i.attr("data-concrete5-link-lightbox-height",g)))),this.selection.selectElement(i),this.code.sync()}else{if(this.utils.browser("mozilla")&&""===this.link.text){var k=a("<a />").attr("href",c).text(b);""!==d&&k.attr("target",d),this.insert.node(k),this.selection.selectElement(k)}else{var k;this.utils.browser("msie")?(k=a('<a href="'+c+'">').text(b),""!==d&&k.attr("target",d),k=a(this.insert.node(k)),this.selection.getText().match(/\s$/)&&k.after(" "),this.selection.selectElement(k)):(document.execCommand("createLink",!1,c),k=a(this.selection.getCurrent()).closest("a",this.$editor[0]),this.utils.browser("mozilla")&&(k=a('a[_moz_dirty=""]')),""!==d&&k.attr("target",d),k.removeAttr("style").removeAttr("_moz_dirty"),this.selection.getText().match(/\s$/)&&k.after(" "),(""!==this.link.text||this.link.text!=b)&&(!this.opts.linebreaks&&h&&h.length<=1&&k.text(b),this.selection.selectElement(k)))}e&&(k.attr("data-concrete5-link-lightbox",e),"iframe"==e&&f&&g&&(k.attr("data-concrete5-link-lightbox-width",f),k.attr("data-concrete5-link-lightbox-height",g))),this.code.sync(),this.core.setCallback("insertedLink",k)}setTimeout(a.proxy(function(){this.observe.links()},this),5)}},unlink:function(b){"undefined"!=typeof b&&b.preventDefault&&b.preventDefault();var c=this.selection.getNodes();if(c){this.buffer.set();for(var d=c.length,e=[],f=0;d>f;f++){"A"===c[f].tagName&&e.push(c[f]);var g=a(c[f]).closest("a",this.$editor[0]);g.replaceWith(g.contents())}this.core.setCallback("deletedLink",e),a(".redactor-link-tooltip").remove(),this.code.sync()}},toggleClass:function(a){this.link.setClass(a,"toggleClass")},addClass:function(a){this.link.setClass(a,"addClass")},removeClass:function(a){this.link.setClass(a,"removeClass")},setClass:function(b,c){var d=this.selection.getInlinesTags(["a"]);d!==!1&&a.each(d,function(){a(this)[c](b)})}}},linkify:function(){return{isKey:function(a){return a==this.keyCode.ENTER||a==this.keyCode.SPACE},isEnabled:function(){return this.opts.convertLinks&&(this.opts.convertUrlLinks||this.opts.convertImageLinks||this.opts.convertVideoLinks)&&!this.utils.isCurrentOrParent("PRE")},format:function(){var b=this.linkify,c=this.opts;this.$editor.find(":not(iframe,img,a,pre)").addBack().contents().filter(function(){return 3===this.nodeType&&""!=a.trim(this.nodeValue)&&!a(this).parent().is("pre")&&(this.nodeValue.match(c.linkify.regexps.youtube)||this.nodeValue.match(c.linkify.regexps.vimeo)||this.nodeValue.match(c.linkify.regexps.image)||this.nodeValue.match(c.linkify.regexps.url))}).each(function(){var d=a(this).text(),e=d;c.convertVideoLinks&&(e.match(c.linkify.regexps.youtube)||e.match(c.linkify.regexps.vimeo))?e=b.convertVideoLinks(e):c.convertImageLinks&&e.match(c.linkify.regexps.image)?e=b.convertImages(e):c.convertUrlLinks&&(e=b.convertLinks(e)),a(this).before(d.replace(d,e)).remove()});var d=this.$editor.find(".redactor-linkify-object").each(function(){var b=a(this);return b.removeClass("redactor-linkify-object"),""===b.attr("class")&&b.removeAttr("class"),b[0]});this.core.setCallback("linkify",d),this.code.sync()},convertVideoLinks:function(a){var b='<iframe class="redactor-linkify-object" width="500" height="281" src="',c='" frameborder="0" allowfullscreen></iframe>';return a.match(this.opts.linkify.regexps.youtube)&&(a=a.replace(this.opts.linkify.regexps.youtube,b+"//www.youtube.com/embed/$1"+c)),a.match(this.opts.linkify.regexps.vimeo)&&(a=a.replace(this.opts.linkify.regexps.vimeo,b+"//player.vimeo.com/video/$2"+c)),a},convertImages:function(a){var b=a.match(this.opts.linkify.regexps.image);return b&&(a=a.replace(a,'<img src="'+b+'" class="redactor-linkify-object" />'),this.opts.linebreaks&&(this.utils.isEmpty(this.code.get())||(a="<br>"+a)),a+="<br>"),a},convertLinks:function(b){var c=b.match(this.opts.linkify.regexps.url);if(c){c=a.grep(c,function(b,d){return a.inArray(b,c)===d});for(var d=c.length,e=0;d>e;e++){var f=c[e],g=f,h=this.opts.linkProtocol+"://";null!==f.match(/(https?|ftp):\/\//i)&&(h=""),g.length>this.opts.linkSize&&(g=g.substring(0,this.opts.linkSize)+"..."),g=decodeURIComponent(g);var i="\\b";-1!=a.inArray(f.slice(-1),["/","&","="])&&(i="");var j=new RegExp("("+f.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+i+")","g");b=b.replace(j,'<a href="'+h+a.trim(f)+'" class="redactor-linkify-object">'+a.trim(g)+"</a>")}}return b}}},list:function(){return{toggle:function(b){this.placeholder.remove(),this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var c=this.selection.getParent(),d=a(c).closest("ol, ul",this.$editor[0]);this.utils.isRedactorParent(d)||0===d.length||(d=!1);var e,f,g=!1;if(d&&d.length){g=!0;var h=d[0].tagName;e="orderedlist"===b&&"UL"===h,f="unorderedlist"===b&&"OL"===h}e?this.utils.replaceToTag(d,"ol"):f?this.utils.replaceToTag(d,"ul"):g?this.list.remove(b,d):this.list.insert(b),this.selection.restore(),this.code.sync()},insert:function(b){var c=this.selection.getCurrent(),d=a(c).closest("td, th",this.$editor[0]);this.utils.browser("msie")&&this.opts.linebreaks?this.list.insertInIe(b):document.execCommand("insert"+b);var e=this.selection.getParent(),f=a(e).closest("ol, ul",this.$editor[0]);if(0!==d.length){var g=d.clone();d.after(g).remove("")}if(this.utils.isEmpty(f.find("li").text())){var h=f.children("li");h.find("br").remove(),h.append(this.selection.getMarkerAsHtml()),this.opts.linebreaks&&this.utils.browser("mozilla")&&2==h.size()&&this.utils.isEmpty(h.eq(1).text())&&h.eq(1).remove()}if(f.length){var i=f.parent();this.utils.isRedactorParent(i)&&"LI"!=i[0].tagName&&this.utils.isBlock(i[0])&&i.replaceWith(i.contents())}this.utils.browser("msie")||this.$editor.focus(),this.clean.clearUnverified()},insertInIe:function(b){var c=this.selection.wrap("div"),d=a(c).html(),e=a("orderedlist"==b?"<ol>":"<ul>"),f=a("<li>");if(""===a.trim(d))f.append(this.selection.getMarkerAsHtml()),e.append(f),this.$editor.find("#selection-marker-1").replaceWith(e);else{var g=d.split(/<br\s?\/?>/gi);if(g)for(var h=0;h<g.length;h++)""!==a.trim(g[h])&&e.append(a("<li>").html(g[h]));else f.append(d),e.append(f);a(c).replaceWith(e)}},remove:function(b,c){a.inArray("ul",this.selection.getBlocks())&&(b="unorderedlist"),document.execCommand("insert"+b);var d=a(this.selection.getCurrent());this.indent.fixEmptyIndent(),this.opts.linebreaks||0!==d.closest("li, th, td",this.$editor[0]).length||(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote").each(a.proxy(this.utils.removeEmpty,this)));var e=a(this.selection.getCurrent()).closest("table",this.$editor[0]),f=e.prev();this.opts.linebreaks||0===e.length||0===f.length||"BR"!=f[0].tagName||f.remove(),this.clean.clearUnverified()}}},modal:function(){return{callbacks:{},getLinkFields:function(){var a=String()+'<div class="form-group"><label class="control-label">'+this.lang.get("open_link")+'</label><select class="form-control" id="redactor-link-url-open"><option value="same">'+this.lang.get("link_same_window")+'</option><option value="blank">'+this.lang.get("link_new_tab")+'</option><option value="lightbox">'+this.lang.get("in_lightbox")+'</option></select></div><div data-field-group="lightbox" style="display: none" class="form-group"><label class="control-label">'+this.lang.get("lightbox_link_type")+'</label><select class="form-control" id="redactor-link-lightbox-type"><option value="image">'+this.lang.get("lightbox_link_type_image")+'</option><option value="iframe">'+this.lang.get("lightbox_link_type_iframe")+'</option></select></div><div data-field-group="lightbox-iframe" style="display: none"><div class="form-group"><label class="control-label">'+this.lang.get("lightbox_link_type_iframe_width")+'</label><input class="form-control" type="text" id="redactor-link-lightbox-iframe-width" /></div><div class="form-group"><label class="control-label">'+this.lang.get("lightbox_link_type_iframe_height")+'</label><input class="form-control" type="text" id="redactor-link-lightbox-iframe-height" /></div></div>';return a},loadTemplates:function(){this.opts.modal={imageEdit:String()+'<section id="redactor-modal-image-edit"><div class="form-group"><label class="control-label">'+this.lang.get("title")+'</label><input type="text" class="form-control" id="redactor-image-title" /></div><div class="form-group"><label class="control-label redactor-image-link-option">'+this.lang.get("link")+'</label><div class="input-group"><input type="text" class="form-control" id="redactor-image-link" /><a href="#" data-action="choose-link-from-sitemap" class="btn btn-default input-group-addon"><i class="fa fa-sitemap"></i></a><a href="#" data-action="choose-file-from-file-manager" class="btn btn-default input-group-addon"><i class="fa fa-file"></i></a></div></div>'+this.modal.getLinkFields()+'<div class="form-group"><label class="control-label redactor-image-position-option">'+this.lang.get("image_position")+'</label><select class="form-control redactor-image-position-option" id="redactor-image-align"><option value="none">'+this.lang.get("none")+'</option><option value="left">'+this.lang.get("left")+'</option><option value="center">'+this.lang.get("center")+'</option><option value="right">'+this.lang.get("right")+"</option></select></div></section>",image:String()+'<section id="redactor-modal-image-insert"><div class="form-group"><label class="control-label">'+this.lang.get("image_web_link")+'</label><div class="input-group"><input type="text" name="redactor-image-link" id="redactor-image-link" class="form-control"  /><a href="#" data-action="choose-image-from-file-manager" class="btn btn-default input-group-addon"><i class="fa fa-search"></i></a></div></div></section>',file:String()+'<section id="redactor-modal-file-insert"><div class="form-group"><label class="control-label">'+this.lang.get("file")+'</label><div class="input-group"><input type="text" name="redactor-file-link" id="redactor-file-link" class="form-control"  /><a href="#" data-action="choose-image-from-file-manager" class="btn btn-default input-group-addon"><i class="fa fa-search"></i></a></div></div><div class="form-group"><label class="control-label">'+this.lang.get("text")+'</label><input class="form-control" type="text" id="redactor-filename" /></div></section>',link:String()+'<section id="redactor-modal-link-insert"><div class="form-group"><label class="control-label">'+this.lang.get("web")+'</label><div class="input-group"><input type="text" class="form-control" id="redactor-link-url" /><a href="#" data-action="choose-link-from-sitemap" class="btn btn-default input-group-addon"><i class="fa fa-sitemap"></i></a><a href="#" data-action="choose-file-from-file-manager" class="btn btn-default input-group-addon"><i class="fa fa-file"></i></a></div></div><div class="form-group"><label class="control-label">'+this.lang.get("text")+'</label><input class="form-control" type="text" id="redactor-link-url-text" /></div>'+this.modal.getLinkFields()+"</section>"},a.extend(this.opts,this.opts.modal)},addCallback:function(a,b){this.modal.callbacks[a]=b},createTabber:function(b){this.modal.$tabber=a("<div>").attr("id","redactor-modal-tabber"),b.prepend(this.modal.$tabber)},addTab:function(b,c,d){var e=a('<a href="#" rel="tab'+b+'">').text(c);d&&e.addClass("active");var f=this;e.on("click",function(b){b.preventDefault(),a(".redactor-tab").hide(),a(".redactor-"+a(this).attr("rel")).show(),f.modal.$tabber.find("a").removeClass("active"),a(this).addClass("active")}),this.modal.$tabber.append(e)},addTemplate:function(a,b){this.opts.modal[a]=b},getTemplate:function(a){return this.opts.modal[a]},getModal:function(){return this.$modalBody.find("section")},load:function(a,b,c){this.modal.templateName=a,this.modal.width=c,this.modal.build(),this.modal.enableEvents(),this.modal.setTitle(b),this.modal.setDraggable(),this.modal.setContent(),"undefined"!=typeof this.modal.callbacks[a]&&this.modal.callbacks[a].call(this)},show:function(){this.utils.disableBodyScroll(),this.utils.isMobile()?this.modal.showOnMobile():this.modal.showOnDesktop(),this.opts.highContrast&&this.$modalBox.addClass("redactor-modal-contrast"),this.$modalOverlay.show(),this.$modalBox.show(),this.$modal.attr("tabindex","-1"),this.$modal.focus(),this.modal.setButtonsWidth(),this.utils.saveScroll(),this.utils.isMobile()||(setTimeout(a.proxy(this.modal.showOnDesktop,this),0),a(window).on("resize.redactor-modal",a.proxy(this.modal.resize,this))),this.core.setCallback("modalOpened",this.modal.templateName,this.$modal),a(document).off("focusin.modal"),this.$modal.find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor-modal",a.proxy(this.modal.setEnter,this))},showOnDesktop:function(){var b=this.$modal.outerHeight(),c=a(window).height(),d=a(window).width();return this.modal.width>d?void this.$modal.css({width:"96%",marginTop:c/2-b/2+"px"}):void(b>c?this.$modal.css({width:this.modal.width+"px",marginTop:"20px"}):this.$modal.css({width:this.modal.width+"px",marginTop:c/2-b/2+"px"}))},showOnMobile:function(){this.$modal.css({width:"96%",marginTop:"2%"})},resize:function(){this.utils.isMobile()?this.modal.showOnMobile():this.modal.showOnDesktop()},setTitle:function(a){this.$modalHeader.html(a)},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName))},setDraggable:function(){"undefined"!=typeof a.fn.draggable&&(this.$modal.draggable({handle:this.$modalHeader}),this.$modalHeader.css("cursor","move"))},setEnter:function(a){13==a.which&&(a.preventDefault(),this.$modal.find("button.redactor-modal-action-btn").click())},createCancelButton:function(){var b=a("<button>").addClass("btn btn-default redactor-modal-close-btn").html(this.lang.get("cancel"));b.on("click",a.proxy(this.modal.close,this)),this.$modalFooter.append(b)},createDeleteButton:function(a){return this.modal.createButton(a,"danger")},createActionButton:function(a){return this.modal.createButton(a,"primary")},createButton:function(b,c){var d=a("<button>").addClass("btn pull-right").addClass("btn-"+c).html(b);return this.$modalFooter.append(d),d},setButtonsWidth:function(){var a=this.$modalFooter.find("button"),b=a.length;0!==b&&0===b&&this.$modalFooter.remove()},build:function(){this.modal.buildOverlay(),this.$modalBox=a('<div id="redactor-modal-box" />').hide(),this.$modal=a('<div id="redactor-modal" />'),this.$modalHeader=a("<header />"),this.$modalBox.addClass("ccm-ui"),this.$modalClose=a('<span class="ui-button-icon-primary ui-icon ui-icon-closethick" />'),this.$modalCloseWrapper=a('<span id="redactor-modal-close"><button class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close" role="button"><span class="ui-button-text">close</span></button></span>'),this.$modalClose.appendTo(this.$modalCloseWrapper.find("button.ui-button")),this.$modalBody=a('<div id="redactor-modal-body" />'),this.$modalFooter=a("<footer />"),this.$modal.addClass("ccm-interaction-dialog"),this.$modal.append(this.$modalHeader),this.$modal.append(this.$modalCloseWrapper),this.$modal.append(this.$modalBody),this.$modal.append(this.$modalFooter),this.$modalBox.append(this.$modal),this.$modalBox.appendTo(document.body)},buildOverlay:function(){this.$modalOverlay=a('<div id="redactor-modal-overlay">').hide(),a("body").prepend(this.$modalOverlay)},enableEvents:function(){this.$modalClose.find("button").on("click.redactor-modal",a.proxy(this.modal.close,this)),a(document).on("keyup.redactor-modal",a.proxy(this.modal.closeHandler,this)),this.$editor.on("keyup.redactor-modal",a.proxy(this.modal.closeHandler,this)),this.$modalBox.on("click.redactor-modal",a.proxy(this.modal.close,this))},disableEvents:function(){this.$modalClose.find("button").off("click.redactor-modal"),a(document).off("keyup.redactor-modal"),this.$editor.off("keyup.redactor-modal"),this.$modalBox.off("click.redactor-modal"),a(window).off("resize.redactor-modal")},closeHandler:function(a){a.which==this.keyCode.ESC&&this.modal.close(!1)},close:function(b){if(b){if(!a(b.target).hasClass("redactor-modal-close-btn")&&b.target!=this.$modalClose[0]&&b.target!=this.$modalBox[0])return;b.preventDefault()}this.$modalBox&&(this.modal.disableEvents(),this.utils.enableBodyScroll(),this.$modalOverlay.remove(),this.$modalBox.fadeOut("fast",a.proxy(function(){this.$modalBox.remove(),setTimeout(a.proxy(this.utils.restoreScroll,this),0),void 0!==b&&this.selection.restore(),a(document.body).css("overflow",this.modal.bodyOveflow),this.core.setCallback("modalClosed",this.modal.templateName)},this)))}}},observe:function(){return{load:function(){if("undefined"==typeof this.opts.destroyed){if(this.utils.browser("msie")){var b=this;this.$editor.find("pre, code").on("mouseover",function(){b.$editor.attr("contenteditable",!1),a(this).attr("contenteditable",!0)}).on("mouseout",function(){b.$editor.attr("contenteditable",!0),a(this).removeAttr("contenteditable")})}this.observe.images(),this.observe.links()}},toolbar:function(a,b){this.observe.buttons(a,b),this.observe.dropdowns()},isCurrent:function(b,c){if("undefined"==typeof c)var c=a(this.selection.getCurrent());return c.is(b)||c.parents(b).length>0},dropdowns:function(){var b=a(this.selection.getCurrent());a.each(this.opts.observe.dropdowns,a.proxy(function(a,c){var d=c.observe,e=d.element,f=c.item,g="undefined"!=typeof d["in"]?d["in"]:!1,h="undefined"!=typeof d.out?d.out:!1;b.closest(e).size()>0?this.observe.setDropdownProperties(f,g,h):this.observe.setDropdownProperties(f,h,g)},this))},setDropdownProperties:function(a,b,c){if(c&&"undefined"!=typeof c.attr&&this.observe.setDropdownAttr(a,c.attr,!0),"undefined"!=typeof b.attr&&this.observe.setDropdownAttr(a,b.attr),"undefined"!=typeof b.title){for(var d=a;d.children().length;)d=d.children().first();d.text(b.title)}},setDropdownAttr:function(b,c,d){a.each(c,function(a,c){"class"==a?d?b.removeClass(c):b.addClass(c):d?b.removeAttr(a):b.attr(a,c)})},addDropdown:function(a,b,c){"undefined"!=typeof c.observe&&(c.item=a,this.opts.observe.dropdowns.push(c))},buttons:function(b,c){var d=this.selection.getCurrent(),e=this.selection.getParent();if(b!==!1?this.button.setInactiveAll():this.button.setInactiveAll(c),b===!1&&"html"!==c)return void(-1!=a.inArray(c,this.opts.activeButtons)&&this.button.toggleActive(c));a.each(this.opts.activeButtonsStates,a.proxy(function(b,c){var f=a(e).closest(b,this.$editor[0]),g=a(d).closest(b,this.$editor[0]);(0===f.length||this.utils.isRedactorParent(f))&&this.utils.isRedactorParent(g)&&(0!==f.length||0!==g.closest(b,this.$editor[0]).length)&&this.button.setActive(c)},this));var f=a(e).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]);if(this.utils.isRedactorParent(e)&&f.length){var g=""===f.css("text-align")?"left":f.css("text-align");this.button.setActive("align"+g)}},addButton:function(a,b){this.opts.activeButtons.push(b),this.opts.activeButtonsStates[a]=b},images:function(){this.$editor.find("img").each(a.proxy(function(b,c){var d=a(c);d.closest("a",this.$editor[0]).on("click",function(a){a.preventDefault()}),this.utils.browser("msie")&&d.attr("unselectable","on"),this.image.setEditable(d)},this)),a(document).on("click.redactor-image-delete."+this.uuid,a.proxy(function(a){this.observe.image=!1,"IMG"==a.target.tagName&&this.utils.isRedactorParent(a.target)&&(this.observe.image=this.observe.image&&this.observe.image==a.target?!1:a.target)},this))},links:function(){this.opts.linkTooltip&&(this.$editor.find("a").on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,a.proxy(this.observe.showTooltip,this)),this.$editor.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,a.proxy(this.observe.closeTooltip,this)),a(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,a.proxy(this.observe.closeTooltip,this)))},getTooltipPosition:function(a){return a.offset()},showTooltip:function(b){var c=a(b.target);if("IMG"!=c[0].tagName&&("A"!==c[0].tagName&&(c=c.closest("a",this.$editor[0])),"A"===c[0].tagName)){var d=c,e=this.observe.getTooltipPosition(d),f=a('<span class="redactor-link-tooltip"></span>'),g=d.attr("href");void 0===g&&(g=""),g.length>24&&(g=g.substring(0,24)+"...");var h=a('<a href="'+d.attr("href")+'" target="_blank" />').html(g).addClass("redactor-link-tooltip-action"),i=a('<a href="#" />').html(this.lang.get("edit")).on("click",a.proxy(this.link.show,this)).addClass("redactor-link-tooltip-action"),j=a('<a href="#" />').html(this.lang.get("unlink")).on("click",a.proxy(this.link.unlink,this)).addClass("redactor-link-tooltip-action");f.append(h).append(" | ").append(i).append(" | ").append(j),f.css({top:e.top+parseInt(d.css("line-height"),10)+"px",left:e.left+"px"}),a(".redactor-link-tooltip").remove(),a("body").append(f)}},closeTooltip:function(b){b=b.originalEvent||b;var c=b.target,d=a(c).closest("a",this.$editor[0]);(0===d.length||"A"!==d[0].tagName||"A"===c.tagName)&&("A"===c.tagName&&this.utils.isRedactorParent(c)||a(c).hasClass("redactor-link-tooltip-action")||a(".redactor-link-tooltip").remove())}}},paragraphize:function(){return{load:function(b){return this.opts.linebreaks?b:""===b||"<p></p>"===b?this.opts.emptyHtml:(b+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,b=b.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>"),b=this.paragraphize.getSafes(b),b=this.paragraphize.getSafesComments(b),b=this.paragraphize.replaceBreaksToNewLines(b),b=this.paragraphize.replaceBreaksToParagraphs(b),b=this.paragraphize.clear(b),b=this.paragraphize.restoreSafes(b),b=b.replace(new RegExp("<br\\s?/?>\n?<("+this.opts.paragraphizeBlocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>"),a.trim(b))},getSafes:function(b){var c=a("<div />").append(b);return c.find("blockquote p").replaceWith(function(){return a(this).append("<br />").contents()}),b=c.html(),c.find(this.opts.paragraphizeBlocks.join(", ")).each(a.proxy(function(a,c){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=c.outerHTML,b=b.replace(c.outerHTML,"\n{replace"+this.paragraphize.z+"}")},this)),b},getSafesComments:function(b){var c=b.match(/<!--([\w\W]*?)-->/gi);return c?(a.each(c,a.proxy(function(a,c){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=c,b=b.replace(c,"\n{replace"+this.paragraphize.z+"}")},this)),b):b},restoreSafes:function(b){return a.each(this.paragraphize.safes,function(a,c){c="undefined"!=typeof c?c.replace(/\$/g,"&#36;"):c,b=b.replace("{replace"+a+"}",c)}),b},replaceBreaksToParagraphs:function(a){var b=a.split(new RegExp("\n","g"),-1);if(a="",b)for(var c=b.length,d=0;c>d;d++){if(!b.hasOwnProperty(d))return;-1==b[d].search("{replace")?(b[d]=b[d].replace(/<p>\n\t?<\/p>/gi,""),b[d]=b[d].replace(/<p><\/p>/gi,""),""!==b[d]&&(a+="<p>"+b[d].replace(/^\n+|\n+$/g,"")+"</p>")):a+=b[d]}return a},replaceBreaksToNewLines:function(a){return a=a.replace(/<br \/>\s*<br \/>/gi,"\n\n"),a=a.replace(/<br\s?\/?>\n?<br\s?\/?>/gi,"\n<br /><br />"),a=a.replace(new RegExp("\r\n","g"),"\n"),
a=a.replace(new RegExp("\r","g"),"\n"),a=a.replace(new RegExp("/\n\n+/"),"g","\n\n")},clear:function(a){return a=a.replace(new RegExp("</blockquote></p>","gi"),"</blockquote>"),a=a.replace(new RegExp("<p></blockquote>","gi"),"</blockquote>"),a=a.replace(new RegExp("<p><blockquote>","gi"),"<blockquote>"),a=a.replace(new RegExp("<blockquote></p>","gi"),"<blockquote>"),a=a.replace(new RegExp("<p><p ","gi"),"<p "),a=a.replace(new RegExp("<p><p>","gi"),"<p>"),a=a.replace(new RegExp("</p></p>","gi"),"</p>"),a=a.replace(new RegExp("<p>\\s?</p>","gi"),""),a=a.replace(new RegExp("\n</p>","gi"),"</p>"),a=a.replace(new RegExp("<p>	?	?\n?<p>","gi"),"<p>"),a=a.replace(new RegExp("<p>	*</p>","gi"),"")}}},paste:function(){return{init:function(b){return this.opts.cleanOnPaste?(this.rtePaste=!0,this.buffer.set(),this.selection.save(),this.utils.saveScroll(),this.paste.createPasteBox(),a(window).on("scroll.redactor-freeze",a.proxy(function(){a(window).scrollTop(this.saveBodyScroll)},this)),void setTimeout(a.proxy(function(){var b=this.$pasteBox.html();this.$pasteBox.remove(),this.selection.restore(),this.utils.restoreScroll(),this.paste.insert(b),a(window).off("scroll.redactor-freeze"),this.linkify.isEnabled()&&this.linkify.format()},this),1)):void setTimeout(a.proxy(this.code.sync,this),1)},createPasteBox:function(){this.$pasteBox=a("<div>").html("").attr("contenteditable","true").css({position:"fixed",width:0,top:0,left:"-9999px"}),this.utils.browser("msie")?this.$box.append(this.$pasteBox):a(".modal-body").length>0?a(".modal-body").append(this.$pasteBox):a("body").append(this.$pasteBox),this.$pasteBox.focus()},insert:function(b){b=this.core.setCallback("pasteBefore",b),b=this.utils.isSelectAll()?this.clean.onPaste(b,!1):this.clean.onPaste(b),b=this.core.setCallback("paste",b),this.utils.isSelectAll()?this.insert.set(b,!1):this.insert.html(b,!1),this.utils.disableSelectAll(),this.rtePaste=!1,setTimeout(a.proxy(this.clean.clearUnverified,this),10),setTimeout(a.proxy(function(){var b=this.$editor.find("span");a.each(b,function(b,c){var d=c.innerHTML.replace(/\u200B/,"");""===d&&0===c.attributes.length&&a(c).remove()})},this),10)}}},placeholder:function(){return{enable:function(){this.placeholder.is()&&(this.$editor.attr("placeholder",this.$element.attr("placeholder")),this.placeholder.toggle(),this.$editor.on("keydown.redactor-placeholder",a.proxy(this.placeholder.toggle,this)))},toggle:function(){setTimeout(a.proxy(function(){var a=this.utils.isEmpty(this.$editor.html(),!1)?"addClass":"removeClass";this.$editor[a]("redactor-placeholder")},this),5)},remove:function(){this.$editor.removeClass("redactor-placeholder")},is:function(){return this.opts.placeholder?this.$element.attr("placeholder",this.opts.placeholder):!("undefined"==typeof this.$element.attr("placeholder")||""===this.$element.attr("placeholder"))}}},progress:function(){return{show:function(){a(document.body).append(a('<div id="redactor-progress"><span></span></div>')),a("#redactor-progress").fadeIn()},hide:function(){a("#redactor-progress").fadeOut(1500,function(){a(this).remove()})}}},selection:function(){return{get:function(){this.sel=document.getSelection(),document.getSelection&&this.sel.getRangeAt&&this.sel.rangeCount?this.range=this.sel.getRangeAt(0):this.range=document.createRange()},addRange:function(){try{this.sel.removeAllRanges()}catch(a){}this.sel.addRange(this.range)},getCurrent:function(){var a=!1;return this.selection.get(),this.sel&&this.sel.rangeCount>0&&(a=this.sel.getRangeAt(0).startContainer),this.utils.isRedactorParent(a)},getParent:function(b){return b=b||this.selection.getCurrent(),b?this.utils.isRedactorParent(a(b).parent()[0]):!1},getPrev:function(){return window.getSelection().anchorNode.previousSibling},getNext:function(){return window.getSelection().anchorNode.nextSibling},getBlock:function(b){for(b=b||this.selection.getCurrent();b;){if(this.utils.isBlockTag(b.tagName))return a(b).hasClass("redactor-editor")?!1:b;b=b.parentNode}return!1},getInlines:function(b,c){if(this.selection.get(),this.range&&this.range.collapsed)return!1;var d=[];b="undefined"==typeof b||b===!1?this.selection.getNodes():b;var e=this.opts.inlineTags;if(e.push("span"),"undefined"!=typeof c)for(var f=0;f<c.length;f++)e.push(c[f]);return a.each(b,a.proxy(function(b,c){-1!=a.inArray(c.tagName.toLowerCase(),e)&&d.push(c)},this)),0===d.length?!1:d},getInlinesTags:function(b){if(this.selection.get(),this.range&&this.range.collapsed)return!1;var c=[],d=this.selection.getNodes();return a.each(d,a.proxy(function(d,e){-1!=a.inArray(e.tagName.toLowerCase(),b)&&c.push(e)},this)),0===c.length?!1:c},getBlocks:function(b){if(this.selection.get(),this.range&&this.range.collapsed)return[this.selection.getBlock()];var c=[];return b="undefined"==typeof b?this.selection.getNodes():b,a.each(b,a.proxy(function(a,b){this.utils.isBlock(b)&&(this.selection.lastBlock=b,c.push(b))},this)),0===c.length?[this.selection.getBlock()]:c},getLastBlock:function(){return this.selection.lastBlock},getNodes:function(){this.selection.get();var b=this.selection.getNodesMarker(1),c=this.selection.getNodesMarker(2);if(this.range.collapsed===!1){if(window.getSelection){var d=window.getSelection();if(d.rangeCount>0){var e=d.getRangeAt(0),f=e.startContainer,g=e.startOffset,h=e.cloneRange();h.collapse(!1),h.insertNode(c),h.setStart(f,g),h.collapse(!0),h.insertNode(b),e.setStartAfter(b),e.setEndBefore(c),d.removeAllRanges(),d.addRange(e)}}}else this.selection.setNodesMarker(this.range,b,!0),c=b;var i=[],j=0,k=this;this.$editor.find("*").each(function(){if(this==b){var d=a(this).parent();0!==d.length&&"BODY"!=d[0].tagName&&k.utils.isRedactorParent(d[0])&&i.push(d[0]),i.push(this),j=1}else j>0&&(i.push(this),j+=1);return this==c?!1:void 0});for(var l=[],m=i.length,n=0;m>n;n++)"nodes-marker-1"!=i[n].id&&"nodes-marker-2"!=i[n].id&&l.push(i[n]);return this.selection.removeNodesMarkers(),l},getNodesMarker:function(b){return a('<span id="nodes-marker-'+b+'" class="redactor-nodes-marker" data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},setNodesMarker:function(a,b,c){var a=a.cloneRange();try{a.collapse(c),a.insertNode(b)}catch(d){}},removeNodesMarkers:function(){a(document).find("span.redactor-nodes-marker").remove(),this.$editor.find("span.redactor-nodes-marker").remove()},fromPoint:function(a,b){this.caret.setOffset(a,b)},wrap:function(a){if(this.selection.get(),this.range.collapsed)return!1;var b=document.createElement(a);return b.appendChild(this.range.extractContents()),this.range.insertNode(b),b},selectElement:function(a){if(this.utils.browser("mozilla")){a=a[0]||a;var b=document.createRange();b.selectNodeContents(a)}else this.caret.set(a,0,a,1)},selectAll:function(){this.selection.get(),this.range.selectNodeContents(this.$editor[0]),this.selection.addRange()},remove:function(){this.selection.get(),this.sel.removeAllRanges()},save:function(){this.selection.createMarkers()},createMarkers:function(){this.selection.get();var a=this.selection.getMarker(1);if(this.selection.setMarker(this.range,a,!0),this.range.collapsed===!1){var b=this.selection.getMarker(2);this.selection.setMarker(this.range,b,!1)}this.savedSel=this.$editor.html()},getMarker:function(b){return"undefined"==typeof b&&(b=1),a('<span id="selection-marker-'+b+'" class="redactor-selection-marker"  data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},getMarkerAsHtml:function(a){return this.utils.getOuterHtml(this.selection.getMarker(a))},setMarker:function(a,b,c){a=a.cloneRange();try{a.collapse(c),a.insertNode(b)}catch(d){this.focus.setStart()}},restore:function(){var a=this.$editor.find("span#selection-marker-1"),b=this.$editor.find("span#selection-marker-2");this.utils.browser("mozilla")&&this.$editor.focus(),0!==a.length&&0!==b.length?this.caret.set(a,0,b,0):0!==a.length?this.caret.set(a,0,a,0):this.$editor.focus(),this.selection.removeMarkers(),this.savedSel=!1},removeMarkers:function(){this.$editor.find("span.redactor-selection-marker").each(function(b,c){var d=a(c).text().replace(/\u200B/g,"");""===d?a(c).remove():a(c).replaceWith(function(){return a(this).contents()})})},getText:function(){return this.selection.get(),this.sel.toString()},getHtml:function(){var a="";if(this.selection.get(),this.sel.rangeCount){for(var b=document.createElement("div"),c=this.sel.rangeCount,d=0;c>d;++d)b.appendChild(this.sel.getRangeAt(d).cloneContents());a=b.innerHTML}return this.clean.onSync(a)},replaceSelection:function(a){this.selection.get(),this.range.deleteContents();var b=document.createElement("div");b.innerHTML=a;for(var c,d=document.createDocumentFragment();c=b.firstChild;)d.appendChild(c);this.range.insertNode(d)},replaceWithHtml:function(a){a=this.selection.getMarkerAsHtml(1)+a+this.selection.getMarkerAsHtml(2),this.selection.get(),window.getSelection&&window.getSelection().getRangeAt?this.selection.replaceSelection(a):document.selection&&document.selection.createRange&&this.range.pasteHTML(a),this.selection.restore(),this.code.sync()}}},shortcuts:function(){return{init:function(b,c){return this.opts.shortcuts?void a.each(this.opts.shortcuts,a.proxy(function(c,d){for(var e=c.split(","),f=e.length,g=0;f>g;g++)"string"==typeof e[g]&&this.shortcuts.handler(b,a.trim(e[g]),a.proxy(function(){var a;"-1"!=d.func.search(/\./)?(a=d.func.split("."),"undefined"!=typeof this[a[0]]&&this[a[0]][a[1]].apply(this,d.params)):this[d.func].apply(this,d.params)},this))},this)):(!b.ctrlKey&&!b.metaKey||66!==c&&73!==c||b.preventDefault(),!1)},handler:function(b,c,d){var e={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},f={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"};c=c.toLowerCase().split(" ");var g=e[b.keyCode],h=String.fromCharCode(b.which).toLowerCase(),i="",j={};a.each(["alt","ctrl","meta","shift"],function(a,c){b[c+"Key"]&&g!==c&&(i+=c+"+")}),g&&(j[i+g]=!0),h&&(j[i+h]=!0,j[i+f[h]]=!0,"shift+"===i&&(j[f[h]]=!0));for(var k=0,l=c.length;l>k;k++)if(j[c[k]])return b.preventDefault(),d.apply(this,arguments)}}},tabifier:function(){return{get:function(a){if(!this.opts.tabifier)return a;var b=["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"],c=["li","dt","dt","h[1-6]","option","script"],d=["p","blockquote","div","dl","fieldset","form","frameset","map","ol","pre","select","td","th","tr","ul"];this.tabifier.lineBefore=new RegExp("^<(/?"+b.join("|/?")+"|"+c.join("|")+")[ >]"),this.tabifier.lineAfter=new RegExp("^<(br|/?"+b.join("|/?")+"|/"+c.join("|/")+")[ >]"),this.tabifier.newLevel=new RegExp("^</?("+d.join("|")+")[ >]");var e=0,f=a.length,g=0,h=null,i=null,j="",k="",l="";for(this.tabifier.cleanlevel=0;f>e;e++){if(g=e,-1==a.substr(e).indexOf("<"))return k+=a.substr(e),this.tabifier.finish(k);for(;f>g&&"<"!=a.charAt(g);)g++;for(e!=g&&(l=a.substr(e,g-e),l.match(/^\s{2,}$/g)||("\n"==k.charAt(k.length-1)?k+=this.tabifier.getTabs():"\n"==l.charAt(0)&&(k+="\n"+this.tabifier.getTabs(),l=l.replace(/^\s+/,"")),k+=l),l.match(/\n/)&&(k+="\n"+this.tabifier.getTabs())),h=g;f>g&&">"!=a.charAt(g);)g++;j=a.substr(h,g-h),e=g;var m;if("!--"==j.substr(1,3)){if(!j.match(/--$/)){for(;"-->"!=a.substr(g,3);)g++;g+=2,j=a.substr(h,g-h),e=g}"\n"!=k.charAt(k.length-1)&&(k+="\n"),k+=this.tabifier.getTabs(),k+=j+">\n"}else"!"==j[1]?k=this.tabifier.placeTag(j+">",k):"?"==j[1]?k+=j+">\n":(m=j.match(/^<(script|style|pre)/i))?(m[1]=m[1].toLowerCase(),j=this.tabifier.cleanTag(j),k=this.tabifier.placeTag(j,k),i=String(a.substr(e+1)).toLowerCase().indexOf("</"+m[1]),i&&(l=a.substr(e+1,i),e+=i,k+=l)):(j=this.tabifier.cleanTag(j),k=this.tabifier.placeTag(j,k))}return this.tabifier.finish(k)},getTabs:function(){for(var a="",b=0;b<this.tabifier.cleanlevel;b++)a+="	";return a},finish:function(a){return a=a.replace(/\n\s*\n/g,"\n"),a=a.replace(/^[\s\n]*/,""),a=a.replace(/[\s\n]*$/,""),a=a.replace(/<script(.*?)>\n<\/script>/gi,"<script$1></script>"),this.tabifier.cleanlevel=0,a},cleanTag:function(a){var b="";a=a.replace(/\n/g," "),a=a.replace(/\s{2,}/g," "),a=a.replace(/^\s+|\s+$/g," ");var c="";a.match(/\/$/)&&(c="/",a=a.replace(/\/+$/,""));for(var d;d=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(a);)d[2]?b+=d[1].toLowerCase()+"="+d[2]:d[1]&&(b+=d[1].toLowerCase()),b+=" ",a=a.substr(d[0].length);return b.replace(/\s*$/,"")+c+">"},placeTag:function(a,b){var c=a.match(this.tabifier.newLevel);return(a.match(this.tabifier.lineBefore)||c)&&(b=b.replace(/\s*$/,""),b+="\n"),c&&"/"==a.charAt(1)&&this.tabifier.cleanlevel--,"\n"==b.charAt(b.length-1)&&(b+=this.tabifier.getTabs()),c&&"/"!=a.charAt(1)&&this.tabifier.cleanlevel++,b+=a,(a.match(this.tabifier.lineAfter)||a.match(this.tabifier.newLevel))&&(b=b.replace(/ *$/,"")),b}}},tidy:function(){return{setupAllowed:function(){if(this.opts.allowedTags&&(this.opts.deniedTags=!1),this.opts.allowedAttr&&(this.opts.removeAttr=!1),!this.opts.linebreaks){var a=["p","section"];this.opts.allowedTags&&this.tidy.addToAllowed(a),this.opts.deniedTags&&this.tidy.removeFromDenied(a)}},addToAllowed:function(b){for(var c=b.length,d=0;c>d;d++)-1==a.inArray(b[d],this.opts.allowedTags)&&this.opts.allowedTags.push(b[d])},removeFromDenied:function(b){for(var c=b.length,d=0;c>d;d++){var e=a.inArray(b[d],this.opts.deniedTags);-1!=e&&this.opts.deniedTags.splice(e,1)}},load:function(b,c){return this.tidy.settings={deniedTags:this.opts.deniedTags,allowedTags:this.opts.allowedTags,removeComments:this.opts.removeComments,replaceTags:this.opts.replaceTags,replaceStyles:this.opts.replaceStyles,removeDataAttr:this.opts.removeDataAttr,removeAttr:this.opts.removeAttr,allowedAttr:this.opts.allowedAttr,removeWithoutAttr:this.opts.removeWithoutAttr,removeEmpty:this.opts.removeEmpty},a.extend(this.tidy.settings,c),b=this.tidy.removeComments(b),this.tidy.$div=a("<div />").append(b),this.tidy.replaceTags(),this.tidy.replaceStyles(),this.tidy.removeTags(),this.tidy.removeAttr(),this.tidy.removeEmpty(),this.tidy.removeParagraphsInLists(),this.tidy.removeDataAttr(),this.tidy.removeWithoutAttr(),b=this.tidy.$div.html(),this.tidy.$div.remove(),b},removeComments:function(a){return this.tidy.settings.removeComments?a.replace(/<!--[\s\S]*?-->/gi,""):a},replaceTags:function(b){if(!this.tidy.settings.replaceTags)return b;for(var c=this.tidy.settings.replaceTags.length,d=[],e=[],f=0;c>f;f++)e.push(this.tidy.settings.replaceTags[f][1]),d.push(this.tidy.settings.replaceTags[f][0]);a.each(d,a.proxy(function(b,c){this.tidy.$div.find(c).replaceWith(function(){return a("<"+e[b]+" />",{html:a(this).html()})})},this))},replaceStyles:function(){if(this.tidy.settings.replaceStyles){var b=this.tidy.settings.replaceStyles.length;this.tidy.$div.find("span").each(a.proxy(function(c,d){for(var e=a(d),f=e.attr("style"),g=0;b>g;g++)if(f&&f.match(new RegExp("^"+this.tidy.settings.replaceStyles[g][0],"i"))){var h=this.tidy.settings.replaceStyles[g][1];e.replaceWith(function(){var b=document.createElement(h);return a(b).append(a(this).contents())})}},this))}},removeTags:function(){!this.tidy.settings.deniedTags&&this.tidy.settings.allowedTags&&this.tidy.$div.find("*").not(this.tidy.settings.allowedTags.join(",")).each(function(b,c){""===c.innerHTML?a(c).remove():a(c).contents().unwrap()}),this.tidy.settings.deniedTags&&this.tidy.$div.find(this.tidy.settings.deniedTags.join(",")).each(function(b,c){a(c).hasClass("redactor-script-tag")||a(c).hasClass("redactor-selection-marker")||(""===c.innerHTML?a(c).remove():a(c).contents().unwrap())})},removeAttr:function(){var b;if(!this.tidy.settings.removeAttr&&this.tidy.settings.allowedAttr){var c=[],d=[];b=this.tidy.settings.allowedAttr.length;for(var e=0;b>e;e++)c.push(this.tidy.settings.allowedAttr[e][0]),d.push(this.tidy.settings.allowedAttr[e][1]);this.tidy.$div.find("*").each(a.proxy(function(b,e){var f=a(e),g=a.inArray(f[0].tagName.toLowerCase(),c),h=this.tidy.removeAttrGetRemoves(g,d,f);h&&a.each(h,function(a,b){f.removeAttr(b)})},this))}if(this.tidy.settings.removeAttr){b=this.tidy.settings.removeAttr.length;for(var e=0;b>e;e++){var f=this.tidy.settings.removeAttr[e][1];a.isArray(f)&&(f=f.join(" ")),this.tidy.$div.find(this.tidy.settings.removeAttr[e][0]).removeAttr(f)}}},removeAttrGetRemoves:function(b,c,d){var e=[];return-1==b?a.each(d[0].attributes,function(a,b){e.push(b.name)}):"*"==c[b]?e=[]:a.each(d[0].attributes,function(d,f){a.isArray(c[b])?-1==a.inArray(f.name,c[b])&&e.push(f.name):c[b]!=f.name&&e.push(f.name)}),e},removeAttrs:function(b,c){return c=new RegExp(c,"g"),b.each(function(){for(var b=a(this),d=this.attributes.length-1,e=d;e>=0;e--){var f=this.attributes[e];f&&f.specified&&f.name.search(c)>=0&&b.removeAttr(f.name)}})},removeEmpty:function(){this.tidy.settings.removeEmpty&&this.tidy.$div.find(this.tidy.settings.removeEmpty.join(",")).each(function(){var b=a(this),c=b.text();c=c.replace(/\u200B/g,""),c=c.replace(/&nbsp;/gi,""),c=c.replace(/\s/g,""),""===c&&0===b.children().length&&b.remove()})},removeParagraphsInLists:function(){this.tidy.$div.find("li p").contents().unwrap()},removeDataAttr:function(){if(this.tidy.settings.removeDataAttr){var b=this.tidy.settings.removeDataAttr;a.isArray(this.tidy.settings.removeDataAttr)&&(b=this.tidy.settings.removeDataAttr.join(",")),this.tidy.removeAttrs(this.tidy.$div.find(b),"^(data-)")}},removeWithoutAttr:function(){this.tidy.settings.removeWithoutAttr&&this.tidy.$div.find(this.tidy.settings.removeWithoutAttr.join(",")).each(function(){0===this.attributes.length&&a(this).contents().unwrap()})}}},toolbar:function(){return{init:function(){return{html:{title:this.lang.get("html"),func:"code.toggle"},formatting:{title:this.lang.get("formatting"),dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("header1"),func:"block.format"},h2:{title:this.lang.get("header2"),func:"block.format"},h3:{title:this.lang.get("header3"),func:"block.format"},h4:{title:this.lang.get("header4"),func:"block.format"},h5:{title:this.lang.get("header5"),func:"block.format"},h6:{title:this.lang.get("header6"),func:"block.format"}}},bold:{title:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline"),func:"inline.format"},unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease"},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase"},image:{title:this.lang.get("image"),func:"image.show"},file:{title:this.lang.get("file"),func:"file.show"},link:{title:this.lang.get("link"),dropdown:{link:{title:this.lang.get("link_insert"),func:"link.show",observe:{element:"a","in":{title:this.lang.get("link_edit")},out:{title:this.lang.get("link_insert")}}},unlink:{title:this.lang.get("unlink"),func:"link.unlink",observe:{element:"a",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},alignment:{title:this.lang.get("alignment"),dropdown:{left:{title:this.lang.get("align_left"),func:"alignment.left"},center:{title:this.lang.get("align_center"),func:"alignment.center"},right:{title:this.lang.get("align_right"),func:"alignment.right"},justify:{title:this.lang.get("align_justify"),func:"alignment.justify"}}},horizontalrule:{title:this.lang.get("horizontalrule"),func:"line.insert"}}},build:function(){this.toolbar.hideButtons(),this.toolbar.hideButtonsOnMobile(),this.toolbar.isButtonSourceNeeded(),0!==this.opts.buttons.length&&(this.$toolbar=this.toolbar.createContainer(),this.toolbar.setOverflow(),this.toolbar.append(),this.toolbar.setFormattingTags(),this.toolbar.loadButtons(),this.toolbar.setFixed(),this.opts.activeButtons&&this.$editor.on("mouseup.redactor keyup.redactor focus.redactor",a.proxy(this.observe.toolbar,this)))},createContainer:function(){return a("<ul>").addClass("redactor-toolbar").attr({id:"redactor-toolbar-"+this.uuid,role:"toolbar"})},setFormattingTags:function(){a.each(this.opts.toolbar.formatting.dropdown,a.proxy(function(b,c){-1==a.inArray(b,this.opts.formatting)&&delete this.opts.toolbar.formatting.dropdown[b]},this))},loadButtons:function(){a.each(this.opts.buttons,a.proxy(function(b,c){if(this.opts.toolbar[c]){var d=this.opts.toolbar[c];this.$toolbar.append(a("<li>").append(this.button.build(c,d)))}},this))},append:function(){this.opts.toolbarExternal?(this.$toolbar.addClass("redactor-toolbar-external"),a(this.opts.toolbarExternal).html(this.$toolbar)):this.$box.prepend(this.$toolbar)},setFixed:function(){this.utils.isDesktop()&&(this.opts.toolbarExternal||this.opts.toolbarFixed&&(this.toolbar.observeScroll(),a(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,a.proxy(this.toolbar.observeScroll,this))))},setOverflow:function(){this.utils.isMobile()&&this.opts.toolbarOverflow&&this.$toolbar.addClass("redactor-toolbar-overflow")},isButtonSourceNeeded:function(){if(!this.opts.source){var a=this.opts.buttons.indexOf("html");-1!==a&&this.opts.buttons.splice(a,1)}},hideButtons:function(){0!==this.opts.buttonsHide.length&&a.each(this.opts.buttonsHide,a.proxy(function(a,b){var c=this.opts.buttons.indexOf(b);this.opts.buttons.splice(c,1)},this))},hideButtonsOnMobile:function(){this.utils.isMobile()&&0!==this.opts.buttonsHideOnMobile.length&&a.each(this.opts.buttonsHideOnMobile,a.proxy(function(a,b){var c=this.opts.buttons.indexOf(b);this.opts.buttons.splice(c,1)},this))},observeScroll:function(){var b=a(this.opts.toolbarFixedTarget).scrollTop(),c=1;this.opts.toolbarFixedTarget===document&&(c=this.$box.offset().top),b+this.opts.toolbarFixedTopOffset>c?this.toolbar.observeScrollEnable(b,c):this.toolbar.observeScrollDisable()},observeScrollEnable:function(b,c){var d=this.opts.toolbarFixedTopOffset+b-c,e=0,f=c+this.$box.height()-32,g=this.$box.innerWidth();this.$toolbar.addClass("toolbar-fixed-box"),this.$toolbar.css({position:"absolute",width:g,top:d+"px",left:e}),b>f&&a(".redactor-dropdown-"+this.uuid+":visible").hide(),this.toolbar.setDropdownsFixed(),this.$toolbar.css("visibility",f>b?"visible":"hidden")},observeScrollDisable:function(){this.$toolbar.css({position:"relative",width:"auto",top:0,left:0,visibility:"visible"}),this.toolbar.unsetDropdownsFixed(),this.$toolbar.removeClass("toolbar-fixed-box")},setDropdownsFixed:function(){var b=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset,c="fixed";this.opts.toolbarFixedTarget!==document&&(b=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,c="absolute"),a(".redactor-dropdown-"+this.uuid).each(function(){a(this).css({position:c,top:b+"px"})})},unsetDropdownsFixed:function(){var b=this.$toolbar.innerHeight()+this.$toolbar.offset().top;a(".redactor-dropdown-"+this.uuid).each(function(){a(this).css({position:"absolute",top:b+"px"})})}}},upload:function(){return{init:function(b,c,d){this.upload.direct=!1,this.upload.callback=d,this.upload.url=c,this.upload.$el=a(b),this.upload.$droparea=a('<div id="redactor-droparea" />'),this.upload.$placeholdler=a('<div id="redactor-droparea-placeholder" />').text(this.lang.get("upload_label")),this.upload.$input=a('<input type="file" name="file" />'),this.upload.$placeholdler.append(this.upload.$input),this.upload.$droparea.append(this.upload.$placeholdler),this.upload.$el.append(this.upload.$droparea),this.upload.$droparea.off("redactor.upload"),this.upload.$input.off("redactor.upload"),this.upload.$droparea.on("dragover.redactor.upload",a.proxy(this.upload.onDrag,this)),this.upload.$droparea.on("dragleave.redactor.upload",a.proxy(this.upload.onDragLeave,this)),this.upload.$input.on("change.redactor.upload",a.proxy(function(a){a=a.originalEvent||a,this.upload.traverseFile(this.upload.$input[0].files[0],a)},this)),this.upload.$droparea.on("drop.redactor.upload",a.proxy(function(a){a.preventDefault(),this.upload.$droparea.removeClass("drag-hover").addClass("drag-drop"),this.upload.onDrop(a)},this))},directUpload:function(a,b){this.upload.direct=!0,this.upload.traverseFile(a,b)},onDrop:function(a){a=a.originalEvent||a;var b=a.dataTransfer.files;this.upload.traverseFile(b[0],a)},traverseFile:function(a,b){if(this.opts.s3)return this.upload.setConfig(a),void this.upload.s3uploadFile(a);var c=window.FormData?new FormData:null;if(window.FormData){this.upload.setConfig(a);var d="image"==this.upload.type?this.opts.imageUploadParam:this.opts.fileUploadParam;c.append(d,a)}this.progress.show(),this.core.setCallback("uploadStart",b,c),this.upload.sendData(c,b)},setConfig:function(a){this.upload.getType(a),this.upload.direct&&(this.upload.url="image"==this.upload.type?this.opts.imageUpload:this.opts.fileUpload,this.upload.callback="image"==this.upload.type?this.image.insert:this.file.insert)},getType:function(a){this.upload.type="image",-1==this.opts.imageTypes.indexOf(a.type)&&(this.upload.type="file")},getHiddenFields:function(b,c){return b===!1||"object"!=typeof b?c:(a.each(b,a.proxy(function(b,d){null!==d&&0===d.toString().indexOf("#")&&(d=a(d).val()),c.append(b,d)},this)),c)},sendData:function(b,c){"image"==this.upload.type?(b=this.upload.getHiddenFields(this.opts.uploadImageFields,b),b=this.upload.getHiddenFields(this.upload.imageFields,b)):(b=this.upload.getHiddenFields(this.opts.uploadFileFields,b),b=this.upload.getHiddenFields(this.upload.fileFields,b));var d=new XMLHttpRequest;d.open("POST",this.upload.url),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.onreadystatechange=a.proxy(function(){if(4==d.readyState){var b=d.responseText;b=b.replace(/^\[/,""),b=b.replace(/\]$/,"");var e;try{e="string"==typeof b?a.parseJSON(b):b}catch(f){e={error:!0}}this.progress.hide(),this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),this.upload.callback(e,this.upload.direct,c)}},this),d.send(b)},onDrag:function(a){a.preventDefault(),this.upload.$droparea.addClass("drag-hover")},onDragLeave:function(a){a.preventDefault(),this.upload.$droparea.removeClass("drag-hover")},clearImageFields:function(){this.upload.imageFields={}},addImageFields:function(a,b){this.upload.imageFields[a]=b},removeImageFields:function(a){delete this.upload.imageFields[a]},clearFileFields:function(){this.upload.fileFields={}},addFileFields:function(a,b){this.upload.fileFields[a]=b},removeFileFields:function(a){delete this.upload.fileFields[a]},s3uploadFile:function(b){this.upload.s3executeOnSignedUrl(b,a.proxy(function(a){this.upload.s3uploadToS3(b,a)},this))},s3executeOnSignedUrl:function(a,b){var c=new XMLHttpRequest,d="?";"-1"!=this.opts.s3.search(/\?/)&&(d="&"),c.open("GET",this.opts.s3+d+"name="+a.name+"&type="+a.type,!0),c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined");var e=this;c.onreadystatechange=function(a){4==this.readyState&&200==this.status?(e.progress.show(),b(decodeURIComponent(this.responseText))):4==this.readyState&&200!=this.status},c.send()},s3createCORSRequest:function(a,b){var c=new XMLHttpRequest;return"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=null,c},s3uploadToS3:function(b,c){var d=this.upload.s3createCORSRequest("PUT",c);d&&(d.onload=a.proxy(function(){if(200==d.status){this.progress.hide();var a=c.split("?");if(!a[0])return!1;this.upload.direct||this.upload.$droparea.removeClass("drag-drop");var b={filelink:a[0]};if("file"==this.upload.type){var e=a[0].split("/");b.filename=e[e.length-1]}this.upload.callback(b,this.upload.direct,!1)}},this),d.onerror=function(){},d.upload.onprogress=function(a){},d.setRequestHeader("Content-Type",b.type),d.setRequestHeader("x-amz-acl","public-read"),d.send(b))}}},utils:function(){return{isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isString:function(a){return"[object String]"==Object.prototype.toString.call(a)},isEmpty:function(b,c){return b=b.replace(/[\u200B-\u200D\uFEFF]/g,""),b=b.replace(/&nbsp;/gi,""),b=b.replace(/<\/?br\s?\/?>/g,""),b=b.replace(/\s/g,""),b=b.replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,""),b=b.replace(/<iframe(.*?[^>])>$/i,"iframe"),b=b.replace(/<source(.*?[^>])>$/i,"source"),c!==!1&&(b=b.replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),b=b.replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")),b=a.trim(b),""===b},normalize:function(a){return"undefined"==typeof a?0:parseInt(a.replace("px",""),10)},hexToRgb:function(a){if("undefined"!=typeof a){if(-1==a.search(/^#/))return a;var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return"rgb("+parseInt(c[1],16)+", "+parseInt(c[2],16)+", "+parseInt(c[3],16)+")"}},getOuterHtml:function(b){return a("<div>").append(a(b).eq(0).clone()).html()},getAlignmentElement:function(b){return-1!==a.inArray(b.tagName,this.opts.alignmentTags)?a(b):a(b).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0])},removeEmptyAttr:function(b,c){var d=a(b);return"undefined"==typeof d.attr(c)?!0:""===d.attr(c)?(d.removeAttr(c),!0):!1},removeEmpty:function(b,c){var d=a(a.parseHTML(c));if(d.find(".redactor-invisible-space").removeAttr("style").removeAttr("class"),0===d.find("hr, br, img, iframe, source").length){var e=a.trim(d.text());this.utils.isEmpty(e,!1)&&d.remove()}},saveScroll:function(){this.saveEditorScroll=this.$editor.scrollTop(),this.saveBodyScroll=a(window).scrollTop(),this.opts.scrollTarget&&(this.saveTargetScroll=a(this.opts.scrollTarget).scrollTop())},restoreScroll:function(){("undefined"!=typeof this.saveScroll||"undefined"!=typeof this.saveBodyScroll)&&(a(window).scrollTop(this.saveBodyScroll),this.$editor.scrollTop(this.saveEditorScroll),this.opts.scrollTarget&&a(this.opts.scrollTarget).scrollTop(this.saveTargetScroll))},createSpaceElement:function(){var a=document.createElement("span");return a.className="redactor-invisible-space",a.innerHTML=this.opts.invisibleSpace,a},removeInlineTags:function(b){var c=this.opts.inlineTags;c.push("span"),"PRE"==b.tagName&&c.push("a"),a(b).find(c.join(",")).not("span.redactor-selection-marker").contents().unwrap()},replaceWithContents:function(b,c){var d=this;return a(b).replaceWith(function(){return c===!0&&d.utils.removeInlineTags(this),a(this).contents()}),a(b)},replaceToTag:function(b,c,d){var e,f=this;return a(b).replaceWith(function(){e=a("<"+c+" />").append(a(this).contents());for(var b=0;b<this.attributes.length;b++)e.attr(this.attributes[b].name,this.attributes[b].value);return d===!0&&f.utils.removeInlineTags(e),e}),e},isStartOfElement:function(){var a=this.selection.getBlock();if(!a)return!1;var b=this.caret.getOffsetOfElement(a);return 0===b?!0:!1},isEndOfElement:function(b){if("undefined"==typeof b){var b=this.selection.getBlock();if(!b)return!1}var c=this.caret.getOffsetOfElement(b),d=a.trim(a(b).text()).replace(/\n\r\n/g,"");return c==d.length?!0:!1},isEndOfEditor:function(){var b=this.$editor[0],c=this.caret.getOffsetOfElement(b),d=a.trim(a(b).html().replace(/(<([^>]+)>)/gi,""));return c==d.length?!0:!1},isBlock:function(a){return a=a[0]||a,a&&this.utils.isBlockTag(a.tagName)},isBlockTag:function(a){return"undefined"==typeof a?!1:this.reIsBlock.test(a)},isTag:function(b,c){var d=a(b).closest(c,this.$editor[0]);return 1==d.length?d[0]:!1},isSelectAll:function(){
return this.selectAll},enableSelectAll:function(){this.selectAll=!0},disableSelectAll:function(){this.selectAll=!1},isRedactorParent:function(b){return b?0===a(b).parents(".redactor-editor").length||a(b).hasClass("redactor-editor")?!1:b:!1},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(b){var c=this.selection.getParent(),d=this.selection.getCurrent();if(a.isArray(b)){var e=0;return a.each(b,a.proxy(function(a,b){this.utils.isCurrentOrParentOne(d,c,b)&&e++},this)),0===e?!1:!0}return this.utils.isCurrentOrParentOne(d,c,b)},isCurrentOrParentOne:function(a,b,c){return c=c.toUpperCase(),b&&b.tagName===c?b:a&&a.tagName===c?a:!1},isOldIe:function(){return this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<9?!0:!1},isLessIe10:function(){return this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<10?!0:!1},isIe11:function(){return!!navigator.userAgent.match(/Trident\/7\./)},browser:function(a){var b=navigator.userAgent.toLowerCase(),c=/(opr)[\/]([\w.]+)/.exec(b)||/(chrome)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||b.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(b)||b.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[];return"safari"==a?"undefined"!=typeof c[3]?"safari"==c[3]:!1:"version"==a?c[2]:"webkit"==a?"chrome"==c[1]||"opr"==c[1]||"webkit"==c[1]:"rv"==c[1]?"msie"==a:"opr"==c[1]?"webkit"==a:a==c[1]},strpos:function(a,b,c){var d=a.indexOf(b,c);return d>=0?d:!1},disableBodyScroll:function(){var b=a("html"),c=window.innerWidth;if(!c){var d=document.documentElement.getBoundingClientRect();c=d.right-Math.abs(d.left)}var e=document.body.clientWidth<c,f=this.utils.measureScrollbar();b.css("overflow","hidden"),e&&b.css("padding-right",f)},measureScrollbar:function(){var b=a("body"),c=document.createElement("div");c.className="redactor-scrollbar-measure",b.append(c);var d=c.offsetWidth-c.clientWidth;return b[0].removeChild(c),d},enableBodyScroll:function(){a("html").css({overflow:"","padding-right":""}),a("body").remove("redactor-scrollbar-measure")}}}},a(window).on("load.tools.redactor",function(){a('[data-tools="redactor"]').redactor()}),b.prototype.init.prototype=b.prototype}(jQuery),!RedactorPlugins)var RedactorPlugins={};if(function(a){RedactorPlugins.fontcolor=function(){return{init:function(){for(var a=["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],b=["fontcolor","backcolor"],c=0;2>c;c++){var d=b[c],e=this.button.add(d,this.lang.get(d)),f=this.button.addDropdown(e);f.width(242),this.fontcolor.buildPicker(f,d,a)}this.button.setAwesome("fontcolor","fa fa-tint"),this.button.setAwesome("backcolor","fa fa-tint re-inverse");var g=this.button.get("backcolor");g.parent().addClass("ccm-inline-toolbar-inverse-cell")},buildPicker:function(b,c,d){for(var e="backcolor"==c?"background-color":"color",f=d.length,g=this,h=function(b){b.preventDefault(),g.fontcolor.set(a(this).data("rule"),a(this).attr("rel"))},i=0;f>i;i++){var j=d[i],k=a('<a rel="'+j+'" data-rule="'+e+'" href="#" style="float: left; font-size: 0; border: 2px solid #fff; padding: 0; margin: 0; width: 22px; height: 22px;"></a>');k.css("background-color",j),k.on("click",h),b.append(k)}var l=a('<a href="#" style="display: block; clear: both; padding: 5px; font-size: 12px; line-height: 1;"></a>').html(this.lang.get("none"));l.on("click",a.proxy(function(a){a.preventDefault(),this.fontcolor.remove(e)},this)),b.append(l)},set:function(a,b){this.inline.format("span","style",a+": "+b+";")},remove:function(a){this.inline.removeStyleRule(a)}}}}(jQuery),!RedactorPlugins)var RedactorPlugins={};if(function(a){RedactorPlugins.fontfamily=function(){return{init:function(){var b=["Arial","Helvetica","Georgia","Times New Roman","Monospace"],c=this,d={};a.each(b,function(a,b){d["s"+a]={title:b,func:function(){c.fontfamily.set(b)}}}),d.remove={title:this.lang.get("remove_font_family"),func:c.fontfamily.reset};var e=this.button.add("fontfamily",this.lang.get("change_font_family"));this.button.setAwesome("fontfamily","fa fa-font"),this.button.addDropdown(e,d)},set:function(a){this.inline.format("span","style","font-family:"+a+";")},reset:function(){this.inline.removeStyleRule("font-family")}}}}(jQuery),!RedactorPlugins)var RedactorPlugins={};if(function(a){RedactorPlugins.fontsize=function(){return{init:function(){var b=[10,11,12,14,16,18,20,24,28,30],c=this,d={};a.each(b,function(a,b){d["s"+a]={title:b+"px",func:function(){c.fontsize.set(b)}}}),d.remove={title:this.lang.get("remove_font_size"),func:c.fontsize.reset};var e=this.button.add("fontsize",this.lang.get("change_font_size"));this.button.setAwesome("fontsize","fa fa-text-height"),this.button.addDropdown(e,d)},set:function(a){this.inline.format("span","style","font-size: "+a+"px;")},reset:function(){this.inline.removeStyleRule("font-size")}}}}(jQuery),!RedactorPlugins)var RedactorPlugins={};if(function(a){RedactorPlugins.table=function(){return{getTemplate:function(){return String()+'<section id="redactor-modal-table-insert"><div class="form-group"><label class="control-label">'+this.lang.get("rows")+'</label><input type="text" size="5" value="2" class="form-control" id="redactor-table-rows" /></div><div class="form-group"><label class="control-label">'+this.lang.get("columns")+'</label><input type="text" size="5" value="3" class="form-control" id="redactor-table-columns" /></div></section>'},init:function(){var a={};a.insert_table={title:this.lang.get("insert_table"),func:this.table.show},a.insert_row_above={title:this.lang.get("insert_row_above"),func:this.table.addRowAbove},a.insert_row_below={title:this.lang.get("insert_row_below"),func:this.table.addRowBelow},a.insert_column_left={title:this.lang.get("insert_column_left"),func:this.table.addColumnLeft},a.insert_column_right={title:this.lang.get("insert_column_right"),func:this.table.addColumnRight},a.add_head={title:this.lang.get("add_head"),func:this.table.addHead},a.delete_head={title:this.lang.get("delete_head"),func:this.table.deleteHead},a.delete_column={title:this.lang.get("delete_column"),func:this.table.deleteColumn},a.delete_row={title:this.lang.get("delete_row"),func:this.table.deleteRow},a.delete_table={title:this.lang.get("delete_table"),func:this.table.deleteTable},this.observe.addButton("td","table"),this.observe.addButton("th","table");var b=this.button.addBefore("link","table",this.lang.get("table"));this.button.setAwesome("table","fa fa-table"),this.button.addDropdown(b,a)},show:function(){this.modal.addTemplate("table",this.table.getTemplate()),this.modal.load("table",this.lang.get("insert_table"),300),this.modal.createCancelButton();var b=this.modal.createActionButton(this.lang.get("insert"));b.on("click",this.table.insert),this.selection.save(),this.modal.show(),a("#redactor-table-rows").focus()},insert:function(){var b,c,d,e,f=a("#redactor-table-rows").val(),g=a("#redactor-table-columns").val(),h=a("<div>"),i=Math.floor(99999*Math.random()),j=a('<table id="table'+i+'"><tbody></tbody></table>');for(b=0;f>b;b++){for(c=a("<tr>"),d=0;g>d;d++)e=a("<td>"+this.opts.invisibleSpace+"</td>"),0===b&&0===d&&e.append(this.selection.getMarker()),a(c).append(e);j.append(c)}h.append(j);var k=h.html();if(this.modal.close(),this.selection.restore(),!this.table.getTable()){this.buffer.set();var l=this.selection.getBlock()||this.selection.getCurrent();l&&"BODY"!=l.tagName?("LI"==l.tagName&&(l=a(l).closest("ul, ol")),a(l).after(k)):this.insert.html(k),this.selection.restore();var m=this.$editor.find("#table"+i);if(!this.opts.linebreaks&&(this.utils.browser("mozilla")||this.utils.browser("msie"))){var n=m.next();0===n.length&&m.after(this.opts.emptyHtml)}this.observe.buttons(),m.find("span.redactor-selection-marker").remove(),m.removeAttr("id"),this.code.sync(),this.core.setCallback("insertedTable",m)}},getTable:function(){var b=a(this.selection.getParent()).closest("table");return this.utils.isRedactorParent(b)?0===b.size()?!1:b:!1},restoreAfterDelete:function(a){this.selection.restore(),a.find("span.redactor-selection-marker").remove(),this.code.sync()},deleteTable:function(){var a=this.table.getTable();if(a){this.buffer.set();var b=a.next();this.opts.linebreaks||0===b.length?this.caret.setAfter(a):this.caret.setStart(b),a.remove(),this.code.sync()}},deleteRow:function(){var b=this.table.getTable();if(b){var c=a(this.selection.getCurrent());this.buffer.set();var d=c.closest("tr"),e=d.prev().length?d.prev():d.next();if(e.length){var f=e.children("td, th").first();f.length&&f.prepend(this.selection.getMarker())}d.remove(),this.table.restoreAfterDelete(b)}},deleteColumn:function(){var b=this.table.getTable();if(b){this.buffer.set();var c=a(this.selection.getCurrent()),d=c.closest("td, th"),e=d[0].cellIndex;b.find("tr").each(a.proxy(function(b,c){var d=a(c),f=0>e-1?e+1:e-1;0===b&&d.find("td, th").eq(f).prepend(this.selection.getMarker()),d.find("td, th").eq(e).remove()},this)),this.table.restoreAfterDelete(b)}},addHead:function(){var b=this.table.getTable();if(b){if(this.buffer.set(),0!==b.find("thead").size())return void this.table.deleteHead();var c=b.find("tr").first().clone();c.find("td").replaceWith(a.proxy(function(){return a("<th>").html(this.opts.invisibleSpace)},this)),$thead=a("<thead></thead>").append(c),b.prepend($thead),this.code.sync()}},deleteHead:function(){var a=this.table.getTable();if(a){var b=a.find("thead");0!==b.size()&&(this.buffer.set(),b.remove(),this.code.sync())}},addRowAbove:function(){this.table.addRow("before")},addRowBelow:function(){this.table.addRow("after")},addColumnLeft:function(){this.table.addColumn("before")},addColumnRight:function(){this.table.addColumn("after")},addRow:function(b){var c=this.table.getTable();if(c){this.buffer.set();var d=a(this.selection.getCurrent()),e=d.closest("tr"),f=e.clone();f.find("th").replaceWith(function(){var b=a("<td>");return b[0].attributes=this.attributes,b.append(a(this).contents())}),f.find("td").html(this.opts.invisibleSpace),"after"==b?e.after(f):e.before(f),this.code.sync()}},addColumn:function(b){var c=this.table.getTable();if(c){var d=0,e=a(this.selection.getCurrent());this.buffer.set();var f=e.closest("tr"),g=e.closest("td, th");f.find("td, th").each(a.proxy(function(b,c){a(c)[0]===g[0]&&(d=b)},this)),c.find("tr").each(a.proxy(function(c,e){var f=a(e).find("td, th").eq(d),g=f.clone();g.html(this.opts.invisibleSpace),"after"==b?f.after(g):f.before(g)},this)),this.code.sync()}}}}}(jQuery),"undefined"==typeof RedactorPlugins)var RedactorPlugins={};if(RedactorPlugins.undoredo=function(){return{init:function(){var a=this.button.addFirst("undo",this.lang.get("undo")),b=this.button.addAfter("undo","redo",this.lang.get("redo"));this.button.setAwesome("undo","fa-undo"),this.button.setAwesome("redo","fa-undo fa-flip-horizontal"),this.button.addCallback(a,this.buffer.undo),this.button.addCallback(b,this.buffer.redo)}}},"undefined"==typeof RedactorPlugins)var RedactorPlugins={};if(RedactorPlugins.concrete5lightbox=function(){return{init:function(){this.opts.concrete5.lightbox=!0}}},"undefined"==typeof RedactorPlugins)var RedactorPlugins={};if(RedactorPlugins.underline=function(){return{init:function(){this.button.addAfter("italic","underline",this.lang.get("underline")),$btn=this.button.get("underline"),this.button.addCallback($btn,this.underline.format),this.button.setAwesome("underline","fa fa-underline")},format:function(a){var b=this.button.get("underline");b.hasClass("redactor-act")?this.inline.removeFormat("u"):this.inline.format("u")}}},"undefined"==typeof RedactorPlugins)var RedactorPlugins={};if(RedactorPlugins.concrete5inline=function(){return{init:function(){var a=this;this.$toolbar.addClass("ccm-inline-toolbar"),this.$toolbar.append($('<li class="ccm-inline-toolbar-button ccm-inline-toolbar-button-cancel"><button id="ccm-redactor-cancel-button" type="button" class="btn btn-mini">'+this.lang.get("cancel")+'</button></li><li class="ccm-inline-toolbar-button ccm-inline-toolbar-button-save"><button id="ccm-redactor-save-button" type="button" class="btn btn-primary btn-mini">'+this.lang.get("save")+"</button></li>"));var b=this.$toolbar;$("#ccm-redactor-cancel-button").unbind().on("click",function(){b.hide(),$("li#ccm-redactor-actions-buttons").hide(),ConcreteEvent.fire("EditModeExitInline"),a.core.destroy()}),$("#ccm-redactor-save-button").unbind().on("click",function(){$("#redactor-content").val(a.code.get()),b.hide(),ConcreteEvent.fire("EditModeBlockSaveInline")})}}},"undefined"==typeof RedactorPlugins)var RedactorPlugins={};if(RedactorPlugins.concrete5magic=function(){return{styles:[],createButton:function(a){if(!a)var a=[];var b;this.concrete5magic;this.button.remove("styles"),b=this.button.get("formatting").length?this.button.addAfter("formatting","styles",this.lang.get("customStyles"),!1,a):this.button.add("styles",this.lang.get("customStyles"),!1,a),this.button.setAwesome("styles","fa-magic"),this.button.addDropdown(b,a)},init:function(){var a=this.concrete5magic,b=this;$.ajax({type:"get",dataType:"json",url:CCM_DISPATCHER_FILENAME+"/ccm/system/backend/editor_data",data:{ccm_token:CCM_EDITOR_SECURITY_TOKEN,cID:CCM_CID},success:function(c){var d={};a.snippetsByHandle={},$.each(c.snippets,function(c,e){a.snippetsByHandle[e.scsHandle]={scsHandle:e.scsHandle,scsName:e.scsName},d[e.scsHandle]={title:e.scsName,func:function(c,d,e,f){var g=a.snippetsByHandle[c],h=String()+'<span class="ccm-content-editor-snippet" contenteditable="false" data-scsHandle="'+g.scsHandle+'">'+g.scsName+"</span>";b.insert.htmlWithoutClean(h)}}});b.button.get("styles");b.styles=c.classes,jQuery.each(c.classes,function(b,c){d["s"+b]={title:c.title,className:c.menuClass,func:function(){a.setCustomFormat(c)}}}),d.remove={title:b.lang.get("remove_style"),func:function(){a.resetCustomFormat()}},a.createButton(d)}}),a.createButton()},setCustomFormat:function(a){-1==a.forceBlock||1!=a.forceBlock&&(!a.wrap||jQuery.inArray(a.wrap,["a","em","strong","small","s","cite","q","dfn","abbr","data","time","var","samp","kbd","i","b","u","mark","ruby","rt","rp","bdi","bdo","span","sub","sup","code"])>-1)?(a.wrap&&this.inline.format(a.wrap),a.style&&this.block.setAttr("style",a.style),a.spanClass&&this.inline.toggleClass(a.spanClass)):(this.selection.wrap(a.wrap),a.style&&this.block.setAttr("style",a.style),a.spanClass&&this.block.setClass(a.spanClass))},resetCustomFormat:function(){var a=this;jQuery.each(this.styles,function(b,c){c.spanClass&&(a.inline.removeFormat(),a.block.removeClass(c.spanClass))})}}},!RedactorPlugins)var RedactorPlugins={};RedactorPlugins.specialcharacters=function(){return{entities:[["&nbsp;","&#160;",!0,"no-break space"],["&amp;","&#38;",!0,"ampersand"],["&quot;","&#34;",!0,"quotation mark"],["&cent;","&#162;",!0,"cent sign"],["&euro;","&#8364;",!0,"euro sign"],["&pound;","&#163;",!0,"pound sign"],["&yen;","&#165;",!0,"yen sign"],["&copy;","&#169;",!0,"copyright sign"],["&reg;","&#174;",!0,"registered sign"],["&trade;","&#8482;",!0,"trade mark sign"],["&permil;","&#8240;",!0,"per mille sign"],["&micro;","&#181;",!0,"micro sign"],["&middot;","&#183;",!0,"middle dot"],["&bull;","&#8226;",!0,"bullet"],["&hellip;","&#8230;",!0,"three dot leader"],["&prime;","&#8242;",!0,"minutes / feet"],["&Prime;","&#8243;",!0,"seconds / inches"],["&sect;","&#167;",!0,"section sign"],["&para;","&#182;",!0,"paragraph sign"],["&szlig;","&#223;",!0,"sharp s / ess-zed"],["&lsaquo;","&#8249;",!0,"single left-pointing angle quotation mark"],["&rsaquo;","&#8250;",!0,"single right-pointing angle quotation mark"],["&laquo;","&#171;",!0,"left pointing guillemet"],["&raquo;","&#187;",!0,"right pointing guillemet"],["&lsquo;","&#8216;",!0,"left single quotation mark"],["&rsquo;","&#8217;",!0,"right single quotation mark"],["&ldquo;","&#8220;",!0,"left double quotation mark"],["&rdquo;","&#8221;",!0,"right double quotation mark"],["&sbquo;","&#8218;",!0,"single low-9 quotation mark"],["&bdquo;","&#8222;",!0,"double low-9 quotation mark"],["&lt;","&#60;",!0,"less-than sign"],["&gt;","&#62;",!0,"greater-than sign"],["&le;","&#8804;",!0,"less-than or equal to"],["&ge;","&#8805;",!0,"greater-than or equal to"],["&ndash;","&#8211;",!0,"en dash"],["&mdash;","&#8212;",!0,"em dash"],["&macr;","&#175;",!0,"macron"],["&oline;","&#8254;",!0,"overline"],["&curren;","&#164;",!0,"currency sign"],["&brvbar;","&#166;",!0,"broken bar"],["&uml;","&#168;",!0,"diaeresis"],["&iexcl;","&#161;",!0,"inverted exclamation mark"],["&iquest;","&#191;",!0,"turned question mark"],["&circ;","&#710;",!0,"circumflex accent"],["&tilde;","&#732;",!0,"small tilde"],["&deg;","&#176;",!0,"degree sign"],["&minus;","&#8722;",!0,"minus sign"],["&plusmn;","&#177;",!0,"plus-minus sign"],["&divide;","&#247;",!0,"division sign"],["&frasl;","&#8260;",!0,"fraction slash"],["&times;","&#215;",!0,"multiplication sign"],["&sup1;","&#185;",!0,"superscript one"],["&sup2;","&#178;",!0,"superscript two"],["&sup3;","&#179;",!0,"superscript three"],["&frac14;","&#188;",!0,"fraction one quarter"],["&frac12;","&#189;",!0,"fraction one half"],["&frac34;","&#190;",!0,"fraction three quarters"],["&fnof;","&#402;",!0,"function / florin"],["&int;","&#8747;",!0,"integral"],["&sum;","&#8721;",!0,"n-ary sumation"],["&infin;","&#8734;",!0,"infinity"],["&radic;","&#8730;",!0,"square root"],["&sim;","&#8764;",!1,"similar to"],["&cong;","&#8773;",!1,"approximately equal to"],["&asymp;","&#8776;",!0,"almost equal to"],["&ne;","&#8800;",!0,"not equal to"],["&equiv;","&#8801;",!0,"identical to"],["&isin;","&#8712;",!1,"element of"],["&notin;","&#8713;",!1,"not an element of"],["&ni;","&#8715;",!1,"contains as member"],["&prod;","&#8719;",!0,"n-ary product"],["&and;","&#8743;",!1,"logical and"],["&or;","&#8744;",!1,"logical or"],["&not;","&#172;",!0,"not sign"],["&cap;","&#8745;",!0,"intersection"],["&cup;","&#8746;",!1,"union"],["&part;","&#8706;",!0,"partial differential"],["&forall;","&#8704;",!1,"for all"],["&exist;","&#8707;",!1,"there exists"],["&empty;","&#8709;",!1,"diameter"],["&nabla;","&#8711;",!1,"backward difference"],["&lowast;","&#8727;",!1,"asterisk operator"],["&prop;","&#8733;",!1,"proportional to"],["&ang;","&#8736;",!1,"angle"],["&acute;","&#180;",!0,"acute accent"],["&cedil;","&#184;",!0,"cedilla"],["&ordf;","&#170;",!0,"feminine ordinal indicator"],["&ordm;","&#186;",!0,"masculine ordinal indicator"],["&dagger;","&#8224;",!0,"dagger"],["&Dagger;","&#8225;",!0,"double dagger"],["&Agrave;","&#192;",!0,"A - grave"],["&Aacute;","&#193;",!0,"A - acute"],["&Acirc;","&#194;",!0,"A - circumflex"],["&Atilde;","&#195;",!0,"A - tilde"],["&Auml;","&#196;",!0,"A - diaeresis"],["&Aring;","&#197;",!0,"A - ring above"],["&AElig;","&#198;",!0,"ligature AE"],["&Ccedil;","&#199;",!0,"C - cedilla"],["&Egrave;","&#200;",!0,"E - grave"],["&Eacute;","&#201;",!0,"E - acute"],["&Ecirc;","&#202;",!0,"E - circumflex"],["&Euml;","&#203;",!0,"E - diaeresis"],["&Igrave;","&#204;",!0,"I - grave"],["&Iacute;","&#205;",!0,"I - acute"],["&Icirc;","&#206;",!0,"I - circumflex"],["&Iuml;","&#207;",!0,"I - diaeresis"],["&ETH;","&#208;",!0,"ETH"],["&Ntilde;","&#209;",!0,"N - tilde"],["&Ograve;","&#210;",!0,"O - grave"],["&Oacute;","&#211;",!0,"O - acute"],["&Ocirc;","&#212;",!0,"O - circumflex"],["&Otilde;","&#213;",!0,"O - tilde"],["&Ouml;","&#214;",!0,"O - diaeresis"],["&Oslash;","&#216;",!0,"O - slash"],["&OElig;","&#338;",!0,"ligature OE"],["&Scaron;","&#352;",!0,"S - caron"],["&Ugrave;","&#217;",!0,"U - grave"],["&Uacute;","&#218;",!0,"U - acute"],["&Ucirc;","&#219;",!0,"U - circumflex"],["&Uuml;","&#220;",!0,"U - diaeresis"],["&Yacute;","&#221;",!0,"Y - acute"],["&Yuml;","&#376;",!0,"Y - diaeresis"],["&THORN;","&#222;",!0,"THORN"],["&agrave;","&#224;",!0,"a - grave"],["&aacute;","&#225;",!0,"a - acute"],["&acirc;","&#226;",!0,"a - circumflex"],["&atilde;","&#227;",!0,"a - tilde"],["&auml;","&#228;",!0,"a - diaeresis"],["&aring;","&#229;",!0,"a - ring above"],["&aelig;","&#230;",!0,"ligature ae"],["&ccedil;","&#231;",!0,"c - cedilla"],["&egrave;","&#232;",!0,"e - grave"],["&eacute;","&#233;",!0,"e - acute"],["&ecirc;","&#234;",!0,"e - circumflex"],["&euml;","&#235;",!0,"e - diaeresis"],["&igrave;","&#236;",!0,"i - grave"],["&iacute;","&#237;",!0,"i - acute"],["&icirc;","&#238;",!0,"i - circumflex"],["&iuml;","&#239;",!0,"i - diaeresis"],["&eth;","&#240;",!0,"eth"],["&ntilde;","&#241;",!0,"n - tilde"],["&ograve;","&#242;",!0,"o - grave"],["&oacute;","&#243;",!0,"o - acute"],["&ocirc;","&#244;",!0,"o - circumflex"],["&otilde;","&#245;",!0,"o - tilde"],["&ouml;","&#246;",!0,"o - diaeresis"],["&oslash;","&#248;",!0,"o slash"],["&oelig;","&#339;",!0,"ligature oe"],["&scaron;","&#353;",!0,"s - caron"],["&ugrave;","&#249;",!0,"u - grave"],["&uacute;","&#250;",!0,"u - acute"],["&ucirc;","&#251;",!0,"u - circumflex"],["&uuml;","&#252;",!0,"u - diaeresis"],["&yacute;","&#253;",!0,"y - acute"],["&thorn;","&#254;",!0,"thorn"],["&yuml;","&#255;",!0,"y - diaeresis"],["&Alpha;","&#913;",!0,"Alpha"],["&Beta;","&#914;",!0,"Beta"],["&Gamma;","&#915;",!0,"Gamma"],["&Delta;","&#916;",!0,"Delta"],["&Epsilon;","&#917;",!0,"Epsilon"],["&Zeta;","&#918;",!0,"Zeta"],["&Eta;","&#919;",!0,"Eta"],["&Theta;","&#920;",!0,"Theta"],["&Iota;","&#921;",!0,"Iota"],["&Kappa;","&#922;",!0,"Kappa"],["&Lambda;","&#923;",!0,"Lambda"],["&Mu;","&#924;",!0,"Mu"],["&Nu;","&#925;",!0,"Nu"],["&Xi;","&#926;",!0,"Xi"],["&Omicron;","&#927;",!0,"Omicron"],["&Pi;","&#928;",!0,"Pi"],["&Rho;","&#929;",!0,"Rho"],["&Sigma;","&#931;",!0,"Sigma"],["&Tau;","&#932;",!0,"Tau"],["&Upsilon;","&#933;",!0,"Upsilon"],["&Phi;","&#934;",!0,"Phi"],["&Chi;","&#935;",!0,"Chi"],["&Psi;","&#936;",!0,"Psi"],["&Omega;","&#937;",!0,"Omega"],["&alpha;","&#945;",!0,"alpha"],["&beta;","&#946;",!0,"beta"],["&gamma;","&#947;",!0,"gamma"],["&delta;","&#948;",!0,"delta"],["&epsilon;","&#949;",!0,"epsilon"],["&zeta;","&#950;",!0,"zeta"],["&eta;","&#951;",!0,"eta"],["&theta;","&#952;",!0,"theta"],["&iota;","&#953;",!0,"iota"],["&kappa;","&#954;",!0,"kappa"],["&lambda;","&#955;",!0,"lambda"],["&mu;","&#956;",!0,"mu"],["&nu;","&#957;",!0,"nu"],["&xi;","&#958;",!0,"xi"],["&omicron;","&#959;",!0,"omicron"],["&pi;","&#960;",!0,"pi"],["&rho;","&#961;",!0,"rho"],["&sigmaf;","&#962;",!0,"final sigma"],["&sigma;","&#963;",!0,"sigma"],["&tau;","&#964;",!0,"tau"],["&upsilon;","&#965;",!0,"upsilon"],["&phi;","&#966;",!0,"phi"],["&chi;","&#967;",!0,"chi"],["&psi;","&#968;",!0,"psi"],["&omega;","&#969;",!0,"omega"],["&alefsym;","&#8501;",!1,"alef symbol"],["&piv;","&#982;",!1,"pi symbol"],["&real;","&#8476;",!1,"real part symbol"],["&thetasym;","&#977;",!1,"theta symbol"],["&upsih;","&#978;",!1,"upsilon - hook symbol"],["&weierp;","&#8472;",!1,"Weierstrass p"],["&image;","&#8465;",!1,"imaginary part"],["&larr;","&#8592;",!0,"leftwards arrow"],["&uarr;","&#8593;",!0,"upwards arrow"],["&rarr;","&#8594;",!0,"rightwards arrow"],["&darr;","&#8595;",!0,"downwards arrow"],["&harr;","&#8596;",!0,"left right arrow"],["&crarr;","&#8629;",!1,"carriage return"],["&lArr;","&#8656;",!1,"leftwards double arrow"],["&uArr;","&#8657;",!1,"upwards double arrow"],["&rArr;","&#8658;",!1,"rightwards double arrow"],["&dArr;","&#8659;",!1,"downwards double arrow"],["&hArr;","&#8660;",!1,"left right double arrow"],["&there4;","&#8756;",!1,"therefore"],["&sub;","&#8834;",!1,"subset of"],["&sup;","&#8835;",!1,"superset of"],["&nsub;","&#8836;",!1,"not a subset of"],["&sube;","&#8838;",!1,"subset of or equal to"],["&supe;","&#8839;",!1,"superset of or equal to"],["&oplus;","&#8853;",!1,"circled plus"],["&otimes;","&#8855;",!1,"circled times"],["&perp;","&#8869;",!1,"perpendicular"],["&sdot;","&#8901;",!1,"dot operator"],["&lceil;","&#8968;",!1,"left ceiling"],["&rceil;","&#8969;",!1,"right ceiling"],["&lfloor;","&#8970;",!1,"left floor"],["&rfloor;","&#8971;",!1,"right floor"],["&lang;","&#9001;",!1,"left-pointing angle bracket"],["&rang;","&#9002;",!1,"right-pointing angle bracket"],["&loz;","&#9674;",!0,"lozenge"],["&spades;","&#9824;",!1,"black spade suit"],["&clubs;","&#9827;",!0,"black club suit"],["&hearts;","&#9829;",!0,"black heart suit"],["&diams;","&#9830;",!0,"black diamond suit"],["&ensp;","&#8194;",!1,"en space"],["&emsp;","&#8195;",!1,"em space"],["&thinsp;","&#8201;",!1,"thin space"],["&zwnj;","&#8204;",!1,"zero width non-joiner"],["&zwj;","&#8205;",!1,"zero width joiner"],["&lrm;","&#8206;",!1,"left-to-right mark"],["&rlm;","&#8207;",!1,"right-to-left mark"],["&shy;","&#173;",!1,"soft hyphen"]],init:function(){var a=this.button.addAfter("horizontalrule","special-character-button",this.lang.get("insert_character"));this.button.setAwesome("special-character-button","fa-copyright"),this.button.addCallback(a,this.specialcharacters.show)},getTemplate:function(){var a=String()+'<section id="redactor-modal-advanced">';for(i=0;i<this.specialcharacters.entities.length;i++)this.specialcharacters.entities[i][2]&&(a+='<a class="re-icon-select" href="#" title="'+this.specialcharacters.entities[i][3]+'">'+this.specialcharacters.entities[i][1]+"</a> ");return a+="</section><style>.re-icon-select {font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif !important; color: black; text-decoration: none; font-size: 1.4em;  text-align: center; border: 1px solid #EEE; display: inline-block; width: 1em; margin-bottom: 0.2em; } .re-icon-select:hover {color: white; background-color: black}</style>"},show:function(){this.modal.addTemplate("specialcharacters",this.specialcharacters.getTemplate()),this.modal.load("specialcharacters",this.lang.get("insert_character"),500),this.modal.createCancelButton(),this.selection.save(),this.modal.show();var a=this.specialcharacters.insert;$(".re-icon-select").on("click",function(){return $(this).addClass("re-icon-selected"),a(),!1})},insert:function(){var a=$(".re-icon-selected").html();this.modal.close(),this.selection.restore(),this.insert.text(a),this.code.sync(),this.buffer.set()}}};

jQuery.Redactor.opts.langs["ja_JP"] = {
  html: "HTML",
  video: "\u30d3\u30c7\u30aa\u3092\u8ffd\u52a0",
  image: "\u753b\u50cf\u3092\u8ffd\u52a0",
  table: "\u30c6\u30fc\u30d6\u30eb",
  link: "\u30ea\u30f3\u30af",
  link_insert: "\u30ea\u30f3\u30af\u3092\u8ffd\u52a0",
  link_edit: "\u30ea\u30f3\u30af\u3092\u7de8\u96c6",
  unlink: "\u30ea\u30f3\u30af\u89e3\u9664",
  formatting: "\u30d5\u30a9\u30fc\u30de\u30c3\u30c8",
  paragraph: "\u901a\u5e38\u306e\u30c6\u30ad\u30b9\u30c8",
  quote: "\u5f15\u7528",
  code: "\u30b3\u30fc\u30c9",
  header1: "\u898b\u51fa\u30571",
  header2: "\u898b\u51fa\u30572",
  header3: "\u898b\u51fa\u30573",
  header4: "\u898b\u51fa\u30574",
  header5: "\u898b\u51fa\u30575",
  bold: "\u592a\u5b57",
  italic: "\u659c\u4f53",
  fontcolor: "\u30d5\u30a9\u30f3\u30c8\u8272",
  backcolor: "\u80cc\u666f\u8272",
  unorderedlist: "\u7b87\u6761\u66f8\u304d\u30ea\u30b9\u30c8",
  orderedlist: "\u756a\u53f7\u4ed8\u304d\u30ea\u30b9\u30c8",
  outdent: "\u30a4\u30f3\u30c7\u30f3\u30c8\u89e3\u9664",
  indent: "\u30a4\u30f3\u30c7\u30f3\u30c8",
  cancel: "\u30ad\u30e3\u30f3\u30bb\u30eb",
  insert: "\u633f\u5165",
  save: "\u4fdd\u5b58",
  _delete: "\u524a\u9664",
  insert_table: "\u30c6\u30fc\u30d6\u30eb\u3092\u633f\u5165",
  insert_row_above: "\u3053\u3053\u306e\u4e0a\u306b\u884c\u3092\u8ffd\u52a0",
  insert_row_below: "\u3053\u3053\u306e\u4e0b\u306b\u884c\u3092\u8ffd\u52a0",
  insert_column_left: "\u3053\u3053\u306e\u5de6\u306b\u5217\u3092\u8ffd\u52a0",
  insert_column_right: "\u3053\u3053\u306e\u53f3\u306b\u5217\u3092\u8ffd\u52a0",
  delete_column: "\u5217\u3092\u524a\u9664",
  delete_row: "\u884c\u3092\u524a\u9664",
  delete_table: "\u30c6\u30fc\u30d6\u30eb\u3092\u524a\u9664",
  rows: "\u884c",
  columns: "\u5217",
  add_head: "\u30d8\u30c3\u30c0\u3092\u8ffd\u52a0",
  delete_head: "\u30d8\u30c3\u30c0\u3092\u524a\u9664",
  title: "\u30bf\u30a4\u30c8\u30eb",
  image_position: "\u30dd\u30b8\u30b7\u30e7\u30f3",
  none: "\u306a\u3057",
  left: "\u5de6",
  right: "\u53f3",
  center: "\u4e2d\u592e\u5bc4\u305b",
  image_web_link: "\u753b\u50cfWeb\u30ea\u30f3\u30af",
  text: "\u30c6\u30ad\u30b9\u30c8",
  mailto: "E\u30e1\u30fc\u30eb",
  web: "URL",
  video_html_code: "\u52d5\u753b\u306e\u57cb\u3081\u8fbc\u307f\u30b3\u30fc\u30c9\u3001\u307e\u305f\u306f YouTube \/ Vimeo \u306e\u30ea\u30f3\u30af",
  file: "\u30d5\u30a1\u30a4\u30eb\u3092\u633f\u5165",
  upload: "\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9",
  download: "\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9",
  choose: "\u9078\u629e",
  or_choose: "\u3082\u3057\u304f\u306f\u9078\u629e",
  drop_file_here: "\u3053\u3053\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u30c9\u30ed\u30c3\u30d7",
  align_left: "\u30c6\u30ad\u30b9\u30c8\u3092\u5de6\u5bc4\u305b",
  align_center: "\u30c6\u30ad\u30b9\u30c8\u3092\u4e2d\u5bc4\u305b",
  align_right: "\u30c6\u30ad\u30b9\u30c8\u3092\u53f3\u5bc4\u305b",
  align_justify: "\u30c6\u30ad\u30b9\u30c8\u4e21\u63c3\u3048",
  horizontalrule: "\u6c34\u5e73\u7dda\u3092\u633f\u5165",
  deleted: "\u524a\u9664\u3055\u308c\u307e\u3057\u305f",
  anchor: "\u30a2\u30f3\u30ab\u30fc",
  open_link: "\u30ea\u30f3\u30af\u3092\u958b\u304f",
  link_new_tab: "\u30ea\u30f3\u30af\u3092\u65b0\u3057\u3044\u30bf\u30d6\u3067\u958b\u304f",
  /* concrete5 */
  link_same_window: "\u540c\u3058\u30a6\u30a3\u30f3\u30c9\u30a6\u3067\u30ea\u30f3\u30af\u3092\u958b\u304f",
  in_lightbox: "\u30e9\u30a4\u30c8\u30dc\u30c3\u30af\u30b9\u3067\u30ea\u30f3\u30af\u3092\u958b\u304f",
  lightbox_link_type: "\u30ea\u30f3\u30af\u30bf\u30a4\u30d7",
  lightbox_link_type_iframe: "\u30a6\u30a7\u30d6\u30da\u30fc\u30b8",
  lightbox_link_type_image: "\u753b\u50cf",
  lightbox_link_type_iframe_options: "\u30d5\u30ec\u30fc\u30e0\u30aa\u30d7\u30b7\u30e7\u30f3",
  lightbox_link_type_iframe_width: "\u5e45",
  lightbox_link_type_iframe_height: "\u9ad8\u3055",
  customStyles: "\u30ab\u30b9\u30bf\u30e0\u30b9\u30bf\u30a4\u30eb",
  remove_font: "\u30d5\u30a9\u30f3\u30c8\u3092\u53d6\u308a\u9664\u304f",
  change_font_family: "Change Font Family",
  remove_style: "\u30b9\u30bf\u30a4\u30eb\u3092\u9664\u304f",
  insert_character: "\u7279\u6b8a\u6587\u5b57\u306e\u633f\u5165",
  undo: "\u53d6\u308a\u6d88\u3059",
  redo: "\u3084\u308a\u76f4\u3057",
  remove_font_family: "Remove Font Family",
  remove_font_size: "Remove Font Size",
  change_font_size: "Change Font Size",
  /* end concrete5 */
  underline: "\u4e0b\u7dda",
  alignment: "\u4f4d\u7f6e\u5408\u308f\u305b",
  filename: "\u540d\u524d (\u30aa\u30d7\u30b7\u30e7\u30f3)",
  edit: "\u7de8\u96c6",
  upload_label: "\u30d5\u30a1\u30a4\u30eb\u3092\u3053\u3053\u306b\u30c9\u30ed\u30c3\u30d7"};

jQuery.Redactor.opts.lang = "ja_JP";
jQuery.each(jQuery.Redactor.opts.langs.en, function(key, value) {
  if(!(key in jQuery.Redactor.opts.langs["ja_JP"])) {
    jQuery.Redactor.opts.langs["ja_JP"][key] = value;
  }
});


